# Effect Ecosystem Integration | kriegcloud/beep-effect | DeepWiki

_Source: https://deepwiki.com/kriegcloud/beep-effect/2.2-effect-ecosystem-integration_

Relevant source files
*   [apps/web/src/app/api/auth/[...all]/route.ts](https://deepwiki.com/kriegcloud/beep-effect/apps/web/src/app/api/auth/%5B...all%5D/route.ts)
*   [docker-compose.yml](https://github.com/kriegcloud/beep-effect/blob/b64126f6/docker-compose.yml)
*   [packages/_internal/db-admin/src/Db.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/_internal/db-admin/src/Db.ts)
*   [packages/_internal/db-admin/test/pg-container.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/_internal/db-admin/test/pg-container.ts)
*   [packages/_internal/db-admin/tsconfig.test.json](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/_internal/db-admin/tsconfig.test.json)
*   [packages/common/constants/src/paths/asset-paths.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/common/constants/src/paths/asset-paths.ts)
*   [packages/common/constants/src/paths/generated/asset-paths.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/common/constants/src/paths/generated/asset-paths.ts)
*   [packages/core/db/src/index.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/core/db/src/index.ts)
*   [packages/core/db/src/types.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/core/db/src/types.ts)
*   [packages/files/infra/src/adapters/repos/_common.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/files/infra/src/adapters/repos/_common.ts)
*   [packages/files/infra/src/db/Db.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/files/infra/src/db/Db.ts)
*   [packages/iam/infra/src/adapters/better-auth/Auth.service.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts)
*   [packages/iam/infra/src/adapters/repos/_common.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/repos/_common.ts)
*   [packages/iam/infra/src/db/Db.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/db/Db.ts)
*   [packages/iam/sdk/package.json](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/sdk/package.json)
*   [packages/iam/sdk/src/clients/sign-in/sign-in.client.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/sdk/src/clients/sign-in/sign-in.client.ts)
*   [packages/iam/sdk/src/index.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/sdk/src/index.ts)
*   [packages/iam/ui/src/sign-up/sign-up.view.tsx](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/ui/src/sign-up/sign-up.view.tsx)
*   [packages/runtime/client/package.json](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/package.json)
*   [packages/runtime/client/src/services/runtime/live-layer.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts)
*   [packages/runtime/server/package.json](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/package.json)
*   [packages/runtime/server/src/server-runtime.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts)

Purpose and Scope
-----------------

This document explains how the Effect-TS library (`effect`) serves as the foundational functional programming infrastructure throughout the beep-effect codebase. It covers the Effect type system, Service pattern for dependency injection, Layer composition, ManagedRuntime execution, error handling patterns, and integration with external libraries. For database-specific Effect patterns, see [Database Layer](https://deepwiki.com/kriegcloud/beep-effect/4.1-database-layer). For runtime configuration details, see [Runtime and Service Composition](https://deepwiki.com/kriegcloud/beep-effect/4.2-runtime-and-service-composition).

Effect Type System Fundamentals
-------------------------------

The codebase uses Effect as its primary abstraction for computations that may fail or require context. The `Effect<A, E, R>` type represents a computation that:

*   Produces a success value of type `A`
*   May fail with error type `E`
*   Requires context/services of type `R`

**Effect Type Composition**

**Sources:**[packages/core/db/src/types.ts 1-37](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/core/db/src/types.ts#L1-L37)[packages/iam/infra/src/adapters/better-auth/Auth.service.ts 12-25](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L12-L25)

Service Definition Pattern
--------------------------

Services in Effect are defined using the `Effect.Service` decorator, which provides type-safe dependency injection and automatic accessor generation.

**Service Definition Structure**

**Sources:**[packages/iam/infra/src/db/Db.ts 1-22](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/db/Db.ts#L1-L22)[packages/files/infra/src/db/Db.ts 1-16](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/files/infra/src/db/Db.ts#L1-L16)

**Service Definition Example - IamDb**

The `IamDb.IamDb` service demonstrates the canonical service pattern:

[packages/iam/infra/src/db/Db.ts 8-21](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/db/Db.ts#L8-L21)

Key components:

*   `Effect.Service<IamDb>()` - Type-safe service definition
*   Service tag: `"@beep/iam-infra/IamDb"` - Unique identifier
*   `effect: factory.serviceEffect` - Construction Effect
*   `accessors: true` - Generates helper methods
*   `IamDb.Live` - Standard layer export
*   `IamDb.Default` - Default implementation

**Service with Dependencies - AuthService**

The `AuthService` shows how services declare dependencies:

[packages/iam/infra/src/adapters/better-auth/Auth.service.ts 241-249](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L241-L249)

The `dependencies` array specifies required services (`AuthEmailService`, `IamDb.IamDb.Live`) which Effect automatically provides when constructing the service.

**Sources:**[packages/iam/infra/src/adapters/better-auth/Auth.service.ts 241-249](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L241-L249)[packages/iam/infra/src/db/Db.ts 8-21](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/db/Db.ts#L8-L21)

Layer Composition and Dependency Injection
------------------------------------------

Effect's Layer system provides compile-time dependency injection by building service dependency graphs.

**Layer Composition Operations**

| Operation | Purpose | Example Usage |
| --- | --- | --- |
| `Layer.merge` | Combine multiple layers into one | `Layer.merge(LayerA, LayerB)` |
| `Layer.mergeAll` | Merge array of layers | `Layer.mergeAll(LoggerLive, TelemetryLive)` |
| `Layer.provide` | Provide dependencies to a layer | `Layer.provide(AppLayer, DbLayer)` |
| `Layer.provideMerge` | Merge and provide | `Layer.provideMerge(AppLayer, DbLayer)` |
| `Layer.unwrapEffect` | Create layer from Effect that produces layers | `Layer.unwrapEffect(Effect.gen(...))` |
| `Layer.scoped` | Manage resource lifecycle | `Layer.scoped(Service, Effect.acquireRelease(...))` |

**Server-Side Layer Dependency Graph**

**Sources:**[packages/runtime/server/src/server-runtime.ts 66-93](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L66-L93)

**Layer Composition Implementation**

The server runtime demonstrates layer composition patterns:

[packages/runtime/server/src/server-runtime.ts 66-93](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L66-L93)

Key patterns:

*   `Layer.mergeAll` - Combines independent layers (repositories, databases)
*   `Layer.provideMerge` - Provides dependencies while merging
*   Hierarchical composition - Layers build on each other (databases → repositories → services → app)

**Sources:**[packages/runtime/server/src/server-runtime.ts 66-93](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L66-L93)

Client Runtime Architecture
---------------------------

The client runtime provides browser-specific services with telemetry and HTTP client capabilities.

**Client Runtime Layer Stack**

**Sources:**[packages/runtime/client/src/services/runtime/live-layer.ts 1-146](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L1-L146)

**Client Runtime Implementation**

[packages/runtime/client/src/services/runtime/live-layer.ts 39-95](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L39-L95)

Key services:

*   `TelemetryLive` - OpenTelemetry WebSdk with batch processors for traces and logs
*   `LoggerLive` - Environment-based logger (pretty for dev, JSON for production)
*   `DevToolsLive` - Development tools via WebSocket (dev only)
*   `HttpClientLive` - Fetch-based HTTP client
*   `NetworkMonitorLive` - Browser connectivity monitoring
*   `WorkerClientLive` - Web Worker communication
*   `makeQueryClientLayer` - TanStack Query integration

**Sources:**[packages/runtime/client/src/services/runtime/live-layer.ts 23-95](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L23-L95)

Server Runtime Architecture
---------------------------

The server runtime orchestrates database connections, repositories, authentication, and telemetry services.

**Server Runtime Service Composition**

**Sources:**[packages/runtime/server/src/server-runtime.ts 1-123](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L1-L123)

**Server Runtime Construction**

[packages/runtime/server/src/server-runtime.ts 34-102](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L34-L102)

The server runtime follows a layered composition strategy:

1.   **Observability Layer** - Telemetry, logging, dev tools
2.   **Database Infrastructure** - PostgreSQL connections via `PgClient`
3.   **Domain Databases** - `IamDb` and `FilesDb` services
4.   **Repositories** - Domain-specific data access
5.   **Core Services** - Email, authentication
6.   **Application** - Composed from all services

The `ManagedRuntime` pattern provides resource lifecycle management, ensuring proper initialization and cleanup.

**Sources:**[packages/runtime/server/src/server-runtime.ts 34-102](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L34-L102)

Effect Execution Patterns
-------------------------

Effects are executed through runtime instances that provide all required services.

**Effect Execution Flow**

**Sources:**[packages/runtime/server/src/server-runtime.ts 99-123](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L99-L123)[packages/runtime/client/src/services/runtime/live-layer.ts 111-145](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L111-L145)

**Server Effect Execution Helpers**

[packages/runtime/server/src/server-runtime.ts 99-123](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L99-L123)

Key functions:

*   `runServerPromise` - Executes Effect and returns Promise, wraps in span
*   `runServerPromiseExit` - Returns full Exit value with detailed error info
*   `Effect.withSpan` - Adds telemetry span around execution

**Client Effect Execution Helpers**

[packages/runtime/client/src/services/runtime/live-layer.ts 111-145](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L111-L145)

Client-side provides similar helpers:

*   `runClientPromise` - Browser Effect execution
*   `runClientPromiseExit` - Exit value capture
*   `makeRunClientPromise` - Creates bound executor for reuse
*   `makeRunClientPromiseExit` - Creates bound exit executor

**Sources:**[packages/runtime/server/src/server-runtime.ts 99-123](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L99-L123)[packages/runtime/client/src/services/runtime/live-layer.ts 111-145](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L111-L145)

Effect.gen Pattern for Composition
----------------------------------

The `Effect.gen` pattern provides imperative-style composition of Effects using generator functions.

**Effect.gen Usage in AuthService**

[packages/iam/infra/src/adapters/better-auth/Auth.service.ts 27-36](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L27-L36)

The generator syntax allows:

*   `yield*` to extract values from Effects
*   Sequential composition that looks synchronous
*   Automatic error propagation
*   Type inference at each step

**Effect.gen in UI Components**

[packages/iam/ui/src/sign-up/sign-up.view.tsx 104-119](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/ui/src/sign-up/sign-up.view.tsx#L104-L119)

React components use `Effect.gen` to compose asynchronous operations:

*   Decode input values
*   Call service methods
*   Handle callbacks
*   Wrapped in runtime execution (`runSignUpEmail`)

**Sources:**[packages/iam/infra/src/adapters/better-auth/Auth.service.ts 27-36](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L27-L36)[packages/iam/ui/src/sign-up/sign-up.view.tsx 104-119](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/ui/src/sign-up/sign-up.view.tsx#L104-L119)

Error Handling Patterns
-----------------------

Effect provides type-safe error handling through the `E` type parameter and tagged errors.

**Effect Error Handling Operations**

| Pattern | Purpose | Example |
| --- | --- | --- |
| `Effect.tryPromise` | Convert Promise to Effect with error handling | `Effect.tryPromise({ try: ..., catch: ... })` |
| `Effect.catchAll` | Handle all errors | `Effect.catchAll(e => Effect.succeed(default))` |
| `Effect.catchTag` | Handle specific tagged error | `Effect.catchTag("DbError", handleDbError)` |
| `Data.TaggedError` | Create typed error class | `class MyError extends Data.TaggedError(...)` |
| `Effect.fail` | Explicitly fail with typed error | `Effect.fail(new MyError(...))` |
| `Effect.withSpan` | Add tracing span (records errors) | `Effect.withSpan(effect, "operation")` |

**Error Handling in PgContainer**

[packages/_internal/db-admin/test/pg-container.ts 29-37](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/_internal/db-admin/test/pg-container.ts#L29-L37)

[packages/_internal/db-admin/test/pg-container.ts 141-170](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/_internal/db-admin/test/pg-container.ts#L141-L170)

Error handling pattern:

1.   Define tagged error classes (`PgContainerError`, `PgContainerUnsupported`)
2.   Use `Effect.tryPromise` to wrap fallible operations
3.   Transform caught exceptions into typed errors
4.   Propagate errors through Effect chain

**Error Handling in Database Operations**

[packages/core/db/src/types.ts 22-36](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/core/db/src/types.ts#L22-L36)

Database operations return `Effect<T, DbError>` where `DbError` represents all database failures. The Effect type system ensures errors are handled or propagated explicitly.

**Sources:**[packages/_internal/db-admin/test/pg-container.ts 29-170](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/_internal/db-admin/test/pg-container.ts#L29-L170)[packages/core/db/src/types.ts 22-36](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/core/db/src/types.ts#L22-L36)

Integration with External Libraries
-----------------------------------

Effect integrates with external libraries by wrapping their APIs in Effect-based abstractions.

**Better-Auth Integration**

**Sources:**[packages/iam/infra/src/adapters/better-auth/Auth.service.ts 1-250](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L1-L250)

**Better-Auth Effect Bridge**

The `AuthService` bridges better-auth callbacks with Effect services:

[packages/iam/infra/src/adapters/better-auth/Auth.service.ts 27-36](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L27-L36)

Key integration points:

1.   Capture Effect runtime: `yield* Effect.runtime()`
2.   Create Promise executor: `Runtime.runPromise(runtime)`
3.   Use in callbacks: `await runPromise(Effect.gen(...))`
4.   Access Effect services: `yield* IamDb.IamDb`, `yield* AuthEmailService`

**Database Hooks Integration**

[packages/iam/infra/src/adapters/better-auth/Auth.service.ts 119-158](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L119-L158)

Database hooks execute Effects within better-auth callbacks:

*   Define Effect program using `Effect.gen`
*   Execute with `runPromise(program)`
*   Use database service (`db.insert`, `db.select`)
*   Add tracing with `Effect.withSpan`

**Sources:**[packages/iam/infra/src/adapters/better-auth/Auth.service.ts 27-158](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L27-L158)[packages/iam/infra/src/adapters/better-auth/Auth.service.ts 241-249](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L241-L249)

Drizzle ORM Integration
-----------------------

Drizzle ORM integration uses Effect's `ExecuteFn` pattern to wrap database queries.

**Database Query Execution Types**

[packages/core/db/src/types.ts 26-36](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/core/db/src/types.ts#L26-L36)

Key types:

*   `ExecuteFn<TFullSchema>` - Wraps Drizzle queries in Effects
*   `Transaction<TFullSchema>` - Transactional Effect execution
*   `TransactionClient` - Type-safe transaction scope
*   `MakeQuery` - Factory for reusable queries

The `ExecuteFn` takes a function receiving the Drizzle client and returns an `Effect<T, DbError>`, providing:

*   Automatic error handling and conversion to `DbError`
*   Transaction support
*   Type-safe schema access

**Sources:**[packages/core/db/src/types.ts 1-37](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/core/db/src/types.ts#L1-L37)

Testing with Effect
-------------------

Test infrastructure uses Effect for database setup and test data creation.

**Test Container Layer Composition**

[packages/_internal/db-admin/test/pg-container.ts 214-264](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/_internal/db-admin/test/pg-container.ts#L214-L264)

Testing pattern:

1.   Create container service with `Effect.Service` + `Effect.acquireRelease`
2.   Build layer hierarchy: Container → PgClient → Domain DBs → Repositories
3.   Use `Layer.unwrapEffect` for dynamic layer creation
4.   Compose with `Layer.provideMerge` and `Layer.provide`
5.   Add `Layer.orDie` to fail tests on setup errors

**Effect-based Test Data Seeding**

[packages/_internal/db-admin/test/pg-container.ts 217-235](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/_internal/db-admin/test/pg-container.ts#L217-L235)

Seed data creation:

*   Use `Effect.gen` for sequential operations
*   Access services via `yield*`
*   Use Effect Schema for encoding (`S.encode`)
*   Execute database operations via service methods

**Sources:**[packages/_internal/db-admin/test/pg-container.ts 214-264](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/_internal/db-admin/test/pg-container.ts#L214-L264)

Service Dependency Declaration
------------------------------

Services declare their dependencies through the `dependencies` array in the service definition.

**Repository Common Dependencies**

[packages/iam/infra/src/adapters/repos/_common.ts 1-3](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/repos/_common.ts#L1-L3)

[packages/files/infra/src/adapters/repos/_common.ts 1-3](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/files/infra/src/adapters/repos/_common.ts#L1-L3)

Pattern:

*   Export `dependencies` array as const
*   Import in repository implementations
*   Spread into service definition
*   Effect resolves dependency graph at compile time

This ensures:

*   Type-safe dependency requirements
*   Compile-time verification of provided services
*   Automatic service injection
*   Clear documentation of service relationships

**Sources:**[packages/iam/infra/src/adapters/repos/_common.ts 1-3](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/repos/_common.ts#L1-L3)[packages/files/infra/src/adapters/repos/_common.ts 1-3](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/files/infra/src/adapters/repos/_common.ts#L1-L3)

ManagedRuntime Pattern
----------------------

`ManagedRuntime` manages the lifecycle of service layers, ensuring proper resource initialization and cleanup.

**Runtime Initialization**

[packages/runtime/server/src/server-runtime.ts 99-102](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L99-L102)

The `ManagedRuntime.make` pattern:

1.   Takes a complete Layer as input
2.   Initializes all services
3.   Provides execution methods (`runPromise`, `runPromiseExit`)
4.   Manages resource lifecycle automatically
5.   Ensures cleanup on shutdown

**Runtime Type Safety**

[packages/runtime/client/src/services/runtime/live-layer.ts 104-110](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L104-L110)

Type aliases capture runtime capabilities:

*   `LiveManagedRuntime` - The runtime instance type
*   `LiveRuntimeContext` - Available service context
*   `ClientRuntimeEnv` - Service types provided
*   Used in helper function type signatures for type safety

**Sources:**[packages/runtime/server/src/server-runtime.ts 99-102](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L99-L102)[packages/runtime/client/src/services/runtime/live-layer.ts 104-110](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L104-L110)

Observability Integration
-------------------------

Effect integrates deeply with OpenTelemetry for distributed tracing and logging.

**Telemetry Configuration**

Client telemetry: [packages/runtime/client/src/services/runtime/live-layer.ts 39-43](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L39-L43)

Server telemetry: [packages/runtime/server/src/server-runtime.ts 36-43](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L36-L43)

Both use:

*   `WebSdk.layer`/`NodeSdk.layer` - OpenTelemetry SDK
*   `BatchSpanProcessor` - Batch trace exports
*   `BatchLogRecordProcessor` - Batch log exports
*   `OTLPTraceExporter` - OTLP trace endpoint
*   `OTLPLogExporter` - OTLP log endpoint

**Span Wrapping Pattern**

All runtime execution helpers wrap Effects with `Effect.withSpan`:

[packages/runtime/server/src/server-runtime.ts 109-113](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L109-L113)

This ensures:

*   Automatic span creation for each operation
*   Parent-child span relationships
*   Error recording in spans
*   Operation timing metrics
*   Distributed tracing across services

**Sources:**[packages/runtime/client/src/services/runtime/live-layer.ts 39-43](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L39-L43)[packages/runtime/server/src/server-runtime.ts 36-43](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L36-L43)[packages/runtime/server/src/server-runtime.ts 109-113](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L109-L113)
