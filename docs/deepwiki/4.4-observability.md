# Observability | kriegcloud/beep-effect | DeepWiki

_Source: https://deepwiki.com/kriegcloud/beep-effect/4.4-observability_

Relevant source files
*   [apps/web/next.config.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/apps/web/next.config.ts)
*   [apps/web/package.json](https://github.com/kriegcloud/beep-effect/blob/b64126f6/apps/web/package.json)
*   [apps/web/tsconfig.json](https://github.com/kriegcloud/beep-effect/blob/b64126f6/apps/web/tsconfig.json)
*   [apps/web/tsconfig.test.json](https://github.com/kriegcloud/beep-effect/blob/b64126f6/apps/web/tsconfig.test.json)
*   [docker-compose.yml](https://github.com/kriegcloud/beep-effect/blob/b64126f6/docker-compose.yml)
*   [package.json](https://github.com/kriegcloud/beep-effect/blob/b64126f6/package.json)
*   [packages/common/constants/src/paths/asset-paths.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/common/constants/src/paths/asset-paths.ts)
*   [packages/common/constants/src/paths/generated/asset-paths.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/common/constants/src/paths/generated/asset-paths.ts)
*   [packages/iam/infra/src/adapters/better-auth/Auth.service.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts)
*   [packages/iam/sdk/package.json](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/sdk/package.json)
*   [packages/iam/sdk/src/clients/sign-in/sign-in.client.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/sdk/src/clients/sign-in/sign-in.client.ts)
*   [packages/iam/sdk/src/index.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/sdk/src/index.ts)
*   [packages/iam/ui/src/sign-up/sign-up.view.tsx](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/ui/src/sign-up/sign-up.view.tsx)
*   [packages/runtime/client/package.json](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/package.json)
*   [packages/runtime/client/src/services/runtime/live-layer.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts)
*   [packages/runtime/server/package.json](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/package.json)
*   [packages/runtime/server/src/server-runtime.ts](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts)
*   [pnpm-lock.yaml](https://github.com/kriegcloud/beep-effect/blob/b64126f6/pnpm-lock.yaml)
*   [tsconfig.base.json](https://github.com/kriegcloud/beep-effect/blob/b64126f6/tsconfig.base.json)
*   [tsconfig.build.json](https://github.com/kriegcloud/beep-effect/blob/b64126f6/tsconfig.build.json)
*   [tsconfig.json](https://github.com/kriegcloud/beep-effect/blob/b64126f6/tsconfig.json)

The Observability system provides distributed tracing, structured logging, and metrics collection across both client and server applications using OpenTelemetry. This system enables monitoring, debugging, and performance analysis of the Effect-based runtime through standardized telemetry export to an OTLP collector.

For information about runtime service composition and dependency injection, see [Runtime and Service Composition](https://deepwiki.com/kriegcloud/beep-effect/4.2-runtime-and-service-composition).

* * *

Purpose and Scope
-----------------

This document covers the OpenTelemetry integration that instruments both client-side (browser) and server-side (Node.js) runtimes with:

*   **Distributed tracing**: Span creation, propagation, and export via OTLP
*   **Structured logging**: Log record processing and export with environment-specific formatting
*   **Development tooling**: Effect DevTools integration for local debugging
*   **Environment-specific configuration**: Debug vs production telemetry settings

The observability infrastructure is implemented as Effect Layers that compose with the runtime systems documented in sections [Client Runtime](https://deepwiki.com/kriegcloud/beep-effect/4.2.1-client-runtime) and [Server Runtime](https://deepwiki.com/kriegcloud/beep-effect/4.2.2-server-runtime).

* * *

Architecture Overview
---------------------

**Sources**: [packages/runtime/client/src/services/runtime/live-layer.ts 1-146](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L1-L146)[packages/runtime/server/src/server-runtime.ts 1-123](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L1-L123)[docker-compose.yml 23-31](https://github.com/kriegcloud/beep-effect/blob/b64126f6/docker-compose.yml#L23-L31)

* * *

Client-Side Observability
-------------------------

### TelemetryLive Layer

The client runtime uses `WebSdk.layer` from `@effect/opentelemetry` to configure browser-based telemetry export. The layer is constructed with OTLP HTTP exporters for both traces and logs.

| Component | Implementation | Purpose |
| --- | --- | --- |
| SDK | `WebSdk.layer` | Browser OpenTelemetry SDK configuration |
| Trace Export | `OTLPTraceExporter` | Exports spans via HTTP to OTLP endpoint |
| Log Export | `OTLPLogExporter` | Exports log records via HTTP to OTLP endpoint |
| Span Processing | `BatchSpanProcessor` | Batches spans before export for efficiency |
| Log Processing | `BatchLogRecordProcessor` | Batches log records before export |

The telemetry layer is created with environment-derived configuration:

[packages/runtime/client/src/services/runtime/live-layer.ts 39-43](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L39-L43)

```
export const TelemetryLive = WebSdk.layer(() => ({
  resource: { serviceName },
  spanProcessor: new BatchSpanProcessor(new OTLPTraceExporter({ url: otlpTraceExporterUrl })),
  logRecordProcessor: new BatchLogRecordProcessor(new OTLPLogExporter({ url: otlpLogExporterUrl })),
})).pipe(Layer.provideMerge(FetchHttpClient.layer));
```

**Environment Variables**:

*   `NEXT_PUBLIC_OTLP_TRACE_EXPORTER_URL`: Client trace export endpoint (default: `http://localhost:4318/v1/traces`)
*   `NEXT_PUBLIC_OTLP_LOG_EXPORTER_URL`: Client log export endpoint (default: `http://localhost:4318/v1/logs`)
*   `NEXT_PUBLIC_APP_NAME`: Service name for resource identification

**Sources**: [packages/runtime/client/src/services/runtime/live-layer.ts 24-43](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L24-L43)

### Logger Configuration

The client logger adapts based on the environment to provide appropriate log formatting:

[packages/runtime/client/src/services/runtime/live-layer.ts 46-49](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L46-L49)

```
export const LoggerLive = isDevEnvironment ? Logger.pretty : Logger.json;
export const LogLevelLive = Logger.minimumLogLevel(isDevEnvironment ? LogLevel.Debug : LogLevel.Info);
```

| Environment | Logger | Log Level | Purpose |
| --- | --- | --- | --- |
| Development | `Logger.pretty` | `LogLevel.Debug` | Human-readable console output |
| Production | `Logger.json` | `LogLevel.Info` | Structured JSON for log aggregation |

**Sources**: [packages/runtime/client/src/services/runtime/live-layer.ts 27-49](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L27-L49)

### DevTools Integration

Development environments enable the Effect DevTools for interactive debugging:

[packages/runtime/client/src/services/runtime/live-layer.ts 52-54](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L52-L54)

```
export const DevToolsLive = isDevEnvironment
  ? DevTools.layerWebSocket().pipe(Layer.provide(BrowserSocket.layerWebSocketConstructor))
  : Layer.empty;
```

The DevTools connect via WebSocket to provide real-time inspection of Effect execution, fiber state, and telemetry data. The connection is omitted in production builds via `Layer.empty`.

**Sources**: [packages/runtime/client/src/services/runtime/live-layer.ts 52-57](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L52-L57)

### ObservabilityLive Composition

The complete client observability stack merges all telemetry layers:

[packages/runtime/client/src/services/runtime/live-layer.ts 57](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L57-L57)

`export const ObservabilityLive = Layer.mergeAll(LoggerLive, TelemetryLive, DevToolsLive);`
This composite layer is provided to the client runtime via `createClientRuntimeLayer`:

[packages/runtime/client/src/services/runtime/live-layer.ts 88-95](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L88-L95)

**Sources**: [packages/runtime/client/src/services/runtime/live-layer.ts 57-95](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L57-L95)

* * *

Server-Side Observability
-------------------------

### TelemetryLive Layer

The server runtime uses `NodeSdk.layer` from `@effect/opentelemetry` to configure Node.js-based telemetry export with the same OTLP HTTP exporter pattern as the client:

[packages/runtime/server/src/server-runtime.ts 39-43](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L39-L43)

```
export const TelemetryLive = NodeSdk.layer(() => ({
  resource: { serviceName },
  spanProcessor: new BatchSpanProcessor(new OTLPTraceExporter({ url: otlpTraceExporterUrl })),
  logRecordProcessor: new BatchLogRecordProcessor(new OTLPLogExporter({ url: otlpLogExporterUrl })),
}));
```

**Environment Variables**:

*   `OTLP_TRACE_EXPORTER_URL`: Server trace export endpoint
*   `OTLP_LOG_EXPORTER_URL`: Server log export endpoint
*   `APP_NAME`: Service name for resource identification

The configuration mirrors the client implementation but targets the server-specific SDK and environment variables.

**Sources**: [packages/runtime/server/src/server-runtime.ts 27-43](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L27-L43)

### Logger Configuration

Server logging follows the same environment-conditional pattern:

[packages/runtime/server/src/server-runtime.ts 50-53](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L50-L53)

```
export const LoggerLive = isDevEnvironment ? makePrettyConsoleLoggerLayer() : Logger.json;
export const LogLevelLive = Logger.minimumLogLevel(isDevEnvironment ? LogLevel.Debug : LogLevel.Info);
```

The `makePrettyConsoleLoggerLayer` function provides enhanced terminal formatting with color-coding and structured output optimized for server logs.

**Sources**: [packages/runtime/server/src/server-runtime.ts 26-53](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L26-L53)

### DevTools Integration

Server DevTools use Node.js WebSocket infrastructure:

[packages/runtime/server/src/server-runtime.ts 58-60](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L58-L60)

```
export const DevToolsLive = isDevEnvironment
  ? DevTools.layerWebSocket().pipe(Layer.provide(NodeSocket.layerWebSocketConstructor))
  : Layer.empty;
```

**Sources**: [packages/runtime/server/src/server-runtime.ts 58-63](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L58-L63)

### ObservabilityLive Composition

The server observability stack composition:

[packages/runtime/server/src/server-runtime.ts 63](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L63-L63)

`export const ObservabilityLive = Layer.mergeAll(LoggerLive, TelemetryLive, DevToolsLive);`
This layer is provided to `serverRuntime` along with `LogLevelLive`:

[packages/runtime/server/src/server-runtime.ts 102](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L102-L102)

**Sources**: [packages/runtime/server/src/server-runtime.ts 63-102](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L63-L102)

* * *

Span Instrumentation
--------------------

### Automatic Span Creation

Effect operations are instrumented with spans using `Effect.withSpan`:

[packages/runtime/client/src/services/runtime/live-layer.ts 114-119](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L114-L119)

```
export const runClientPromise = <A, E>(
  runtime: LiveManagedRuntime,
  effect: Effect.Effect<A, E, ClientRuntimeEnv>,
  spanName = "clientRuntime.runPromise",
  options?: RunPromiseOptions
) => runtime.runPromise(Effect.withSpan(effect, spanName), options);
```

Similar patterns exist for server operations:

[packages/runtime/server/src/server-runtime.ts 109-113](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L109-L113)

```
export const runServerPromise = <A, E>(
  effect: Effect.Effect<A, E, ServerRuntimeEnv>,
  spanName = "serverRuntime.runPromise",
  options?: Parameters<typeof serverRuntime.runPromise>[1]
) => serverRuntime.runPromise(Effect.withSpan(effect, spanName), options);
```

### Application-Level Spans

Service methods throughout the codebase use `Effect.withSpan` to create named trace spans:

**Example from AuthService**: [packages/iam/infra/src/adapters/better-auth/Auth.service.ts 88](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L88-L88)

`.pipe(Effect.withSpan("AuthService.emailVerification.sendVerificationEmail"))`
[packages/iam/infra/src/adapters/better-auth/Auth.service.ts 103](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L103-L103)

`.pipe(Effect.withSpan("AuthService.emailAndPassword.sendResetPassword"))`
[packages/iam/infra/src/adapters/better-auth/Auth.service.ts 157](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L157-L157)

`.pipe(Effect.withSpan("AuthService.databaseHooks.user.create.after"))`
**Example from IAM SDK**: [packages/iam/ui/src/sign-up/sign-up.view.tsx 30](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/ui/src/sign-up/sign-up.view.tsx#L30-L30)

```
const runSignUpEmail = makeRunClientPromise(runtime, "iam.signUp.email");
const runSocialSignIn = makeRunClientPromise(runtime, "iam.signIn.social");
```

**Sources**: [packages/runtime/client/src/services/runtime/live-layer.ts 114-145](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L114-L145)[packages/runtime/server/src/server-runtime.ts 109-123](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L109-L123)[packages/iam/infra/src/adapters/better-auth/Auth.service.ts 88-157](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L88-L157)[packages/iam/ui/src/sign-up/sign-up.view.tsx 30-31](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/ui/src/sign-up/sign-up.view.tsx#L30-L31)

* * *

Tracing Flow
------------

**Sources**: [packages/runtime/client/src/services/runtime/live-layer.ts 39-119](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L39-L119)[packages/runtime/server/src/server-runtime.ts 39-113](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L39-L113)

* * *

OTLP Collector Configuration
----------------------------

The repository uses Grafana's LGTM (Loki, Grafana, Tempo, Mimir) stack for telemetry collection and visualization:

[docker-compose.yml 23-31](https://github.com/kriegcloud/beep-effect/blob/b64126f6/docker-compose.yml#L23-L31)

```
grafana:
  image: grafana/otel-lgtm:0.11.10
  container_name: grafana
  restart: unless-stopped
  ports:
    - "4000:3000"   # Grafana UI
    - "4318:4318"   # OTLP HTTP
  volumes:
    - ./docker/grafana/otelcol-config.yaml:/otel-lgtm/otelcol-config.yaml:ro
```

| Port | Service | Protocol | Purpose |
| --- | --- | --- | --- |
| 4000 | Grafana UI | HTTP | Web interface for querying traces/logs |
| 4318 | OTLP Receiver | HTTP | Trace and log ingestion endpoint |

### CSP Configuration

The Next.js application allows OTLP connections via Content Security Policy:

[apps/web/next.config.ts 9-36](https://github.com/kriegcloud/beep-effect/blob/b64126f6/apps/web/next.config.ts#L9-L36)

```
const otlpOrigin = process.env.NEXT_PUBLIC_OTLP_TRACE_EXPORTER_URL
  ? new URL(process.env.NEXT_PUBLIC_OTLP_TRACE_EXPORTER_URL).origin
  : undefined;

const CONNECT_SRC = Array.from(new Set([...CONNECT_SRC_BASE, ...otlpOrigins]));
```

The CSP `connect-src` directive includes the OTLP collector origin to permit telemetry export from the browser.

**Sources**: [docker-compose.yml 23-31](https://github.com/kriegcloud/beep-effect/blob/b64126f6/docker-compose.yml#L23-L31)[apps/web/next.config.ts 9-36](https://github.com/kriegcloud/beep-effect/blob/b64126f6/apps/web/next.config.ts#L9-L36)

* * *

Development vs Production Configuration
---------------------------------------

The observability system adapts its behavior based on the `env` value from environment configuration:

### Environment Detection

**Client**: [packages/runtime/client/src/services/runtime/live-layer.ts 27](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L27-L27)

`const isDevEnvironment = clientEnv.env === "dev";`
**Server**: [packages/runtime/server/src/server-runtime.ts 27](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L27-L27)

`const isDevEnvironment = serverEnv.app.env === "dev";`
### Configuration Matrix

| Feature | Development | Production |
| --- | --- | --- |
| Logger Format | `Logger.pretty` | `Logger.json` |
| Log Level | `LogLevel.Debug` | `LogLevel.Info` |
| DevTools | `DevTools.layerWebSocket()` | `Layer.empty` |
| Telemetry Debug | `debug: true` | `debug: false` |
| OTLP Export | Localhost:4318 | Configured endpoint |

### Telemetry Debug Mode

Debug telemetry is enabled when the server log level is `Debug` or `All`:

[packages/iam/infra/src/adapters/better-auth/Auth.service.ts 31](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L31-L31)

```
const isDebug = P.or(Equal.equals(LogLevel.Debug), Equal.equals(LogLevel.All))(serverEnv.app.logLevel);

return yield* Effect.succeed({
  telemetry: {
    debug: isDebug,
  },
  // ...
});
```

This debug flag affects Better Auth's internal telemetry verbosity, which also exports via the Effect telemetry system.

**Sources**: [packages/runtime/client/src/services/runtime/live-layer.ts 27-54](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L27-L54)[packages/runtime/server/src/server-runtime.ts 27-60](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L27-L60)[packages/iam/infra/src/adapters/better-auth/Auth.service.ts 31-38](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/iam/infra/src/adapters/better-auth/Auth.service.ts#L31-L38)

* * *

OpenTelemetry Dependencies
--------------------------

The observability system relies on the following OpenTelemetry packages, version-pinned via pnpm overrides:

| Package | Version | Purpose |
| --- | --- | --- |
| `@effect/opentelemetry` | ^0.58.0 | Effect integration with OpenTelemetry SDK |
| `@opentelemetry/api` | ^1.9.0 | OpenTelemetry core API types |
| `@opentelemetry/sdk-trace-base` | ^2.1.0 | Base tracing SDK types |
| `@opentelemetry/sdk-trace-node` | ^2.1.0 | Node.js tracing SDK |
| `@opentelemetry/sdk-trace-web` | ^2.1.0 | Browser tracing SDK |
| `@opentelemetry/sdk-metrics` | ^2.1.0 | Metrics SDK |
| `@opentelemetry/sdk-logs` | ^0.205.0 | Logs SDK |
| `@opentelemetry/exporter-trace-otlp-http` | ^0.205.0 | OTLP trace HTTP exporter |
| `@opentelemetry/exporter-logs-otlp-http` | ^0.205.0 | OTLP log HTTP exporter |
| `@opentelemetry/resources` | ^2.1.0 | Resource semantic conventions |

**Sources**: [package.json 84-108](https://github.com/kriegcloud/beep-effect/blob/b64126f6/package.json#L84-L108)[pnpm-lock.yaml 13-30](https://github.com/kriegcloud/beep-effect/blob/b64126f6/pnpm-lock.yaml#L13-L30)

* * *

Usage Patterns
--------------

### Creating Instrumented Effects

Client-side effects with telemetry:

```
import { makeRunClientPromise, useRuntime } from "@beep/runtime-client";
import * as Effect from "effect/Effect";

const runtime = useRuntime();
const runMyOperation = makeRunClientPromise(runtime, "myFeature.myOperation");

await runMyOperation(
  Effect.gen(function* () {
    // Effect operations automatically inherit the span context
    const result = yield* someEffect;
    return result;
  })
);
```

Server-side effects with telemetry:

```
import { runServerPromise } from "@beep/runtime-server";
import * as Effect from "effect/Effect";

await runServerPromise(
  Effect.gen(function* () {
    // Effect operations within this span
    const data = yield* fetchData;
    return data;
  }),
  "api.handler.myEndpoint"
);
```

### Custom Span Attributes

Add attributes to the current span context:

```
Effect.withSpan(
  Effect.gen(function* () {
    // Span is active for this scope
    yield* Effect.annotateCurrentSpan("userId", userId);
    yield* Effect.annotateCurrentSpan("requestId", requestId);

    const result = yield* processRequest;
    return result;
  }),
  "processRequest",
  { attributes: { "service.version": "1.0.0" } }
);
```

**Sources**: [packages/runtime/client/src/services/runtime/live-layer.ts 114-145](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L114-L145)[packages/runtime/server/src/server-runtime.ts 109-123](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L109-L123)

* * *

Integration Points
------------------

### Runtime Composition

Observability layers are composed into the runtime via `Layer.provide`:

**Client Runtime**: [packages/runtime/client/src/services/runtime/live-layer.ts 88-95](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L88-L95)

```
export const createClientRuntimeLayer: ClientRuntimeLive = (queryClient) =>
  Layer.mergeAll(
    HttpClientLive,
    ObservabilityLive,
    NetworkMonitorLive,
    WorkerClientLive,
    makeQueryClientLayer(queryClient)
  ).pipe(Layer.provide(LogLevelLive));
```

**Server Runtime**: [packages/runtime/server/src/server-runtime.ts 102](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L102-L102)

`export const serverRuntime = ManagedRuntime.make(AppLive.pipe(Layer.provide([ObservabilityLive, LogLevelLive])));`
### Service Dependencies

Services that require observability context declare it in their Effect type signature. The telemetry layer is provided transitively through the runtime composition.

**Sources**: [packages/runtime/client/src/services/runtime/live-layer.ts 88-95](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/client/src/services/runtime/live-layer.ts#L88-L95)[packages/runtime/server/src/server-runtime.ts 93-102](https://github.com/kriegcloud/beep-effect/blob/b64126f6/packages/runtime/server/src/server-runtime.ts#L93-L102)

* * *

Summary
-------

The Observability system provides comprehensive telemetry across client and server runtimes through:

1.   **Standardized Export**: OTLP HTTP protocol to Grafana LGTM stack
2.   **Environment Adaptation**: Debug-friendly logging in development, structured JSON in production
3.   **Effect Integration**: Automatic span context propagation through Effect operations
4.   **Development Tools**: Optional DevTools WebSocket connection for interactive debugging
5.   **Unified Configuration**: Environment-derived settings for endpoints, service names, and debug flags

The system enables distributed tracing of user actions from browser through API handlers to database operations, with all telemetry centralized in the OTLP collector for querying and visualization.
