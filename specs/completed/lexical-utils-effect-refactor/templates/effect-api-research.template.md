# Effect API Research: Lexical Utils Refactor

> Generated by mcp-researcher

---

## Summary

| API | Import | Primary Use Case | Verified |
|-----|--------|------------------|----------|
| Stream | effect/Stream | Async generator replacement | |
| HashSet | effect/HashSet | Native Set replacement | |
| String (Str) | effect/String | String methods | |
| Array (A) | effect/Array | Array methods | |
| Option (O) | effect/Option | Null handling | |
| Predicate (P) | effect/Predicate | Type guards | |
| Schema (S) | effect/Schema | JSON + regex | |

---

## effect/Stream

### Import

```typescript
import * as Stream from "effect/Stream";
```

### Key APIs

#### Stream.fromAsyncIterable

**Purpose**: Convert async iterable to Stream
**Signature**: [signature]
**Example**:
```typescript
[example code]
```

#### Stream.unfold

**Purpose**: Create stream from stateful computation
**Signature**: [signature]
**Example**:
```typescript
[example code]
```

#### Stream.runCollect

**Purpose**: Collect all stream elements
**Signature**: [signature]
**Example**:
```typescript
[example code]
```

### Gotchas

- [gotcha 1]
- [gotcha 2]

---

## effect/HashSet

### Import

```typescript
import * as HashSet from "effect/HashSet";
```

### Key APIs

#### HashSet.fromIterable

**Purpose**: Create HashSet from array
**Signature**: [signature]
**Example**:
```typescript
[example code]
```

#### HashSet.has

**Purpose**: Check membership
**Signature**: [signature]
**Example**:
```typescript
[example code]
```

### Gotchas

- [gotcha 1]

---

## effect/String (Str)

### Import

```typescript
import * as Str from "effect/String";
```

### Key APIs

| Method | Signature | Notes |
|--------|-----------|-------|
| Str.split | | |
| Str.toLowerCase | | |
| Str.toUpperCase | | |
| Str.slice | | |

### Gotchas

- [Does Str.split support regex?]

---

## effect/Array (A)

### Import

```typescript
import * as A from "effect/Array";
```

### Key APIs

| Method | Signature | Notes |
|--------|-----------|-------|
| A.map | | |
| A.filter | | |
| A.join | | |
| A.reduce | | |
| A.head | | Returns Option |
| A.fromIterable | | |

---

## effect/Option (O)

### Import

```typescript
import * as O from "effect/Option";
```

### Key APIs

| Method | Signature | Notes |
|--------|-----------|-------|
| O.fromNullable | | |
| O.map | | |
| O.flatMap | | |
| O.getOrElse | | |
| O.match | | |

---

## effect/Predicate (P)

### Import

```typescript
import * as P from "effect/Predicate";
```

### Key APIs

| Method | Use Case |
|--------|----------|
| P.isNotNull | null check |
| P.isNotUndefined | undefined check |
| P.isString | typeof replacement |
| P.isTruthy | Boolean filter |

---

## effect/Schema (S)

### Import

```typescript
import * as S from "effect/Schema";
```

### S.pattern()

**Purpose**: Create regex-validated string schema
**Example**:
```typescript
const UrlPattern = S.String.pipe(
  S.pattern(/regex/)
);
```

### S.decodeUnknownSync()

**Purpose**: Replace JSON.parse with validation
**Example**:
```typescript
const result = S.decodeUnknownSync(MySchema)(jsonString);
```

### S.parseJson()

**Purpose**: Combined JSON parse + decode
**Example**:
```typescript
[example]
```

---

## Transformation Mapping

| Native Pattern | Effect Replacement |
|----------------|-------------------|
| `string.split(delim)` | `Str.split(string, delim)` |
| `array.map(fn)` | `A.map(array, fn)` |
| `new Set([...])` | `HashSet.fromIterable([...])` |
| `set.has(x)` | `HashSet.has(set, x)` |
| `JSON.parse(str)` | `S.decodeUnknownSync(schema)(str)` |
| `if (x !== null)` | `O.fromNullable(x)` or `P.isNotNull(x)` |
| `async function` | `Effect.gen(function* () { ... })` |
