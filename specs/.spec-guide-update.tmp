## Orchestrator Delegation Rules

> **CRITICAL**: Orchestrators coordinate, they do NOT execute. All substantive work MUST be delegated to specialized sub-agents.

### Mandatory Delegation Matrix

| Task Type | Delegate To | Never Do Directly |
|-----------|-------------|-------------------|
| Code exploration (>3 files) | `codebase-researcher` | Sequential Glob/Read |
| Effect documentation lookup | `mcp-researcher` | Manual doc searching |
| Source code implementation | `effect-code-writer` | Writing .ts files |
| Test implementation | `test-writer` | Writing .test.ts files |
| Architecture validation | `architecture-pattern-enforcer` | Layer checks |
| Documentation writing | `doc-writer` | README/AGENTS.md files |
| Error fixing | `package-error-fixer` | Manual error resolution |

### Delegation Trigger Rules

An orchestrator MUST delegate when ANY of these conditions are met:
- Task requires reading more than 3 files
- Task requires more than 5 sequential tool calls
- Task involves generating source code
- Task involves generating test code
- Task requires broad codebase search

### Orchestrator Allowed Actions

Orchestrators MAY directly:
- Read 1-3 small files for quick context
- Make 1-5 tool calls for coordination
- Synthesize sub-agent outputs
- Create handoff documents
- Update REFLECTION_LOG.md

---

## Phase Sizing Constraints

### Hard Limits

| Metric | Maximum | Recommended |
|--------|---------|-------------|
| Work items per phase | 7 | 5-6 |
| Sub-agent delegations per phase | 10 | 6-8 |
| Direct orchestrator tool calls | 20 | 10-15 |
| Sessions per phase | 2 | 1 |

### Phase Split Triggers

A phase MUST be split into sub-phases (P[N]a, P[N]b) when:
- Phase has 8+ work items
- Phase has 3+ "Large" work items (6+ tool calls each)
- Estimated duration exceeds 2 sessions

---

### 11. Orchestrator Doing Research Directly

**Wrong**: Orchestrator performs sequential Glob/Read/Grep operations
```
[Orchestrator]
Let me find the service patterns...
[Glob: packages/iam/**/*.ts]
[Read: file1.ts]
[Read: file2.ts]
[Grep: "Effect.Service"]
[Read: file3.ts]
... (10+ tool calls, context consumed)
```

**Right**: Orchestrator delegates research to codebase-researcher
```
[Orchestrator]
I need to understand service patterns.
[Task: codebase-researcher]
"Find all Effect.Service definitions in packages/iam/ and summarize patterns"
(Agent returns summary, orchestrator continues with synthesized knowledge)
```

### 12. Unbounded Phase Sizes

**Wrong**: Phase defined by feature scope without size limits
```
Phase 2: Full Implementation
- Implement entity service
- Implement relation service
- Implement extraction pipeline
- Implement grounder
- Write all tests
- Add observability
- Create documentation
(7+ items = context exhaustion risk)
```

**Right**: Phase sized to context budget
```
Phase 2a: Core Services (5 items max)
- Entity service (delegate: effect-code-writer)
- Relation service (delegate: effect-code-writer)
- Core tests (delegate: test-writer)
- Verify builds
- Checkpoint handoff

Phase 2b: Pipeline & Extensions
- Extraction pipeline
- Grounder service
- Integration tests
- Observability
- Checkpoint handoff
```

### 13. Late Context Checkpoints

**Wrong**: Creating handoff after context stress
```
[... 50+ tool calls ...]
"Context is getting long, let me quickly create a handoff..."
(Rushed, incomplete handoff)
```

**Right**: Proactive checkpointing
```
[After 15-20 tool calls or completing 3 sub-tasks]
"Checkpoint: Creating interim handoff before continuing."
(Deliberate, comprehensive handoff)
```
