# IDE Configuration Conflict Matrix

> P1 Analysis - Rule File Consistency Check
> Generated: 2026-02-03

---

## Summary

| Metric | Value | Status |
|--------|-------|--------|
| Total source files (.claude/rules/) | 3 | ✓ |
| Total synced files (.cursor/rules/) | 3 | ⚠ Stale |
| Total symlinked files (.windsurf/rules/) | 0 | ✗ Missing |
| Files with critical content drift | 2 | ⚠ |
| Files with contradictions | 1 | ⚠ |

---

## Primary Conflict Matrix

| File | .claude/rules/ | .cursor/rules/ | .windsurf/rules/ | Issue |
|------|----------------|----------------|------------------|-------|
| **general** | ✓ (148 lines, 5.2KB) | ✓ (91 lines, 3.2KB) | ✗ Missing | **CRITICAL: 38% content loss** |
| **behavioral** | ✓ (50 lines, 1.8KB) | ✓ (55 lines, 2.0KB) | ✗ Missing | Minor - frontmatter overhead only |
| **effect-patterns** | ✓ (673 lines, 27KB) | ✓ (316 lines, 12KB) | ✗ Missing | **CRITICAL: 53% content loss** |

---

## Content Drift Analysis

### general.mdc (57 lines missing, 38% shorter)

**Missing Sections:**

| Section | Source Lines | Impact |
|---------|--------------|--------|
| Test Framework - MANDATORY | 52-75 (24 lines) | HIGH - Wrong test framework usage |
| Test File Organization | 77-90 (14 lines) | MEDIUM - Inconsistent test placement |
| Isolating Changes from Pre-existing Errors | 117-138 (22 lines) | MEDIUM - Debugging difficulty |

**Contradiction Found:**

| Topic | .claude Source | .cursor Version | Impact |
|-------|----------------|-----------------|--------|
| Test file location | `./test` directory mirroring `./src` | "adjacent to source files or `__tests__/`" | HIGH - Contradictory guidance |

### effect-patterns.mdc (357 lines missing, 53% shorter)

**Missing Sections:**

| Section | Source Lines | Impact |
|---------|--------------|--------|
| EntityId Usage (MANDATORY) | 125-258 (~125 lines) | **CRITICAL** - Type safety bypass |
| Testing (REQUIRED) | 585-655 (~130 lines) | HIGH - Wrong test patterns |
| Reference Documentation | 657-673 (17 lines) | LOW - Navigation only |

**Impact Assessment:**
- Developers using Cursor IDE will not receive mandatory guidance on branded EntityIds
- Table column `.$type<>()` requirements missing
- Test runner selection guidance missing

### behavioral.mdc (5 extra lines)

**Status:** No content loss. Extra lines are MDC frontmatter (expected).

---

## Symlink Status

| Location | Expected State | Actual State | Status |
|----------|----------------|--------------|--------|
| `.windsurf/rules/` | Symlink → `.claude/rules/` | Directory does not exist | ✗ MISSING |
| `.windsurf/skills/` | N/A | Directory exists (2 skills) | ✓ Present |

**Finding:** The `.windsurf/` directory exists but contains only `skills/`, not `rules/`.

---

## Sync Script Analysis

**Location:** `scripts/sync-cursor-rules.ts`

| Capability | Status | Notes |
|------------|--------|-------|
| Transform .md → .mdc | ✓ | Working |
| Add frontmatter | ✓ | Working |
| Transform paths → globs | ✓ | Working |
| **Content validation** | ✗ | Not implemented |
| **Stale detection** | ✗ | Not implemented |
| **Line count verification** | ✗ | Not implemented |

**Root Cause:** Cursor MDC files appear to have been manually edited or generated by an older version of the sync script.

---

## Recommended Fixes (Prioritized)

### P0: CRITICAL - Re-sync Cursor Rules

**Issue:** 38-53% content loss in Cursor MDC files

**Fix:**
```bash
bun run scripts/sync-cursor-rules.ts
```

**Verification:**
```bash
# Compare line counts (MDC should be ~3-5 lines longer due to frontmatter)
wc -l .claude/rules/*.md .cursor/rules/*.mdc

# Expected results:
# general.md: 148 → general.mdc: ~152
# behavioral.md: 50 → behavioral.mdc: ~55
# effect-patterns.md: 673 → effect-patterns.mdc: ~677
```

### P1: Create Windsurf Symlink

**Issue:** `.windsurf/rules/` does not exist

**Fix:**
```bash
ln -s ../.claude/rules .windsurf/rules
```

**Verification:**
```bash
ls -la .windsurf/rules  # Should show: rules -> ../.claude/rules
```

### P2: Harden Sync Script

**Issue:** No safeguards against content drift

**Recommended Enhancements:**

1. Add line count validation after transformation
2. Add `syncedAt` timestamp to frontmatter
3. Add source content hash for drift detection
4. Add CI check to verify freshness

---

## Content Verification Checklist

After fixes applied, verify:

| Check | Command | Expected Result |
|-------|---------|-----------------|
| Line count parity | `wc -l .claude/rules/*.md .cursor/rules/*.mdc` | MDC files ~3-5 lines longer |
| Content match | `diff <(tail -n +5 .cursor/rules/general.mdc) .claude/rules/general.md` | Empty (no differences) |
| Windsurf symlink | `ls -la .windsurf/rules` | Shows symlink to .claude/rules |
| Symlink content | `cat .windsurf/rules/general.md` | Displays Claude source content |

---

## Long-term Maintenance Strategy

| IDE | Source | Sync Strategy | Maintenance |
|-----|--------|---------------|-------------|
| Claude Code | `.claude/rules/*.md` | N/A (authoritative) | Manual edits |
| Cursor | `.cursor/rules/*.mdc` | Run sync script | Automated via script |
| Windsurf | `.windsurf/rules/` | Symlink | Zero maintenance |

**Key Principle:** Never manually edit `.cursor/rules/*.mdc` - they are generated artifacts.
