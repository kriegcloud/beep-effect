# Skill Memory: lexical-migration

> Auto-generated by SpecWeave Reflect v4.0
> Last updated: 2026-01-27
> Project: beep-effect2/lexical-playground-port

## Learned Patterns

### LRN-20260127-P11A1 (observation, high)
**Content**: Always check existing globals.css before adding CSS variables - projects may already have themed OKLCH variables that should be preserved rather than overwritten with generic defaults.
**Context**: P11-A discovered globals.css already had intentional teal-themed OKLCH variables
**Triggers**: css, variables, globals, theme, oklch
**Added**: 2026-01-27
**Source**: session:P11-A

### LRN-20260127-P11A2 (observation, high)
**Content**: shadcn-editor theme migration reduces CSS significantly (~25%) by replacing verbose CSS with Tailwind classes in editor-theme.ts while keeping only Lexical-required classes (syntax highlighting, tables, checkboxes) in editor-theme.css.
**Context**: Theme file creation reduced 800 lines to 599 lines
**Triggers**: theme, css, tailwind, lexical, migration
**Added**: 2026-01-27
**Source**: session:P11-A

### LRN-20260127-P11A3 (rule, high)
**Content**: When migrating to shadcn-native Lexical, combine legacy ToolbarContext (state management) with new activeEditor pattern (nested editor support) in a unified context provider for cleaner architecture.
**Context**: Toolbar context migration combined both patterns successfully
**Triggers**: toolbar, context, lexical, shadcn, state
**Added**: 2026-01-27
**Source**: session:P11-A

### LRN-20260127-P11A4 (rule, high)
**Content**: For P11 orchestration, spawn parallel sub-agents for independent foundation tasks (theme files, hooks, context) - they don't have dependencies and can run concurrently for faster execution.
**Context**: 4 parallel agents completed foundation tasks efficiently
**Triggers**: orchestrator, parallel, agents, foundation
**Added**: 2026-01-27
**Source**: session:P11-A

### LRN-20260127-P11A5 (correction, medium)
**Content**: After type-checking new files, watch for: (1) unused @ts-expect-error directives that are no longer needed, (2) unused variables from copied/adapted code - prefix with underscore if intentionally unused.
**Context**: Two minor type errors found and fixed in verification
**Triggers**: typescript, verification, ts-expect-error, unused
**Added**: 2026-01-27
**Source**: session:P11-A

### LRN-20260127-P11A6 (observation, medium)
**Content**: shadcn-editor uses es-toolkit/debounce instead of lodash - prefer es-toolkit when adapting hooks as it's already a project dependency with smaller bundle size.
**Context**: Hooks agent chose es-toolkit over lodash for debounce utility
**Triggers**: debounce, lodash, es-toolkit, hooks
**Added**: 2026-01-27
**Source**: session:P11-A

### LRN-20260127-P11B1 (rule, high)
**Content**: Don't wholesale copy shadcn-editor plugins to replace existing Lexical plugins - existing plugins work fine and are more mature. The main value of shadcn-editor is UI component patterns, not plugin logic.
**Context**: Research showed existing plugins had more features than shadcn versions
**Triggers**: plugins, copy, shadcn-editor, migration, lexical
**Added**: 2026-01-27
**Source**: session:P11-B

### LRN-20260127-P11B2 (correction, high)
**Content**: Use `asChild` pattern for shadcn DropdownMenuTrigger - NEVER use custom `render` props. The shadcn/Radix UI pattern requires Button as direct child with asChild prop, not a render function.
**Context**: Fixed 12 instances across 5 files that used incorrect render prop pattern
**Triggers**: dropdown, asChild, render, shadcn, radix, trigger
**Added**: 2026-01-27
**Source**: session:P11-B

### LRN-20260127-P11B3 (rule, high)
**Content**: @lexical/headless has nested lexical dependency causing type incompatibility. Use `as any` cast for nodes array when creating headless editor: `nodes: [...PlaygroundNodes] as any`.
**Context**: Type error in validation.ts due to different lexical version in headless package
**Triggers**: lexical, headless, nodes, type, cast, validation
**Added**: 2026-01-27
**Source**: session:P11-B

### LRN-20260127-P11B4 (rule, high)
**Content**: Preserve existing custom nodes that have superior features over shadcn-editor versions. ImageNode (figure/figcaption support), MentionNode (exportDOM), custom nodes (DateTimeNode, PollNode, etc.) should be kept.
**Context**: Comparison showed existing nodes had more mature implementations
**Triggers**: nodes, custom, preserve, image, mention, features
**Added**: 2026-01-27
**Source**: session:P11-B

### LRN-20260127-P11B5 (rule, medium)
**Content**: When updating Lexical nodes, always add explicit `type` and `version` properties to exportJSON return value for serialization compatibility. Pattern: `return { ...super.exportJSON(), type: 'node-type', version: 1, ...customProps }`.
**Context**: Updated 8 nodes to have explicit exportJSON with type/version
**Triggers**: exportJSON, nodes, serialization, type, version
**Added**: 2026-01-27
**Source**: session:P11-B

### LRN-20260127-P11C1 (rule, high)
**Content**: When modularizing a large component like ToolbarPlugin (1383 lines), extract in dependency order - least coupled components first (UndoRedo, TextFormat) before more complex ones (FontControls, AdvancedText).
**Context**: Phase 1 extracted 3 simple components, Phase 2 extracted 2 medium-complexity components
**Triggers**: toolbar, modularization, extraction, order, dependencies
**Added**: 2026-01-27
**Source**: session:P11-C

### LRN-20260127-P11C2 (rule, high)
**Content**: Keep state management centralized in parent component when modularizing - extracted components should only handle presentation and dispatch commands. Use context hooks (useToolbarState) for read access, props for callbacks.
**Context**: Toolbar state stays in ToolbarPlugin, components read via context
**Triggers**: state, centralized, context, modularization, parent
**Added**: 2026-01-27
**Source**: session:P11-C

### LRN-20260127-P11C3 (rule, medium)
**Content**: Complex inline components like BlockFormatDropDown, ElementFormatDropdown, and InsertContentMenu should remain inline until a dedicated refactoring phase - they have high coupling with modal systems and conditional rendering.
**Context**: Analysis identified these as "Phase 3" candidates requiring more careful extraction
**Triggers**: inline, complex, dropdown, insert, modal, coupling
**Added**: 2026-01-27
**Source**: session:P11-C

### LRN-20260127-P11C4 (observation, high)
**Content**: Parallel sub-agent extraction works efficiently for independent toolbar components - spawn multiple agents when components have no dependencies on each other (Phase 1: 3 parallel, Phase 2: 2 parallel).
**Context**: Both extraction phases completed quickly with parallel agent execution
**Triggers**: parallel, agents, extraction, components, independent
**Added**: 2026-01-27
**Source**: session:P11-C

### LRN-20260127-P11C5 (observation, medium)
**Content**: Toolbar modularization reduced render section from ~500 lines to ~200 lines (60% reduction) while keeping all business logic intact - state management, $updateToolbar, and complex dropdowns remain in parent.
**Context**: Final composition integrated 5 extracted components into cleaner ToolbarPlugin
**Triggers**: toolbar, render, reduction, modularization, lines
**Added**: 2026-01-27
**Source**: session:P11-C

### LRN-20260127-P11D1 (rule, high)
**Content**: Categorize custom features into KEEP/OPTIONAL/REMOVE based on business value vs maintenance cost. KEEP = business critical (DateTimeNode). OPTIONAL = nice-to-have with heavy dependencies (Excalidraw). REMOVE = unclear purpose or redundant (SpecialTextNode).
**Context**: Audited 8 custom nodes with clear decision framework
**Triggers**: custom, features, evaluation, keep, remove, optional
**Added**: 2026-01-27
**Source**: session:P11-D

### LRN-20260127-P11D2 (rule, high)
**Content**: Heavy external dependencies (Excalidraw ~500KB+) should be flagged as OPTIONAL and consider feature flags for lazy loading. Weigh dependency size against actual usage frequency.
**Context**: Excalidraw adds significant bundle weight for potentially infrequent use
**Triggers**: dependency, bundle, excalidraw, optional, feature-flag
**Added**: 2026-01-27
**Source**: session:P11-D

### LRN-20260127-P11D3 (rule, medium)
**Content**: Nested editor patterns (like StickyNode) add significant serialization complexity and maintenance burden. Evaluate if the feature is scope creep before keeping - isolated note-taking within a document editor may be overkill.
**Context**: StickyNode creates nested editor instances with portal rendering
**Triggers**: nested, editor, sticky, complexity, scope
**Added**: 2026-01-27
**Source**: session:P11-D

### LRN-20260127-P11D4 (correction, medium)
**Content**: Consolidate redundant insert actions - Insert GIF was just a hardcoded INSERT_IMAGE_COMMAND with cat.gif asset. Remove wrapper actions that provide no additional value over the base command.
**Context**: Found Insert GIF action was redundant wrapper
**Triggers**: insert, gif, redundant, consolidate, action
**Added**: 2026-01-27
**Source**: session:P11-D

### LRN-20260127-P11D5 (rule, medium)
**Content**: Document technical debt during feature evaluation even if not immediately fixing it. Create a P11-D_DECISIONS.md or similar tracking document for future reference.
**Context**: Identified 6 technical debt items during node audit
**Triggers**: technical, debt, documentation, evaluation, decisions
**Added**: 2026-01-27
**Source**: session:P11-D

### LRN-20260127-P11E1 (rule, high)
**Content**: Delete CSS files in batches with import verification after each batch. After deleting CSS files, immediately grep for all imports referencing them and update to new paths before type-checking.
**Context**: Deleted 8 CSS/theme files, had to update multiple import statements
**Triggers**: css, delete, import, migration, theme
**Added**: 2026-01-27
**Source**: session:P11-E

### LRN-20260127-P11E2 (rule, high)
**Content**: When removing a custom node, search for all three integration points: PlaygroundNodes.ts (registration), Editor.tsx (plugin usage), and settings files (related toggle options).
**Context**: Removed SpecialTextNode - found settings toggle that was missed initially
**Triggers**: node, remove, cleanup, integration, registration
**Added**: 2026-01-27
**Source**: session:P11-E

### LRN-20260127-P11E3 (observation, medium)
**Content**: CSS class prefix changes (e.g., PlaygroundEditorTheme__ → EditorTheme__) must be updated in both theme definition files AND inline string references in plugin components (querySelector, classList).
**Context**: Found CSS class references scattered across multiple plugin files
**Triggers**: css, class, prefix, rename, theme
**Added**: 2026-01-27
**Source**: session:P11-E

### LRN-20260127-P11E4 (observation, medium)
**Content**: Theme consolidation from multiple files (PlaygroundEditorTheme.ts, CommentEditorTheme.ts, StickyEditorTheme.ts) to single file should export named variants from one location with barrel export for clean imports.
**Context**: Created editor-theme.ts with editorTheme, commentEditorTheme, stickyEditorTheme exports
**Triggers**: theme, consolidate, export, barrel, variants
**Added**: 2026-01-27
**Source**: session:P11-E

### LRN-20260127-P11E5 (correction, medium)
**Content**: When auditing CSS completeness, check for styles referenced by JavaScript (context menus, scroll shadows, dynamically added classes) - these won't show up in static CSS analysis.
**Context**: Found missing context menu and table scroll shadow styles that were added dynamically
**Triggers**: css, audit, dynamic, javascript, complete
**Added**: 2026-01-27
**Source**: session:P11-E

### LRN-20260127-P11F1 (observation, high)
**Content**: P11 shadcn-native migration achieved 87% theme/CSS file reduction (8→1) and 77% CSS line reduction (~3000→689) by consolidating to single editor-theme.css + editor-theme.ts combination.
**Context**: Final metrics documented after completing all P11 phases
**Triggers**: metrics, css, reduction, migration, theme
**Added**: 2026-01-27
**Source**: session:P11-F

### LRN-20260127-P11F2 (rule, high)
**Content**: Multi-phase migrations benefit from structured handoff documents per phase (HANDOFF_P11-A.md through F.md) enabling session continuity, then archiving to handoffs/archive/ on completion.
**Context**: 6 handoff documents managed across P11 phases, archived at end
**Triggers**: handoff, archive, migration, phases, session
**Added**: 2026-01-27
**Source**: session:P11-F

### LRN-20260127-P11F3 (observation, medium)
**Content**: Toolbar modularization (60% render reduction) combined with CSS consolidation (77% reduction) significantly improves editor maintainability without changing functionality.
**Context**: ToolbarPlugin 500→200 lines, 5 extracted components
**Triggers**: toolbar, modularization, maintainability, render
**Added**: 2026-01-27
**Source**: session:P11-F