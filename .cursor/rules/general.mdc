---
description: "General rules"
alwaysApply: true
---

# General Project Rules

## Code Quality

- NEVER use `any`, `@ts-ignore`, or unchecked casts
- ALWAYS validate external data with `@beep/schema`
- ALWAYS run `bun run lint:fix` before committing
- Use Effect testing utilities from `@beep/testkit`
- Use `Effect.log*` with structured objects for logging

## Architecture Boundaries

- NEVER use direct cross-slice imports
- NEVER use relative `../../../` paths
- ALWAYS use `@beep/*` path aliases
- Cross-slice imports ONLY through `packages/shared/*` or `packages/common/*`

## Slice Structure

Each vertical slice follows this dependency order:
```
domain -> tables -> infra -> client -> ui
```

## Commands Reference

| Category     | Command                                                          |
|--------------|------------------------------------------------------------------|
| **Install**  | `bun install`                                                    |
| **Dev**      | `bun run dev`                                                    |
| **Build**    | `bun run build`                                                  |
| **Check**    | `bun run check`                                                  |
| **Lint**     | `bun run lint` / `bun run lint:fix`                              |
| **Test**     | `bun run test`                                                   |
| **DB**       | `bun run db:generate` / `bun run db:migrate` / `bun run db:push` |
| **Services** | `bun run services:up`                                            |

## Environment & Secrets

- NEVER access `process.env` directly in application code
- ALWAYS use the `@beep/env` package for typed environment access
- NEVER commit `.env` files or secrets to version control
- Use `dotenvx` for environment management

## Testing

- `bun run test` — Run all tests
- `bun run test --filter=@beep/package` — Run tests for specific package
- Place test files adjacent to source files or in `__tests__/` directories

## Turborepo Verification Behavior

**IMPORTANT**: Turborepo's `--filter` flag cascades through ALL package dependencies.

When running `bun run check --filter @beep/package`:
1. Turborepo resolves ALL dependencies of `@beep/package`
2. Type-checks dependencies FIRST (in dependency order)
3. Type-checks the target package LAST
4. Reports errors from ANY package in the dependency chain

**Implication**: If `@beep/iam-tables` depends on `@beep/iam-domain`, errors in the domain package will cause tables verification to fail, even if the tables code is correct.

**Debugging Failed Checks**:
```bash
# If cascading check fails, isolate the error source:

# 1. Check if error is in upstream dependency
bun run check --filter @beep/upstream-package

# 2. Or use isolated syntax check (no dependency resolution)
bun tsc --noEmit path/to/file.ts
```

**Fix errors in dependency order**: Always resolve upstream package errors before downstream packages.

See [documentation/patterns/database-patterns.md](../../documentation/patterns/database-patterns.md#turborepo-verification-cascading) for detailed debugging workflows.

## Documentation

| Document                           | Purpose                   |
|------------------------------------|---------------------------|
| `README.md`                        | Onboarding & summary      |
| `documentation/`                   | Internal contributor docs |
| `documentation/patterns/`          | Implementation recipes    |
| `documentation/EFFECT_PATTERNS.md` | Effect-specific patterns  |
| `specs/`                           | Specification library     |
