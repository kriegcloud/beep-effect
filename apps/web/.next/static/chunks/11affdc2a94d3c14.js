(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,804011,e=>{"use strict";let t,r,i,n,a,s;var o,l,d,u,c,h=e.i(51889),f=e.i(878753),p=e.i(980914),m=e.i(660421),g=e.i(45526),y=e.i(915838),v=e.i(494576),S=e.i(153917);let x=(e,t)=>{t(p.isFailure(e)&&!h.isInterruptedOnly(e.cause)?1:0)},w=(e,t)=>{let r=g.getOrDefault(e,m.currentLoggers);return v.has(r,S.defaultLogger)?g.updateAs(e,{fiberId:t,fiberRef:m.currentLoggers,value:r.pipe(v.remove(S.defaultLogger),v.add(S.prettyLoggerDefault))}):e},k=(t=({fiber:e})=>{addEventListener("beforeunload",()=>{e.unsafeInterruptAsFork(e.id())})},(0,y.dual)(e=>f.isEffect(e[0]),(e,r)=>t({fiber:r?.disableErrorReporting===!0?f.runFork(e,{updateRefs:r?.disablePrettyLogger===!0?void 0:w}):f.runFork(f.tapErrorCause(e,e=>h.isInterruptedOnly(e)?f.void:f.logError(e)),{updateRefs:r?.disablePrettyLogger===!0?void 0:w}),teardown:r?.teardown??x})));var C=e.i(514423),b=e.i(777444),E=e.i(741140),I=e.i(405763);e.i(343469);var T=e.i(462241),R=e.i(559238),A=e.i(874068),M=e.i(277233),P=e.i(788339),F=e.i(121501);let L=Symbol.for("@effect/platform/Runner/PlatformRunner"),O=E.GenericTag("@effect/platform/Runner/PlatformRunner"),_=E.Reference()("@effect/platform/WorkerRunner/CloseLatch",{defaultValue:()=>I.unsafeMake(R.none)}),N=A.effect(_,I.make());var q=e.i(527827),z=e.i(954616),D=e.i(249646),U=e.i(167256),H=e.i(717729),$=e.i(797734);let W=(0,D.globalValue)("@effect/platform-browser/Worker/cachedPorts",()=>new Set);"undefined"!=typeof self&&"onconnect"in self&&(self.onconnect=function(e){W.add(e.ports[0])});let B=A.sync(O,()=>{let e;return e=self,O.of({[L]:L,start:f.fnUntraced(function*(t){let r=yield*U.make(),i=0,n=new Map,a=f.fnUntraced(function*(r){let a,s=yield*f.scope,o=(yield*f.interruptible(f.runtime())).pipe(H.updateContext(E.omit($.Scope))),l=yield*z.make(),d=H.runFork(o);function u(e){"Failure"!==e._tag||h.isInterruptedOnly(e.cause)||I.unsafeDone(t,p.die(h.squash(e.cause)))}function c(e){I.unsafeDone(t,new C.WorkerError({reason:"decode",cause:e.data}))}function m(e){I.unsafeDone(t,new C.WorkerError({reason:"unknown",cause:e.data}))}function g(e){let a=$.fork(s,q.sequential).pipe(f.flatMap(a=>{let s=i++;n.set(s,[e,a]);let o=function(e){let i=e.data;if(0===i[0]){let e=r(s,i[1]);if(f.isEffect(e)){let t=d(e);t.addObserver(u),z.unsafeAdd(l,t)}}else{let e=n.get(s);if(!e)return;if(1===n.size)return I.unsafeDone(t,p.void);n.delete(s),f.runFork($.close(e[1],p.void))}};return e.addEventListener("message",o),e.addEventListener("messageerror",c),"start"in e&&e.start(),e.postMessage([0]),$.addFinalizer(a,f.sync(()=>{e.removeEventListener("message",o),e.removeEventListener("messageerror",m),e.close()}))}),d);a.addObserver(u),z.unsafeAdd(l,a)}if(e.addEventListener("error",m),"onconnect"in e){for(let t of(a=e.onconnect,e.onconnect=function(e){g(e.ports[0])},W))g(t);W.clear(),yield*$.addFinalizer(s,f.sync(()=>e.close()))}else g(e);yield*$.addFinalizer(s,f.sync(()=>{e.removeEventListener("error",m),"onconnect"in e&&(e.onconnect=a)}))});return(0,y.identity)({run:a,send:(t,r,i)=>f.sync(()=>{(n.get(t)?.[0]??e).postMessage([1,r],{transfer:i})}),disconnects:r})})})});var G=e.i(747445),j=e.i(886999);y.identity;e.i(927378);var V=e.i(566206),J=e.i(47342),K=e.i(681830),Y=e.i(532102),Q=e.i(643284),X=e.i(805624),Z=e.i(600025),ee=e.i(930178);let et=Symbol.for("@effect/platform/HttpServerResponse"),er=Symbol.for("@effect/platform/HttpServerRespondable");class ei extends Y.StructuralClass{status;statusText;cookies;body;[et];headers;constructor(e,t,r,i,n){if(super(),this.status=e,this.statusText=t,this.cookies=i,this.body=n,this[et]=et,n.contentType||n.contentLength){const e={...r};n.contentType&&(e["content-type"]=n.contentType),n.contentLength&&(e["content-length"]=n.contentLength.toString()),this.headers=e}else this.headers=r}commit(){return f.succeed(this)}[er](){return f.succeed(this)}[Q.NodeInspectSymbol](){return this.toJSON()}toString(){return Q.format(this)}toJSON(){return{_id:"@effect/platform/HttpServerResponse",status:this.status,statusText:this.statusText,headers:Q.redact(this.headers),cookies:this.cookies.toJSON(),body:this.body.toJSON()}}}let en=e=>"object"==typeof e&&null!==e&&et in e,ea=e=>new ei(e?.status??204,e?.statusText,e?.headers?G.fromInput(e.headers):G.empty,e?.cookies??X.empty,ee.empty),es=(e,t)=>e?.contentType?e.contentType:e?.headers?t["content-type"]:void 0,eo=((e,t)=>{let r=e.headers;return"Empty"===t._tag&&(r=G.remove(G.remove(r,"Content-Type"),"Content-length")),new ei(e.status,e.statusText,r,e.cookies,t)},Symbol.for("@effect/platform/HttpServerRespondable")),el=ea({status:400}),ed=ea({status:404}),eu=e=>en(e)?f.succeed(e):f.orDie(e[eo]()),ec=Symbol.for("@effect/platform/HttpServerError"),eh=(0,D.globalValue)("@effect/platform/HttpServerError/clientAbortFiberId",()=>R.runtime(-499,0)),ef=ea({status:500}),ep=ea({status:499}),em=ea({status:503}),eg=ec;class ey extends(0,V.TypeIdError)(eg,"RequestError"){[eo](){return ea({status:400})}get methodAndUrl(){return`${this.request.method} ${this.request.url}`}get message(){return this.description?`${this.reason}: ${this.description} (${this.methodAndUrl})`:`${this.reason} error (${this.methodAndUrl})`}}class ev extends(0,V.TypeIdError)(eg,"RouteNotFound"){constructor(e){super(e),this.stack=`${this.name}: ${this.message}`}[eo](){return ea({status:404})}get message(){return`${this.request.method} ${this.request.url} not found`}}var eS=e.i(632488),ex=Q,ew=e.i(555166),ek=b,eC=E,eb=y,eE=Q,eI=j,eT=M;let eR=/; *([!#$%&'*+.^\w`|~-]+)=("(?:[\v\u0020\u0021\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\v\u0020-\u00ff])*"|[!#$%&'*+.^\w`|~-]+) */gu,eA=/\\([\v\u0020-\u00ff])/gu,eM=/^[!#$%&'*+.^\w|~-]+\/[!#$%&'*+.^\w|~-]+$/u,eP=/^[!#$%&'*+.^\w|~-]+$/u,eF={value:"",parameters:Object.create(null)};function eL(e,t=!1){let r,i,n;if("string"!=typeof e)return eF;let a=e.indexOf(";"),s=-1!==a?e.slice(0,a).trim():e.trim();if(!1===(t?eP:eM).test(s))return eF;let o={value:s.toLowerCase(),parameters:Object.create(null)};if(-1===a)return o;for(eR.lastIndex=a;i=eR.exec(e);){if(i.index!==a)return eF;a+=i[0].length,r=i[1].toLowerCase(),'"'===(n=i[2])[0]&&(n=n.slice(1,n.length-1),!t&&eA.test(n)&&(n=n.replace(eA,"$1"))),o.parameters[r]=n}return a!==e.length?eF:o}(o=u||(u={}))[o.key=0]="key",o[o.whitespace=1]="whitespace",o[o.value=2]="value";let eO={_tag:"Continue"},e_=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1],eN=[0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1];var eq=e.i(294197);(l=c||(c={}))[l.headers=0]="headers",l[l.body=1]="body";let ez={_tag:"InvalidDisposition"},eD={_tag:"EndNotReached"},eU={_tag:"ReachedLimit",limit:"MaxParts"},eH={_tag:"ReachedLimit",limit:"MaxTotalSize"},e$={_tag:"ReachedLimit",limit:"MaxPartSize"},eW={_tag:"ReachedLimit",limit:"MaxFieldSize"},eB=new TextEncoder().encode("\r\n");function eG(e){return void 0!==e.filename||"application/octet-stream"===e.contentType}function ej(e){}let eV=new TextDecoder("utf-8"),eJ=function({headers:e,onFile:t,onField:r,onError:i,onDone:n,isFile:a=eG,maxParts:s=1/0,maxTotalSize:o=1/0,maxPartSize:l=1/0,maxFieldSize:d=1048576}){var h,f;let p,m,g=eL(e["content-type"]).parameters.boundary;if(void 0===g)return i({_tag:"InvalidBoundary"}),{write:ej,end(){}};let y={state:c.headers,index:0,parts:0,onChunk:ej,info:void 0,headerSkip:0,partSize:0,totalSize:0,isFile:!1,fieldChunks:[],fieldSize:0};function v(){y.state=c.body,y.isFile=!0,y.onChunk=ej}let S=function(){let e=new TextDecoder,t={state:u.key,headers:Object.create(null),key:"",value:void 0,crlf:0,previousChunk:void 0,pairs:0,size:0};function r(e){return t.state=u.key,t.headers=Object.create(null),t.key="",t.value=void 0,t.crlf=0,t.previousChunk=void 0,t.pairs=0,t.size=0,e}function i(e,t){let r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function n(e){return r({_tag:"Failure",reason:e,headers:t.headers})}return function(a,s){let o,l=0;if(void 0!==t.previousChunk){o=l=t.previousChunk.length;let e=new Uint8Array(a.length+l);e.set(t.previousChunk),e.set(a,l),t.previousChunk=void 0,a=e}let d=a.length;e:for(;s<d;){if(t.state===u.key){let r=s;for(;r<d;r++){if(t.size++>16384)return n("HeaderTooLarge");if(58===a[r]){if(t.key+=e.decode(a.subarray(s,r)).toLowerCase(),0===t.key.length)return n("InvalidHeaderName");32===a[r+1]&&32!==a[r+2]&&9!==a[r+2]?(s=r+2,t.state=u.value,t.size++):32!==a[r+1]&&9!==a[r+1]?(s=r+1,t.state=u.value):(s=r+1,t.state=u.whitespace);break}if(1!==e_[a[r]])return n("InvalidHeaderName")}if(r===d)return t.key+=e.decode(a.subarray(s,d)).toLowerCase(),eO}if(t.state===u.whitespace){for(;s<d;s++){if(t.size++>16384)return n("HeaderTooLarge");if(32!==a[s]&&9!==a[s]){t.state=u.value;break}}if(s===d)return eO}if(t.state===u.value){let c=s;for(void 0!==o&&(c=o,o=void 0);c<d;c++){if(t.size++>16384)return n("HeaderTooLarge");if(13===a[c]||t.crlf>0){let o=a[c];if(13===o&&0===t.crlf&&(t.crlf=1,c++,t.size++,o=a[c]),10===o&&1===t.crlf&&(t.crlf=2,c++,t.size++,o=a[c]),13===o&&2===t.crlf&&(t.crlf=3,c++,t.size++,o=a[c]),10===o&&3===t.crlf&&(t.crlf=4,c++,t.size++),t.crlf<4&&c>=d)return t.previousChunk=a.subarray(s),eO;if(t.crlf>=2){t.value=void 0===t.value?a.subarray(s,c-t.crlf):i(t.value,a.subarray(s,c-t.crlf));let o=e.decode(t.value);if(void 0===t.headers[t.key]?t.headers[t.key]=o:"string"==typeof t.headers[t.key]?t.headers[t.key]=[t.headers[t.key],o]:t.headers[t.key].push(o),s=c,t.size--,4!==t.crlf&&100===t.pairs)return n("TooManyHeaders");if(3===t.crlf)return n("InvalidHeaderValue");if(4===t.crlf)return r({_tag:"Headers",headers:t.headers,endPosition:s-l});t.pairs++,t.key="",t.value=void 0,t.crlf=0,t.state=u.key;continue e}}else if(1!==eN[a[c]])return n("InvalidHeaderValue")}if(c===d)return t.value=void 0===t.value?a.subarray(s,d):i(t.value,a.subarray(s,d)),eO}}return s>d&&(t.size+=d-s),eO}}(),x=(h=`\r
--${g}`,f=function(e,o){if(0===e)return void v();if(e!==y.index){if(y.index>0)if(y.isFile)y.onChunk(null),y.partSize=0;else{if(1===y.fieldChunks.length)r(y.info,y.fieldChunks[0]);else{let e=new Uint8Array(y.fieldSize),t=0;for(let r=0;r<y.fieldChunks.length;r++){let i=y.fieldChunks[r];e.set(i,t),t+=i.length}r(y.info,e)}y.fieldSize=0,y.fieldChunks=[]}if(y.state=c.headers,y.index=e,y.headerSkip=2,45===o[0]&&45===o[1])return n();y.parts++,y.parts>s&&i(eU)}if((y.partSize+=o.length)>l&&i(e$),y.state===c.headers){let e,r=S(o,y.headerSkip);if(y.headerSkip=0,"Continue"===r._tag)return;if("Failure"===r._tag)return v(),i({_tag:"BadHeaders",error:r});let n=eL(r.headers["content-type"]),s=eL(r.headers["content-disposition"],!0);if("form-data"===s.value&&!("name"in s.parameters))return v(),i(ez);if("filename*"in s.parameters){let t=s.parameters["filename*"].split("''");2===t.length&&(e=decodeURIComponent(t[1]))}if(y.info={name:s.parameters.name??"",filename:e??s.parameters.filename,contentType:""===n.value?void 0!==s.parameters.filename?"application/octet-stream":"text/plain":n.value,contentTypeParameters:n.parameters,contentDisposition:s.value,contentDispositionParameters:s.parameters,headers:r.headers},y.state=c.body,y.isFile=a(y.info),y.isFile&&(y.onChunk=t(y.info)),r.endPosition<o.length)if(y.isFile)y.onChunk(o.subarray(r.endPosition));else{let e=o.subarray(r.endPosition);(y.fieldSize+=e.length)>d&&i(eW),y.fieldChunks.push(e)}}else y.isFile?y.onChunk(o):((y.fieldSize+=o.length)>d&&i(eW),y.fieldChunks.push(o))},p=function(e){let t=new TextEncoder().encode(e),r=t.length,i={};for(let e=0;e<r;e++){let r=t[e];void 0===i[r]&&(i[r]=[]),i[r].push(e)}return{needle:t,needleLength:r,indexes:i,firstByte:t[0],previousChunk:void 0,previousChunkLength:0,matchIndex:0}}(h),void 0!==eB&&(p.previousChunk=eB,p.previousChunkLength=eB.length),m=function(){if("Buffer"in globalThis&&!("Bun"in globalThis||"Deno"in globalThis))return function(e,t,r){return eq.Buffer.prototype.indexOf.call(e,t,r)};let e=new Uint8Array(256).fill(p.needle.length);for(let t=0,r=p.needle.length-1;t<r;++t)e[p.needle[t]]=r-t;return function(t,r,i){let n=t.length,a=i+p.needleLength-1;for(;a<n;){for(let e=p.needleLength-1,i=a;e>=0&&t[i]===r[e];e--,i--)if(0===e)return i;a+=e[t[a]]}return -1}}(),{write:function(e){let t=e.length;if(void 0!==p.previousChunk){let r=new Uint8Array(p.previousChunkLength+t);r.set(p.previousChunk),r.set(e,p.previousChunkLength),e=r,t=p.previousChunkLength+t,p.previousChunk=void 0}if(t<p.needleLength){p.previousChunk=e,p.previousChunkLength=t;return}let r=0;for(;r<t;){let i=m(e,p.needle,r);if(i>-1){i>r&&f(p.matchIndex,e.subarray(r,i)),p.matchIndex+=1,r=i+p.needleLength;continue}if(e[t-1]in p.indexes){let i=p.indexes[e[t-1]],n=-1;for(let r=0,a=i.length;r<a;r++){let a=i[r];e[t-1-a]===p.firstByte&&r>n&&(n=a)}-1===n?0===r?f(p.matchIndex,e):f(p.matchIndex,e.subarray(r)):(t-1-n>r&&f(p.matchIndex,e.subarray(r,t-1-n)),p.previousChunk=e.subarray(t-1-n),p.previousChunkLength=n+1)}else 0===r?f(p.matchIndex,e):f(p.matchIndex,e.subarray(r));break}},end:function(){void 0!==p.previousChunk&&p.previousChunk!==eB&&f(p.matchIndex,p.previousChunk),p.previousChunk=eB,p.previousChunkLength=eB?.length??0,p.matchIndex=0}});return{write:e=>(y.totalSize+=e.length)>o?i(eH):x.write(e),end(){x.end(),y.state===c.body&&i(eD),y.state=c.headers,y.index=0,y.parts=0,y.onChunk=ej,y.info=void 0,y.totalSize=0,y.partSize=0,y.fieldChunks=[],y.fieldSize=0}}};var eK=e.i(861404),eY=e.i(26528);let eQ=Symbol.for("@effect/platform/Multipart"),eX=Symbol.for("@effect/platform/Multipart/MultipartError");class eZ extends eT.TaggedError()("MultipartError",{reason:eT.Literal("FileTooLarge","FieldTooLarge","BodyTooLarge","TooManyParts","InternalError","Parse"),cause:eT.Defect}){[eX]=eX;get message(){return this.reason}}e=>K.hasProperty(e,eQ)&&K.isTagged(e,"PersistedFile");let e1=e=>"Success"===e._tag?eS.void:eS.failCause(e.cause);class e0 extends eE.Class{[eQ];constructor(){super(),this[eQ]=eQ}}class e2 extends e0{key;contentType;value;_tag="Field";constructor(e,t,r){super(),this.key=e,this.contentType=t,this.value=r}toJSON(){return{_id:"@effect/platform/Multipart/Part",_tag:"Field",key:this.key,contentType:this.contentType,value:this.value}}}class e4 extends e0{_tag="File";key;name;contentType;content;contentEffect;constructor(e,t){super(),this.key=e.name,this.name=e.filename??e.name,this.contentType=e.contentType,this.content=P.fromChannel(t),this.contentEffect=t.pipe(eS.pipeTo(e5),eS.run,f.mapError(e=>new eZ({reason:"InternalError",cause:e})))}toJSON(){return{_id:"@effect/platform/Multipart/Part",_tag:"File",key:this.key,name:this.name,contentType:this.contentType}}}let e8=(e,t)=>f.flatMap(eK.FileSystem,r=>f.mapError(P.run(t.content,r.sink(e)),e=>new eZ({reason:"InternalError",cause:e}))),e5=eS.suspend(()=>{let e=new Uint8Array(0),t=eS.readWithCause({onInput(r){for(let t of r){let r=new Uint8Array(e.length+t.length);r.set(e,0),r.set(t,e.length),e=r}return t},onFailure:e=>eS.failCause(e),onDone:()=>eS.succeed(e)});return t});class e7 extends e0{key;name;contentType;path;_tag="PersistedFile";constructor(e,t,r,i){super(),this.key=e,this.name=t,this.contentType=r,this.path=i}toJSON(){return{_id:"@effect/platform/Multipart/Part",_tag:"PersistedFile",key:this.key,name:this.name,contentType:this.contentType,path:this.path}}}class e3 extends eC.Reference()("@effect/platform/Multipart/MaxParts",{defaultValue:eI.none}){}class e6 extends eC.Reference()("@effect/platform/Multipart/MaxFieldSize",{defaultValue:(0,eb.constant)(eK.Size(0xa00000))}){}class e9 extends eC.Reference()("@effect/platform/Multipart/MaxFileSize",{defaultValue:eI.none}){}class te extends eC.Reference()("@effect/platform/Multipart/FieldMimeTypes",{defaultValue:(0,eb.constant)(ek.make("application/json"))}){}e.i(24487);let tt=Symbol.for("@effect/platform/HttpServerRequest"),tr=E.GenericTag("@effect/platform/HttpServerRequest"),ti=E.GenericTag("@effect/platform/HttpServerRequest/ParsedSearchParams");class tn extends ex.Class{source;url;headersOverride;remoteAddressOverride;[tt];[ew.TypeId];constructor(e,t,r,i){super(),this.source=e,this.url=t,this.headersOverride=r,this.remoteAddressOverride=i,this[tt]=tt,this[ew.TypeId]=ew.TypeId}toJSON(){return ew.inspect(this,{_id:"@effect/platform/HttpServerRequest",method:this.method,url:this.originalUrl})}modify(e){return new tn(this.source,e.url??this.url,e.headers??this.headersOverride,e.remoteAddress??this.remoteAddressOverride)}get method(){return this.source.method.toUpperCase()}get originalUrl(){return this.source.url}get remoteAddress(){return this.remoteAddressOverride?j.some(this.remoteAddressOverride):j.none()}get headers(){return this.headersOverride??=G.fromInput(this.source.headers),this.headersOverride}cachedCookies;get cookies(){return this.cachedCookies?this.cachedCookies:this.cachedCookies=X.parseHeader(this.headers.cookie??"")}get stream(){return this.source.body?P.fromReadableStream(()=>this.source.body,e=>new ey({request:this,reason:"Decode",cause:e})):P.fail(new ey({request:this,reason:"Decode",description:"can not create stream from empty body"}))}textEffect;get text(){return this.textEffect||(this.textEffect=f.runSync(f.cached(f.tryPromise({try:()=>this.source.text(),catch:e=>new ey({request:this,reason:"Decode",cause:e})})))),this.textEffect}get json(){return f.tryMap(this.text,{try:e=>JSON.parse(e),catch:e=>new ey({request:this,reason:"Decode",cause:e})})}get urlParamsBody(){return f.flatMap(this.text,e=>f.try({try:()=>Z.fromInput(new URLSearchParams(e)),catch:e=>new ey({request:this,reason:"Decode",cause:e})}))}multipartEffect;get multipart(){return this.multipartEffect||(this.multipartEffect=f.runSync(f.cached(((e,t=e8)=>f.gen(function*(){let r=yield*eK.FileSystem,i=yield*eY.Path,n=yield*r.makeTempDirectoryScoped(),a=Object.create(null);return yield*P.runForEach(e,e=>{if("Field"===e._tag)return e.key in a?"string"==typeof a[e.key]?a[e.key]=[a[e.key],e.value]:a[e.key].push(e.value):a[e.key]=e.value,f.void;if(""===e.name)return f.void;let r=i.join(n,i.basename(e.name).slice(-128)),s=new e7(e.key,e.name,e.contentType,r);return Array.isArray(a[e.key])?a[e.key].push(s):a[e.key]=[s],t(r,e)}),a}).pipe(f.catchTags({SystemError:e=>f.fail(new eZ({reason:"InternalError",cause:e})),BadArgument:e=>f.fail(new eZ({reason:"InternalError",cause:e}))})))(this.multipartStream)))),this.multipartEffect}get multipartStream(){return P.pipeThroughChannel(P.mapError(this.stream,e=>new eZ({reason:"InternalError",cause:e})),((e,t=16)=>eS.acquireUseRelease(f.all([f.withFiberRuntime(t=>{let r=eC.get(t.currentContext,te);return f.succeed({headers:e,maxParts:eI.getOrUndefined(eC.get(t.currentContext,e3)),maxFieldSize:Number(eC.get(t.currentContext,e6)),maxPartSize:eC.get(t.currentContext,e9).pipe(eI.map(Number),eI.getOrUndefined),maxTotalSize:eC.get(t.currentContext,ew.MaxBodySize).pipe(eI.map(Number),eI.getOrUndefined),isFile:0===r.length?void 0:e=>!ek.some(r,t=>e.contentType.includes(t))&&eG(e)})}),U.make(t)]),([e,t])=>{let r=[],i=eI.none(),n=eJ({...e,onField(e,t){r.push(new e2(e.name,e.contentType,(function(e){if("utf-8"===e||"utf8"===e||""===e)return eV;try{return new TextDecoder(e)}catch(e){return eV}})(e.contentTypeParameters.charset??"utf-8").decode(t)))},onFile(e){let t=[],i=!1,n=eS.suspend(()=>{if(0===t.length)return i?eS.void:eS.zipRight(a,n);let e=ek.unsafeFromArray(t);return t=[],i?eS.write(e):eS.zipRight(eS.write(e),eS.zipRight(a,n))});return r.push(new e4(e,n)),function(e){null===e?i=!0:t.push(e)}},onError(e){i=eI.some(p.fail(function(e){if("ReachedLimit"===e._tag)switch(e.limit){case"MaxParts":return new eZ({reason:"TooManyParts",cause:e});case"MaxFieldSize":return new eZ({reason:"FieldTooLarge",cause:e});case"MaxPartSize":return new eZ({reason:"FileTooLarge",cause:e});case"MaxTotalSize":return new eZ({reason:"BodyTooLarge",cause:e})}return new eZ({reason:"Parse",cause:e})}(e)))},onDone(){i=eI.some(p.void)}}),a=eS.flatMap(t.takeAll,([e,t])=>eS.sync(()=>{ek.forEach(e,ek.forEach(n.write)),t&&n.end()})),s=eS.flatMap(a,()=>{if(0===r.length)return"None"===i._tag?s:e1(i.value);let e=ek.unsafeFromArray(r);return r=[],eS.zipRight(eS.write(e),"None"===i._tag?s:e1(i.value))});return eS.embedInput(s,{awaitRead:()=>f.void,emit:e=>t.offer(e),error:e=>(i=eI.some(p.failCause(e)),t.end),done:e=>t.end})},([,e])=>e.shutdown))(this.headers))}arrayBufferEffect;get arrayBuffer(){return this.arrayBufferEffect||(this.arrayBufferEffect=f.runSync(f.cached(f.tryPromise({try:()=>this.source.arrayBuffer(),catch:e=>new ey({request:this,reason:"Decode",cause:e})})))),this.arrayBufferEffect}get upgrade(){return f.fail(new ey({request:this,reason:"Decode",description:"Not an upgradeable ServerRequest"}))}}()=>m.unsafeMake(j.none());e.i(594231);let ta=(0,D.globalValue)(Symbol.for("@effect/platform/HttpMiddleware/loggerDisabled"),()=>m.unsafeMake(!1)),ts=(0,D.globalValue)(Symbol.for("@effect/platform/HttpMiddleware/tracerDisabledWhen"),()=>m.unsafeMake(y.constFalse)),to=E.Reference()("@effect/platform/HttpMiddleware/SpanNameGenerator",{defaultValue:()=>e=>`http.server ${e.method}`}),tl=D.globalValue("@effect/platform/HttpApp/ejectedScopes",()=>new WeakSet);H.defaultRuntime;var td=e.i(266417),tu=E,tc=y,th=e.i(732366);let tf=/\+/g,tp=function(){};tp.prototype=Object.create(null);let tm=/^https?:\/\/.*?\//,tg=/(\/:[^/()]*?)\?(\/?)/;class ty{constructor(e={}){this.options={ignoreTrailingSlash:!0,ignoreDuplicateSlashes:!0,caseSensitive:!1,maxParamLength:100,...e}}options;routes=[];trees={};on(e,t,r){let i=t.match(tg);if(i&&void 0!==i.index){tb(t.length===i.index+i[0].length,"Optional Parameter needs to be the last parameter of the path");let n=t.replace(tg,"$1$2"),a=t.replace(tg,"$2");this.on(e,n,r),this.on(e,a,r);return}for(let i of(this.options.ignoreDuplicateSlashes&&(t=tE(t)),this.options.ignoreTrailingSlash&&(t=tI(t)),"string"==typeof e?[e]:e))this._on(i,t,r)}all(e,t){this.on(tA,e,t)}_on(e,t,r){void 0===this.trees[e]&&(this.trees[e]=new tw("/"));let i=t;if("*"===i&&0!==this.trees[e].prefix.length){let t=this.trees[e];this.trees[e]=new tw(""),this.trees[e].staticChildren["/"]=t}let n=this.trees[e].prefix.length,a=this.trees[e],s=[];for(let e=0;e<=i.length;e++){if(58===i.charCodeAt(e)&&58===i.charCodeAt(e+1)){e++;continue}let t=58===i.charCodeAt(e)&&58!==i.charCodeAt(e+1),r=42===i.charCodeAt(e);if(t||r||e===i.length&&e!==n){let t=i.slice(n,e);this.options.caseSensitive||(t=t.toLowerCase()),t=(t=t.split("::").join(":")).split("%").join("%25"),a=a.createStaticChild(t)}if(t){let t=!1,r=[],l=e+1;for(let d=l;;d++){let u=i.charCodeAt(d),c=40===u,h=45===u||46===u,f=47===u||d===i.length;if(c||h||f){let u=i.slice(l,d);if(s.push(u),t=t||c||h,c){var o;let e=function(e,t){let r=1;for(;t<e.length;){if("\\"===e[++t]){t++;continue}if(")"===e[t]?r--:"("===e[t]&&r++,!r)return t}throw TypeError('Invalid regexp expression in "'+e+'"')}(i,d),t=i.slice(d,e+1);r.push((94===(o=t).charCodeAt(1)&&(o=o.slice(0,1)+o.slice(2)),36===o.charCodeAt(o.length-2)&&(o=o.slice(0,o.length-2)+o.slice(o.length-1)),o)),d=e+1}else r.push("(.*?)");let p=d;for(;d<i.length;d++){let e=i.charCodeAt(d);if(47===e)break;if(58===e)if(58===i.charCodeAt(d+1))d++;else break}let m=i.slice(p,d);if(m&&(m=(m=m.split("::").join(":")).split("%").join("%25"),r.push(m.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"))),l=d+1,f||47===i.charCodeAt(d)||d===i.length){let s=t?"()"+m:m,o=i.slice(e,d);i=i.slice(0,e+1)+s+i.slice(d),e+=s.length;let l=t?RegExp("^"+r.join("")+"$"):void 0;a=a.createParametricChild(l,m,o),n=e+1;break}}}}else if(r&&(s.push("*"),a=a.createWildcardChild(),n=e+1,e!==i.length-1))throw Error("Wildcard must be the last character in the route")}for(let t of(this.options.caseSensitive||(i=i.toLowerCase()),"*"===i&&(i="/*"),this.routes))if(t.method===e&&t.pattern===i)throw Error(`Method '${e}' already declared for route '${i}'`);let l={method:e,path:t,pattern:i,params:s,handler:r};this.routes.push(l),a.addRoute(l)}has(e,t){let r=this.trees[e];if(void 0===r)return!1;let i=r.getStaticChild(t);return void 0!==i&&i.isLeafNode}find(e,t){let r,i,n,a=this.trees[e];if(void 0===a)return;47!==t.charCodeAt(0)&&(t=t.replace(tm,"/")),this.options.ignoreDuplicateSlashes&&(t=tE(t));try{t=(r=function(e){let t=!1,r=!1,i="";for(let n=1;n<e.length;n++){let a=e.charCodeAt(n);if(37===a){let i=e.charCodeAt(n+1),a=e.charCodeAt(n+2);void 0===tT(i,a)?t=!0:(r=!0,50===i&&53===a&&(t=!0,e=e.slice(0,n+1)+"25"+e.slice(n+1),n+=2),n+=2)}else if(63===a||59===a||35===a){i=e.slice(n+1),e=e.slice(0,n);break}}return{path:t?decodeURI(e):e,querystring:i,shouldDecodeParam:r}}(t)).path,i=r.querystring,n=r.shouldDecodeParam}catch(e){return}this.options.ignoreTrailingSlash&&(t=tI(t));let s=t;!1===this.options.caseSensitive&&(t=t.toLowerCase());let o=this.options.maxParamLength,l=a.prefix.length,d=[],u=t.length,c=[];for(;;){if(l===u&&a.isLeafNode){let e=a.handlerStorage?.find();if(void 0!==e)return{handler:e.handler,params:e.createParams(d),searchParams:function(e){let t=new tp;if("string"!=typeof e)return t;let r=e.length,i="",n="",a=-1,s=-1,o=!1,l=!1,d=!1,u=!1,c=!1,h=0;for(let f=0;f<r+1;f++)if(38===(h=f!==r?e.charCodeAt(f):38)){if((c=s>a)||(s=f),i=e.slice(a+1,s),c||i.length>0){if(d&&(i=i.replace(tf," ")),o)try{i=decodeURIComponent(i)||i}catch{}if(c&&(n=e.slice(s+1,f),u&&(n=n.replace(tf," ")),l))try{n=decodeURIComponent(n)||n}catch{}let r=t[i];void 0===r?t[i]=n:r.pop?r.push(n):t[i]=[r,n]}n="",a=f,s=f,o=!1,l=!1,d=!1,u=!1}else 61===h?s<=a?s=f:l=!0:43===h?s>a?u=!0:d=!0:37===h&&(s>a?l=!0:o=!0);return t}(i)}}let e=a.getNextNode(t,l,c,d.length);if(void 0===e){if(0===c.length)return;let t=c.pop();l=t.brotherPathIndex,d.splice(t.paramsCount),e=t.brotherNode}if("StaticNode"===(a=e)._tag){l+=a.prefix.length;continue}if("WildcardNode"===a._tag){let e=s.slice(l);n&&(e=tR(e)),d.push(e),l=u;continue}if("ParametricNode"===a._tag){let e=s.indexOf("/",l);-1===e&&(e=u);let t=s.slice(l,e);if(n&&(t=tR(t)),void 0!==a.regex){let e=a.regex.exec(t);if(null===e)continue;for(let t=1;t<e.length;t++){let r=e[t];if(r.length>o)return;d.push(r)}}else{if(t.length>o)return;d.push(t)}l=e}}}}class tv{handlers=[];unconstrainedHandler;find(){return this.unconstrainedHandler}add(e){var t;let r,i={params:e.params,handler:e.handler,createParams:(r=(t=e.params).length,function(e){let i={};for(let n=0;n<r;n++)i[t[n]]=e[n];return i})};this.handlers.push(i),this.unconstrainedHandler=this.handlers[0]}}class tS{isLeafNode=!1;routes;handlerStorage;addRoute(e){void 0===this.routes?this.routes=[e]:this.routes.push(e),void 0===this.handlerStorage&&(this.handlerStorage=new tv),this.isLeafNode=!0,this.handlerStorage.add(e)}}class tx extends tS{staticChildren={};findStaticMatchingChild(e,t){let r=this.staticChildren[e.charAt(t)];if(void 0!==r&&r.matchPrefix(e,t))return r}getStaticChild(e,t=0){if(e.length===t)return this;let r=this.findStaticMatchingChild(e,t);if(void 0!==r)return r.getStaticChild(e,t+r.prefix.length)}createStaticChild(e){if(0===e.length)return this;let t=this.staticChildren[e.charAt(0)];if(t){let r=1;for(;r<t.prefix.length;r++)if(e.charCodeAt(r)!==t.prefix.charCodeAt(r)){t=t.split(this,r);break}return t.createStaticChild(e.slice(r))}let r=e.charAt(0);return this.staticChildren[r]=new tw(e),this.staticChildren[r]}}class tw extends tx{_tag="StaticNode";constructor(e){super(),this.setPrefix(e)}prefix;matchPrefix;parametricChildren=[];wildcardChild;setPrefix(e){if(this.prefix=e,1===e.length)this.matchPrefix=(e,t)=>!0;else{let t=e.length;this.matchPrefix=function(e,r){for(let i=1;i<t;i++)if(e.charCodeAt(r+i)!==this.prefix.charCodeAt(i))return!1;return!0}}}getParametricChild(e){if(void 0===e)return this.parametricChildren.find(e=>!1===e.isRegex);let t=e.source;return this.parametricChildren.find(e=>void 0!==e.regex&&e.regex.source===t)}createParametricChild(e,t,r){let i=this.getParametricChild(e);return void 0!==i?i.nodePaths.add(r):(i=new tk(e,t,r),this.parametricChildren.push(i),this.parametricChildren.sort((e,t)=>e.isRegex?t.isRegex?void 0===e.staticSuffix?1:void 0===t.staticSuffix?-1:t.staticSuffix.endsWith(e.staticSuffix)?1:e.staticSuffix.endsWith(t.staticSuffix)?-1:0:-1:1)),i}createWildcardChild(){return void 0===this.wildcardChild&&(this.wildcardChild=new tC),this.wildcardChild}split(e,t){let r=this.prefix.slice(0,t),i=this.prefix.slice(t);this.setPrefix(i);let n=new tw(r);return n.staticChildren[i.charAt(0)]=this,e.staticChildren[r.charAt(0)]=n,n}getNextNode(e,t,r,i){let n=this.findStaticMatchingChild(e,t),a=0;if(void 0===n){if(0===this.parametricChildren.length)return this.wildcardChild;n=this.parametricChildren[0],a=1}void 0!==this.wildcardChild&&r.push({paramsCount:i,brotherPathIndex:t,brotherNode:this.wildcardChild});for(let e=this.parametricChildren.length-1;e>=a;e--)r.push({paramsCount:i,brotherPathIndex:t,brotherNode:this.parametricChildren[e]});return n}}class tk extends tx{regex;staticSuffix;_tag="ParametricNode";constructor(e,t,r){super(),this.regex=e,this.staticSuffix=t,this.isRegex=!!e,this.nodePaths=new Set([r])}isRegex;nodePaths;getNextNode(e,t){return this.findStaticMatchingChild(e,t)}}class tC extends tS{_tag="WildcardNode";getNextNode(e,t,r,i){}}let tb=(e,t)=>{if(!e)throw Error(t)};function tE(e){return e.replace(/\/\/+/g,"/")}function tI(e){return e.length>1&&47===e.charCodeAt(e.length-1)?e.slice(0,-1):e}function tT(e,t){return 50===e?53===t?"%":51===t?"#":52===t?"$":54===t?"&":66===t||98===t?"+":67===t||99===t?",":70===t||102===t?"/":void 0:51===e?65===t||97===t?":":66===t||98===t?";":68===t||100===t?"=":70===t||102===t?"?":void 0:52===e&&48===t?"@":void 0}function tR(e){let t=e.indexOf("%");if(-1===t)return e;let r="",i=t;for(let n=t;n<e.length;n++)if(37===e.charCodeAt(n)){let t=tT(e.charCodeAt(n+1),e.charCodeAt(n+2));r+=e.slice(i,n)+t,i=n+3}return e.slice(0,t)+r+e.slice(i)}let tA=["ACL","BIND","CHECKOUT","CONNECT","COPY","DELETE","GET","HEAD","LINK","LOCK","M-SEARCH","MERGE","MKACTIVITY","MKCALENDAR","MKCOL","MOVE","NOTIFY","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PURGE","PUT","REBIND","REPORT","SEARCH","SOURCE","SUBSCRIBE","TRACE","UNBIND","UNLINK","UNLOCK","UNSUBSCRIBE"];var tM=E,tP=e.i(988772),tF=e.i(862409),tL=e.i(404292),tO=e.i(876898);e.i(618458);var t_=M,tN=e.i(959776);class tq extends t_.ArrayFormatterIssue.annotations({identifier:"Issue",description:"Represents an error encountered while parsing a value to match the schema"}){}class tz extends t_.TaggedError()("HttpApiDecodeError",{issues:t_.Array(tq),message:t_.String},tN.annotations({status:400,description:"The request did not match the expected schema"})){static fromParseError(e){return J.ArrayFormatter.formatError(e).pipe(f.zip(J.TreeFormatter.formatError(e)),f.map(([e,t])=>new tz({issues:e,message:t})))}static refailParseError(e){return f.flatMap(tz.fromParseError(e),f.fail)}}let tD=Symbol.for("@effect/platform/HttpApi"),tU={[tD]:tD,pipe(){return(0,tF.pipeArguments)(this,arguments)},add(e){return tH({identifier:this.identifier,groups:tO.set(this.groups,e.identifier,e),errorSchema:this.errorSchema,annotations:this.annotations,middlewares:this.middlewares})},addHttpApi(e){let t={...this.groups};for(let r in e.groups){let i=e.groups[r].annotateContext(E.empty());i.annotations=E.merge(e.annotations,i.annotations),i.middlewares=new Set([...e.middlewares,...i.middlewares]),t[r]=i}return tH({identifier:this.identifier,groups:t,errorSchema:tN.UnionUnify(this.errorSchema,e.errorSchema),annotations:this.annotations,middlewares:this.middlewares})},addError(e,t){return tH({identifier:this.identifier,groups:this.groups,errorSchema:tN.UnionUnify(this.errorSchema,t?.status?e.annotations(tN.annotations({status:t.status})):e),annotations:this.annotations,middlewares:this.middlewares})},prefix(e){return tH({identifier:this.identifier,groups:tO.map(this.groups,t=>t.prefix(e)),errorSchema:this.errorSchema,annotations:this.annotations,middlewares:this.middlewares})},middleware(e){return tH({identifier:this.identifier,groups:this.groups,errorSchema:tN.UnionUnify(this.errorSchema,e.failure),annotations:this.annotations,middlewares:new Set([...this.middlewares,e])})},annotate(e,t){return tH({identifier:this.identifier,groups:this.groups,errorSchema:this.errorSchema,annotations:E.add(this.annotations,e,t),middlewares:this.middlewares})},annotateContext(e){return tH({identifier:this.identifier,groups:this.groups,errorSchema:this.errorSchema,annotations:E.merge(this.annotations,e),middlewares:this.middlewares})}},tH=e=>{function t(){}return Object.setPrototypeOf(t,tU),t.groups=e.groups,t.errorSchema=e.errorSchema,t.annotations=e.annotations,t.middlewares=e.middlewares,t};var t$=Y,tW=Q,tB=e.i(817261),tG=e.i(858615);let tj=Symbol.for("@effect/platform/Etag/Generator"),tV=E.GenericTag("@effect/platform/Etag/Generator");e.i(572539),e.i(836917);let tJ=E.GenericTag("@effect/platform/HttpServer"),tK=(0,y.dual)(e=>f.isEffect(e[0]),(e,t)=>A.scopedDiscard(f.flatMap(tJ,r=>r.serve(e,t))));f.flatMap(tJ,e=>(e=>f.flatMap(tB.HttpClient,t=>{if("UnixAddress"===e._tag)return f.die(Error("HttpServer.layerTestClient: UnixAddress not supported"));let r="0.0.0.0"===e.hostname?"127.0.0.1":e.hostname,i=`http://${r}:${e.port}`;return f.succeed(tB.mapRequest(t,tG.prependUrl(i)))}))(e.address)),tB.HttpClient;let tY=Symbol.for("@effect/platform/HttpRouter"),tQ=Symbol.for("@effect/platform/HttpRouter/Route"),tX=Symbol.for("@effect/platform/HttpRouter/RouteContext"),tZ=E.GenericTag("@effect/platform/HttpRouter/RouteContext"),t1=(0,D.globalValue)("@effect/platform/HttpRouter/currentRouterConfig",()=>m.unsafeMake({}));class t0 extends t$.StructuralClass{routes;mounts;[tY];constructor(e,t){super(),this.routes=e,this.mounts=t,this[tY]=tY,this.httpApp=t2(this).pipe(f.flatMap(e=>this.httpApp=e))}httpApp;commit(){return this.httpApp}toJSON(){return{_id:"Router",routes:this.routes.toJSON(),mounts:this.mounts.toJSON()}}toString(){return tW.format(this)}[tW.NodeInspectSymbol](){return this.toJSON()}}let t2=e=>f.map(m.get(t1),t=>{let r=((e={})=>new ty(e))(t),i=b.toReadonlyArray(e.mounts).map(([e,t,r])=>[e,new t5(new t8("*",r?.includePrefix?`${e}/*`:"/*",t,r?.includePrefix?j.none():j.some(e),!1),{}),r]),n=i.length;return b.forEach(e.routes,e=>{"*"===e.method?r.all(e.path,e):r.on(e.method,e.path,e)}),f.withFiberRuntime(e=>{let t=E.unsafeMake(new Map(e.getFiberRef(m.currentContext).unsafeMap)),a=E.unsafeGet(t,tr);if(n>0){let e=a.url.indexOf("?"),r=-1===e?a.url:a.url.slice(0,e);for(let e=0;e<n;e++){let[n,s,o]=i[e];if(r===n||r.startsWith(n+"/"))return t.unsafeMap.set(tZ.key,s),o?.includePrefix!==!0&&t.unsafeMap.set(tr.key,t4(a,n)),f.locally(f.flatMap(s.route.handler,eu),m.currentContext,t)}}let s=r.find(a.method,a.url);if(void 0===s&&"HEAD"===a.method&&(s=r.find("GET",a.url)),void 0===s)return f.fail(new ev({request:a}));let o=s.handler;"Some"===o.prefix._tag&&t.unsafeMap.set(tr.key,t4(a,o.prefix.value)),t.unsafeMap.set(ti.key,s.searchParams),t.unsafeMap.set(tZ.key,new t5(o,s.params));let l=E.getOption(t,th.ParentSpan);"Some"===l._tag&&"Span"===l.value._tag&&l.value.attribute("http.route",o.path);let d=f.flatMap(o.handler,eu);return f.locally(o.uninterruptible?d:f.interruptible(d),m.currentContext,t)})});function t4(e,t){let r=t.length;return e.modify({url:e.url.length<=r?"/":e.url.slice(r)})}class t8 extends tW.Class{method;path;handler;prefix;uninterruptible;[tQ];constructor(e,t,r,i=j.none(),n=!1){super(),this.method=e,this.path=t,this.handler=r,this.prefix=i,this.uninterruptible=n,this[tQ]=tQ}toJSON(){return{_id:"@effect/platform/HttpRouter/Route",method:this.method,path:this.path,prefix:this.prefix.toJSON()}}}class t5{route;params;[tX];constructor(e,t){this.route=e,this.params=t,this[tX]=tX}}let t7=new t0(b.empty(),b.empty()),t3=(0,y.dual)(2,(e,t)=>new t0(b.append(e.routes,t),e.mounts)),t6=(0,y.dual)(2,(e,t)=>t9(e,t)),t9=(...e)=>new t0(e.reduce((e,t)=>b.appendAll(e,t.routes),b.empty()),e.reduce((e,t)=>b.appendAll(e,t.mounts),b.empty())),re=e=>e.endsWith("/")?e.slice(0,-1):e,rt=(0,y.dual)(2,(e,t)=>(t=re(t),new t0(b.map(e.routes,e=>new t8(e.method,"/"===e.path?t:t+e.path,e.handler,j.orElse(j.map(e.prefix,e=>t+e),()=>j.some(t)),e.uninterruptible)),b.map(e.mounts,([e,r])=>["/"===e?t:t+e,r])))),rr=(0,y.dual)(3,(e,t,r)=>t6(e,rt(r,t))),ri=(0,y.dual)(e=>K.hasProperty(e[0],tY),(e,t,r,i)=>new t0(e.routes,b.append(e.mounts,[re(t),r,i]))),rn=e=>(0,y.dual)(e=>{let t;return t=e[0],K.hasProperty(t,tY)},(t,r,i,n)=>new t0(b.append(t.routes,new t8(e,r,i,j.none(),n?.uninterruptible??!1)),t.mounts)),ra=rn("*"),rs=rn("GET"),ro=rn("POST"),rl=rn("PUT"),rd=rn("PATCH"),ru=rn("DELETE"),rc=rn("HEAD"),rh=rn("OPTIONS"),rf=((e,t)=>new t0(b.map(e.routes,e=>new t8(e.method,e.path,t(f.flatMap(e.handler,eu)),e.prefix,e.uninterruptible)),b.map(e.mounts,([e,r])=>[e,t(r)])),()=>{let e=t7;return{addRoute:t=>f.sync(()=>{e=t3(e,t)}),all:(t,r,i)=>f.sync(()=>{e=ra(e,t,r,i)}),get:(t,r,i)=>f.sync(()=>{e=rs(e,t,r,i)}),post:(t,r,i)=>f.sync(()=>{e=ro(e,t,r,i)}),put:(t,r,i)=>f.sync(()=>{e=rl(e,t,r,i)}),patch:(t,r,i)=>f.sync(()=>{e=rd(e,t,r,i)}),del:(t,r,i)=>f.sync(()=>{e=ru(e,t,r,i)}),head:(t,r,i)=>f.sync(()=>{e=rc(e,t,r,i)}),options:(t,r,i)=>f.sync(()=>{e=rh(e,t,r,i)}),router:f.sync(()=>e),mount:(t,r)=>f.sync(()=>{e=rr(e,t,r)}),mountApp:(t,r,i)=>f.sync(()=>{e=ri(e,t,r,i)}),concat:t=>f.sync(()=>{e=t6(e,t)})}});e.i(375688),y.constFalse;let rp={[Symbol.for("@effect/platform/HttpApiBuilder/Handlers")]:{_Endpoints:y.identity},pipe(){return(0,tF.pipeArguments)(this,arguments)},handle(e,t,r){let i=this.group.endpoints[e];return rm({group:this.group,handlers:b.append(this.handlers,{endpoint:i,handler:t,withFullRequest:!1,uninterruptible:r?.uninterruptible??!1})})},handleRaw(e,t,r){let i=this.group.endpoints[e];return rm({group:this.group,handlers:b.append(this.handlers,{endpoint:i,handler:t,withFullRequest:!0,uninterruptible:r?.uninterruptible??!1})})}},rm=e=>{let t=Object.create(rp);return t.group=e.group,t.handlers=e.handlers,t},rg=(0,D.globalValue)("securityMiddlewareCache",()=>new WeakMap),ry=M.declare(en),rv=(e,t,r)=>J.fail(new J.Forbidden(r,e,"Encode only schema"));tN.getStatusSuccessAST,d=tN.getStatusErrorAST,r=new WeakMap,i=(e,t,r)=>{var i,n,a,s;let o=tN.isVoid(r.to),l=d(r.to);if(o)return ea({status:l});let u=tN.getEncoding(r.to);switch(u.kind){case"Json":let c;return f.mapError((c={status:l,contentType:u.contentType},f.map(ee.json(e),e=>new ei(c?.status??200,c?.statusText,c?.headers?G.fromInput(c.headers):G.empty,c?.cookies??X.empty,e))),e=>new J.Type(r,e,"Could not encode to JSON"));case"Text":let h;return J.succeed((i=e,n={status:l,contentType:u.contentType},h=n?.headers?G.fromInput(n.headers):G.empty,new ei(n?.status??200,n?.statusText,h,n?.cookies??X.empty,ee.text(i,es(n,h)))));case"Uint8Array":let p;return J.succeed((a=e,s={status:l,contentType:u.contentType},p=s?.headers?G.fromInput(s.headers):G.empty,new ei(s?.status??200,s?.statusText,p,s?.cookies??X.empty,ee.uint8Array(a,es(s,p)))));case"UrlParams":let m;return J.succeed((m={status:l,contentType:u.contentType},new ei(m?.status??200,m?.statusText,m?.headers?G.fromInput(m.headers):G.empty,m?.cookies??X.empty,ee.text(Z.toString(Z.fromInput(e)),"application/x-www-form-urlencoded"))))}},e=>{if(r.has(e.ast))return r.get(e.ast);let t=M.transformOrFail(ry,e,{decode:rv,encode:i});return r.set(t.ast,t),t};class rS extends tM.Tag("@effect/platform/HttpApiBuilder/Middleware")(){static layer=A.sync(rS,()=>{let e=y.identity;return rS.of({add:t=>f.sync(()=>{let r=e;e=e=>t(r(e))}),retrieve:f.sync(()=>e)})})}let rx=tu.GenericTag("@effect/platform/HttpLayerRouter"),rw=Symbol.for("@effect/platform/HttpLayerRouter/Route"),rk=e=>({...e,uninterruptible:e.uninterruptible??!1,prefix:e.prefix??j.none(),[rw]:rw}),rC=(0,tc.dual)(2,(e,t)=>{let r;return t=(r=t).endsWith("/")?r.slice(0,-1):r,"/"===e?t:t+e}),rb=((e,t)=>rk({...e,path:rC(e.path,t),prefix:j.match(e.prefix,{onNone:()=>j.some(t),onSome:e=>j.some(rC(e,t))})}),Symbol.for("@effect/platform/HttpLayerRouter/Middleware")),rE=(e,t)=>t?.global?A.scopedDiscard(f.gen(function*(){let t=yield*rx,r=f.isEffect(e)?yield*e:e;yield*t.addGlobalMiddleware(r)})):new rR(f.isEffect(e)?A.scopedContext(f.map(e,e=>tu.unsafeMake(new Map([[rT,e]])))):A.succeedContext(tu.unsafeMake(new Map([[rT,e]])))),rI=0,rT="@effect/platform/HttpLayerRouter/MiddlewareFn";class rR{layerFn;dependencies;[rb]={};constructor(e,t){this.layerFn=e,this.dependencies=t;const r=`@effect/platform/HttpLayerRouter/Middleware-${++rI}`;this.layer=A.scopedContext(f.gen(this,function*(){let e=yield*f.context(),t=[e.unsafeMap.get(rT)];if(this.dependencies){let r=yield*A.CurrentMemoMap,i=tu.get(e,$.Scope),n=yield*A.buildWithMemoMap(this.dependencies,r,i);t.push(...rM(n))}return tu.unsafeMake(new Map([[r,t]]))})).pipe(A.provide(this.layerFn))}layer;combine(e){return new rR(this.layerFn,this.dependencies?A.provideMerge(this.dependencies,e.layer):e.layer)}}let rA=new WeakMap,rM=e=>{let t=rA.get(e);if(t)return t;let r=td.empty(),i=0;for(let[t,n]of e.unsafeMap)t.startsWith("@effect/platform/HttpLayerRouter/Middleware-")&&(r.push(n),n.length>i&&(i=n.length));if(0===r.length)t=[];else{let e=new Set;for(let t=i-1;t>=0;t--)for(let i of r)t<i.length&&e.add(i[t]);t=td.fromIterable(e).reverse()}return rA.set(e,t),t};(function(){return 0==arguments.length?rE:rE(arguments[0],arguments[1])})(e=>f.zipRight(m.set(ta,!0),e)).layer;var rP=E;e.i(300767);var rF=E,rL=e.i(784086),rO=e.i(22555);rO.None;let r_=rO.Interruption;rO.OpSupervision,rO.RuntimeMetrics,rO.WindDown,rO.CooperativeYielding,rO.cooperativeYielding,rO.diff,rO.differ;let rN=rO.disable;rO.disableAll,rL.disableCooperativeYielding,rL.disableInterruption,rL.disableOpSupervision,rL.disableRuntimeMetrics,rL.disableWindDown,rO.enable,rO.enableAll,rL.enableCooperativeYielding,rL.enableInterruption,rL.enableOpSupervision,rL.enableRuntimeMetrics,rL.enableWindDown,rO.interruptible,rO.interruption,rO.isEnabled,rO.isDisabled,rO.make,rO.none,rO.opSupervision,rO.patch,rO.render,rO.runtimeMetrics,rO.toSet,rO.windDown,e.i(213029);var rq=e.i(487992),rz=e.i(857106),rD=e.i(99899),rU=e.i(172035),rH=e.i(470114);let r$=f.fnUntraced(function*(e,t){let r=!0!==t.disableTracing,i=!0!==t.disableSpanPropagation,n=!0!==t.disableClientAcks,a=t.spanPrefix??"RpcServer",s=t.concurrency??"unbounded",o=t.disableFatalDefects??!1,l=yield*f.context(),d=rF.get(l,$.Scope),u=yield*z.make(),c=yield*z.runtime(u)().pipe(f.interruptible),m="unbounded"===s?void 0:yield*f.makeSemaphore(s),g=new Map,v=!1,S=f.unsafeMakeLatch(!1);yield*$.addFinalizer(d,f.fiberIdWith(e=>{for(let t of(v=!0,g.values())){if(t.ended=!0,0===t.fibers.size){c(x(t));continue}for(let r of t.fibers.values())r.unsafeInterruptAsFork(e)}return 0===g.size?f.void:S.await}));let x=e=>{g.delete(e.id);let r=t.onFromServer({_tag:"ClientEnd",clientId:e.id});return v&&0===g.size?f.zipRight(r,S.open):r},w=(e,r,i)=>{let a=e.latches.get(r.id);if(n&&!a&&(a=f.unsafeMakeLatch(!1),e.latches.set(r.id,a)),f.isEffect(i)){let n=!1;return i.pipe(f.flatMap(i=>f.whileLoop({while:()=>!n,body:(0,y.constant)(f.flatMap(i.takeAll,([i,s])=>{if(n=s,!b.isNonEmpty(i))return f.void;let o=t.onFromServer({_tag:"Chunk",clientId:e.id,requestId:r.id,values:b.toReadonlyArray(i)});return a?(a.unsafeClose(),f.zipRight(o,a.await)):o})),step:y.constVoid})),f.scoped)}return P.runForEachChunk(i,i=>{if(!b.isNonEmpty(i))return f.void;let n=t.onFromServer({_tag:"Chunk",clientId:e.id,requestId:r.id,values:b.toReadonlyArray(i)});return a?(a.unsafeClose(),f.zipRight(n,a.await)):n})},k=(e,r)=>f.suspend(()=>{let i=e.ended&&0===e.fibers.size,n=t.onFromServer({_tag:"Defect",clientId:e.id,defect:r});return i?f.zipRight(n,x(e)):n});return(0,y.identity)({write:(n,s)=>f.catchAllDefect(f.withFiberRuntime(d=>{if(v)return f.interrupt;let c=g.get(n);if(c){if(c.ended)return f.interrupt}else c={id:n,latches:new Map,fibers:new Map,ended:!1},g.set(n,c);switch(s._tag){case"Request":return((n,s,d)=>{if(s.fibers.has(d.id))return f.interrupt;let c=e.requests.get(d.tag),g=l.unsafeMap.get(c?.key);if(!c||!g){let e=f.catchAllDefect(t.onFromServer({_tag:"Exit",clientId:s.id,requestId:d.id,exit:p.die(`Unknown request tag: ${d.tag}`)}),e=>k(s,e));return!s.ended||s.fibers.size>0?e:f.zipRight(e,x(s))}let y=rU.isStreamSchema(c.successSchema),v=g.handler(d.payload,{clientId:s.id,headers:d.headers}),S=rz.isWrapper(v),C=S&&v.fork,b=S&&v.uninterruptible,E=S?v.value:v,I=rW(c,l,s.id,d.payload,d.headers,y?w(s,d,E):E),T=!1,A=f.matchCauseEffect(b?I:f.interruptible(I),{onSuccess:e=>(T=!0,t.onFromServer({_tag:"Exit",clientId:s.id,requestId:d.id,exit:p.succeed(e)})),onFailure:e=>(T=!0,!o&&h.isDie(e)&&!h.isInterrupted(e))?k(s,h.squash(e)):t.onFromServer({_tag:"Exit",clientId:s.id,requestId:d.id,exit:p.failCause(e)})});if(r){let e=n.currentContext.unsafeMap.get(th.ParentSpan.key);A=f.withSpan(A,`${a}.${d.tag}`,{captureStackTrace:!1,attributes:t.spanAttributes,parent:i&&d.spanId?{_tag:"ExternalSpan",traceId:d.traceId,spanId:d.spanId,sampled:d.sampled,context:rF.empty()}:void 0,links:i&&e?[{_tag:"SpanLink",span:e,attributes:{}}]:void 0})}!C&&m&&(A=m.withPermits(1)(A));let M=H.make({context:rF.merge(g.context,n.currentContext),fiberRefs:n.getFiberRefs(),runtimeFlags:rN(H.defaultRuntime.runtimeFlags,r_)}),P=H.runFork(M,A);return z.unsafeAdd(u,P),s.fibers.set(d.id,P),P.addObserver(e=>{T||"Failure"!==e._tag||z.unsafeAdd(u,H.runFork(M,t.onFromServer({_tag:"Exit",clientId:s.id,requestId:d.id,exit:p.interrupt(R.none)}))),s.fibers.delete(d.id),s.latches.delete(d.id),s.ended&&0===s.fibers.size&&z.unsafeAdd(u,H.runFork(M,x(s)))}),f.void})(d,c,s);case"Ack":{let e=c.latches.get(s.requestId);return e?e.open:f.void}case"Interrupt":{let e=c.fibers.get(s.requestId);return e?T.interruptAsFork(e,rJ):t.onFromServer({_tag:"Exit",clientId:n,requestId:s.requestId,exit:p.interrupt(R.none)})}case"Eof":if(c.ended=!0,c.fibers.size>0)return f.void;return x(c);default:return k(c,`Unknown request tag: ${s._tag}`)}}),e=>k(g.get(n),e)),disconnect:e=>f.fiberIdWith(t=>{let r=g.get(e);if(!r)return f.void;for(let e of r.fibers.values())e.unsafeInterruptAsFork(t);return g.delete(e),f.void})})}),rW=(e,t,r,i,n,a)=>{if(0===e.middlewares.size)return a;let s={rpc:e,payload:i,headers:n,clientId:r};for(let r of e.middlewares)if(r.wrap)a=rF.unsafeGet(t,r)({...s,next:a});else if(r.optional){let e=rF.unsafeGet(t,r),i=a;a=f.matchEffect(e(s),{onFailure:()=>i,onSuccess:void 0!==r.provides?e=>f.provideService(i,r.provides,e):e=>i})}else{let e=rF.unsafeGet(t,r);a=void 0!==r.provides?f.provideServiceEffect(a,r.provides,e(s)):f.zipRight(e(s),a)}return a},rB=f.fnUntraced(function*(e,t){let{disconnects:r,end:i,run:n,send:a,supportsAck:s,supportsSpanPropagation:o,supportsTransferables:l}=yield*rG,d=yield*f.context(),u=yield*$.make(),c=yield*r$(e,{...t,disableClientAcks:!s,disableSpanPropagation:!o,onFromServer(e){let t=m.get(e.clientId);if(!t)return f.void;switch(e._tag){case"Chunk":{let r=t.schemas.get(e.requestId);if(!r)return f.void;return g(t,e.requestId,r.collector,f.provide(r.encodeChunk(e.values),r.context),t=>({_tag:"Chunk",requestId:String(e.requestId),values:t}))}case"Exit":{let r=t.schemas.get(e.requestId);if(!r)return f.void;return t.schemas.delete(e.requestId),g(t,e.requestId,r.collector,f.provide(r.encodeExit(e.exit),r.context),t=>({_tag:"Exit",requestId:String(e.requestId),exit:t}))}case"Defect":return S(t,e.defect);case"ClientEnd":return m.delete(e.clientId),i(e.clientId)}}}).pipe($.extend(u));yield*f.fork(f.interruptible(f.whileLoop({while:y.constTrue,body:(0,y.constant)(f.flatMap(r.take,e=>(m.delete(e),c.disconnect(e)))),step:y.constVoid})));let p=new WeakMap,m=new Map,g=(e,t,r,i,n)=>(r?f.provideService(i,F.Collector,r):i).pipe(f.flatMap(t=>a(e.id,n(t),r&&r.unsafeClear())),f.catchAllCause(r=>{e.schemas.delete(t);let i=h.squash(h.map(r,J.TreeFormatter.formatErrorSync));return f.zipRight(v(e,t,i),c.write(e.id,{_tag:"Interrupt",requestId:t,interruptors:[]}))})),v=(e,t,r)=>f.catchAllCause(a(e.id,{_tag:"Exit",requestId:String(t),exit:{_tag:"Failure",cause:{_tag:"Die",defect:r}}}),t=>S(e,h.squash(t))),S=(e,t)=>f.catchAllCause(a(e.id,{_tag:"Defect",defect:t}),e=>f.annotateLogs(f.logDebug(e),{module:"RpcServer",method:"sendDefect"}));return yield*n((t,r)=>{let i=m.get(t);switch(!i&&(i={id:t,schemas:new Map},m.set(t,i)),r._tag){case"Request":{let n,a=K.hasProperty(r,"tag")?r.tag:"",s=e.requests.get(a);if(!s)return S(i,`Unknown request tag: ${a}`);switch(typeof r.id){case"bigint":case"string":n=(0,rD.RequestId)(r.id);break;default:return S(i,`Invalid request id: ${r.id}`)}let o=(e=>{let t=p.get(e);if(!t){let r=d.unsafeMap.get(e.key),i=rU.getStreamSchemas(e.successSchema.ast);t={decode:M.decodeUnknown(e.payloadSchema),encodeChunk:M.encodeUnknown(M.Array(j.isSome(i)?i.value.success:M.Any)),encodeExit:M.encodeUnknown(rz.exitSchema(e)),context:r.context},p.set(e,t)}return t})(s);return f.matchEffect(f.provide(o.decode(r.payload),o.context),{onFailure:e=>v(i,n,J.TreeFormatter.formatErrorSync(e)),onSuccess:e=>(i.schemas.set(n,l?{...o,collector:F.unsafeMakeCollector()}:o),c.write(t,{...r,id:n,payload:e,headers:G.fromInput(r.headers)}))})}case"Ping":return f.catchAllCause(a(i.id,rD.constPong),e=>S(i,h.squash(e)));case"Eof":return c.write(t,r);case"Ack":return c.write(t,{...r,requestId:(0,rD.RequestId)(r.requestId)});case"Interrupt":return c.write(t,{...r,requestId:(0,rD.RequestId)(r.requestId),interruptors:[]});default:return S(i,`Unknown request tag: ${r._tag}`)}}).pipe(f.interruptible,f.tapErrorCause(e=>f.logFatal("BUG: RpcServer protocol crashed",e)),f.onExit(e=>$.close(u,e)))});class rG extends rF.Tag("@effect/rpc/RpcServer/Protocol")(){static make=(0,rq.withRun)()}let rj=rG.make(f.fnUntraced(function*(e){let t=yield*f.withFiberRuntime(f.succeed),r=yield*O,i=yield*_,n=yield*r.start(i),a=yield*I.make(),s=new Set,o=yield*U.make();return yield*I.await(i).pipe(f.onExit(()=>(t.currentScheduler.scheduleTask(()=>t.unsafeInterruptAsFork(t.id()),0),f.void)),f.forkScoped),yield*n.run((t,r)=>(s.add(t),"InitialMessage"===r._tag)?I.succeed(a,r.value):e(t,r)),yield*o.take.pipe(f.tap(e=>(s.delete(e),o.offer(e))),f.forkScoped),{disconnects:o,send:n.send,end:e=>f.void,clientIds:f.sync(()=>s),initialMessage:f.asSome(I.await(a)),supportsAck:!0,supportsTransferables:!0,supportsSpanPropagation:!0}})),rV=A.scoped(rG,rj),rJ=R.make(-499,0);var rK=e.i(370218);let rY=e=>{if(e<=1)return!1;if(e<=3)return!0;if(e%2==0||e%3==0)return!1;for(let t=5;t*t<=e;t+=6)if(e%t==0||e%(t+2)==0)return!1;return!0},rQ=rK.WorkerRpc.toLayer(f.gen(function*(){return yield*f.logInfo("Worker started"),{filterData:e=>f.gen(function*(){if(yield*f.logInfo(`Worker received request to filter ${e.data.length} items with threshold ${e.threshold}`),yield*f.sleep("3 seconds"),e.threshold<0)return yield*f.logError("Worker received invalid threshold"),yield*new rK.FilterError({message:"Threshold cannot be negative"});let t=e.data.filter(t=>t>e.threshold);return yield*f.logInfo(`Worker finished filtering. Returning ${t.length} items.`),t}),calculatePrimes:({upperBound:e})=>f.gen(function*(){yield*f.logInfo(`Worker received request to calculate primes up to ${e}`);let t=0;for(let r=2;r<=e;r++)rY(r)&&(t+=1);return yield*f.logInfo(`Worker finished calculating primes. Found ${t} primes.`),t})}}));k((s=(n=rK.WorkerRpc,A.scopedDiscard(f.forkScoped(f.interruptible(rB(n,a))))).pipe(A.provide(rQ),A.provide(rV),A.provide(B)),f.scopedWith(f.fnUntraced(function*(e){let t=yield*A.buildWithScope(A.provideMerge(s,N),e),r=E.get(t,_);return yield*I.await(r)}))).pipe(f.tapErrorCause(e=>f.logError("[Worker]",e)))),e.s([],804011)}]);