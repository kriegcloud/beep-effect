(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,375688,e=>{"use strict";var t=e.i(266417),i=e.i(713512),r=e.i(829466),n=e.i(886999),a=e.i(47342),s=e.i(681830),u=e.i(876898),l=e.i(618458);let o=(e,t)=>{let a=t.definitionPath??"#/$defs/",o=t.target??"jsonSchema7",b=t.topLevelReferenceStrategy??"keep",g=t.additionalPropertiesStrategy??"strict";return function e(t,a,o,b,g,y,w){if("handle-identifier"===o&&("skip"!==g.topLevelReferenceStrategy||l.isSuspend(t))){let i=function e(t){let i=n.getOrUndefined(l.getJSONIdentifier(t));if(void 0===i){if(l.isSuspend(t))return e(t.f());if(l.isTransformation(t)&&l.isTypeLiteral(t.from)&&l.isDeclaration(t.to)){let i=t.to,r=l.getSurrogateAnnotation(i);if(n.isSome(r))return e(i)}}return i}(t);if(void 0!==i){let r=i.replace(/~/ig,"~0").replace(/\//ig,"~1"),n={$ref:g.getRef(r)};return u.has(a,i)||(a[i]=n,a[i]=e(t,a,"ignore-identifier",b,g,"handle-annotation",w)),n}}if("handle-annotation"===y){let i=l.getJSONSchemaAnnotation(t);if(n.isSome(i)){var S,C,R;let n=i.value;if(S=t,C=n,l.isRefinement(S)&&S.annotations[l.SchemaIdAnnotationId]===r.IntSchemaId?"type"in C&&"integer"!==C.type:"type"in C||"oneOf"in C||"anyOf"in C||"$ref"in C)if("Declaration"===t._tag)return _(n,t);else return n;if("Refinement"!==t._tag)return{...e(t,a,o,b,g,"ignore-annotation",w),...n};{let i,r,s=l.getTransformationFrom(t);if(void 0!==s)return e(s,a,o,b,g,"handle-annotation",w);return R=e(t.from,a,o,b,g,"handle-annotation",w),i={...R,...v(t),...n},i.allOf??=[],(r=(e,t)=>{e in n&&e in R&&(i.allOf.unshift({[e]:R[e]}),i.allOf=i.allOf.filter(t))})("minLength",e=>e.minLength>n.minLength),r("maxLength",e=>e.maxLength<n.maxLength),r("pattern",e=>e.pattern!==n.pattern),r("minItems",e=>e.minItems>n.minItems),r("maxItems",e=>e.maxItems<n.maxItems),r("minimum",e=>e.minimum>n.minimum),r("maximum",e=>e.maximum<n.maximum),r("exclusiveMinimum",e=>e.exclusiveMinimum>n.exclusiveMinimum),r("exclusiveMaximum",e=>e.exclusiveMaximum<n.exclusiveMaximum),r("multipleOf",e=>e.multipleOf!==n.multipleOf),0===i.allOf.length&&delete i.allOf,i}}}let z=l.getSurrogateAnnotation(t);if(n.isSome(z))return e(z.value,a,o,b,g,"handle-annotation",w);switch(t._tag){case"Declaration":case"UndefinedKeyword":case"BigIntKeyword":case"UniqueSymbol":case"SymbolKeyword":if("ignore-errors"===w)return _(c,t);throw Error(i.getJSONSchemaMissingAnnotationErrorMessage(b,t));case"Suspend":if("handle-identifier"===o){if("ignore-errors"===w)return _(c,t);throw Error(i.getJSONSchemaMissingIdentifierAnnotationErrorMessage(b,t))}return e(t.f(),a,"ignore-identifier",b,g,"handle-annotation",w);case"NeverKeyword":return _(p,t);case"VoidKeyword":return _(f,t);case"UnknownKeyword":return _(h,t);case"AnyKeyword":return _(c,t);case"ObjectKeyword":return _(d,t);case"StringKeyword":return _({type:"string"},t);case"NumberKeyword":return _({type:"number"},t);case"BooleanKeyword":return _({type:"boolean"},t);case"Literal":{let e=t.literal;if(null===e)return _({type:"null"},t);if(s.isString(e))return _({type:"string",enum:[e]},t);if(s.isNumber(e))return _({type:"number",enum:[e]},t);else if(s.isBoolean(e))return _({type:"boolean",enum:[e]},t);if("ignore-errors"===w)return _(c,t);throw Error(i.getJSONSchemaMissingAnnotationErrorMessage(b,t))}case"Enums":{let e=t.enums.map(e=>({type:s.isNumber(e[1])?"number":"string",title:e[0],enum:[e[1]]}));return e.length>=1?_({$comment:"/schemas/enums",anyOf:e},t):_(p,t)}case"TupleType":{let r=t.elements.map((t,i)=>k(e(t.type,a,"handle-identifier",b.concat(i),g,"handle-annotation",w),E(t.type,t))),n=t.rest.map(t=>k(e(t.type,a,"handle-identifier",b,g,"handle-annotation",w),E(t.type,t))),s={type:"array"},u=t.elements.length;u>0&&(s.minItems=u-t.elements.filter(e=>e.isOptional).length,s.items=r);let l=n.length;if(l>0){let e=n[0];if(1===l&&t.elements.every(e=>e.type===t.rest[0].type)?s.items=e:s.additionalItems=e,l>1){if("ignore-errors"===w)return _(c,t);throw Error(i.getJSONSchemaUnsupportedPostRestElementsErrorMessage(b))}}else u>0?s.additionalItems=!1:s.maxItems=0;return _(s,t)}case"TypeLiteral":{let r,n;if(0===t.propertySignatures.length&&0===t.indexSignatures.length)return _(m,t);let u={type:"object",required:[],properties:{},additionalProperties:function(e){switch(e.additionalPropertiesStrategy){case"allow":return!0;case"strict":return!1}}(g)};for(let i of t.indexSignatures){let t=x(i.type)??i.type,s=i.parameter;switch(s._tag){case"StringKeyword":u.additionalProperties=e(t,a,"handle-identifier",b,g,"handle-annotation",w);break;case"TemplateLiteral":r=e(t,a,"handle-identifier",b,g,"handle-annotation",w),n={type:"string",pattern:l.getTemplateLiteralRegExp(s).source};break;case"Refinement":r=e(t,a,"handle-identifier",b,g,"handle-annotation",w),n=e(s,a,"handle-identifier",b,g,"handle-annotation",w);break;case"SymbolKeyword":{let i=b.concat("[symbol]");u.additionalProperties=e(t,a,"handle-identifier",i,g,"handle-annotation",w),n=e(s,a,"handle-identifier",i,g,"handle-annotation",w)}}}for(let r=0;r<t.propertySignatures.length;r++){let n=t.propertySignatures[r],l=n.name;if(s.isString(l)){let t=x(n.type),i=t??n.type;u.properties[l]=k(e(i,a,"handle-identifier",b.concat(n.name),g,"handle-annotation",w),E(i,n)),n.isOptional||void 0!==t||u.required.push(l)}else{if("ignore-errors"===w)return _(c,t);throw Error(i.getJSONSchemaUnsupportedKeyErrorMessage(l,b))}}return void 0!==r&&(delete u.additionalProperties,u.patternProperties={"":r}),void 0!==n&&(u.propertyNames=n),_(u,t)}case"Union":{let i=function(e){let t=[];for(let i of e)if(!(i===p||s.hasProperty(i,"$id")&&i.$id===p.$id&&3===Object.keys(i).length&&i.title===l.neverKeyword.annotations[l.TitleAnnotationId])){if("$id"in i&&i.$id===c.$id||"$id"in i&&i.$id===h.$id||"$id"in i&&i.$id===f.$id)return[i];if(A(i)&&t.length>0){let e=t[t.length-1];if(A(e)&&e.type===i.type){t[t.length-1]={type:e.type,enum:[...e.enum,...i.enum]};continue}}t.push(i)}return t}(t.types.map(t=>e(t,a,"handle-identifier",b,g,"handle-annotation",w)));switch(i.length){case 0:return p;case 1:return _(i[0],t);default:return _({anyOf:i},t)}}case"Refinement":return e(t.from,a,o,b,g,"handle-annotation",w);case"TemplateLiteral":{let e=l.getTemplateLiteralRegExp(t);return _({type:"string",title:String(t),description:"a template literal",pattern:e.source},t)}case"Transformation":{if(I(t.from)){let i={type:"string",contentMediaType:"application/json"};return function(e){switch(e.target){case"jsonSchema7":return!1;case"jsonSchema2019-09":case"openApi3.1":return!0}}(g)&&(i.contentSchema=e(t.to,a,o,b,g,"handle-annotation",w)),i}let i=e(t.from,a,o,b,g,"handle-annotation",w);if("TypeLiteralTransformation"===t.transformation._tag&&M(i)){let r=e(t.to,{},"ignore-identifier",b,g,"handle-annotation","ignore-errors");if(M(r))for(let e of t.transformation.propertySignatureTransformations){let t=e.to,n=e.from;if(s.isString(t)&&s.isString(n)){let e=r.properties[t];if(s.isRecord(e)){let t=i.properties[n];if(s.isRecord(t)){let r={};s.isString(e.title)&&(r.title=e.title),s.isString(e.description)&&(r.description=e.description),Array.isArray(e.examples)&&(r.examples=e.examples),Object.hasOwn(e,"default")&&(r.default=e.default),i.properties[n]=F(t,r)}}}}}return _(i,t)}}}(e,t.definitions,"handle-identifier",[],{getRef:e=>a+e,target:o,topLevelReferenceStrategy:b,additionalPropertiesStrategy:g},"handle-annotation","handle-errors")},p={$id:"/schemas/never",not:{}},c={$id:"/schemas/any"},h={$id:"/schemas/unknown"},f={$id:"/schemas/void"},d={$id:"/schemas/object",anyOf:[{type:"object"},{type:"array"}]},m={$id:"/schemas/%7B%7D",anyOf:[{type:"object"},{type:"array"}]};function b(e){if(void 0!==e)return n.getOrUndefined(l.getDescriptionAnnotation(e))}function g(e){if(void 0!==e)return n.getOrUndefined(l.getTitleAnnotation(e))}function y(e){return void 0!==e?l.getDefaultAnnotation(e):n.none()}function w(e){if(void 0!==e)return n.getOrUndefined(l.getExamplesAnnotation(e))}function S(e,t,i){if(void 0!==t)switch(e._tag){case"StringKeyword":return t!==l.stringKeyword.annotations[i]?t:void 0;case"NumberKeyword":return t!==l.numberKeyword.annotations[i]?t:void 0;case"BooleanKeyword":return t!==l.booleanKeyword.annotations[i]?t:void 0}return t}function C(e,i,r,s,u){var l;let o={};if(void 0!==i&&(o.description=i),void 0!==r&&(o.title=r),n.isSome(s)){let t=(l=s.value,a.getOption(e,!1)(l));n.isSome(t)&&(o.default=t.value)}if(void 0!==u){let i,r,n=(i=a.getOption(e,!1),(r=t.filterMap(u,e=>i(e))).length>0?r:void 0);void 0!==n&&(o.examples=n)}if(0!==Object.keys(o).length)return o}function E(e,t){return C(e,b(t),g(t),y(t),w(t))}function v(e){return C(e,S(e,b(e),l.DescriptionAnnotationId),S(e,g(e),l.TitleAnnotationId),y(e),w(e))}function k(e,t){return t?"$ref"in e?{allOf:[e],...t}:{...e,...t}:e}let x=e=>{if(n.isNone(l.getJSONSchemaAnnotation(e)))return l.pruneUndefined(e,x,e=>x(e.from))},I=e=>e.annotations[l.SchemaIdAnnotationId]===l.ParseJsonSchemaId;function _(e,t){return F(e,v(t))}function F(e,t){return void 0===t||0===Object.keys(t).length?e:"$ref"in e?{allOf:[e],...t}:{...e,...t}}function M(e){return s.isRecord(e)&&"object"===e.type&&s.isRecord(e.properties)}function A(e){return s.hasProperty(e,"enum")&&"type"in e&&2===Object.keys(e).length}e.s(["fromAST",0,o,"make",0,e=>{let t={},i={$schema:"http://json-schema.org/draft-07/schema#",$defs:{},...o(l.isTransformation(e.ast)&&I(e.ast.from)?e.ast.to:e.ast,{definitions:t})};return u.isEmptyRecord(t)?delete i.$defs:i.$defs=t,i}])},50099,e=>{"use strict";e.i(266417);var t=e.i(343469),i=e.i(915838),r=e.i(886999);let n=Symbol.for("effect/Brand/Refined");i.unsafeCoerce,e.s(["nominal",0,()=>Object.assign(e=>e,{[n]:n,option:e=>r.some(e),either:e=>t.right(e),is:e=>!0})])},717729,e=>{"use strict";var t=e.i(482166);let i=t.unsafeFork;t.unsafeRunSyncExit;let r=t.unsafeRunSync,n=t.unsafeRunCallback;t.unsafeRunPromise;let a=t.unsafeRunPromiseExit,s=t.defaultRuntime;t.defaultRuntimeFlags;let u=t.make;t.FiberFailureCauseId,t.isAsyncFiberException,t.isFiberFailure,t.fiberFailure,t.updateRuntimeFlags,t.enableRuntimeFlag,t.disableRuntimeFlag;let l=t.updateContext;t.provideService,t.updateFiberRefs,t.setFiberRef,t.deleteFiberRef,e.s(["defaultRuntime",0,s,"make",0,u,"runCallback",0,n,"runFork",0,i,"runPromiseExit",0,a,"runSync",0,r,"updateContext",0,l])},566206,e=>{"use strict";var t=e.i(300767);e.i(681830);var i=e.i(277233);let r=Symbol.for("@effect/platform/Error"),n=i.Literal("Clipboard","Command","FileSystem","KeyValueStore","Path","Stream","Terminal");class a extends i.TaggedError("@effect/platform/Error/BadArgument")("BadArgument",{module:n,method:i.String,description:i.optional(i.String),cause:i.optional(i.Defect)}){[r]=r;get message(){return`${this.module}.${this.method}${this.description?`: ${this.description}`:""}`}}let s=i.Literal("AlreadyExists","BadResource","Busy","InvalidData","NotFound","PermissionDenied","TimedOut","UnexpectedEof","Unknown","WouldBlock","WriteZero");class u extends i.TaggedError("@effect/platform/Error/SystemError")("SystemError",{reason:s,module:n,method:i.String,description:i.optional(i.String),syscall:i.optional(i.String),pathOrDescriptor:i.optional(i.Union(i.String,i.Number)),cause:i.optional(i.Defect)}){[r]=r;get message(){return`${this.reason}: ${this.module}.${this.method}${void 0!==this.pathOrDescriptor?` (${this.pathOrDescriptor})`:""}${this.description?`: ${this.description}`:""}`}}e.s(["BadArgument",()=>a,"SystemError",()=>u,"TypeIdError",0,(e,i)=>{class r extends t.Error{_tag=i}return r.prototype[e]=e,r.prototype.name=i,r}])},660421,552452,e=>{"use strict";var t=e.i(449969),i=e.i(916142),r=e.i(350188),n=e.i(617712);t.FiberRefTypeId,i.fiberRefMake,i.fiberRefMakeWith,i.fiberRefMakeContext,i.fiberRefMakeRuntimeFlags;let a=t.fiberRefUnsafeMake;t.fiberRefUnsafeMakeHashSet,t.fiberRefUnsafeMakeContext,i.fiberRefUnsafeMakeSupervisor,t.fiberRefUnsafeMakePatch;let s=t.fiberRefGet;t.fiberRefGetAndSet,t.fiberRefGetAndUpdate,t.fiberRefGetAndUpdateSome;let u=t.fiberRefGetWith,l=t.fiberRefSet;t.fiberRefDelete,t.fiberRefReset,t.fiberRefModify,t.fiberRefModifySome;let o=t.fiberRefUpdate;t.fiberRefUpdateSome,t.fiberRefUpdateAndGet,t.fiberRefUpdateSomeAndGet,t.currentConcurrency,t.currentRequestBatching;let p=r.currentCache;r.currentCacheEnabled;let c=t.currentContext,h=t.currentSchedulingPriority;t.currentMaxOpsBeforeYield,t.currentUnhandledErrorLogLevel,t.currentVersionMismatchErrorLogLevel,t.currentLogAnnotations;let f=i.currentLoggers;t.currentLogLevel,i.currentMinimumLogLevel,t.currentLogSpan,i.currentRuntimeFlags;let d=n.currentScheduler;i.currentSupervisor,t.currentMetricLabels;let m=t.currentTracerEnabled,b=t.currentTracerTimingEnabled;t.currentTracerSpanAnnotations,t.currentTracerSpanLinks,t.currentInterruptedCause,e.s(["currentContext",0,c,"currentLoggers",0,f,"currentRequestCache",0,p,"currentScheduler",0,d,"currentSchedulingPriority",0,h,"currentTracerEnabled",0,m,"currentTracerTimingEnabled",0,b,"get",0,s,"getWith",0,u,"set",0,l,"unsafeMake",0,a,"update",0,o],660421);var g=e.i(266417),y=e.i(777444),w=e.i(532102),S=e.i(915838),C=e.i(803847),E=e.i(192075),v=e.i(886999),k=e.i(862409),x=e.i(681830);let I=Symbol.for("effect/QueueEnqueue"),_=Symbol.for("effect/QueueDequeue"),F=Symbol.for("effect/QueueStrategy"),M=Symbol.for("effect/BackingQueue"),A={_A:e=>e},R={_A:e=>e},z={_In:e=>e},T={_Out:e=>e};class W extends w.Class{queue;takers;shutdownHook;shutdownFlag;strategy;[I]=z;[_]=T;constructor(e,t,i,r,n){super(),this.queue=e,this.takers=t,this.shutdownHook=i,this.shutdownFlag=r,this.strategy=n}pipe(){return(0,k.pipeArguments)(this,arguments)}commit(){return this.take}capacity(){return this.queue.capacity()}get size(){return t.suspend(()=>t.catchAll(this.unsafeSize(),()=>t.interrupt))}unsafeSize(){return E.get(this.shutdownFlag)?v.none():v.some(this.queue.length()-C.length(this.takers)+this.strategy.surplusSize())}get isEmpty(){return t.map(this.size,e=>e<=0)}get isFull(){return t.map(this.size,e=>e>=this.capacity())}get shutdown(){return t.uninterruptible(t.withFiberRuntime(e=>((0,S.pipe)(this.shutdownFlag,E.set(!0)),(0,S.pipe)(i.forEachConcurrentDiscard(ei(this.takers),i=>t.deferredInterruptWith(i,e.id()),!1,!1),t.zipRight(this.strategy.shutdown),t.whenEffect(t.deferredSucceed(this.shutdownHook,void 0)),t.asVoid))))}get isShutdown(){return t.sync(()=>E.get(this.shutdownFlag))}get awaitShutdown(){return t.deferredAwait(this.shutdownHook)}isActive(){return!E.get(this.shutdownFlag)}unsafeOffer(e){let t;if(E.get(this.shutdownFlag))return!1;if(0===this.queue.length()){let i=(0,S.pipe)(this.takers,C.poll(C.EmptyMutableQueue));i!==C.EmptyMutableQueue?(ee(i,e),t=!0):t=!1}else t=!1;if(t)return!0;let i=this.queue.offer(e);return ea(this.strategy,this.queue,this.takers),i}offer(e){return t.suspend(()=>{let i;if(E.get(this.shutdownFlag))return t.interrupt;if(0===this.queue.length()){let t=(0,S.pipe)(this.takers,C.poll(C.EmptyMutableQueue));t!==C.EmptyMutableQueue?(ee(t,e),i=!0):i=!1}else i=!1;if(i)return t.succeed(!0);let r=this.queue.offer(e);return ea(this.strategy,this.queue,this.takers),r?t.succeed(!0):this.strategy.handleSurplus([e],this.queue,this.takers,this.shutdownFlag)})}offerAll(e){return t.suspend(()=>{if(E.get(this.shutdownFlag))return t.interrupt;let i=g.fromIterable(e),r=0===this.queue.length()?g.fromIterable(er(this.takers,i.length)):g.empty,[n,a]=(0,S.pipe)(i,g.splitAt(r.length));for(let e=0;e<r.length;e++)ee(r[e],n[e]);if(0===a.length)return t.succeed(!0);let s=this.queue.offerAll(a);return ea(this.strategy,this.queue,this.takers),y.isEmpty(s)?t.succeed(!0):this.strategy.handleSurplus(s,this.queue,this.takers,this.shutdownFlag)})}get take(){return t.withFiberRuntime(e=>{if(E.get(this.shutdownFlag))return t.interrupt;let i=this.queue.poll(C.EmptyMutableQueue);if(i!==C.EmptyMutableQueue)return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),t.succeed(i);{let i=t.deferredUnsafeMake(e.id());return(0,S.pipe)(t.suspend(()=>((0,S.pipe)(this.takers,C.offer(i)),ea(this.strategy,this.queue,this.takers),E.get(this.shutdownFlag)?t.interrupt:t.deferredAwait(i))),t.onInterrupt(()=>t.sync(()=>en(this.takers,i))))}})}get takeAll(){return t.suspend(()=>E.get(this.shutdownFlag)?t.interrupt:t.sync(()=>{let e=this.queue.pollUpTo(1/0);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),y.fromIterable(e)}))}takeUpTo(e){return t.suspend(()=>E.get(this.shutdownFlag)?t.interrupt:t.sync(()=>{let t=this.queue.pollUpTo(e);return this.strategy.unsafeOnQueueEmptySpace(this.queue,this.takers),y.fromIterable(t)}))}takeBetween(e,i){return t.suspend(()=>D(this,e,i,y.empty()))}}let D=(e,i,r,n)=>r<i?t.succeed(n):(0,S.pipe)(Q(e,r),t.flatMap(a=>{let s=i-a.length;return 1===s?(0,S.pipe)(H(e),t.map(e=>(0,S.pipe)(n,y.appendAll(a),y.append(e)))):s>1?(0,S.pipe)(H(e),t.flatMap(t=>D(e,s-1,r-a.length-1,(0,S.pipe)(n,y.appendAll(a),y.append(t))))):t.succeed((0,S.pipe)(n,y.appendAll(a)))})),O=e=>(0,x.hasProperty)(e,I),P=e=>(0,x.hasProperty)(e,_),L=(e,i)=>(0,S.pipe)(t.deferredMake(),t.map(t=>{let r;return r=C.unbounded(),new W(e,r,t,E.make(!1),i)}));class N{mutable;[M]=R;constructor(e){this.mutable=e}poll(e){return C.poll(this.mutable,e)}pollUpTo(e){return C.pollUpTo(this.mutable,e)}offerAll(e){return C.offerAll(this.mutable,e)}offer(e){return C.offer(this.mutable,e)}capacity(){return C.capacity(this.mutable)}length(){return C.length(this.mutable)}}let B=e=>new N(e),q=(0,S.dual)(2,(e,t)=>e.offer(t)),U=(0,S.dual)(2,(e,t)=>e.unsafeOffer(t)),j=(0,S.dual)(2,(e,t)=>e.offerAll(t)),H=e=>e.take,Q=(0,S.dual)(2,(e,t)=>e.takeUpTo(t)),V=(0,S.dual)(3,(e,t,i)=>e.takeBetween(t,i)),G=(0,S.dual)(2,(e,t)=>e.takeBetween(t,t)),$=()=>new X,K=()=>new Z,J=()=>new Y;class X{[F]=A;putters=C.unbounded();surplusSize(){return C.length(this.putters)}onCompleteTakersWithEmptyQueue(e){for(;!C.isEmpty(this.putters)&&!C.isEmpty(e);){let t=C.poll(e,void 0),i=C.poll(this.putters,void 0);i[2]&&ee(i[1],!0),ee(t,i[0])}}get shutdown(){return(0,S.pipe)(t.fiberId,t.flatMap(e=>(0,S.pipe)(t.sync(()=>ei(this.putters)),t.flatMap(r=>i.forEachConcurrentDiscard(r,([i,r,n])=>n?(0,S.pipe)(t.deferredInterruptWith(r,e),t.asVoid):t.void,!1,!1)))))}handleSurplus(e,i,r,n){return t.withFiberRuntime(a=>{let s=t.deferredUnsafeMake(a.id());return(0,S.pipe)(t.suspend(()=>(this.unsafeOffer(e,s),this.unsafeOnQueueEmptySpace(i,r),ea(this,i,r),E.get(n)?t.interrupt:t.deferredAwait(s))),t.onInterrupt(()=>t.sync(()=>this.unsafeRemove(s))))})}unsafeOnQueueEmptySpace(e,t){let i=!0;for(;i&&(e.capacity()===1/0||e.length()<e.capacity());){let r=(0,S.pipe)(this.putters,C.poll(C.EmptyMutableQueue));if(r===C.EmptyMutableQueue)i=!1;else{let i=e.offer(r[0]);i&&r[2]?ee(r[1],!0):i||et(this.putters,(0,S.pipe)(ei(this.putters),y.prepend(r))),ea(this,e,t)}}}unsafeOffer(e,t){let i=g.fromIterable(e);for(let e=0;e<i.length;e++){let r=i[e];e===i.length-1?(0,S.pipe)(this.putters,C.offer([r,t,!0])):(0,S.pipe)(this.putters,C.offer([r,t,!1]))}}unsafeRemove(e){et(this.putters,(0,S.pipe)(ei(this.putters),y.filter(([,t])=>t!==e)))}}class Z{[F]=A;surplusSize(){return 0}get shutdown(){return t.void}onCompleteTakersWithEmptyQueue(){}handleSurplus(e,i,r,n){return t.succeed(!1)}unsafeOnQueueEmptySpace(e,t){}}class Y{[F]=A;surplusSize(){return 0}get shutdown(){return t.void}onCompleteTakersWithEmptyQueue(){}handleSurplus(e,i,r,n){return t.sync(()=>(this.unsafeOffer(i,e),ea(this,i,r),!0))}unsafeOnQueueEmptySpace(e,t){}unsafeOffer(e,t){let i,r=t[Symbol.iterator](),n=!0;for(;!(i=r.next()).done&&n;){if(0===e.capacity())return;e.poll(C.EmptyMutableQueue),n=e.offer(i.value)}}}let ee=(e,i)=>t.deferredUnsafeDone(e,t.succeed(i)),et=(e,t)=>(0,S.pipe)(e,C.offerAll(t)),ei=e=>(0,S.pipe)(e,C.pollUpTo(1/0)),er=(e,t)=>(0,S.pipe)(e,C.pollUpTo(t)),en=(e,t)=>{et(e,(0,S.pipe)(ei(e),y.filter(e=>t!==e)))},ea=(e,t,i)=>{let r=!0;for(;r&&0!==t.length();){let n=(0,S.pipe)(i,C.poll(C.EmptyMutableQueue));if(n!==C.EmptyMutableQueue){let a=t.poll(C.EmptyMutableQueue);a!==C.EmptyMutableQueue?(ee(n,a),e.unsafeOnQueueEmptySpace(t,i)):et(i,(0,S.pipe)(ei(i),y.prepend(n))),r=!0}else r=!1}r&&0===t.length()&&!C.isEmpty(i)&&e.onCompleteTakersWithEmptyQueue(i)};e.s(["BackingQueueTypeId",0,M,"DequeueTypeId",0,_,"EnqueueTypeId",0,I,"QueueStrategyTypeId",0,F,"awaitShutdown",0,e=>e.awaitShutdown,"backPressureStrategy",0,$,"bounded",0,e=>(0,S.pipe)(t.sync(()=>C.bounded(e)),t.flatMap(e=>L(B(e),$()))),"capacity",0,e=>e.capacity(),"dequeueVariance",0,T,"dropping",0,e=>(0,S.pipe)(t.sync(()=>C.bounded(e)),t.flatMap(e=>L(B(e),K()))),"droppingStrategy",0,K,"enqueueVariance",0,z,"isDequeue",0,P,"isEmpty",0,e=>e.isEmpty,"isEnqueue",0,O,"isFull",0,e=>e.isFull,"isQueue",0,e=>O(e)&&P(e),"isShutdown",0,e=>e.isShutdown,"make",0,L,"offer",0,q,"offerAll",0,j,"poll",0,e=>t.map(e.takeUpTo(1),y.head),"shutdown",0,e=>e.shutdown,"size",0,e=>e.size,"sliding",0,e=>(0,S.pipe)(t.sync(()=>C.bounded(e)),t.flatMap(e=>L(B(e),J()))),"slidingStrategy",0,J,"take",0,H,"takeAll",0,e=>e.takeAll,"takeBetween",0,V,"takeN",0,G,"takeUpTo",0,Q,"unbounded",0,()=>(0,S.pipe)(t.sync(()=>C.unbounded()),t.flatMap(e=>L(B(e),K()))),"unsafeOffer",0,U],552452)},979475,e=>{"use strict";var t=e.i(777444),i=e.i(532102),r=e.i(915838),n=e.i(803847),a=e.i(192075),s=e.i(292546),u=e.i(886999),l=e.i(862409),o=e.i(449969),p=e.i(579977),c=e.i(916142),h=e.i(552452);let f=Symbol.for("effect/PubSub/AbsentValue"),d=(e,t)=>i=>{i.has(e)||i.set(e,new Set),i.get(e).add(t)},m=(e,t)=>i=>{if(!i.has(e))return;let r=i.get(e);r.delete(t),0===r.size&&i.delete(e)},b=(0,r.dual)(2,(e,t)=>e.publish(t)),g=e=>{let t="number"==typeof e?{capacity:e}:e;R(t.capacity);let i=t.replay&&t.replay>0?new H(Math.ceil(t.replay)):void 0;return 1===t.capacity?new E(i):(0,s.nextPow2)(t.capacity)===t.capacity?new S(t.capacity,i):new y(t.capacity,i)};class y{capacity;replayBuffer;array;publisherIndex=0;subscribers;subscriberCount=0;subscribersIndex=0;constructor(e,t){this.capacity=e,this.replayBuffer=t,this.array=Array.from({length:e}),this.subscribers=Array.from({length:e})}replayWindow(){return this.replayBuffer?new Q(this.replayBuffer):V}isEmpty(){return this.publisherIndex===this.subscribersIndex}isFull(){return this.publisherIndex===this.subscribersIndex+this.capacity}size(){return this.publisherIndex-this.subscribersIndex}publish(e){if(this.isFull())return!1;if(0!==this.subscriberCount){let t=this.publisherIndex%this.capacity;this.array[t]=e,this.subscribers[t]=this.subscriberCount,this.publisherIndex+=1}return this.replayBuffer&&this.replayBuffer.offer(e),!0}publishAll(e){if(0===this.subscriberCount)return this.replayBuffer&&this.replayBuffer.offerAll(e),t.empty();let i=t.fromIterable(e),r=i.length,n=this.publisherIndex-this.subscribersIndex,a=Math.min(r,this.capacity-n);if(0===a)return i;let s=0,u=this.publisherIndex+a;for(;this.publisherIndex!==u;){let e=t.unsafeGet(i,s++),r=this.publisherIndex%this.capacity;this.array[r]=e,this.subscribers[r]=this.subscriberCount,this.publisherIndex+=1,this.replayBuffer&&this.replayBuffer.offer(e)}return t.drop(i,s)}slide(){if(this.subscribersIndex!==this.publisherIndex){let e=this.subscribersIndex%this.capacity;this.array[e]=f,this.subscribers[e]=0,this.subscribersIndex+=1}this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.subscriberCount+=1,new w(this,this.publisherIndex,!1)}}class w{self;subscriberIndex;unsubscribed;constructor(e,t,i){this.self=e,this.subscriberIndex=t,this.unsubscribed=i}isEmpty(){return this.unsubscribed||this.self.publisherIndex===this.subscriberIndex||this.self.publisherIndex===this.self.subscribersIndex}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(e){if(this.unsubscribed)return e;if(this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex),this.subscriberIndex!==this.self.publisherIndex){let e=this.subscriberIndex%this.self.capacity,t=this.self.array[e];return this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=f,this.self.subscribersIndex+=1),this.subscriberIndex+=1,t}return e}pollUpTo(e){if(this.unsubscribed)return t.empty();this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);let i=Math.min(e,this.self.publisherIndex-this.subscriberIndex);if(i<=0)return t.empty();let r=[],n=this.subscriberIndex+i;for(;this.subscriberIndex!==n;){let e=this.subscriberIndex%this.self.capacity,t=this.self.array[e];this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=f,this.self.subscribersIndex+=1),r.push(t),this.subscriberIndex+=1}return t.fromIterable(r)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.subscriberCount-=1,this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);this.subscriberIndex!==this.self.publisherIndex;){let e=this.subscriberIndex%this.self.capacity;this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=f,this.self.subscribersIndex+=1),this.subscriberIndex+=1}}}class S{capacity;replayBuffer;array;mask;publisherIndex=0;subscribers;subscriberCount=0;subscribersIndex=0;constructor(e,t){this.capacity=e,this.replayBuffer=t,this.array=Array.from({length:e}),this.mask=e-1,this.subscribers=Array.from({length:e})}replayWindow(){return this.replayBuffer?new Q(this.replayBuffer):V}isEmpty(){return this.publisherIndex===this.subscribersIndex}isFull(){return this.publisherIndex===this.subscribersIndex+this.capacity}size(){return this.publisherIndex-this.subscribersIndex}publish(e){if(this.isFull())return!1;if(0!==this.subscriberCount){let t=this.publisherIndex&this.mask;this.array[t]=e,this.subscribers[t]=this.subscriberCount,this.publisherIndex+=1}return this.replayBuffer&&this.replayBuffer.offer(e),!0}publishAll(e){if(0===this.subscriberCount)return this.replayBuffer&&this.replayBuffer.offerAll(e),t.empty();let i=t.fromIterable(e),r=i.length,n=this.publisherIndex-this.subscribersIndex,a=Math.min(r,this.capacity-n);if(0===a)return i;let s=0,u=this.publisherIndex+a;for(;this.publisherIndex!==u;){let e=t.unsafeGet(i,s++),r=this.publisherIndex&this.mask;this.array[r]=e,this.subscribers[r]=this.subscriberCount,this.publisherIndex+=1,this.replayBuffer&&this.replayBuffer.offer(e)}return t.drop(i,s)}slide(){if(this.subscribersIndex!==this.publisherIndex){let e=this.subscribersIndex&this.mask;this.array[e]=f,this.subscribers[e]=0,this.subscribersIndex+=1}this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.subscriberCount+=1,new C(this,this.publisherIndex,!1)}}class C{self;subscriberIndex;unsubscribed;constructor(e,t,i){this.self=e,this.subscriberIndex=t,this.unsubscribed=i}isEmpty(){return this.unsubscribed||this.self.publisherIndex===this.subscriberIndex||this.self.publisherIndex===this.self.subscribersIndex}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(e){if(this.unsubscribed)return e;if(this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex),this.subscriberIndex!==this.self.publisherIndex){let e=this.subscriberIndex&this.self.mask,t=this.self.array[e];return this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=f,this.self.subscribersIndex+=1),this.subscriberIndex+=1,t}return e}pollUpTo(e){if(this.unsubscribed)return t.empty();this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);let i=Math.min(e,this.self.publisherIndex-this.subscriberIndex);if(i<=0)return t.empty();let r=[],n=this.subscriberIndex+i;for(;this.subscriberIndex!==n;){let e=this.subscriberIndex&this.self.mask,t=this.self.array[e];this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=f,this.self.subscribersIndex+=1),r.push(t),this.subscriberIndex+=1}return t.fromIterable(r)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.subscriberCount-=1,this.subscriberIndex=Math.max(this.subscriberIndex,this.self.subscribersIndex);this.subscriberIndex!==this.self.publisherIndex;){let e=this.subscriberIndex&this.self.mask;this.self.subscribers[e]-=1,0===this.self.subscribers[e]&&(this.self.array[e]=f,this.self.subscribersIndex+=1),this.subscriberIndex+=1}}}class E{replayBuffer;publisherIndex=0;subscriberCount=0;subscribers=0;value=f;capacity=1;constructor(e){this.replayBuffer=e}replayWindow(){return this.replayBuffer?new Q(this.replayBuffer):V}pipe(){return(0,l.pipeArguments)(this,arguments)}isEmpty(){return 0===this.subscribers}isFull(){return!this.isEmpty()}size(){return+!this.isEmpty()}publish(e){return!this.isFull()&&(0!==this.subscriberCount&&(this.value=e,this.subscribers=this.subscriberCount,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(e),!0)}publishAll(e){if(0===this.subscriberCount)return this.replayBuffer&&this.replayBuffer.offerAll(e),t.empty();let i=t.fromIterable(e);return t.isEmpty(i)?i:this.publish(t.unsafeHead(i))?t.drop(i,1):i}slide(){this.isFull()&&(this.subscribers=0,this.value=f),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.subscriberCount+=1,new v(this,this.publisherIndex,!1)}}class v{self;subscriberIndex;unsubscribed;constructor(e,t,i){this.self=e,this.subscriberIndex=t,this.unsubscribed=i}isEmpty(){return this.unsubscribed||0===this.self.subscribers||this.subscriberIndex===this.self.publisherIndex}size(){return+!this.isEmpty()}poll(e){if(this.isEmpty())return e;let t=this.self.value;return this.self.subscribers-=1,0===this.self.subscribers&&(this.self.value=f),this.subscriberIndex+=1,t}pollUpTo(e){if(this.isEmpty()||e<1)return t.empty();let i=this.self.value;return this.self.subscribers-=1,0===this.self.subscribers&&(this.self.value=f),this.subscriberIndex+=1,t.of(i)}unsubscribe(){this.unsubscribed||(this.unsubscribed=!0,this.self.subscriberCount-=1,this.subscriberIndex!==this.self.publisherIndex&&(this.self.subscribers-=1,0===this.self.subscribers&&(this.self.value=f)))}}class k{replayBuffer;publisherHead={value:f,subscribers:0,next:null};publisherTail=this.publisherHead;publisherIndex=0;subscribersIndex=0;capacity=Number.MAX_SAFE_INTEGER;constructor(e){this.replayBuffer=e}replayWindow(){return this.replayBuffer?new Q(this.replayBuffer):V}isEmpty(){return this.publisherHead===this.publisherTail}isFull(){return!1}size(){return this.publisherIndex-this.subscribersIndex}publish(e){let t=this.publisherTail.subscribers;return 0!==t&&(this.publisherTail.next={value:e,subscribers:t,next:null},this.publisherTail=this.publisherTail.next,this.publisherIndex+=1),this.replayBuffer&&this.replayBuffer.offer(e),!0}publishAll(e){if(0!==this.publisherTail.subscribers)for(let t of e)this.publish(t);else this.replayBuffer&&this.replayBuffer.offerAll(e);return t.empty()}slide(){this.publisherHead!==this.publisherTail&&(this.publisherHead=this.publisherHead.next,this.publisherHead.value=f,this.subscribersIndex+=1),this.replayBuffer&&this.replayBuffer.slide()}subscribe(){return this.publisherTail.subscribers+=1,new x(this,this.publisherTail,this.publisherIndex,!1)}}class x{self;subscriberHead;subscriberIndex;unsubscribed;constructor(e,t,i,r){this.self=e,this.subscriberHead=t,this.subscriberIndex=i,this.unsubscribed=r}isEmpty(){if(this.unsubscribed)return!0;let e=!0,t=!0;for(;t;)this.subscriberHead===this.self.publisherTail?t=!1:this.subscriberHead.next.value!==f?(e=!1,t=!1):(this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1);return e}size(){return this.unsubscribed?0:this.self.publisherIndex-Math.max(this.subscriberIndex,this.self.subscribersIndex)}poll(e){if(this.unsubscribed)return e;let t=!0,i=e;for(;t;)if(this.subscriberHead===this.self.publisherTail)t=!1;else{let e=this.subscriberHead.next.value;e!==f&&(i=e,this.subscriberHead.subscribers-=1,0===this.subscriberHead.subscribers&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=f,this.self.subscribersIndex+=1),t=!1),this.subscriberHead=this.subscriberHead.next,this.subscriberIndex+=1}return i}pollUpTo(e){let i=[],r=0;for(;r!==e;){let t=this.poll(f);t===f?r=e:(i.push(t),r+=1)}return t.fromIterable(i)}unsubscribe(){if(!this.unsubscribed)for(this.unsubscribed=!0,this.self.publisherTail.subscribers-=1;this.subscriberHead!==this.self.publisherTail;)this.subscriberHead.next.value!==f&&(this.subscriberHead.subscribers-=1,0===this.subscriberHead.subscribers&&(this.self.publisherHead=this.self.publisherHead.next,this.self.publisherHead.value=f,this.self.subscribersIndex+=1)),this.subscriberHead=this.subscriberHead.next}}class I extends i.Class{pubsub;subscribers;subscription;pollers;shutdownHook;shutdownFlag;strategy;replayWindow;[h.DequeueTypeId]=h.dequeueVariance;constructor(e,t,i,r,n,a,s,u){super(),this.pubsub=e,this.subscribers=t,this.subscription=i,this.pollers=r,this.shutdownHook=n,this.shutdownFlag=a,this.strategy=s,this.replayWindow=u}commit(){return this.take}pipe(){return(0,l.pipeArguments)(this,arguments)}capacity(){return this.pubsub.capacity}isActive(){return!a.get(this.shutdownFlag)}get size(){return o.suspend(()=>a.get(this.shutdownFlag)?o.interrupt:o.succeed(this.subscription.size()+this.replayWindow.remaining))}unsafeSize(){return a.get(this.shutdownFlag)?u.none():u.some(this.subscription.size()+this.replayWindow.remaining)}get isFull(){return o.suspend(()=>a.get(this.shutdownFlag)?o.interrupt:o.succeed(this.subscription.size()===this.capacity()))}get isEmpty(){return o.map(this.size,e=>0===e)}get shutdown(){return o.uninterruptible(o.withFiberRuntime(e=>(a.set(this.shutdownFlag,!0),(0,r.pipe)(c.forEachParUnbounded(W(this.pollers),t=>o.deferredInterruptWith(t,e.id()),!1),o.zipRight(o.sync(()=>{this.subscribers.delete(this.subscription),this.subscription.unsubscribe(),this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers)})),o.whenEffect(o.deferredSucceed(this.shutdownHook,void 0)),o.asVoid))))}get isShutdown(){return o.sync(()=>a.get(this.shutdownFlag))}get awaitShutdown(){return o.deferredAwait(this.shutdownHook)}get take(){return o.withFiberRuntime(e=>{if(a.get(this.shutdownFlag))return o.interrupt;if(this.replayWindow.remaining>0){let e=this.replayWindow.take();return o.succeed(e)}let t=n.isEmpty(this.pollers)?this.subscription.poll(n.EmptyMutableQueue):n.EmptyMutableQueue;if(t!==n.EmptyMutableQueue)return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),o.succeed(t);{let t=o.deferredUnsafeMake(e.id());return(0,r.pipe)(o.suspend(()=>((0,r.pipe)(this.pollers,n.offer(t)),(0,r.pipe)(this.subscribers,d(this.subscription,this.pollers)),this.strategy.unsafeCompletePollers(this.pubsub,this.subscribers,this.subscription,this.pollers),a.get(this.shutdownFlag)?o.interrupt:o.deferredAwait(t))),o.onInterrupt(()=>o.sync(()=>L(this.pollers,t))))}})}get takeAll(){return o.suspend(()=>{if(a.get(this.shutdownFlag))return o.interrupt;let e=n.isEmpty(this.pollers)?D(this.subscription):t.empty();return(this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),this.replayWindow.remaining>0)?o.succeed(t.appendAll(this.replayWindow.takeAll(),e)):o.succeed(e)})}takeUpTo(e){return o.suspend(()=>{let i;if(a.get(this.shutdownFlag))return o.interrupt;if(this.replayWindow.remaining>=e){let t=this.replayWindow.takeN(e);return o.succeed(t)}this.replayWindow.remaining>0&&(i=this.replayWindow.takeAll(),e-=i.length);let r=n.isEmpty(this.pollers)?O(this.subscription,e):t.empty();return this.strategy.unsafeOnPubSubEmptySpace(this.pubsub,this.subscribers),i?o.succeed(t.appendAll(i,r)):o.succeed(r)})}takeBetween(e,i){return o.suspend(()=>_(this,e,i,t.empty()))}}let _=(e,i,n,a)=>n<i?o.succeed(a):(0,r.pipe)(e.takeUpTo(n),o.flatMap(s=>{let u=i-s.length;return 1===u?(0,r.pipe)(e.take,o.map(e=>(0,r.pipe)(a,t.appendAll(s),t.append(e)))):u>1?(0,r.pipe)(e.take,o.flatMap(i=>_(e,u-1,n-s.length-1,(0,r.pipe)(a,t.appendAll(s),t.append(i))))):o.succeed((0,r.pipe)(a,t.appendAll(s)))}));class F{pubsub;subscribers;scope;shutdownHook;shutdownFlag;strategy;[h.EnqueueTypeId]=h.enqueueVariance;[h.DequeueTypeId]=h.dequeueVariance;constructor(e,t,i,r,n,a){this.pubsub=e,this.subscribers=t,this.scope=i,this.shutdownHook=r,this.shutdownFlag=n,this.strategy=a}capacity(){return this.pubsub.capacity}get size(){return o.suspend(()=>a.get(this.shutdownFlag)?o.interrupt:o.sync(()=>this.pubsub.size()))}unsafeSize(){return a.get(this.shutdownFlag)?u.none():u.some(this.pubsub.size())}get isFull(){return o.map(this.size,e=>e===this.capacity())}get isEmpty(){return o.map(this.size,e=>0===e)}get awaitShutdown(){return o.deferredAwait(this.shutdownHook)}get isShutdown(){return o.sync(()=>a.get(this.shutdownFlag))}get shutdown(){return o.uninterruptible(o.withFiberRuntime(e=>((0,r.pipe)(this.shutdownFlag,a.set(!0)),(0,r.pipe)(this.scope.close(o.exitInterrupt(e.id())),o.zipRight(this.strategy.shutdown),o.whenEffect(o.deferredSucceed(this.shutdownHook,void 0)),o.asVoid))))}publish(e){return o.suspend(()=>a.get(this.shutdownFlag)?o.interrupt:this.pubsub.publish(e)?(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),o.succeed(!0)):this.strategy.handleSurplus(this.pubsub,this.subscribers,t.of(e),this.shutdownFlag))}isActive(){return!a.get(this.shutdownFlag)}unsafeOffer(e){return!a.get(this.shutdownFlag)&&!!this.pubsub.publish(e)&&(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),!0)}publishAll(e){return o.suspend(()=>{if(a.get(this.shutdownFlag))return o.interrupt;let i=P(this.pubsub,e);return(this.strategy.unsafeCompleteSubscribers(this.pubsub,this.subscribers),t.isEmpty(i))?o.succeed(!0):this.strategy.handleSurplus(this.pubsub,this.subscribers,i,this.shutdownFlag)})}get subscribe(){let e,t,i,r=o.tap(c.all([this.scope.fork(p.sequential),(e=this.pubsub,t=this.subscribers,i=this.strategy,o.map(o.deferredMake(),r=>{let s,u,l,o,p,c;return s=e,u=t,l=e.subscribe(),o=n.unbounded(),p=r,c=a.make(!1),new I(s,u,l,o,p,c,i,s.replayWindow())}))]),e=>e[0].addFinalizer(()=>e[1].shutdown));return o.map(c.acquireRelease(r,(e,t)=>e[0].close(t)),e=>e[1])}offer(e){return this.publish(e)}offerAll(e){return this.publishAll(e)}pipe(){return(0,l.pipeArguments)(this,arguments)}}let M=(e,t)=>o.flatMap(c.scopeMake(),i=>o.map(o.deferredMake(),r=>A(e,new Map,i,r,a.make(!1),t))),A=(e,t,i,r,n,a)=>new F(e,t,i,r,n,a),R=e=>{if(e<=0)throw new o.InvalidPubSubCapacityException(`Cannot construct PubSub with capacity of ${e}`)},z=(e,t)=>{o.deferredUnsafeDone(e,o.succeed(t))},T=(e,t)=>(0,r.pipe)(e,n.offerAll(t)),W=e=>(0,r.pipe)(e,n.pollUpTo(1/0)),D=e=>e.pollUpTo(1/0),O=(e,t)=>e.pollUpTo(t),P=(e,t)=>e.publishAll(t),L=(e,i)=>{T(e,(0,r.pipe)(W(e),t.filter(e=>e!==i)))};class N{publishers=n.unbounded();get shutdown(){return o.flatMap(o.fiberId,e=>o.flatMap(o.sync(()=>W(this.publishers)),t=>c.forEachConcurrentDiscard(t,([t,i,n])=>n?(0,r.pipe)(o.deferredInterruptWith(i,e),o.asVoid):o.void,!1,!1)))}handleSurplus(e,t,i,n){return o.withFiberRuntime(s=>{let u=o.deferredUnsafeMake(s.id());return(0,r.pipe)(o.suspend(()=>(this.unsafeOffer(i,u),this.unsafeOnPubSubEmptySpace(e,t),this.unsafeCompleteSubscribers(e,t),a.get(n)?o.interrupt:o.deferredAwait(u))),o.onInterrupt(()=>o.sync(()=>this.unsafeRemove(u))))})}unsafeOnPubSubEmptySpace(e,i){let a=!0;for(;a&&!e.isFull();){let s=(0,r.pipe)(this.publishers,n.poll(n.EmptyMutableQueue));if(s===n.EmptyMutableQueue)a=!1;else{let n=e.publish(s[0]);n&&s[2]?z(s[1],!0):n||T(this.publishers,(0,r.pipe)(W(this.publishers),t.prepend(s))),this.unsafeCompleteSubscribers(e,i)}}}unsafeCompletePollers(e,t,i,r){return U(this,e,t,i,r)}unsafeCompleteSubscribers(e,t){return j(this,e,t)}unsafeOffer(e,t){let i=e[Symbol.iterator](),a=i.next();if(!a.done)for(;;){let e=a.value;if((a=i.next()).done){(0,r.pipe)(this.publishers,n.offer([e,t,!0]));break}(0,r.pipe)(this.publishers,n.offer([e,t,!1]))}}unsafeRemove(e){T(this.publishers,(0,r.pipe)(W(this.publishers),t.filter(([t,i])=>i!==e)))}}class B{get shutdown(){return o.void}handleSurplus(e,t,i,r){return o.succeed(!1)}unsafeOnPubSubEmptySpace(e,t){}unsafeCompletePollers(e,t,i,r){return U(this,e,t,i,r)}unsafeCompleteSubscribers(e,t){return j(this,e,t)}}class q{get shutdown(){return o.void}handleSurplus(e,t,i,r){return o.sync(()=>(this.unsafeSlidingPublish(e,i),this.unsafeCompleteSubscribers(e,t),!0))}unsafeOnPubSubEmptySpace(e,t){}unsafeCompletePollers(e,t,i,r){return U(this,e,t,i,r)}unsafeCompleteSubscribers(e,t){return j(this,e,t)}unsafeSlidingPublish(e,t){let i=t[Symbol.iterator](),r=i.next();if(!r.done&&e.capacity>0){let t=r.value,n=!0;for(;n;){e.slide();let a=e.publish(t);a&&(r=i.next())&&!r.done?t=r.value:a&&(n=!1)}}}}let U=(e,i,a,s,u)=>{let l=!0;for(;l&&!s.isEmpty();){let o=(0,r.pipe)(u,n.poll(n.EmptyMutableQueue));if(o===n.EmptyMutableQueue)(0,r.pipe)(a,m(s,u)),n.isEmpty(u)?l=!1:(0,r.pipe)(a,d(s,u));else{let l=s.poll(n.EmptyMutableQueue);l===n.EmptyMutableQueue?T(u,(0,r.pipe)(W(u),t.prepend(o))):(z(o,l),e.unsafeOnPubSubEmptySpace(i,a))}}},j=(e,t,i)=>{for(let[r,n]of i)for(let a of n)e.unsafeCompletePollers(t,i,r,a)};class H{capacity;constructor(e){this.capacity=e}head={value:f,next:null};tail=this.head;size=0;index=0;slide(){this.index++}offer(e){this.tail.value=e,this.tail.next={value:f,next:null},this.tail=this.tail.next,this.size===this.capacity?this.head=this.head.next:this.size+=1}offerAll(e){for(let t of e)this.offer(t)}}class Q{buffer;head;index;remaining;constructor(e){this.buffer=e,this.index=e.index,this.remaining=e.size,this.head=e.head}fastForward(){for(;this.index<this.buffer.index;)this.head=this.head.next,this.index++}take(){if(0===this.remaining)return;this.index<this.buffer.index&&this.fastForward(),this.remaining--;let e=this.head.value;return this.head=this.head.next,e}takeN(e){if(0===this.remaining)return t.empty();this.index<this.buffer.index&&this.fastForward();let i=Math.min(e,this.remaining),r=Array(i);for(let e=0;e<i;e++){let t=this.head.value;this.head=this.head.next,r[e]=t}return this.remaining-=i,t.unsafeFromArray(r)}takeAll(){return this.takeN(this.remaining)}}let V={remaining:0,take:()=>void 0,takeN:()=>t.empty(),takeAll:()=>t.empty()};e.s(["bounded",0,e=>o.suspend(()=>M(g(e),new N)),"dropping",0,e=>o.suspend(()=>M(g(e),new B)),"publish",0,b,"shutdown",0,e=>e.shutdown,"sliding",0,e=>o.suspend(()=>M(g(e),new q)),"subscribe",0,e=>e.subscribe,"unbounded",0,e=>o.suspend(()=>{let t;return M((t=e,new k(t?.replay?new H(t.replay):void 0)),new B)})],979475)},383615,e=>{"use strict";var t=e.i(552452);t.EnqueueTypeId;let i=t.DequeueTypeId;t.QueueStrategyTypeId,t.BackingQueueTypeId,t.isQueue,t.isDequeue,t.isEnqueue,t.backPressureStrategy,t.droppingStrategy,t.slidingStrategy,t.make;let r=t.bounded,n=t.dropping,a=t.sliding,s=t.unbounded,u=t.capacity,l=t.size,o=t.isEmpty,p=t.isFull,c=t.isShutdown,h=t.awaitShutdown,f=t.shutdown,d=t.offer,m=t.unsafeOffer,b=t.offerAll,g=t.poll,y=t.take,w=t.takeAll,S=t.takeUpTo,C=t.takeBetween,E=t.takeN;e.s(["DequeueTypeId",0,i,"awaitShutdown",0,h,"bounded",0,r,"capacity",0,u,"dropping",0,n,"isEmpty",0,o,"isFull",0,p,"isShutdown",0,c,"offer",0,d,"offerAll",0,b,"poll",0,g,"shutdown",0,f,"size",0,l,"sliding",0,a,"take",0,y,"takeAll",0,w,"takeBetween",0,C,"takeN",0,E,"takeUpTo",0,S,"unbounded",0,s,"unsafeOffer",0,m])},913578,223356,981354,251785,377473,e=>{"use strict";var t=e.i(51889),i=e.i(777444),r=e.i(741140),n=e.i(405763),a=e.i(878753),s=e.i(343469),u=e.i(615446),l=e.i(980914),o=e.i(462241),p=e.i(660421),c=e.i(915838),h=e.i(874068),f=e.i(886999),d=e.i(681830),m=e.i(979475),b=e.i(383615),g=e.i(335260),y=e.i(797734),w=e.i(527827),S=e.i(559238),C=e.i(494576),E=e.i(862409);let v="Continue",k=Symbol.for("effect/ChannelChildExecutorDecision"),x={[k]:k},I=e=>{let t=Object.create(x);return t._tag=v,t},_="ContinuationK",F=Symbol.for("effect/ChannelContinuation"),M={_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutDone:e=>e,_OutErr2:e=>e,_OutElem:e=>e,_OutDone2:e=>e};class A{onSuccess;onHalt;_tag=_;[F]=M;constructor(e,t){this.onSuccess=e,this.onHalt=t}onExit(e){return l.isFailure(e)?this.onHalt(e.cause):this.onSuccess(e.value)}}class R{finalizer;_tag="ContinuationFinalizer";[F]=M;constructor(e){this.finalizer=e}}let z="PullAfterNext",T={[Symbol.for("effect/ChannelUpstreamPullStrategy")]:{_A:e=>e}},W=e=>{let t=Object.create(T);return t._tag=z,t.emitSeparator=e,t},D="BracketOut",O="Bridge",P="ConcatAll",L="Emit",N="Ensuring",B="Fail",q="Fold",U="FromEffect",j="PipeTo",H="Provide",Q="Read",V="Succeed",G="SucceedNow",$="Suspend",K=Symbol.for("effect/Channel"),J={[K]:{_Env:e=>e,_InErr:e=>e,_InElem:e=>e,_InDone:e=>e,_OutErr:e=>e,_OutElem:e=>e,_OutDone:e=>e},pipe(){return(0,E.pipeArguments)(this,arguments)}},X=e=>(0,d.hasProperty)(e,K)||a.isEffect(e),Z=(0,c.dual)(2,(e,t)=>{let i=Object.create(J);return i._tag=D,i.acquire=()=>e,i.finalizer=t,i}),Y=(0,c.dual)(2,(e,t)=>{let i=Object.create(J);return i._tag=q,i.channel=e,i.k=new A(ew,t),i}),ee=e=>eC(()=>{let t=[];return ec(ed(e,et(t)),e=>eE(()=>[i.fromIterable(t),e]))}),et=e=>eg({onInput:t=>ec(eE(()=>{e.push(t)}),()=>et(e)),onFailure:el,onDone:eS}),ei=e=>er(e,c.constVoid,c.constVoid),er=(e,t,i)=>{let r=Object.create(J);return r._tag=P,r.combineInners=t,r.combineAll=i,r.onPull=()=>W(f.none()),r.onEmit=()=>I,r.value=()=>e,r.k=c.identity,r},en=(0,c.dual)(4,(e,t,i,r)=>{let n=Object.create(J);return n._tag=P,n.combineInners=i,n.combineAll=r,n.onPull=()=>W(f.none()),n.onEmit=()=>I,n.value=()=>e,n.k=t,n}),ea=(0,c.dual)(6,(e,t,i,r,n,a)=>{let s=Object.create(J);return s._tag=P,s.combineInners=i,s.combineAll=r,s.onPull=n,s.onEmit=a,s.value=()=>e,s.k=t,s}),es=(0,c.dual)(2,(e,t)=>{let i=Object.create(J);return i._tag=O,i.input=t,i.channel=e,i}),eu=(0,c.dual)(2,(e,t)=>{let i=Object.create(J);return i._tag=N,i.channel=e,i.finalizer=t,i}),el=e=>eo(t.fail(e)),eo=e=>ep(()=>e),ep=e=>{let t=Object.create(J);return t._tag=B,t.error=e,t},ec=(0,c.dual)(2,(e,t)=>{let i=Object.create(J);return i._tag=q,i.channel=e,i.k=new A(t,eo),i}),eh=(0,c.dual)(2,(e,t)=>{let i=Object.create(J);return i._tag=q,i.channel=e,i.k=new A(t.onSuccess,t.onFailure),i}),ef=e=>{let t=Object.create(J);return t._tag=U,t.effect=()=>e,t},ed=(0,c.dual)(2,(e,t)=>{let i=Object.create(J);return i._tag=j,i.left=()=>e,i.right=()=>t,i}),em=(0,c.dual)(2,(e,t)=>{let i=Object.create(J);return i._tag=H,i.context=()=>t,i.inner=e,i}),eb=e=>{let t=Object.create(J);return t._tag=Q,t.more=ew,t.done=new A(()=>el(e),()=>el(e)),t},eg=e=>ey({onInput:e.onInput,onFailure:i=>s.match(t.failureOrCause(i),{onLeft:e.onFailure,onRight:eo}),onDone:e.onDone}),ey=e=>{let t=Object.create(J);return t._tag=Q,t.more=e.onInput,t.done=new A(e.onDone,e.onFailure),t},ew=e=>eE(()=>e),eS=e=>{let t=Object.create(J);return t._tag=G,t.terminal=e,t},eC=e=>{let t=Object.create(J);return t._tag=$,t.channel=e,t},eE=e=>{let t=Object.create(J);return t._tag=V,t.evaluate=e,t},ev=eS(void 0),ek=e=>{let t=Object.create(J);return t._tag=L,t.out=e,t};e.s(["ChannelTypeId",0,K,"acquireReleaseOut",0,Z,"catchAllCause",0,Y,"collectElements",0,ee,"concatAll",0,ei,"concatAllWith",0,er,"concatMapWith",0,en,"concatMapWithCustom",0,ea,"embedInput",0,es,"ensuringWith",0,eu,"fail",0,el,"failCause",0,eo,"failCauseSync",0,ep,"failSync",0,e=>ep(()=>t.fail(e())),"flatMap",0,ec,"foldCauseChannel",0,eh,"fromEffect",0,ef,"isChannel",0,X,"pipeTo",0,ed,"provideContext",0,em,"readOrFail",0,eb,"readWith",0,eg,"readWithCause",0,ey,"succeed",0,ew,"succeedNow",0,eS,"suspend",0,eC,"sync",0,eE,"void",()=>ev,"write",0,ek],223356);let ex="Done",eI="Emit",e_="FromEffect",eF="Read",eM={[Symbol.for("effect/ChannelState")]:{_E:e=>e,_R:e=>e}},eA=()=>{let e=Object.create(eM);return e._tag=ex,e},eR=()=>{let e=Object.create(eM);return e._tag=eI,e},ez=e=>{let t=Object.create(eM);return t._tag=e_,t.effect=e,t},eT=(e,t,i,r)=>{let n=Object.create(eM);return n._tag=eF,n.upstream=e,n.onEffect=t,n.onEmit=i,n.onDone=r,n},eW=e=>e._tag===e_,eD=e=>eW(e)?a.ignore(e.effect):void 0,eO="PullFromChild",eP="PullFromUpstream",eL="DrainChildExecutors",eN="Emit";class eB{childExecutor;parentSubexecutor;onEmit;_tag=eO;constructor(e,t,i){this.childExecutor=e,this.parentSubexecutor=t,this.onEmit=i}close(e){let t=this.childExecutor.close(e),i=this.parentSubexecutor.close(e);return void 0!==t&&void 0!==i?a.zipWith(a.exit(t),a.exit(i),(e,t)=>(0,c.pipe)(e,l.zipRight(t))):void 0!==t?t:void 0!==i?i:void 0}enqueuePullFromChild(e){return this}}class eq{upstreamExecutor;createChild;lastDone;activeChildExecutors;combineChildResults;combineWithChildResult;onPull;onEmit;_tag=eP;constructor(e,t,i,r,n,a,s,u){this.upstreamExecutor=e,this.createChild=t,this.lastDone=i,this.activeChildExecutors=r,this.combineChildResults=n,this.combineWithChildResult=a,this.onPull=s,this.onEmit=u}close(e){let t=this.upstreamExecutor.close(e);return[...this.activeChildExecutors.map(t=>void 0!==t?t.childExecutor.close(e):void 0),t].reduce((e,t)=>void 0!==e&&void 0!==t?a.zipWith(e,a.exit(t),(e,t)=>l.zipRight(e,t)):void 0!==e?e:void 0!==t?a.exit(t):void 0,void 0)}enqueuePullFromChild(e){return new eq(this.upstreamExecutor,this.createChild,this.lastDone,[...this.activeChildExecutors,e],this.combineChildResults,this.combineWithChildResult,this.onPull,this.onEmit)}}class eU{upstreamExecutor;lastDone;activeChildExecutors;upstreamDone;combineChildResults;combineWithChildResult;onPull;_tag=eL;constructor(e,t,i,r,n,a,s){this.upstreamExecutor=e,this.lastDone=t,this.activeChildExecutors=i,this.upstreamDone=r,this.combineChildResults=n,this.combineWithChildResult=a,this.onPull=s}close(e){let t=this.upstreamExecutor.close(e);return[...this.activeChildExecutors.map(t=>void 0!==t?t.childExecutor.close(e):void 0),t].reduce((e,t)=>void 0!==e&&void 0!==t?a.zipWith(e,a.exit(t),(e,t)=>l.zipRight(e,t)):void 0!==e?e:void 0!==t?a.exit(t):void 0,void 0)}enqueuePullFromChild(e){return new eU(this.upstreamExecutor,this.lastDone,[...this.activeChildExecutors,e],this.upstreamDone,this.combineChildResults,this.combineWithChildResult,this.onPull)}}class ej{value;next;_tag=eN;constructor(e,t){this.value=e,this.next=t}close(e){return this.next.close(e)}enqueuePullFromChild(e){return this}}let eH={[Symbol.for("effect/ChannelUpstreamPullRequest")]:{_A:e=>e}},eQ=e=>{let t=Object.create(eH);return t._tag="Pulled",t.value=e,t};class eV{_activeSubexecutor=void 0;_cancelled=void 0;_closeLastSubstream=void 0;_currentChannel;_done=void 0;_doneStack=[];_emitted=void 0;_executeCloseLastSubstream;_input=void 0;_inProgressFinalizer=void 0;_providedEnv;constructor(e,t,i){this._currentChannel=e,this._executeCloseLastSubstream=i,this._providedEnv=t}run(){let e;for(;void 0===e;)if(void 0!==this._cancelled)e=this.processCancellation();else if(void 0!==this._activeSubexecutor)e=this.runSubexecutor();else try{if(void 0===this._currentChannel)e=eA();else switch(a.isEffect(this._currentChannel)&&(this._currentChannel=ef(this._currentChannel)),this._currentChannel._tag){case D:e=this.runBracketOut(this._currentChannel);break;case O:{let t=this._currentChannel.input;if(this._currentChannel=this._currentChannel.channel,void 0!==this._input){let i=this._input;this._input=void 0;let r=()=>a.flatMap(t.awaitRead(),()=>a.suspend(()=>{let e=i.run();switch(e._tag){case ex:return l.match(i.getDone(),{onFailure:e=>t.error(e),onSuccess:e=>t.done(e)});case eI:return a.flatMap(t.emit(i.getEmit()),()=>r());case e_:return a.matchCauseEffect(e.effect,{onFailure:e=>t.error(e),onSuccess:()=>r()});case eF:return eK(e,()=>r(),e=>t.error(e))}}));e=ez(a.flatMap(a.forkDaemon(a.interruptible(r())),e=>a.sync(()=>this.addFinalizer(t=>a.flatMap(o.interrupt(e),()=>a.suspend(()=>{let e=this.restorePipe(t,i);return void 0!==e?e:a.void}))))))}break}case P:{let e=new eV(this._currentChannel.value(),this._providedEnv,e=>a.sync(()=>{let t=void 0===this._closeLastSubstream?a.void:this._closeLastSubstream;this._closeLastSubstream=(0,c.pipe)(t,a.zipRight(e))}));e._input=this._input;let t=this._currentChannel;this._activeSubexecutor=new eq(e,e=>t.k(e),void 0,[],(e,i)=>t.combineInners(e,i),(e,i)=>t.combineAll(e,i),e=>t.onPull(e),e=>t.onEmit(e)),this._closeLastSubstream=void 0,this._currentChannel=void 0;break}case L:this._emitted=this._currentChannel.out,this._currentChannel=void 0!==this._activeSubexecutor?void 0:ev,e=eR();break;case N:this.runEnsuring(this._currentChannel);break;case B:e=this.doneHalt(this._currentChannel.error());break;case q:this._doneStack.push(this._currentChannel.k),this._currentChannel=this._currentChannel.channel;break;case U:{let t=void 0===this._providedEnv?this._currentChannel.effect():(0,c.pipe)(this._currentChannel.effect(),a.provide(this._providedEnv));e=ez(a.matchCauseEffect(t,{onFailure:e=>{let t=this.doneHalt(e);return void 0!==t&&eW(t)?t.effect:a.void},onSuccess:e=>{let t=this.doneSucceed(e);return void 0!==t&&eW(t)?t.effect:a.void}}));break}case j:{let e=this._input,t=new eV(this._currentChannel.left(),this._providedEnv,e=>this._executeCloseLastSubstream(e));t._input=e,this._input=t,this.addFinalizer(t=>{let i=this.restorePipe(t,e);return void 0!==i?i:a.void}),this._currentChannel=this._currentChannel.right();break}case H:{let e=this._providedEnv;this._providedEnv=this._currentChannel.context(),this._currentChannel=this._currentChannel.inner,this.addFinalizer(()=>a.sync(()=>{this._providedEnv=e}));break}case Q:{let t=this._currentChannel;e=eT(this._input,c.identity,e=>{try{this._currentChannel=t.more(e)}catch(e){this._currentChannel=t.done.onExit(l.die(e))}},e=>{let i=e=>t.done.onExit(e);this._currentChannel=i(e)});break}case V:e=this.doneSucceed(this._currentChannel.evaluate());break;case G:e=this.doneSucceed(this._currentChannel.terminal);break;case $:this._currentChannel=this._currentChannel.channel()}}catch(e){this._currentChannel=eo(t.die(e))}return e}getDone(){return this._done}getEmit(){return this._emitted}cancelWith(e){this._cancelled=e}clearInProgressFinalizer(){this._inProgressFinalizer=void 0}storeInProgressFinalizer(e){this._inProgressFinalizer=e}popAllFinalizers(e){let t=[],i=this._doneStack.pop();for(;i;)"ContinuationFinalizer"===i._tag&&t.push(i.finalizer),i=this._doneStack.pop();let r=0===t.length?a.void:e$(t,e);return this.storeInProgressFinalizer(r),r}popNextFinalizers(){let e=[];for(;0!==this._doneStack.length;){let t=this._doneStack[this._doneStack.length-1];if(t._tag===_)break;e.push(t),this._doneStack.pop()}return e}restorePipe(e,t){let i=this._input;return(this._input=t,void 0!==i)?i.close(e):a.void}close(e){let t,i,r=this._inProgressFinalizer;void 0!==r&&(t=(0,c.pipe)(r,a.ensuring(a.sync(()=>this.clearInProgressFinalizer()))));let n=this.popAllFinalizers(e);void 0!==n&&(i=(0,c.pipe)(n,a.ensuring(a.sync(()=>this.clearInProgressFinalizer()))));let s=void 0===this._activeSubexecutor?void 0:this._activeSubexecutor.close(e);if(void 0!==s||void 0!==t||void 0!==i)return(0,c.pipe)(a.exit(eG(s)),a.zip(a.exit(eG(t))),a.zip(a.exit(eG(i))),a.map(([[e,t],i])=>(0,c.pipe)(e,l.zipRight(t),l.zipRight(i))),a.uninterruptible,a.flatMap(e=>a.suspend(()=>e)))}doneSucceed(e){if(0===this._doneStack.length)return this._done=l.succeed(e),this._currentChannel=void 0,eA();let t=this._doneStack[this._doneStack.length-1];if(t._tag===_){this._doneStack.pop(),this._currentChannel=t.onSuccess(e);return}let i=this.popNextFinalizers();if(0===this._doneStack.length)return this._doneStack=i.reverse(),this._done=l.succeed(e),this._currentChannel=void 0,eA();let r=e$(i.map(e=>e.finalizer),l.succeed(e));return this.storeInProgressFinalizer(r),ez((0,c.pipe)(r,a.ensuring(a.sync(()=>this.clearInProgressFinalizer())),a.uninterruptible,a.flatMap(()=>a.sync(()=>this.doneSucceed(e)))))}doneHalt(e){if(0===this._doneStack.length)return this._done=l.failCause(e),this._currentChannel=void 0,eA();let i=this._doneStack[this._doneStack.length-1];if(i._tag===_){this._doneStack.pop();try{this._currentChannel=i.onHalt(e)}catch(e){this._currentChannel=eo(t.die(e))}return}let r=this.popNextFinalizers();if(0===this._doneStack.length)return this._doneStack=r.reverse(),this._done=l.failCause(e),this._currentChannel=void 0,eA();let n=e$(r.map(e=>e.finalizer),l.failCause(e));return this.storeInProgressFinalizer(n),ez((0,c.pipe)(n,a.ensuring(a.sync(()=>this.clearInProgressFinalizer())),a.uninterruptible,a.flatMap(()=>a.sync(()=>this.doneHalt(e)))))}processCancellation(){return this._currentChannel=void 0,this._done=this._cancelled,this._cancelled=void 0,eA()}runBracketOut(e){return ez(a.uninterruptible(a.matchCauseEffect(this.provide(e.acquire()),{onFailure:e=>a.sync(()=>{this._currentChannel=eo(e)}),onSuccess:t=>a.sync(()=>{this.addFinalizer(i=>this.provide(e.finalizer(t,i))),this._currentChannel=ek(t)})})))}provide(e){return void 0===this._providedEnv?e:(0,c.pipe)(e,a.provide(this._providedEnv))}runEnsuring(e){this.addFinalizer(e.finalizer),this._currentChannel=e.channel}addFinalizer(e){this._doneStack.push(new R(e))}runSubexecutor(){let e=this._activeSubexecutor;switch(e._tag){case eO:return this.pullFromChild(e.childExecutor,e.parentSubexecutor,e.onEmit,e);case eP:return this.pullFromUpstream(e);case eL:return this.drainChildExecutors(e);case eN:return this._emitted=e.value,this._activeSubexecutor=e.next,eR()}}replaceSubexecutor(e){this._currentChannel=void 0,this._activeSubexecutor=e}finishWithExit(e){let t=l.match(e,{onFailure:e=>this.doneHalt(e),onSuccess:e=>this.doneSucceed(e)});return this._activeSubexecutor=void 0,void 0===t?a.void:eW(t)?t.effect:a.void}finishSubexecutorWithCloseEffect(e,...t){this.addFinalizer(()=>(0,c.pipe)(t,a.forEach(t=>(0,c.pipe)(a.sync(()=>t(e)),a.flatMap(e=>void 0!==e?e:a.void)),{discard:!0})));let i=(0,c.pipe)(e,l.match({onFailure:e=>this.doneHalt(e),onSuccess:e=>this.doneSucceed(e)}));return this._activeSubexecutor=void 0,i}applyUpstreamPullStrategy(e,t,i){switch(i._tag){case z:{let r=!e||t.some(e=>void 0!==e);return[i.emitSeparator,r?[void 0,...t]:t]}case"PullAfterAllEnqueued":{let r=!e||t.some(e=>void 0!==e);return[i.emitSeparator,r?[...t,void 0]:t]}}}pullFromChild(e,t,i,r){return eT(e,c.identity,n=>{let a=i(n);switch(a._tag){case v:break;case"Close":this.finishWithDoneValue(e,t,a.value);break;case"Yield":{let e=t.enqueuePullFromChild(r);this.replaceSubexecutor(e)}}this._activeSubexecutor=new ej(n,this._activeSubexecutor)},l.match({onFailure:i=>{let r=this.handleSubexecutorFailure(e,t,i);return void 0===r?void 0:eD(r)},onSuccess:i=>{this.finishWithDoneValue(e,t,i)}}))}finishWithDoneValue(e,t,i){switch(t._tag){case eP:{let r=new eq(t.upstreamExecutor,t.createChild,void 0!==t.lastDone?t.combineChildResults(t.lastDone,i):i,t.activeChildExecutors,t.combineChildResults,t.combineWithChildResult,t.onPull,t.onEmit);this._closeLastSubstream=e.close(l.succeed(i)),this.replaceSubexecutor(r);break}case eL:{let r=new eU(t.upstreamExecutor,void 0!==t.lastDone?t.combineChildResults(t.lastDone,i):i,t.activeChildExecutors,t.upstreamDone,t.combineChildResults,t.combineWithChildResult,t.onPull);this._closeLastSubstream=e.close(l.succeed(i)),this.replaceSubexecutor(r)}}}handleSubexecutorFailure(e,t,i){return this.finishSubexecutorWithCloseEffect(l.failCause(i),e=>t.close(e),t=>e.close(t))}pullFromUpstream(e){if(0===e.activeChildExecutors.length)return this.performPullFromUpstream(e);let t=e.activeChildExecutors[0],i=new eq(e.upstreamExecutor,e.createChild,e.lastDone,e.activeChildExecutors.slice(1),e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit);if(void 0===t)return this.performPullFromUpstream(i);this.replaceSubexecutor(new eB(t.childExecutor,i,t.onEmit))}performPullFromUpstream(e){return eT(e.upstreamExecutor,e=>{let t=void 0===this._closeLastSubstream?a.void:this._closeLastSubstream;return this._closeLastSubstream=void 0,(0,c.pipe)(this._executeCloseLastSubstream(t),a.zipRight(e))},t=>{if(void 0!==this._closeLastSubstream){let i=this._closeLastSubstream;return this._closeLastSubstream=void 0,(0,c.pipe)(this._executeCloseLastSubstream(i),a.map(()=>{let i=new eV(e.createChild(t),this._providedEnv,this._executeCloseLastSubstream);i._input=this._input;let[r,n]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(eQ(t)));this._activeSubexecutor=new eB(i,new eq(e.upstreamExecutor,e.createChild,e.lastDone,n,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),f.isSome(r)&&(this._activeSubexecutor=new ej(r.value,this._activeSubexecutor))}))}let i=new eV(e.createChild(t),this._providedEnv,this._executeCloseLastSubstream);i._input=this._input;let[r,n]=this.applyUpstreamPullStrategy(!1,e.activeChildExecutors,e.onPull(eQ(t)));this._activeSubexecutor=new eB(i,new eq(e.upstreamExecutor,e.createChild,e.lastDone,n,e.combineChildResults,e.combineWithChildResult,e.onPull,e.onEmit),e.onEmit),f.isSome(r)&&(this._activeSubexecutor=new ej(r.value,this._activeSubexecutor))},t=>{if(e.activeChildExecutors.some(e=>void 0!==e)){let t=new eU(e.upstreamExecutor,e.lastDone,[void 0,...e.activeChildExecutors],e.upstreamExecutor.getDone(),e.combineChildResults,e.combineWithChildResult,e.onPull);if(void 0!==this._closeLastSubstream){let e=this._closeLastSubstream;return this._closeLastSubstream=void 0,(0,c.pipe)(this._executeCloseLastSubstream(e),a.map(()=>this.replaceSubexecutor(t)))}return void this.replaceSubexecutor(t)}let i=this._closeLastSubstream,r=this.finishSubexecutorWithCloseEffect((0,c.pipe)(t,l.map(t=>e.combineWithChildResult(e.lastDone,t))),()=>i,t=>e.upstreamExecutor.close(t));return void 0===r?void 0:eD(r)})}drainChildExecutors(e){if(0===e.activeChildExecutors.length){let t=this._closeLastSubstream;return void 0!==t&&this.addFinalizer(()=>a.succeed(t)),this.finishSubexecutorWithCloseEffect(e.upstreamDone,()=>t,t=>e.upstreamExecutor.close(t))}let t=e.activeChildExecutors[0],i=e.activeChildExecutors.slice(1);if(void 0===t){var r;let t,[n,a]=this.applyUpstreamPullStrategy(!0,i,e.onPull((r=i.reduce((e,t)=>void 0!==t?e+1:e,0),(t=Object.create(eH))._tag="NoUpstream",t.activeDownstreamCount=r,t)));return(this.replaceSubexecutor(new eU(e.upstreamExecutor,e.lastDone,a,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull)),f.isSome(n))?(this._emitted=n.value,eR()):void 0}let n=new eU(e.upstreamExecutor,e.lastDone,i,e.upstreamDone,e.combineChildResults,e.combineWithChildResult,e.onPull);this.replaceSubexecutor(new eB(t.childExecutor,n,t.onEmit))}}let eG=e=>void 0!==e?e:a.void,e$=(e,t)=>(0,c.pipe)(a.forEach(e,e=>a.exit(e(t))),a.map(e=>(0,c.pipe)(l.all(e),f.getOrElse(()=>l.void))),a.flatMap(e=>a.suspend(()=>e))),eK=(e,t,i)=>{let r=[e],n=()=>{let e=r.pop();if(void 0===e||void 0===e.upstream)return a.dieMessage("Unexpected end of input for channel execution");let s=e.upstream.run();switch(s._tag){case eI:{let s=e.onEmit(e.upstream.getEmit());if(0===r.length){if(void 0===s)return a.suspend(t);return(0,c.pipe)(s,a.matchCauseEffect({onFailure:i,onSuccess:t}))}if(void 0===s)return a.suspend(()=>n());return(0,c.pipe)(s,a.matchCauseEffect({onFailure:i,onSuccess:()=>n()}))}case ex:{let s=e.onDone(e.upstream.getDone());if(0===r.length){if(void 0===s)return a.suspend(t);return(0,c.pipe)(s,a.matchCauseEffect({onFailure:i,onSuccess:t}))}if(void 0===s)return a.suspend(()=>n());return(0,c.pipe)(s,a.matchCauseEffect({onFailure:i,onSuccess:()=>n()}))}case e_:return r.push(e),(0,c.pipe)(e.onEffect(s.effect),a.catchAllCause(t=>a.suspend(()=>{let i=e.onDone(l.failCause(t));return void 0===i?a.void:i})),a.matchCauseEffect({onFailure:i,onSuccess:()=>n()}));case eF:return r.push(e),r.push(s),a.suspend(()=>n())}};return n()},eJ=(0,c.dual)(2,(e,i)=>a.uninterruptibleMask(r=>a.all([y.fork(i,w.sequential),n.make(),n.make()]).pipe(a.flatMap(([s,u,p])=>r(a.acquireUseRelease(a.sync(()=>new eV(e,void 0,c.identity)),e=>a.suspend(()=>eX(e.run(),e).pipe(a.intoDeferred(u),a.zipRight(n.await(u)),a.zipLeft(n.await(p)))),(e,t)=>{let i=e.close(t);return void 0===i?a.void:a.tapErrorCause(i,e=>y.addFinalizer(s,a.failCause(e)))})).pipe(a.forkIn(i),a.flatMap(e=>i.addFinalizer(i=>{let r=l.isFailure(i)?t.interruptors(i.cause):void 0;return n.isDone(u).pipe(a.flatMap(t=>t?n.succeed(p,void 0).pipe(a.zipRight(o.await(e)),a.zipRight(o.inheritAll(e))):n.succeed(p,void 0).pipe(a.zipRight(r&&C.size(r)>0?o.interruptAs(e,S.combineAll(r)):o.interrupt(e)),a.zipRight(o.inheritAll(e)))))}).pipe(a.zipRight(r(n.await(u)))))))))),eX=(e,t)=>{switch(e._tag){case e_:return(0,c.pipe)(e.effect,a.flatMap(()=>eX(t.run(),t)));case eI:return eX(t.run(),t);case ex:return a.suspend(()=>t.getDone());case eF:return eK(e,()=>eX(t.run(),t),a.failCause)}};e.s(["ChannelExecutor",()=>eV,"readUpstream",0,eK,"runIn",0,eJ],981354);let eZ="Done",eY="Await",e0=Symbol.for("effect/ChannelMergeDecision"),e1={[e0]:{_R:e=>e,_E0:e=>e,_Z0:e=>e,_E:e=>e,_Z:e=>e}},e2=e=>{let t=Object.create(e1);return t._tag=eZ,t.effect=e,t},e4=e=>{let t=Object.create(e1);return t._tag=eY,t.f=e,t},e7=(0,c.dual)(2,(e,{onAwait:t,onDone:i})=>{switch(e._tag){case eZ:return i(e.effect);case eY:return t(e.f)}});e.s(["Await",0,e4,"AwaitConst",0,e=>e4(()=>e),"Done",0,e2,"MergeDecisionTypeId",0,e0,"isMergeDecision",0,e=>(0,d.hasProperty)(e,e0),"match",0,e7],251785);let e3="BothRunning",e8="LeftDone",e9="RightDone",e6=Symbol.for("effect/ChannelMergeState"),e5={[e6]:e6},te=(e,t)=>{let i=Object.create(e5);return i._tag=e3,i.left=e,i.right=t,i},tt=e=>{let t=Object.create(e5);return t._tag=e8,t.f=e,t},ti=e=>{let t=Object.create(e5);return t._tag=e9,t.f=e,t},tr="BackPressure",tn="BufferSliding",ta=Symbol.for("effect/ChannelMergeStrategy"),ts={[ta]:ta},tu=e=>{let t=Object.create(ts);return t._tag=tr,t},tl=(0,c.dual)(2,(e,{onBackPressure:t,onBufferSliding:i})=>{switch(e._tag){case tr:return t();case tn:return i()}});e.s(["BackPressure",0,tu,"BufferSliding",0,e=>{let t=Object.create(ts);return t._tag=tn,t},"match",0,tl],377473);let to="Empty",tp="Emit",tc="Error",th="Done",tf=e=>({_tag:to,notifyProducer:e}),td=e=>({_tag:tp,notifyConsumers:e});class tm{ref;constructor(e){this.ref=e}awaitRead(){return a.flatten(g.modify(this.ref,e=>e._tag===to?[n.await(e.notifyProducer),e]:[a.void,e]))}get close(){return a.fiberIdWith(e=>this.error(t.interrupt(e)))}done(e){return a.flatten(g.modify(this.ref,t=>{switch(t._tag){case to:return[n.await(t.notifyProducer),t];case tp:return[a.forEach(t.notifyConsumers,t=>n.succeed(t,s.left(e)),{discard:!0}),{_tag:th,done:e}];case tc:case th:return[a.interrupt,t]}}))}emit(e){return a.flatMap(n.make(),t=>a.flatten(g.modify(this.ref,i=>{switch(i._tag){case to:return[n.await(i.notifyProducer),i];case tp:{let r=i.notifyConsumers[0],a=i.notifyConsumers.slice(1);if(void 0!==r)return[n.succeed(r,s.right(e)),0===a.length?tf(t):td(a)];throw Error("Bug: Channel.SingleProducerAsyncInput.emit - Queue was empty! please report an issue at https://github.com/Effect-TS/effect/issues")}case tc:case th:return[a.interrupt,i]}})))}error(e){return a.flatten(g.modify(this.ref,t=>{switch(t._tag){case to:return[n.await(t.notifyProducer),t];case tp:return[a.forEach(t.notifyConsumers,t=>n.failCause(t,e),{discard:!0}),{_tag:tc,cause:e}];case tc:case th:return[a.interrupt,t]}}))}get take(){return this.takeWith(e=>l.failCause(t.map(e,s.left)),e=>l.succeed(e),e=>l.fail(s.right(e)))}takeWith(e,t,i){return a.flatMap(n.make(),r=>a.flatten(g.modify(this.ref,u=>{switch(u._tag){case to:return[a.zipRight(n.succeed(u.notifyProducer,void 0),a.matchCause(n.await(r),{onFailure:e,onSuccess:s.match({onLeft:i,onRight:t})})),td([r])];case tp:return[a.matchCause(n.await(r),{onFailure:e,onSuccess:s.match({onLeft:i,onRight:t})}),td([...u.notifyConsumers,r])];case tc:return[a.succeed(e(u.cause)),u];case th:return[a.succeed(i(u.done)),u]}})))}}let tb=()=>(0,c.pipe)(n.make(),a.flatMap(e=>g.make(tf(e))),a.map(e=>new tm(e)));var tg=e.i(625290),ty=e.i(85358);let tw=(e,t,i)=>ec(ef(g.make(()=>a.void)),r=>(0,c.pipe)(ef(a.uninterruptible(a.tap(e,e=>g.set(r,t=>i(e,t))))),ec(t),eu(e=>a.flatMap(g.get(r),t=>t(e))))),tS=(0,c.dual)(2,(e,t)=>tQ(e,()=>t)),tC=e=>eC(()=>{let t=(e,i,r)=>ih(g.modify(r,n=>i(n)?[eg({onInput:n=>ec(ek(n),()=>t(e,i,r)),onFailure:e=>el(e),onDone:e=>eS(e)}),n]:[ec(ek(n),()=>t(e,i,r)),e]));return t(e.empty,e.isEmpty,e.ref)}),tE=(0,c.dual)(2,(e,i)=>Y(e,e=>s.match(t.failureOrCause(e),{onLeft:i,onRight:eo}))),tv=(0,c.dual)(2,(e,t)=>en(e,t,()=>void 0,()=>void 0)),tk=(0,c.dual)(2,(e,t)=>{let i=eg({onInput:e=>f.match(t(e),{onNone:()=>i,onSome:e=>ec(ek(e),()=>i)}),onFailure:el,onDone:eS});return ed(e,i)}),tx=(0,c.dual)(2,(e,t)=>{let i=eg({onInput:e=>ec(ek(e),()=>i),onFailure:el,onDone:e=>eS(t(e))});return ed(i,e)}),tI=(0,c.dual)(2,(e,t)=>{let i=eg({onInput:e=>ec(ek(e),()=>i),onFailure:el,onDone:e=>ef(t(e))});return ed(i,e)}),t_=(0,c.dual)(2,(e,t)=>{let i=eg({onInput:e=>ec(ek(e),()=>i),onFailure:e=>el(t(e)),onDone:eS});return ed(i,e)}),tF=(0,c.dual)(2,(e,t)=>{let i=eg({onInput:e=>ec(ek(e),()=>i),onFailure:e=>ef(t(e)),onDone:eS});return ed(i,e)}),tM=(0,c.dual)(2,(e,t)=>{let i=eg({onInput:e=>ec(ek(t(e)),()=>i),onFailure:el,onDone:eS});return ed(i,e)}),tA=(0,c.dual)(2,(e,t)=>{let i=eg({onInput:e=>ec(ec(ef(t(e)),ek),()=>i),onFailure:el,onDone:eS});return ed(i,e)}),tR=e=>eC(()=>{let t=[];return(0,c.pipe)(ed(e,tz(t)),ec(e=>ew([i.unsafeFromArray(t),e])))}),tz=e=>eg({onInput:t=>ec(eE(()=>{e.push(t)}),()=>tz(e)),onFailure:el,onDone:ew}),tT=e=>{let t=ey({onInput:()=>t,onFailure:eo,onDone:ew});return ed(e,t)},tW=(0,c.dual)(2,(e,t)=>eu(e,()=>t)),tD=()=>ef(a.context()),tO=e=>ec(tD(),e),tP=e=>ec(e,c.identity),tL=(0,c.dual)(2,(e,i)=>eh(e,{onFailure:e=>{let r=t.failureOrCause(e);switch(r._tag){case"Left":return i.onFailure(r.left);case"Right":return eo(r.right)}},onSuccess:i.onSuccess})),tN=e=>ih(e.takeWith(eo,t=>ec(ek(t),()=>tN(e)),ew)),tB=e=>eC(()=>tq(e)),tq=e=>(0,c.pipe)(ef(b.take(e)),ec(s.match({onLeft:l.match({onFailure:eo,onSuccess:eS}),onRight:t=>ec(ek(t),()=>tq(e))}))),tU=()=>eg({onInput:e=>ec(ek(e),()=>tU()),onFailure:el,onDone:eS}),tj=(0,c.dual)(2,(e,t)=>t4(e,{other:ef(t),onSelfDone:e=>e2(a.suspend(()=>e)),onOtherDone:e=>e2(a.suspend(()=>e))})),tH=(0,c.dual)(2,(e,t)=>tj(e,n.await(t))),tQ=(0,c.dual)(2,(e,t)=>ec(e,e=>eE(()=>t(e)))),tV=(0,c.dual)(2,(e,t)=>ec(e,e=>ef(t(e)))),tG=(0,c.dual)(2,(e,i)=>t$(e,t.map(i))),t$=(0,c.dual)(2,(e,t)=>Y(e,e=>eo(t(e)))),tK=(0,c.dual)(2,(e,t)=>{let i=eg({onInput:e=>ec(ek(t(e)),()=>i),onFailure:el,onDone:eS});return ed(e,i)}),tJ=(0,c.dual)(2,(e,t)=>{let i=ey({onInput:e=>(0,c.pipe)(ef(t(e)),ec(ek),ec(()=>i)),onFailure:eo,onDone:eS});return ed(e,i)}),tX=(0,c.dual)(3,(e,t,i)=>im(r=>a.gen(function*(){let u=yield*tb(),l=tN(u),o=yield*b.bounded(i);yield*y.addFinalizer(r,b.shutdown(o));let p=yield*n.make(),h=i===1/0?e=>c.identity:(yield*a.makeSemaphore(i)).withPermits,f=yield*l.pipe(ed(e),il(r));yield*f.pipe(a.matchCauseEffect({onFailure:e=>b.offer(o,a.failCause(e)),onSuccess:s.match({onLeft:e=>a.zipRight(a.interruptible(h(i)(a.void)),a.asVoid(b.offer(o,a.succeed(s.left(e))))),onRight:e=>a.gen(function*(){let i=yield*n.make(),u=yield*n.make();yield*b.offer(o,a.map(n.await(i),s.right)),yield*n.succeed(u,void 0).pipe(a.zipRight(a.uninterruptibleMask(i=>a.exit(i(n.await(p))).pipe(a.raceFirst(a.exit(i(t(e)))),a.flatMap(c.identity))).pipe(a.tapErrorCause(e=>n.failCause(p,e)),a.intoDeferred(i))),h(1),a.forkIn(r)),yield*n.await(u)})})}),a.forever,a.interruptible,a.forkIn(r));let d=ih(a.matchCause(a.flatten(b.take(o)),{onFailure:eo,onSuccess:s.match({onLeft:eS,onRight:e=>ec(ek(e),()=>d)})}));return es(d,u)}))),tZ=e=>t=>tY(e)(t,c.constVoid),tY=({bufferSize:e=16,concurrency:i,mergeStrategy:r=tu()})=>(u,l)=>im(p=>a.gen(function*(){let h="unbounded"===i?Number.MAX_SAFE_INTEGER:i,d=yield*tb(),m=tN(d),w=yield*b.bounded(e);yield*y.addFinalizer(p,b.shutdown(w));let S=yield*b.unbounded();yield*y.addFinalizer(p,b.shutdown(S));let C=yield*g.make(f.none()),E=yield*n.make(),v=(yield*a.makeSemaphore(h)).withPermits,k=yield*il(ed(m,u),p);function x(e){return e.pipe(a.flatMap(s.match({onLeft:e=>a.succeed(f.some(e)),onRight:e=>a.as(b.offer(w,a.succeed(s.right(e))),f.none())})),a.repeat({until:e=>f.isSome(e)}),a.flatMap(e=>g.update(C,f.match({onNone:()=>f.some(e.value),onSome:t=>f.some(l(t,e.value))}))),a.catchAllCause(e=>t.isInterrupted(e)?a.failCause(e):b.offer(w,a.failCause(e)).pipe(a.zipRight(n.succeed(E,void 0)),a.asVoid)))}yield*k.pipe(a.matchCauseEffect({onFailure:e=>b.offer(w,a.failCause(e)).pipe(a.zipRight(a.succeed(!1))),onSuccess:s.match({onLeft:e=>a.raceWith(a.interruptible(n.await(E)),a.interruptible(v(h)(a.void)),{onSelfDone:(e,t)=>a.as(o.interrupt(t),!1),onOtherDone:(t,i)=>a.zipRight(o.interrupt(i),g.get(C).pipe(a.flatMap(f.match({onNone:()=>b.offer(w,a.succeed(s.left(e))),onSome:t=>b.offer(w,a.succeed(s.left(l(t,e))))})),a.as(!1)))}),onRight:e=>tl(r,{onBackPressure:()=>a.gen(function*(){let t=yield*n.make(),i=a.scopedWith(t=>il(ed(m,e),t).pipe(a.flatMap(e=>a.race(a.exit(x(e)),a.exit(a.interruptible(n.await(E))))),a.flatMap(c.identity)));return yield*n.succeed(t,void 0).pipe(a.zipRight(i),v(1),a.forkIn(p)),yield*n.await(t),!(yield*n.isDone(E))}),onBufferSliding:()=>a.gen(function*(){let t=yield*n.make(),i=yield*n.make(),r=yield*b.size(S);yield*b.take(S).pipe(a.flatMap(e=>n.succeed(e,void 0)),a.when(()=>r>=h)),yield*b.offer(S,t);let s=a.scopedWith(i=>il(ed(m,e),i).pipe(a.flatMap(e=>a.exit(x(e)).pipe(a.race(a.exit(a.interruptible(n.await(E)))),a.race(a.exit(a.interruptible(n.await(t)))))),a.flatMap(c.identity)));return yield*n.succeed(i,void 0).pipe(a.zipRight(s),v(1),a.forkIn(p)),yield*n.await(i),!(yield*n.isDone(E))})})})}),a.repeat({while:e=>e}),a.forkIn(p));let I=(0,c.pipe)(b.take(w),a.flatten,a.matchCause({onFailure:eo,onSuccess:s.match({onLeft:eS,onRight:e=>ec(ek(e),()=>I)})}),ih);return es(I,d)})),t0=(0,c.dual)(3,(e,t,i)=>tZ(i)(tK(e,t))),t1=(0,c.dual)(2,(e,t)=>tZ({concurrency:t})(tK(e,c.identity))),t2=(0,c.dual)(3,(e,t,i)=>tY({concurrency:t})(tK(e,c.identity),i)),t4=(0,c.dual)(2,(e,t)=>im(function(i){return a.gen(function*(){let r=yield*tb(),n=tN(r),u=yield*il(ed(n,e),i),p=yield*il(ed(n,t.other),i);function c(e,t,r){return(n,u,p)=>{function c(e){return e._tag===eZ?a.succeed(ef(a.zipRight(o.interrupt(t),e.effect))):a.map(o.await(t),l.match({onFailure:t=>ef(e.f(l.failCause(t))),onSuccess:s.match({onLeft:t=>ef(e.f(l.succeed(t))),onRight:t=>iC(ek(t),h(p(e.f)))})}))}return l.match(e,{onFailure:e=>c(n(l.failCause(e))),onSuccess:s.match({onLeft:e=>c(n(l.succeed(e))),onRight:e=>a.succeed(ec(ek(e),()=>ec(ef(a.forkIn(a.interruptible(r),i)),e=>h(u(e,t)))))})})}}function h(e){switch(e._tag){case e3:{let i=a.interruptible(o.join(e.left)),r=a.interruptible(o.join(e.right));return ih(a.raceWith(i,r,{onSelfDone:(i,r)=>a.zipRight(o.interrupt(r),c(i,e.right,u)(t.onSelfDone,te,e=>tt(e))),onOtherDone:(i,r)=>a.zipRight(o.interrupt(r),c(i,e.left,p)(t.onOtherDone,(e,t)=>te(t,e),e=>ti(e)))}))}case e8:return ih(a.map(a.exit(p),l.match({onFailure:t=>ef(e.f(l.failCause(t))),onSuccess:s.match({onLeft:t=>ef(e.f(l.succeed(t))),onRight:t=>ec(ek(t),()=>h(tt(e.f)))})})));case e9:return ih(a.map(a.exit(u),l.match({onFailure:t=>ef(e.f(l.failCause(t))),onSuccess:s.match({onLeft:t=>ef(e.f(l.succeed(t))),onRight:t=>ec(ek(t),()=>h(ti(e.f)))})})))}}return ef(a.withFiberRuntime(e=>{let t=a.withFiberRuntime(t=>(t.transferChildren(e.scope()),a.void)),r=a.interruptible(u).pipe(a.ensuring(t),a.forkIn(i)),n=a.interruptible(p).pipe(a.ensuring(t),a.forkIn(i));return a.zipWith(r,n,(e,t)=>te(e,t))})).pipe(ec(h),es(r))})})),t7=ef(a.never),t3=(0,c.dual)(2,(e,t)=>t8(e,t)),t8=(0,c.dual)(2,(e,i)=>tE(e,e=>ep(()=>t.die(i(e))))),t9=(0,c.dual)(2,(e,t)=>tE(e,t)),t6=(0,c.dual)(2,(e,i)=>eC(()=>{let r,n=eg({onInput:e=>ec(ek(e),()=>n),onFailure:e=>(r=iv(e),eo(t.die(r))),onDone:eS}),a=ey({onInput:e=>(0,c.pipe)(ek(e),ec(()=>a)),onFailure:e=>t.isDieType(e)&&ik(e.defect)&&u.equals(e.defect,r)?el(e.defect.error):eo(e),onDone:eS});return ed(ed(ed(e,n),i),a)})),t5=(0,c.dual)(3,(e,t,i)=>ec(tD(),n=>em(e,r.add(n,t,i)))),ie=(0,c.dual)(2,(e,t)=>im(i=>a.map(h.buildWithScope(t,i),t=>em(e,t)))),it=(0,c.dual)(2,(e,t)=>tO(i=>em(e,t(i)))),ii=(0,c.dual)(2,(e,t)=>ie(e,h.merge(h.context(),t))),ir=e=>ec(e,()=>ir(e)),ia=e=>a.scopedWith(t=>eJ(e,t)),is=e=>ih(a.uninterruptibleMask(t=>a.map(y.make(),i=>Z(a.tapErrorCause(t(y.extend(e,i)),e=>y.close(i,l.failCause(e))),(e,t)=>y.close(i,t))))),iu=e=>id(a.map(a.scope,t=>ec(ef(e(t)),ek))),il=(0,c.dual)(2,(e,t)=>a.zip(a.sync(()=>new eV(e,void 0,c.identity)),a.runtime()).pipe(a.tap(([e,i])=>y.addFinalizerExit(t,t=>{let r=e.close(t);return void 0!==r?a.provide(r,i):a.void})),a.uninterruptible,a.map(([e])=>a.suspend(()=>io(e.run(),e))))),io=(e,t)=>{switch(e._tag){case ex:return l.match(t.getDone(),{onFailure:a.failCause,onSuccess:e=>a.succeed(s.left(e))});case eI:return a.succeed(s.right(t.getEmit()));case e_:return(0,c.pipe)(e.effect,a.flatMap(()=>io(t.run(),t)));case eF:return eK(e,()=>io(t.run(),t),e=>a.failCause(e))}},ip=e=>eC(()=>ic(e)),ic=e=>ey({onInput:t=>ec(ef(b.offer(e,s.right(t))),()=>ic(e)),onFailure:t=>ef(b.offer(e,s.left(l.failCause(t)))),onDone:t=>ef(b.offer(e,s.left(l.succeed(t))))}),ih=e=>tP(ef(e)),id=e=>er(is(e),(e,t)=>e,(e,t)=>e),im=e=>er(iu(e),(e,t)=>e,(e,t)=>e),ib=(0,c.dual)(3,(e,t,i)=>it(e,e=>r.merge(e,r.make(t,i(r.unsafeGet(e,t)))))),ig=e=>iy(0,e.length,e),iy=(e,t,r)=>e===t?ev:(0,c.pipe)(ek((0,c.pipe)(r,i.unsafeGet(e))),ec(()=>iy(e+1,t,r))),iw=(0,c.dual)(e=>X(e[1]),(e,t,i)=>i?.concurrent?t4(e,{other:t,onSelfDone:e=>e4(t=>a.suspend(()=>l.zip(e,t))),onOtherDone:e=>e4(t=>a.suspend(()=>l.zip(t,e)))}):ec(e,e=>tQ(t,t=>[e,t]))),iS=(0,c.dual)(e=>X(e[1]),(e,t,i)=>i?.concurrent?tQ(iw(e,t,{concurrent:!0}),e=>e[0]):ec(e,e=>tS(t,e))),iC=(0,c.dual)(e=>X(e[1]),(e,t,i)=>i?.concurrent?tQ(iw(e,t,{concurrent:!0}),e=>e[1]):ec(e,()=>t)),iE=Symbol.for("effect/Channel/ChannelException"),iv=e=>({_tag:"ChannelException",[iE]:iE,error:e}),ik=e=>(0,d.hasProperty)(e,iE);e.s(["ChannelException",0,iv,"ChannelExceptionTypeId",0,iE,"acquireUseRelease",0,tw,"as",0,tS,"asVoid",0,e=>tQ(e,c.constVoid),"buffer",0,tC,"bufferChunk",0,e=>tC({empty:i.empty(),isEmpty:i.isEmpty,ref:e}),"catchAll",0,tE,"collect",0,tk,"concatMap",0,tv,"concatOut",0,e=>ei(e),"context",0,tD,"contextWith",0,e=>tQ(tD(),e),"contextWithChannel",0,tO,"contextWithEffect",0,e=>tV(tD(),e),"doneCollect",0,tR,"drain",0,tT,"emitCollect",0,e=>ec(tR(e),ek),"ensuring",0,tW,"flatten",0,tP,"foldChannel",0,tL,"fromEither",0,e=>eC(()=>s.match(e,{onLeft:el,onRight:ew})),"fromInput",0,tN,"fromOption",0,e=>eC(()=>f.match(e,{onNone:()=>el(f.none()),onSome:ew})),"fromPubSub",0,e=>id(a.map(m.subscribe(e),tB)),"fromPubSubScoped",0,e=>a.map(m.subscribe(e),tB),"fromQueue",0,tB,"identityChannel",0,tU,"interruptWhen",0,tj,"interruptWhenDeferred",0,tH,"isChannelException",0,ik,"map",0,tQ,"mapEffect",0,tV,"mapError",0,tG,"mapErrorCause",0,t$,"mapInput",0,tx,"mapInputContext",0,it,"mapInputEffect",0,tI,"mapInputError",0,t_,"mapInputErrorEffect",0,tF,"mapInputIn",0,tM,"mapInputInEffect",0,tA,"mapOut",0,tK,"mapOutEffect",0,tJ,"mapOutEffectPar",0,tX,"mergeAll",0,tZ,"mergeAllUnbounded",0,e=>tY({concurrency:"unbounded"})(e,c.constVoid),"mergeAllUnboundedWith",0,(e,t)=>tY({concurrency:"unbounded"})(e,t),"mergeAllWith",0,tY,"mergeMap",0,t0,"mergeOut",0,t1,"mergeOutWith",0,t2,"mergeWith",0,t4,"never",0,t7,"orDie",0,t3,"orDieWith",0,t8,"orElse",0,t9,"pipeToOrFail",0,t6,"provideLayer",0,ie,"provideService",0,t5,"provideSomeLayer",0,ii,"read",0,()=>eb(f.none()),"repeated",0,ir,"run",0,ia,"runCollect",0,e=>ia(ee(e)),"runDrain",0,e=>ia(tT(e)),"runScoped",0,e=>a.scopeWith(t=>eJ(e,t)),"scoped",0,is,"scopedWith",0,iu,"splitLines",0,()=>eC(()=>{let e="",t=!1,r=ey({onInput:n=>{let a,s=(a=[],i.map(n,i=>{if(0!==i.length){let r=0,n=i.indexOf("\r"),s=i.indexOf("\n");for(t&&(0===s?(a.push(e),e="",r=1,s=i.indexOf("\n",r)):e+="\r",t=!1);-1!==n||-1!==s;)-1===n||-1!==s&&s<n?(0===e.length?a.push(i.substring(r,s)):(a.push(e+i.substring(r,s)),e=""),r=s+1,s=i.indexOf("\n",r)):i.length===n+1?(t=!0,n=-1):s===n+1?(0===e.length?a.push(i.substring(r,n)):(e+=i.substring(r,n),a.push(e),e=""),r=n+2,n=i.indexOf("\r",r),s=i.indexOf("\n",r)):n=i.indexOf("\r",n+1);t?e+=i.substring(r,i.length-1):e+=i.substring(r,i.length)}}),i.unsafeFromArray(a));return i.isEmpty(s)?r:ec(ek(s),()=>r)},onFailure:t=>0===e.length?eo(t):ec(ek(i.of(e)),()=>eo(t)),onDone:t=>0===e.length?ew(t):ec(ek(i.of(e)),()=>ew(t))});return r}),"toPubSub",0,e=>ip(e),"toPull",0,e=>a.flatMap(a.scope,t=>il(e,t)),"toPullIn",0,il,"toQueue",0,ip,"unwrap",0,ih,"unwrapScoped",0,id,"unwrapScopedWith",0,im,"updateService",0,ib,"withSpan",0,function(){let e="string"!=typeof arguments[0],t=e?arguments[1]:arguments[0],i=ty.addSpanStackTrace(e?arguments[2]:arguments[1]),n=a.all([a.makeSpan(t,i),a.context(),a.clock,p.get(p.currentTracerTimingEnabled)]);if(e){let e=arguments[0];return tw(n,([t,i])=>em(e,r.add(i,ty.spanTag,t)),([e,,t,i],r)=>tg.endSpan(e,r,t,i))}return e=>tw(n,([t,i])=>em(e,r.add(i,ty.spanTag,t)),([e,,t,i],r)=>tg.endSpan(e,r,t,i))},"writeAll",0,(...e)=>ig(i.fromIterable(e)),"writeChunk",0,ig,"zip",0,iw,"zipLeft",0,iS,"zipRight",0,iC],913578)},154776,e=>{"use strict";var t=e.i(266417),i=e.i(51889),r=e.i(777444),n=e.i(389631),a=e.i(284445),s=e.i(878753),u=e.i(343469),l=e.i(980914),o=e.i(915838),p=e.i(608913),c=e.i(494576),h=e.i(886999),f=e.i(862409),d=e.i(681830),m=e.i(979475),b=e.i(383615),g=e.i(335260),y=e.i(797734),w=e.i(913578),S=e.i(251785),C=e.i(223356);let E=Symbol.for("effect/Sink"),v={_A:e=>e,_In:e=>e,_L:e=>e,_E:e=>e,_R:e=>e};class k{channel;[E]=v;constructor(e){this.channel=e}pipe(){return(0,f.pipeArguments)(this,arguments)}}let x=e=>(0,d.hasProperty)(e,E),I=e=>new k(C.suspend(()=>e$(e()))),_=(0,o.dual)(2,(e,t)=>(0,o.pipe)(e,eR(()=>t))),F=e=>C.readWithCause({onInput:t=>F((0,o.pipe)(e,r.appendAll(t))),onFailure:C.failCause,onDone:()=>C.succeed(e)}),M=(e,t)=>C.readWithCause({onInput:i=>{let[n,a]=r.splitAt(i,e);return n.length<e?M(e-n.length,r.appendAll(t,n)):r.isEmpty(a)?C.succeed(r.appendAll(t,n)):C.flatMap(C.write(a),()=>C.succeed(r.appendAll(t,n)))},onFailure:C.failCause,onDone:()=>C.succeed(t)}),A=(e,i)=>C.readWith({onInput:n=>{let[a,s]=(0,o.pipe)(r.toReadonlyArray(n),t.span(e));return 0===s.length?A(e,(0,o.pipe)(i,r.appendAll(r.unsafeFromArray(a)))):(0,o.pipe)(C.write(r.unsafeFromArray(s)),w.zipRight(C.succeed((0,o.pipe)(i,r.appendAll(r.unsafeFromArray(a))))))},onFailure:C.fail,onDone:()=>C.succeed(i)}),R=(e,t)=>C.readWith({onInput:i=>(0,o.pipe)(C.fromEffect((0,o.pipe)(i,s.takeWhile(e),s.map(r.unsafeFromArray))),C.flatMap(n=>{let a=(0,o.pipe)(i,r.drop(n.length));return r.isEmpty(a)?R(e,(0,o.pipe)(t,r.appendAll(n))):(0,o.pipe)(C.write(a),w.zipRight(C.succeed((0,o.pipe)(t,r.appendAll(n)))))})),onFailure:C.fail,onDone:()=>C.succeed(t)}),z=(0,o.dual)(2,(e,t)=>{let i=(0,o.pipe)(g.make(r.empty()),s.zip(g.make(!1)));return new k((0,o.pipe)(C.fromEffect(i),C.flatMap(([i,r])=>{let n=C.readWith({onInput:e=>(0,o.pipe)(C.write(e),C.flatMap(()=>n)),onFailure:C.fail,onDone:e=>(0,o.pipe)(C.fromEffect(g.set(r,!0)),w.as(e))});return(0,o.pipe)(n,C.pipeTo(w.bufferChunk(i)),C.pipeTo(T(e,i,r,t.initial,t.while,t.body)))})))}),T=(e,t,i,n,a,s)=>(0,o.pipe)(e$(e),w.doneCollect,w.foldChannel({onFailure:C.fail,onSuccess:([u,l])=>a(l)?(0,o.pipe)(C.fromEffect(g.set(t,r.flatten(u))),C.flatMap(()=>(0,o.pipe)(C.fromEffect(g.get(i)),C.flatMap(p=>{let c=s(n,l);return p?(0,o.pipe)(C.write(r.flatten(u)),w.as(c)):T(e,t,i,c,a,s)})))):(0,o.pipe)(C.write(r.flatten(u)),w.as(n))})),W=(0,o.dual)(2,(e,t)=>(0,o.pipe)(e,O(r.map(t)))),D=(0,o.dual)(2,(e,t)=>P(e,e=>s.map(s.forEach(e,e=>t(e)),r.unsafeFromArray))),O=(0,o.dual)(2,(e,t)=>{let i=C.readWith({onInput:e=>(0,o.pipe)(C.write(t(e)),C.flatMap(()=>i)),onFailure:C.fail,onDone:C.succeed});return new k((0,o.pipe)(i,C.pipeTo(e$(e))))}),P=(0,o.dual)(2,(e,t)=>{let i=C.readWith({onInput:e=>(0,o.pipe)(C.fromEffect(t(e)),C.flatMap(C.write),C.flatMap(()=>i)),onFailure:C.fail,onDone:C.succeed});return new k((0,o.pipe)(i,w.pipeToOrFail(e$(e))))}),L=(0,o.dual)(2,(e,t)=>eR(W(e,t.onInput),t.onDone)),N=(0,o.dual)(2,(e,t)=>ez(D(e,t.onInput),t.onDone)),B=(0,o.dual)(2,(e,t)=>eR(O(e,t.onInput),t.onDone)),q=(0,o.dual)(2,(e,t)=>ez(P(e,t.onInput),t.onDone)),U=new k(w.drain(w.identityChannel())),j=e=>I(()=>new k(H(e))),H=e=>C.readWith({onInput:t=>{let i=(0,o.pipe)(t,r.drop(e)),n=Math.max(e-t.length,0);return r.isEmpty(t)||n>0?H(n):(0,o.pipe)(C.write(i),w.zipRight(w.identityChannel()))},onFailure:C.fail,onDone:()=>C.void}),Q=e=>C.readWith({onInput:t=>(0,o.pipe)(t,s.dropUntil(e),s.map(t=>0===t.length?Q(e):(0,o.pipe)(C.write(r.unsafeFromArray(t)),w.zipRight(w.identityChannel()))),w.unwrap),onFailure:C.fail,onDone:()=>C.void}),V=e=>new k(G(e)),G=e=>C.readWith({onInput:t=>{let i=(0,o.pipe)(t,r.dropWhile(e));return r.isEmpty(i)?G(e):(0,o.pipe)(C.write(i),w.zipRight(w.identityChannel()))},onFailure:C.fail,onDone:C.succeedNow}),$=e=>C.readWith({onInput:t=>(0,o.pipe)(t,s.dropWhile(e),s.map(t=>0===t.length?$(e):(0,o.pipe)(C.write(r.unsafeFromArray(t)),w.zipRight(w.identityChannel()))),w.unwrap),onFailure:C.fail,onDone:()=>C.void}),K=(0,o.dual)(2,(e,t)=>new k((0,o.pipe)(e,e$,w.ensuring(t)))),J=(0,o.dual)(2,(e,t)=>new k((0,o.pipe)(e,e$,C.ensuringWith(t)))),X=()=>e_(s.context()),Z=e=>new k(C.fail(e)),Y=e=>new k(C.failCause(e)),ee=e=>new k(C.failCauseSync(e)),et=(0,o.dual)(2,(e,t)=>P(e,e=>s.map(s.filter(e,t),r.unsafeFromArray))),ei=(0,o.dual)(2,(e,t)=>new k((0,o.pipe)(C.fromEffect((0,o.pipe)(g.make(r.empty()),s.zip(g.make(!1)))),C.flatMap(([i,n])=>{let a=C.readWith({onInput:e=>(0,o.pipe)(C.write(e),C.flatMap(()=>a)),onFailure:C.fail,onDone:e=>(0,o.pipe)(C.fromEffect(g.set(n,!0)),w.as(e))}),s=w.foldChannel(C.collectElements(e$(e)),{onFailure:C.fail,onSuccess:([e,a])=>(0,o.pipe)(C.fromEffect(t(a)),C.flatMap(t=>(0,o.pipe)(C.fromEffect(g.set(i,r.flatten(e))),w.zipRight((0,o.pipe)(C.fromEffect(g.get(n)),C.flatMap(i=>t?(0,o.pipe)(C.write(r.flatten(e)),w.as(h.some(a))):i?(0,o.pipe)(C.write(r.flatten(e)),w.as(h.none())):s))))))});return(0,o.pipe)(a,C.pipeTo(w.bufferChunk(i)),C.pipeTo(s))})))),er=(e,t,i)=>I(()=>new k(en(e,t,i))),en=(e,t,i)=>t(e)?C.readWith({onInput:n=>{let[a,s]=ea(e,n,t,i,0,n.length);return r.isNonEmpty(s)?(0,o.pipe)(C.write(s),w.as(a)):en(a,t,i)},onFailure:C.fail,onDone:()=>C.succeedNow(e)}):C.succeedNow(e),ea=(e,t,i,n,a,s)=>{if(a===s)return[e,r.empty()];let u=n(e,(0,o.pipe)(t,r.unsafeGet(a)));return i(u)?ea(u,t,i,n,a+1,s):[u,(0,o.pipe)(t,r.drop(a+1))]},es=(0,o.dual)(2,(e,t)=>new k((0,o.pipe)(e$(e),C.collectElements,w.foldChannel({onFailure:e=>e$(t.onFailure(e)),onSuccess:([e,i])=>C.suspend(()=>{let n={ref:(0,o.pipe)(e,r.filter(r.isNonEmpty))},a=(0,o.pipe)(C.sync(()=>{let e=n.ref;return n.ref=r.empty(),e}),C.flatMap(e=>w.writeChunk(e))),s=w.identityChannel(),u=(0,o.pipe)(a,w.zipRight(s),C.pipeTo(e$(t.onSuccess(i))));return C.flatMap(C.collectElements(u),([e,t])=>(0,o.pipe)(C.succeed(n.ref),C.flatMap(w.writeChunk),w.zipRight(w.writeChunk(e)),w.as(t)))})})))),eu=(e,t,i)=>I(()=>new k(el(e,t,i))),el=(e,t,i)=>t(e)?C.readWith({onInput:r=>el(i(e,r),t,i),onFailure:C.fail,onDone:()=>C.succeedNow(e)}):C.succeedNow(e),eo=(e,t,i)=>I(()=>new k(ep(e,t,i))),ep=(e,t,i)=>t(e)?C.readWith({onInput:r=>(0,o.pipe)(C.fromEffect(i(e,r)),C.flatMap(e=>ep(e,t,i))),onFailure:C.fail,onDone:()=>C.succeedNow(e)}):C.succeedNow(e),ec=(e,t,i)=>I(()=>new k(eh(e,t,i))),eh=(e,t,i)=>t(e)?C.readWith({onInput:r=>(0,o.pipe)(C.fromEffect(ef(e,r,t,i)),C.flatMap(([e,r])=>(0,o.pipe)(r,h.match({onNone:()=>eh(e,t,i),onSome:t=>(0,o.pipe)(C.write(t),w.as(e))})))),onFailure:C.fail,onDone:()=>C.succeedNow(e)}):C.succeedNow(e),ef=(e,t,i,r)=>ed(e,t,0,t.length,i,r),ed=(e,t,i,n,a,u)=>i===n?s.succeed([e,h.none()]):(0,o.pipe)(u(e,(0,o.pipe)(t,r.unsafeGet(i))),s.flatMap(e=>a(e)?ed(e,t,i+1,n,a,u):s.succeed([e,h.some((0,o.pipe)(t,r.drop(i+1)))]))),em=(e,t)=>eu(e,o.constTrue,t),eb=e=>eg({...e,decompose:r.of}),eg=e=>I(()=>new k(ey(e.initial,0,!1,e.maxCost,e.cost,e.decompose,e.body))),ey=(e,t,i,n,a,s,u)=>C.readWith({onInput:l=>{let[p,c,h,f]=ew(l,e,t,i,n,a,s,u);return r.isNonEmpty(f)?(0,o.pipe)(C.write(f),w.zipRight(C.succeedNow(p))):t>n?C.succeedNow(p):ey(p,c,h,n,a,s,u)},onFailure:C.fail,onDone:()=>C.succeedNow(e)}),ew=(e,t,i,n,a,s,u,l)=>{for(let o=0;o<e.length;o++){let p=r.unsafeGet(e,o),c=i;if((i+=s(t,p))<=a){t=l(t,p),n=!0;continue}let h=u(p);if(h.length<=1&&!n)return[l(t,p),i,!0,r.drop(e,o+1)];if(h.length<=1&&n)return[t,c,n,r.drop(e,o)];e=r.appendAll(h,r.drop(e,o+1)),i=c,o=-1}return[t,i,n,r.empty()]},eS=e=>I(()=>new k(eC(e.initial,e.maxCost,e.cost,e.decompose,e.body,0,!1))),eC=(e,t,i,n,a,s,u)=>C.readWith({onInput:l=>(0,o.pipe)(C.fromEffect(eE(e,t,i,n,a,l,u,s,0)),C.flatMap(([e,u,l,p])=>r.isNonEmpty(p)?(0,o.pipe)(C.write(p),w.zipRight(C.succeedNow(e))):s>t?C.succeedNow(e):eC(e,t,i,n,a,u,l))),onFailure:C.fail,onDone:()=>C.succeedNow(e)}),eE=(e,t,i,n,a,u,l,p,c)=>{if(c===u.length)return s.succeed([e,p,l,r.empty()]);let h=(0,o.pipe)(u,r.unsafeGet(c));return(0,o.pipe)(i(e,h),s.map(e=>p+e),s.flatMap(f=>f<=t?(0,o.pipe)(a(e,h),s.flatMap(e=>eE(e,t,i,n,a,u,!0,f,c+1))):(0,o.pipe)(n(h),s.flatMap(d=>d.length<=1&&!l?(0,o.pipe)(a(e,h),s.map(e=>[e,f,!0,(0,o.pipe)(u,r.drop(c+1))])):d.length<=1&&l?s.succeed([e,p,l,(0,o.pipe)(u,r.drop(c))]):eE(e,t,i,n,a,(0,o.pipe)(d,r.appendAll((0,o.pipe)(u,r.drop(c+1)))),l,p,0)))))},ev=(0,o.dual)(2,(e,t)=>es(e,{onFailure:Z,onSuccess:t})),ek=e=>{let t=C.readWithCause({onInput:i=>(0,o.pipe)(C.fromEffect(e(i)),C.flatMap(()=>t)),onFailure:C.failCause,onDone:()=>C.void});return new k(t)},ex=(e,t,i,n,a)=>i===n?a:(0,o.pipe)(C.fromEffect(e((0,o.pipe)(t,r.unsafeGet(i)))),C.flatMap(s=>s?ex(e,t,i+1,n,a):C.write((0,o.pipe)(t,r.drop(i)))),w.catchAll(e=>(0,o.pipe)(C.write((0,o.pipe)(t,r.drop(i))),w.zipRight(C.fail(e))))),eI=e=>new k(e),e_=e=>new k(C.fromEffect(e)),eF=e=>C.readWith({onInput:t=>w.foldChannel(C.fromEffect(e(h.some(t))),{onFailure:([e,t])=>u.match(e,{onLeft:e=>(0,o.pipe)(C.write(t),w.zipRight(C.fail(e))),onRight:e=>(0,o.pipe)(C.write(t),w.zipRight(C.succeedNow(e)))}),onSuccess:()=>eF(e)}),onFailure:C.fail,onDone:()=>w.foldChannel(C.fromEffect(e(h.none())),{onFailure:([e,t])=>u.match(e,{onLeft:e=>(0,o.pipe)(C.write(t),w.zipRight(C.fail(e))),onRight:e=>(0,o.pipe)(C.write(t),w.zipRight(C.succeedNow(e)))}),onSuccess:()=>C.fromEffect(s.dieMessage("BUG: Sink.fromPush - please report an issue at https://github.com/Effect-TS/effect/issues"))})}),eM=(e,t)=>t?.shutdown?eK(s.map(s.acquireRelease(s.succeed(e),b.shutdown),eM)):ek(t=>b.offerAll(e,t)),eA=e=>new k(w.drain(e$(e))),eR=(0,o.dual)(2,(e,t)=>new k((0,o.pipe)(e$(e),w.map(t)))),ez=(0,o.dual)(2,(e,t)=>new k((0,o.pipe)(e$(e),w.mapEffect(t)))),eT=(0,o.dual)(2,(e,t)=>new k((0,o.pipe)(e$(e),w.mapError(t)))),eW=(0,o.dual)(2,(e,t)=>new k((0,o.pipe)(e$(e),w.mapOut(r.map(t))))),eD=e_(s.never),eO=(0,o.dual)(2,(e,t)=>new k((0,o.pipe)(e$(e),w.orElse(()=>e$(t()))))),eP=(0,o.dual)(2,(e,t)=>new k((0,o.pipe)(e$(e),C.provideContext(t)))),eL=(0,o.dual)(2,(e,t)=>(0,o.pipe)(e,eN(t),eR(u.merge))),eN=(0,o.dual)(e=>x(e[1]),(e,t,i)=>eB(e,{other:t,onSelfDone:e=>S.Done(s.map(e,u.left)),onOtherDone:e=>S.Done(s.map(e,u.right)),capacity:i?.capacity??16})),eB=(0,o.dual)(2,(e,t)=>eJ(function(i){return s.gen(function*(){let r=yield*m.bounded(t?.capacity??16),n=yield*y.extend(m.subscribe(r),i),a=yield*y.extend(m.subscribe(r),i),s=w.toPubSub(r),u=w.fromQueue(n).pipe(C.pipeTo(e$(e)),w.zipLeft(C.fromEffect(b.shutdown(n))),w.mergeWith({other:w.fromQueue(a).pipe(C.pipeTo(e$(t.other)),w.zipLeft(C.fromEffect(b.shutdown(a)))),onSelfDone:t.onSelfDone,onOtherDone:t.onOtherDone}));return new k(w.mergeWith(s,{other:u,onSelfDone:()=>S.Await(o.identity),onOtherDone:e=>S.Done(e)}))})})),eq=(0,o.dual)(2,(e,t)=>(0,o.pipe)(e,eU(t,o.identity))),eU=(0,o.dual)(3,(e,t,r)=>new k((0,o.pipe)(e,e$,w.catchAll(e=>h.match(t(e),{onNone:()=>C.failCauseSync(()=>i.die(r(e))),onSome:C.fail}))))),ej=(0,o.dual)(2,(e,t)=>new k((0,o.pipe)(C.fromEffect(g.make(r.empty())),C.flatMap(i=>(0,o.pipe)(eH(!1,i,t),w.pipeToOrFail(e$(e)),C.collectElements,C.flatMap(([e,t])=>(0,o.pipe)(C.fromEffect(g.get(i)),C.flatMap(i=>(0,o.pipe)(C.write((0,o.pipe)(i,r.appendAll(r.flatten(e)))),w.zipRight(C.succeed(t))))))))))),eH=(e,t,i)=>C.readWithCause({onInput:n=>{if(r.isEmpty(n))return eH(e,t,i);if(e){let e=eQ(n,i);if(-1===e)return w.zipRight(C.write(n),eH(!0,t,i));let[a,s]=r.splitAt(n,e);return w.zipRight(C.write(a),C.fromEffect(g.set(t,s)))}let a=eQ(n,i,1);if(-1===a)return w.zipRight(C.write(n),eH(!0,t,i));let[s,u]=(0,o.pipe)(n,r.splitAt(Math.max(a,1)));return w.zipRight(C.write(s),C.fromEffect(g.set(t,u)))},onFailure:C.failCause,onDone:C.succeed}),eQ=(e,t,i=0)=>{let r,n=e[Symbol.iterator](),a=0,s=-1;for(;s<0&&(r=n.next())&&!r.done;){let e=r.value;a>=i&&t(e)&&(s=a),a+=1}return s},eV=em(0,(e,t)=>e+r.reduce(t,0,(e,t)=>e+t)),eG=(0,o.dual)(3,(e,t,i)=>new k((0,o.pipe)(C.fromEffect(t),C.flatMap(r=>(0,o.pipe)(e,e$,C.flatMap(e=>(0,o.pipe)(C.fromEffect(t),w.map(t=>[e,i(r,t)])))))))),e$=e=>s.isEffect(e)?e$(e_(e)):e.channel,eK=e=>new k(w.unwrapScoped(e.pipe(s.map(e=>e$(e))))),eJ=e=>new k(w.unwrapScopedWith(t=>e(t).pipe(s.map(e=>e$(e))))),eX=e=>(0,o.pipe)(e,eG(n.currentTimeMillis,(e,t)=>a.millis(t-e))),eZ=(0,o.dual)(e=>x(e[1]),(e,t,i)=>e1(e,t,(e,t)=>[e,t],i)),eY=(0,o.dual)(e=>x(e[1]),(e,t,i)=>e1(e,t,(e,t)=>e,i)),e0=(0,o.dual)(e=>x(e[1]),(e,t,i)=>e1(e,t,(e,t)=>t,i)),e1=(0,o.dual)(e=>x(e[1]),(e,t,i,r)=>r?.concurrent?eB(e,{other:t,onSelfDone:l.match({onFailure:e=>S.Done(s.failCause(e)),onSuccess:e=>S.Await(l.match({onFailure:s.failCause,onSuccess:t=>s.succeed(i(e,t))}))}),onOtherDone:l.match({onFailure:e=>S.Done(s.failCause(e)),onSuccess:e=>S.Await(l.match({onFailure:s.failCause,onSuccess:t=>s.succeed(i(t,e))}))})}):ev(e,e=>eR(t,t=>i(e,t)))),e2=em(0,(e,t)=>e+t.length),e4=I(()=>{let e=[];return(0,o.pipe)(em(void 0,(t,i)=>r.map(i,t=>{e.push(String(t))})),eR(()=>e.join("")))}),e7=(0,o.pipe)(eX(U),eR(e=>e[1]));e.s(["SinkTypeId",0,E,"as",0,_,"channelToSink",0,e=>new k(e),"collectAll",0,()=>new k(F(r.empty())),"collectAllFrom",0,e=>z(e,{initial:r.empty(),while:o.constTrue,body:(e,t)=>(0,o.pipe)(e,r.append(t))}),"collectAllN",0,e=>I(()=>eI(M(e,r.empty()))),"collectAllToMap",0,(e,t)=>em(p.empty(),(i,n)=>(0,o.pipe)(n,r.reduce(i,(i,r)=>{let n=e(r),a=(0,o.pipe)(i,p.has(n))?t((0,o.pipe)(i,p.unsafeGet(n)),r):r;return(0,o.pipe)(i,p.set(n,a))}))),"collectAllToMapN",0,(e,t,i)=>eb({initial:p.empty(),maxCost:e,cost:(e,i)=>+!(0,o.pipe)(e,p.has(t(i))),body:(e,r)=>{let n=t(r),a=(0,o.pipe)(e,p.has(n))?i((0,o.pipe)(e,p.unsafeGet(n)),r):r;return(0,o.pipe)(e,p.set(n,a))}}),"collectAllToSet",0,()=>em(c.empty(),(e,t)=>(0,o.pipe)(t,r.reduce(e,(e,t)=>(0,o.pipe)(e,c.add(t))))),"collectAllToSetN",0,e=>eb({initial:c.empty(),maxCost:e,cost:(e,t)=>+!c.has(e,t),body:(e,t)=>c.add(e,t)}),"collectAllUntil",0,e=>(0,o.pipe)(er([r.empty(),!0],e=>e[1],([t,i],n)=>[(0,o.pipe)(t,r.append(n)),!e(n)]),eR(e=>e[0])),"collectAllUntilEffect",0,e=>(0,o.pipe)(ec([r.empty(),!0],e=>e[1],([t,i],n)=>(0,o.pipe)(e(n),s.map(e=>[(0,o.pipe)(t,r.append(n)),!e]))),eR(e=>e[0])),"collectAllWhile",0,e=>eI(A(e,r.empty())),"collectAllWhileEffect",0,e=>eI(R(e,r.empty())),"collectAllWhileWith",0,z,"collectLeftover",0,e=>new k((0,o.pipe)(C.collectElements(e$(e)),w.map(([e,t])=>[t,r.flatten(e)]))),"context",0,X,"contextWith",0,e=>(0,o.pipe)(X(),eR(e)),"contextWithEffect",0,e=>(0,o.pipe)(X(),ez(e)),"contextWithSink",0,e=>new k(w.unwrap(s.contextWith(t=>e$(e(t))))),"count",0,e2,"die",0,e=>Y(i.die(e)),"dieMessage",0,e=>Y(i.die(new i.RuntimeException(e))),"dieSync",0,e=>ee(()=>i.die(e())),"dimap",0,L,"dimapChunks",0,B,"dimapChunksEffect",0,q,"dimapEffect",0,N,"drain",0,U,"drop",0,j,"dropUntil",0,e=>new k((0,o.pipe)(e$(V(t=>!e(t))),w.pipeToOrFail(e$(j(1))))),"dropUntilEffect",0,e=>I(()=>new k(Q(e))),"dropWhile",0,V,"dropWhileEffect",0,e=>I(()=>new k($(e))),"ensuring",0,K,"ensuringWith",0,J,"every",0,e=>er(!0,o.identity,(t,i)=>t&&e(i)),"fail",0,Z,"failCause",0,Y,"failCauseSync",0,ee,"failSync",0,e=>new k(C.failSync(e)),"filterInput",0,e=>t=>(0,o.pipe)(t,O(r.filter(e))),"filterInputEffect",0,et,"findEffect",0,ei,"flatMap",0,ev,"fold",0,er,"foldChunks",0,eu,"foldChunksEffect",0,eo,"foldEffect",0,ec,"foldLeft",0,(e,t)=>eA(er(e,o.constTrue,t)),"foldLeftChunks",0,em,"foldLeftChunksEffect",0,(e,t)=>eA(eo(e,o.constTrue,t)),"foldLeftEffect",0,(e,t)=>ec(e,o.constTrue,t),"foldSink",0,es,"foldUntil",0,(e,t,i)=>(0,o.pipe)(er([e,0],e=>e[1]<t,([e,t],r)=>[i(e,r),t+1]),eR(e=>e[0])),"foldUntilEffect",0,(e,t,i)=>(0,o.pipe)(ec([e,0],e=>e[1]<t,([e,t],r)=>(0,o.pipe)(i(e,r),s.map(e=>[e,t+1]))),eR(e=>e[0])),"foldWeighted",0,eb,"foldWeightedDecompose",0,eg,"foldWeightedDecomposeEffect",0,eS,"foldWeightedEffect",0,e=>eS({...e,decompose:e=>s.succeed(r.of(e))}),"forEach",0,e=>{let t=C.readWithCause({onInput:i=>(0,o.pipe)(C.fromEffect(s.forEach(i,t=>e(t),{discard:!0})),C.flatMap(()=>t)),onFailure:C.failCause,onDone:()=>C.void});return new k(t)},"forEachChunk",0,ek,"forEachChunkWhile",0,e=>{let t=C.readWith({onInput:i=>(0,o.pipe)(C.fromEffect(e(i)),C.flatMap(e=>e?t:C.void)),onFailure:C.fail,onDone:()=>C.void});return new k(t)},"forEachWhile",0,e=>{let t=C.readWithCause({onInput:i=>ex(e,i,0,i.length,t),onFailure:C.failCause,onDone:()=>C.void});return new k(t)},"fromChannel",0,eI,"fromEffect",0,e_,"fromPubSub",0,(e,t)=>eM(e,t),"fromPush",0,e=>new k(w.unwrapScoped((0,o.pipe)(e,s.map(eF)))),"fromQueue",0,eM,"head",0,()=>er(h.none(),h.isNone,(e,t)=>h.match(e,{onNone:()=>h.some(t),onSome:()=>e})),"ignoreLeftover",0,eA,"last",0,()=>em(h.none(),(e,t)=>h.orElse(r.last(t),()=>e)),"leftover",0,e=>new k(C.suspend(()=>C.write(e))),"map",0,eR,"mapEffect",0,ez,"mapError",0,eT,"mapInput",0,W,"mapInputChunks",0,O,"mapInputChunksEffect",0,P,"mapInputEffect",0,D,"mapLeftover",0,eW,"mkString",0,e4,"never",0,eD,"orElse",0,eO,"provideContext",0,eP,"race",0,eL,"raceBoth",0,eN,"raceWith",0,eB,"refineOrDie",0,eq,"refineOrDieWith",0,eU,"some",0,e=>er(!1,e=>!e,(t,i)=>t||e(i)),"splitWhere",0,ej,"succeed",0,e=>new k(C.succeed(e)),"sum",0,eV,"summarized",0,eG,"suspend",0,I,"sync",0,e=>new k(C.sync(e)),"take",0,e=>(0,o.pipe)(eu(r.empty(),t=>t.length<e,(e,t)=>(0,o.pipe)(e,r.appendAll(t))),ev(t=>{let[i,n]=(0,o.pipe)(t,r.splitAt(e));return new k((0,o.pipe)(C.write(n),w.zipRight(C.succeedNow(i))))})),"timed",0,e7,"toChannel",0,e$,"unwrap",0,e=>new k(w.unwrap((0,o.pipe)(e,s.map(e=>e$(e))))),"unwrapScoped",0,eK,"unwrapScopedWith",0,eJ,"withDuration",0,eX,"zip",0,eZ,"zipLeft",0,eY,"zipRight",0,e0,"zipWith",0,e1])},594294,195480,e=>{"use strict";var t=e.i(251785);t.MergeDecisionTypeId;let i=t.Done,r=t.Await;t.AwaitConst,t.isMergeDecision,t.match,e.s(["Await",0,r,"Done",0,i],594294);var n=e.i(741140),a=e.i(284445),s=e.i(532102),u=e.i(915838),l=e.i(126539),o=e.i(625290),p=e.i(449969),c=e.i(519479),h=e.i(916142);let f=Symbol.for("effect/RcRef"),d={_tag:"Empty"},m={_tag:"Closed"},b={_A:u.identity,_E:u.identity};class g extends s.Class{acquire;context;scope;idleTimeToLive;[f]=b;[l.TypeId]=l.TypeId;state=d;semaphore=c.unsafeMakeSemaphore(1);constructor(e,t,i,r){super(),this.acquire=e,this.context=t,this.scope=i,this.idleTimeToLive=r,this.get=y(this)}get;commit(){return this.get}}let y=e=>p.uninterruptibleMask(t=>p.suspend(()=>{switch(e.state._tag){case"Closed":return p.interrupt;case"Acquired":return e.state.refCount++,e.state.fiber?p.as(p.interruptFiber(e.state.fiber),e.state):p.succeed(e.state);case"Empty":return h.scopeMake().pipe(o.bindTo("scope"),o.bind("value",({scope:i})=>t(p.fiberRefLocally(e.acquire,p.currentContext,n.add(e.context,h.scopeTag,i)))),p.map(({scope:t,value:i})=>{let r={_tag:"Acquired",value:i,scope:t,fiber:void 0,refCount:1};return e.state=r,r}))}})).pipe(e.semaphore.withPermits(1),o.bindTo("state"),o.bind("scope",()=>h.scopeTag),p.tap(({scope:t,state:i})=>t.addFinalizer(()=>p.suspend(()=>(i.refCount--,i.refCount>0)?p.void:void 0===e.idleTimeToLive?(e.state=d,p.scopeClose(i.scope,p.exitVoid)):o.sleep(e.idleTimeToLive).pipe(p.interruptible,p.zipRight(p.suspend(()=>"Acquired"===e.state._tag&&0===e.state.refCount?(e.state=d,p.scopeClose(i.scope,p.exitVoid)):p.void)),h.ensuring(p.sync(()=>{i.fiber=void 0})),c.forkIn(e.scope),p.tap(e=>{i.fiber=e}),e.semaphore.withPermits(1))))),p.map(({state:e})=>e.value));e.s(["get",0,y,"make",0,e=>p.withFiberRuntime(t=>{let i=t.getFiberRef(p.currentContext),r=n.get(i,h.scopeTag),s=new g(e.acquire,i,r,e.idleTimeToLive?a.decode(e.idleTimeToLive):void 0);return p.as(r.addFinalizer(()=>s.semaphore.withPermits(1)(p.suspend(()=>{let e="Acquired"===s.state._tag?p.scopeClose(s.state.scope,p.exitVoid):p.void;return s.state=m,e}))),s)})],195480)},927070,887672,e=>{"use strict";var t=e.i(915838);let i="Left",r="Right",n="Both",a="Either",s={_tag:i},u={_tag:r},l={_tag:n},o={_tag:a},p=(0,t.dual)(2,(e,t)=>{switch(e._tag){case i:return t.onLeft();case r:return t.onRight();case n:return t.onBoth();case a:return t.onEither()}});e.s(["Both",0,l,"Either",0,o,"Left",0,s,"Right",0,u,"fromInput",0,e=>{switch(e){case"left":return s;case"right":return u;case"both":return l;case"either":return o;default:return e}},"isBoth",0,e=>e._tag===n,"isEither",0,e=>e._tag===a,"isLeft",0,e=>e._tag===i,"isRight",0,e=>e._tag===r,"match",0,p],887672),e.s(["Both",0,l],927070)},632488,297129,e=>{"use strict";var t=e.i(913578),i=e.i(223356),r=e.i(154776),n=e.i(932915);i.ChannelTypeId,t.ChannelExceptionTypeId,i.isChannel;let a=t.acquireUseRelease;i.acquireReleaseOut,t.as,t.asVoid,t.buffer,t.bufferChunk,t.catchAll,i.catchAllCause,i.concatAll,i.concatAllWith,t.concatMap,i.concatMapWith,i.concatMapWithCustom,t.collect,t.concatOut,t.mapInput,t.mapInputEffect,t.mapInputError,t.mapInputErrorEffect,t.mapInputIn,t.mapInputInEffect,t.doneCollect,t.drain;let s=i.embedInput;t.emitCollect,t.ensuring,i.ensuringWith,t.context,t.contextWith,t.contextWithChannel,t.contextWithEffect,i.fail,i.failSync;let u=i.failCause;i.failCauseSync;let l=i.flatMap;t.flatten,t.foldChannel,i.foldCauseChannel,i.fromEffect,t.fromEither,t.fromInput,t.fromPubSub,t.fromPubSubScoped,t.fromOption,t.fromQueue,t.identityChannel,t.interruptWhen,t.interruptWhenDeferred,t.map,t.mapEffect,t.mapError,t.mapErrorCause,t.mapOut,t.mapOutEffect,t.mapOutEffectPar,t.mergeAll,t.mergeAllUnbounded,t.mergeAllUnboundedWith,t.mergeAllWith,t.mergeMap,t.mergeOut,t.mergeOutWith,t.mergeWith,t.never,t.orDie,t.orDieWith,t.orElse;let o=i.pipeTo;t.pipeToOrFail,i.provideContext,t.provideLayer,t.mapInputContext,t.provideSomeLayer,t.provideService,t.read,i.readOrFail,i.readWith;let p=i.readWithCause;t.repeated;let c=t.run;t.runCollect;let h=t.runDrain;t.runScoped,t.scoped,t.scopedWith,t.splitLines;let f=i.succeed,d=i.suspend,m=i.sync;t.toPubSub;let b=t.toPull;t.toPullIn,t.toQueue,r.channelToSink,n.channelToStream;let g=i.void,y=t.unwrap,w=t.unwrapScoped;t.unwrapScopedWith,t.updateService,t.withSpan;let S=i.write;t.writeAll,t.writeChunk,t.zip,t.zipLeft;let C=t.zipRight;t.ChannelException,t.isChannelException,e.s(["acquireUseRelease",0,a,"embedInput",0,s,"failCause",0,u,"flatMap",0,l,"pipeTo",0,o,"readWithCause",0,p,"run",0,c,"runDrain",0,h,"succeed",0,f,"suspend",0,d,"sync",0,m,"toPull",0,b,"unwrap",0,y,"unwrapScoped",0,w,"void",()=>g,"write",0,S,"zipRight",0,C],632488),r.SinkTypeId,r.as,r.collectAll,r.collectAllN,r.collectAllFrom,r.collectAllToMap,r.collectAllToMapN,r.collectAllToSet,r.collectAllToSetN,r.collectAllUntil,r.collectAllUntilEffect,r.collectAllWhile,r.collectAllWhileEffect,r.collectAllWhileWith,r.collectLeftover,r.mapInput,r.mapInputEffect,r.mapInputChunks,r.mapInputChunksEffect,r.count,r.die,r.dieMessage,r.dieSync,r.dimap,r.dimapEffect,r.dimapChunks,r.dimapChunksEffect,r.drain,r.drop,r.dropUntil,r.dropUntilEffect,r.dropWhile,r.dropWhileEffect,r.ensuring,r.ensuringWith,r.context,r.contextWith,r.contextWithEffect,r.contextWithSink,r.every;let E=r.fail;r.failSync,r.failCause,r.failCauseSync,r.filterInput,r.filterInputEffect,r.findEffect,r.fold,r.foldSink,r.foldChunks,r.foldChunksEffect,r.foldEffect,r.foldLeft,r.foldLeftChunks,r.foldLeftChunksEffect,r.foldLeftEffect,r.foldUntil,r.foldUntilEffect,r.foldWeighted,r.foldWeightedDecompose,r.foldWeightedDecomposeEffect,r.foldWeightedEffect;let v=r.forEach;r.forEachChunk,r.forEachChunkWhile,r.forEachWhile,r.flatMap,r.fromChannel,r.toChannel,r.fromEffect,r.fromPubSub,r.fromPush,r.fromQueue,r.head,r.ignoreLeftover,r.last,r.leftover,r.map,r.mapEffect,r.mapError,r.mapLeftover,r.mkString,r.never,r.orElse,r.provideContext,r.race,r.raceBoth,r.raceWith,r.refineOrDie,r.refineOrDieWith,r.some,r.splitWhere,r.succeed,r.sum,r.summarized,r.suspend,r.sync,r.take,r.timed,r.unwrap;let k=r.unwrapScoped;r.unwrapScopedWith,r.withDuration,r.zip,r.zipLeft,r.zipRight,r.zipWith,e.s(["fail",0,E,"forEach",0,v,"unwrapScoped",0,k],297129)},861404,572539,e=>{"use strict";e.i(50099);var t=e.i(741140);e.i(300767);var i=e.i(632488),r=e.i(777444),n=e.i(878753),a=e.i(915838),s=e.i(874068),u=e.i(886999),l=e.i(297129),o=e.i(788339),p=e.i(566206);let c=(0,t.GenericTag)("@effect/platform/FileSystem"),h=e=>"bigint"==typeof e?e:BigInt(e),f=BigInt(1024),d=f*f*f*f*f,m=(e,t)=>new p.SystemError({module:"FileSystem",method:e,reason:"NotFound",description:"No such file or directory",pathOrDescriptor:t}),b=e=>({access:e=>n.fail(m("access",e)),chmod:e=>n.fail(m("chmod",e)),chown:e=>n.fail(m("chown",e)),copy:e=>n.fail(m("copy",e)),copyFile:e=>n.fail(m("copyFile",e)),exists:()=>n.succeed(!1),link:e=>n.fail(m("link",e)),makeDirectory:()=>n.die("not implemented"),makeTempDirectory:()=>n.die("not implemented"),makeTempDirectoryScoped:()=>n.die("not implemented"),makeTempFile:()=>n.die("not implemented"),makeTempFileScoped:()=>n.die("not implemented"),open:e=>n.fail(m("open",e)),readDirectory:e=>n.fail(m("readDirectory",e)),readFile:e=>n.fail(m("readFile",e)),readFileString:e=>n.fail(m("readFileString",e)),readLink:e=>n.fail(m("readLink",e)),realPath:e=>n.fail(m("realPath",e)),remove:()=>n.void,rename:e=>n.fail(m("rename",e)),sink:e=>l.fail(m("sink",e)),stat:e=>n.fail(m("stat",e)),stream:e=>o.fail(m("stream",e)),symlink:e=>n.fail(m("symlink",e)),truncate:e=>n.fail(m("truncate",e)),utimes:e=>n.fail(m("utimes",e)),watch:e=>o.fail(m("watch",e)),writeFile:e=>n.fail(m("writeFile",e)),writeFileString:e=>n.fail(m("writeFileString",e)),...e});e.s(["GiB",0,e=>h(1024*e*1048576),"KiB",0,e=>h(1024*e),"MiB",0,e=>h(1024*e*1024),"PiB",0,e=>h(BigInt(e)*d),"Size",0,h,"TiB",0,e=>h(1024*e*0x40000000),"layerNoop",0,e=>s.succeed(c,b(e)),"make",0,e=>c.of({...e,exists:t=>(0,a.pipe)(e.access(t),n.as(!0),n.catchTag("SystemError",e=>"NotFound"===e.reason?n.succeed(!1):n.fail(e))),readFileString:(t,i)=>n.tryMap(e.readFile(t),{try:e=>new TextDecoder(i).decode(e),catch:e=>new p.BadArgument({module:"FileSystem",method:"readFileString",description:"invalid encoding",cause:e})}),stream:(t,s)=>(0,a.pipe)(e.open(t,{flag:"r"}),s?.offset?n.tap(e=>e.seek(s.offset,"start")):a.identity,n.map(e=>((e,{bufferSize:t=16,bytesToRead:n,chunkSize:a=h(65536)}={})=>{let s=void 0!==n?h(n):void 0,l=h(a);return o.bufferChunks(o.fromChannel(function t(n){return void 0!==s&&s<=n?i.void:i.flatMap(e.readAlloc(void 0!==s&&s-n<l?s-n:l),u.match({onNone:()=>i.void,onSome:e=>i.flatMap(i.write(r.of(e)),i=>t(n+BigInt(e.length)))}))}(BigInt(0))),{capacity:t})})(e,s)),o.unwrapScoped),sink:(t,i)=>(0,a.pipe)(e.open(t,{flag:"w",...i}),n.map(e=>l.forEach(t=>e.writeAll(t))),l.unwrapScoped),writeFileString:(t,i,r)=>n.flatMap(n.try({try:()=>new TextEncoder().encode(i),catch:e=>new p.BadArgument({module:"FileSystem",method:"writeFileString",description:"could not encode string",cause:e})}),i=>e.writeFile(t,i,r))}),"makeNoop",0,b,"tag",0,c],572539),e.s(["FileSystem",0,c,"Size",0,h],861404)},26528,836917,e=>{"use strict";var t=e.i(741140),i=e.i(878753),r=e.i(915838),n=e.i(874068),a=e.i(566206);let s=Symbol.for("@effect/platform/Path"),u=(0,t.GenericTag)("@effect/platform/Path");function l(e,t){let i,r="",n=0,a=-1,s=0;for(let u=0;u<=e.length;++u){if(u<e.length)i=e.charCodeAt(u);else if(47===i)break;else i=47;if(47===i){if(a===u-1||1===s);else if(a!==u-1&&2===s){if(r.length<2||2!==n||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2)){if(r.length>2){let e=r.lastIndexOf("/");if(e!==r.length-1){-1===e?(r="",n=0):n=(r=r.slice(0,e)).length-1-r.lastIndexOf("/"),a=u,s=0;continue}}else if(2===r.length||1===r.length){r="",n=0,a=u,s=0;continue}}t&&(r.length>0?r+="/..":r="..",n=2)}else r.length>0?r+="/"+e.slice(a+1,u):r=e.slice(a+1,u),n=u-a-1;a=u,s=0}else 46===i&&-1!==s?++s:s=-1}return r}let o=function(){let e,t="",i=!1;for(let r=arguments.length-1;r>=-1&&!i;r--){let n;if(r>=0)n=arguments[r];else{let t=globalThis.process;void 0===e&&"process"in globalThis&&"object"==typeof t&&null!==t&&"function"==typeof t.cwd&&(e=t.cwd()),n=e}0!==n.length&&(t=n+"/"+t,i=47===n.charCodeAt(0))}if(t=l(t,!i),i)if(t.length>0)return"/"+t;else return"/";return t.length>0?t:"."},p=/%/g,c=/\\/g,h=/\n/g,f=/\r/g,d=/\t/g,m=u.of({[s]:s,resolve:o,normalize(e){if(0===e.length)return".";let t=47===e.charCodeAt(0),i=47===e.charCodeAt(e.length-1);return(0!==(e=l(e,!t)).length||t||(e="."),e.length>0&&i&&(e+="/"),t)?"/"+e:e},isAbsolute:e=>e.length>0&&47===e.charCodeAt(0),join(){let e;if(0==arguments.length)return".";for(let t=0;t<arguments.length;++t){let i=arguments[t];i.length>0&&(void 0===e?e=i:e+="/"+i)}return void 0===e?".":m.normalize(e)},relative(e,t){if(e===t||(e=m.resolve(e),t=m.resolve(t),e===t))return"";let i=1;for(;i<e.length&&47===e.charCodeAt(i);++i);let r=e.length,n=r-i,a=1;for(;a<t.length&&47===t.charCodeAt(a);++a);let s=t.length-a,u=n<s?n:s,l=-1,o=0;for(;o<=u;++o){if(o===u){if(s>u){if(47===t.charCodeAt(a+o))return t.slice(a+o+1);else if(0===o)return t.slice(a+o)}else n>u&&(47===e.charCodeAt(i+o)?l=o:0===o&&(l=0));break}let r=e.charCodeAt(i+o);if(r!==t.charCodeAt(a+o))break;47===r&&(l=o)}let p="";for(o=i+l+1;o<=r;++o)(o===r||47===e.charCodeAt(o))&&(0===p.length?p+="..":p+="/..");return p.length>0?p+t.slice(a+l):(a+=l,47===t.charCodeAt(a)&&++a,t.slice(a))},dirname(e){if(0===e.length)return".";let t=e.charCodeAt(0),i=47===t,r=-1,n=!0;for(let i=e.length-1;i>=1;--i)if(47===(t=e.charCodeAt(i))){if(!n){r=i;break}}else n=!1;return -1===r?i?"/":".":i&&1===r?"//":e.slice(0,r)},basename(e,t){let i,r=0,n=-1,a=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";let s=t.length-1,u=-1;for(i=e.length-1;i>=0;--i){let l=e.charCodeAt(i);if(47===l){if(!a){r=i+1;break}}else -1===u&&(a=!1,u=i+1),s>=0&&(l===t.charCodeAt(s)?-1==--s&&(n=i):(s=-1,n=u))}return r===n?n=u:-1===n&&(n=e.length),e.slice(r,n)}for(i=e.length-1;i>=0;--i)if(47===e.charCodeAt(i)){if(!a){r=i+1;break}}else -1===n&&(a=!1,n=i+1);return -1===n?"":e.slice(r,n)},extname(e){let t=-1,i=0,r=-1,n=!0,a=0;for(let s=e.length-1;s>=0;--s){let u=e.charCodeAt(s);if(47===u){if(!n){i=s+1;break}continue}-1===r&&(n=!1,r=s+1),46===u?-1===t?t=s:1!==a&&(a=1):-1!==t&&(a=-1)}return -1===t||-1===r||0===a||1===a&&t===r-1&&t===i+1?"":e.slice(t,r)},format:function(e){let t,i;if(null===e||"object"!=typeof e)throw TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return t=e.dir||e.root,i=e.base||(e.name||"")+(e.ext||""),t?t===e.root?t+i:t+"/"+i:i},parse(e){let t,i={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return i;let r=e.charCodeAt(0),n=47===r;n?(i.root="/",t=1):t=0;let a=-1,s=0,u=-1,l=!0,o=e.length-1,p=0;for(;o>=t;--o){if(47===(r=e.charCodeAt(o))){if(!l){s=o+1;break}continue}-1===u&&(l=!1,u=o+1),46===r?-1===a?a=o:1!==p&&(p=1):-1!==a&&(p=-1)}return -1===a||-1===u||0===p||1===p&&a===u-1&&a===s+1?-1!==u&&(0===s&&n?i.base=i.name=e.slice(1,u):i.base=i.name=e.slice(s,u)):(0===s&&n?(i.name=e.slice(1,a),i.base=e.slice(1,u)):(i.name=e.slice(s,a),i.base=e.slice(s,u)),i.ext=e.slice(a,u)),s>0?i.dir=e.slice(0,s-1):n&&(i.dir="/"),i},sep:"/",fromFileUrl:function(e){if("file:"!==e.protocol)return i.fail(new a.BadArgument({module:"Path",method:"fromFileUrl",description:"URL must be of scheme file"}));if(""!==e.hostname)return i.fail(new a.BadArgument({module:"Path",method:"fromFileUrl",description:"Invalid file URL host"}));let t=e.pathname;for(let e=0;e<t.length;e++)if("%"===t[e]){let r=32|t.codePointAt(e+2);if("2"===t[e+1]&&102===r)return i.fail(new a.BadArgument({module:"Path",method:"fromFileUrl",description:"must not include encoded / characters"}))}return i.succeed(decodeURIComponent(t))},toFileUrl:function(e){var t;let r=new URL("file://"),n=o(e);return 47===e.charCodeAt(e.length-1)&&"/"!==n[n.length-1]&&(n+="/"),(t=n).includes("%")&&(t=t.replace(p,"%25")),t.includes("\\")&&(t=t.replace(c,"%5C")),t.includes("\n")&&(t=t.replace(h,"%0A")),t.includes("\r")&&(t=t.replace(f,"%0D")),t.includes("	")&&(t=t.replace(d,"%09")),r.pathname=t,i.succeed(r)},toNamespacedPath:r.identity}),b=n.succeed(u,m);e.s(["Path",0,u,"TypeId",0,s,"layer",0,b],836917),e.s(["Path",0,u],26528)},315113,e=>{"use strict";let t=Symbol.for("effect/PrimaryKey");e.s(["symbol",0,t])},788339,932915,167256,e=>{"use strict";var t=e.i(51889),i=e.i(777444),r=e.i(405763),n=e.i(878753),a=e.i(532102),s=e.i(980914),u=e.i(915838),l=e.i(886999),o=e.i(862409),p=e.i(681830),c=e.i(383615),h=e.i(335260),f=e.i(797734),d=e.i(913578),m=e.i(981354),b=e.i(223356),g=e.i(389631),y=e.i(741140),w=e.i(284445),S=e.i(343469),C=e.i(615446),E=e.i(462241),v=e.i(660421),k=e.i(197244),x=e.i(874068),I=e.i(594294),_=e.i(979475),F=e.i(195480),M=e.i(717729),A=e.i(213029),R=e.i(927070),z=e.i(266417),T=e.i(494576),W=e.i(349543),D=e.i(93842),O=e.i(449969),P=e.i(328593),L=e.i(977441),N=e.i(736418),B=e.i(154776);class q{value;constructor(e){this.value=e}}let U=(e,t)=>({ref:e,isNew:t,isChanged:!1,expected:e.versioned,newValue:e.versioned.value}),j=(e,t)=>{e.isChanged=!0,e.newValue=t},H=e=>{e.ref.versioned=new q(e.newValue)},Q=e=>({ref:e.ref,isNew:e.isNew,isChanged:e.isChanged,expected:e.expected,newValue:e.newValue}),V=e=>e.ref.versioned!==e.expected,G=e=>e.isChanged,$="Invalid",K="ReadWrite",J=e=>{for(let t of e)H(t[1])},X=e=>{let t="ReadOnly";for(let[,i]of e)if((t=V(i)?$:G(i)?K:t)===$)break;return t},Z="WithSTMRuntime",Y="OnFailure",ee="OnRetry",et="OnSuccess",ei="Provide",er="Sync",en="Succeed",ea="Retry",es="Fail",eu="Interrupt",el="Fail",eo="Interrupt",ep="Succeed",ec="Retry",eh="Done",ef="Suspend",ed="Done",em="Interrupted",eb="Running",eg="effect/STM/State",ey=Symbol.for(eg),ew=e=>(0,p.hasProperty)(e,ey),eS=e=>({[ey]:ey,_tag:ed,exit:e,[W.symbol](){return(0,u.pipe)(W.hash(eg),W.combine(W.hash(ed)),W.combine(W.hash(e)),W.cached(this))},[C.symbol]:t=>ew(t)&&t._tag===ed&&C.equals(e,t.exit)}),eC=(0,u.pipe)(W.hash(eg),W.combine(W.hash(em)),W.combine(W.hash("interrupted"))),eE={[ey]:ey,_tag:em,[W.symbol]:()=>eC,[C.symbol]:e=>ew(e)&&e._tag===em},ev=(0,u.pipe)(W.hash(eg),W.combine(W.hash(eb)),W.combine(W.hash("running"))),ek={[ey]:ey,_tag:eb,[W.symbol]:()=>ev,[C.symbol]:e=>ew(e)&&e._tag===eb},ex=e=>{switch(e._tag){case el:return eS(s.fail(e.error));case"Die":return eS(s.die(e.defect));case eo:return eS(s.interrupt(e.fiberId));case ep:return eS(s.succeed(e.value));case ec:throw Error("BUG: STM.STMState.fromTExit - please report an issue at https://github.com/Effect-TS/effect/issues")}},eI="effect/TExit",e_=Symbol.for(eI),eF={_A:e=>e,_E:e=>e},eM=e=>(0,p.hasProperty)(e,e_),eA=e=>({[e_]:eF,_tag:el,error:e,[W.symbol](){return(0,u.pipe)(W.hash(eI),W.combine(W.hash(el)),W.combine(W.hash(e)),W.cached(this))},[C.symbol]:t=>eM(t)&&t._tag===el&&C.equals(e,t.error)}),eR=e=>({[e_]:eF,_tag:"Die",defect:e,[W.symbol](){return(0,u.pipe)(W.hash(eI),W.combine(W.hash("Die")),W.combine(W.hash(e)),W.cached(this))},[C.symbol]:t=>eM(t)&&"Die"===t._tag&&C.equals(e,t.defect)}),ez=e=>({[e_]:eF,_tag:eo,fiberId:e,[W.symbol](){return(0,u.pipe)(W.hash(eI),W.combine(W.hash(eo)),W.combine(W.hash(e)),W.cached(this))},[C.symbol]:t=>eM(t)&&t._tag===eo&&C.equals(e,t.fiberId)}),eT=e=>({[e_]:eF,_tag:ep,value:e,[W.symbol](){return(0,u.pipe)(W.hash(eI),W.combine(W.hash(ep)),W.combine(W.hash(e)),W.cached(this))},[C.symbol]:t=>eM(t)&&t._tag===ep&&C.equals(e,t.value)}),eW=(0,u.pipe)(W.hash(eI),W.combine(W.hash(ec)),W.combine(W.hash("retry"))),eD={[e_]:eF,_tag:ec,[W.symbol]:()=>eW,[C.symbol]:e=>eM(e)&&e._tag===ec},eO=e=>({_tag:ef,journal:e}),eP={ref:0},eL=Symbol.for("effect/STM"),eN={_R:e=>e,_E:e=>e,_A:e=>e};class eB{effect_instruction_i0;_op=L.OP_COMMIT;effect_instruction_i1=void 0;effect_instruction_i2=void 0;[n.EffectTypeId];[P.StreamTypeId];[B.SinkTypeId];[b.ChannelTypeId];get[eL](){return eN}constructor(e){this.effect_instruction_i0=e,this[n.EffectTypeId]=P.effectVariance,this[P.StreamTypeId]=eN,this[B.SinkTypeId]=eN,this[b.ChannelTypeId]=eN}[C.symbol](e){return this===e}[W.symbol](){return W.cached(this,W.random(this))}[Symbol.iterator](){return new N.SingleShotGen(new D.YieldWrap(this))}commit(){return eq(this,u.constVoid,u.constVoid)}pipe(){return(0,o.pipeArguments)(this,arguments)}}let eq=(e,t,i)=>(0,O.withFiberRuntime)(r=>{let a=r.id(),s=r.getFiberRef(v.currentContext),l=r.getFiberRef(v.currentScheduler),o=r.getFiberRef(v.currentSchedulingPriority),p=eU(a,e,s,l,o);switch(p._tag){case eh:return t(p.exit),p.exit;case ef:{let r,p=(r=eP.ref+1,eP.ref=r,r),c={value:ek},h=n.async(t=>ej(a,e,p,c,s,l,o,t));return n.uninterruptibleMask(e=>(0,u.pipe)(e(h),n.catchAllCause(e=>{let r=c.value;return r._tag===eb&&(c.value=eE),(r=c.value)._tag===ed?(t(r.exit),r.exit):(i(),n.failCause(e))})))}}}),eU=(e,i,r,n,a)=>{let u=new Map,l=new eV(i,u,e,r).run(),o=X(u);if(o===K&&l._tag===ep)J(u);else if(o===$)throw Error("BUG: STM.TryCommit.tryCommitSync - please report an issue at https://github.com/Effect-TS/effect/issues");switch(l._tag){case ep:return eH(s.succeed(l.value),u,n,a);case el:{let e=t.fail(l.error);return eH(s.failCause(e),u,n,a)}case"Die":{let e=t.die(l.defect);return eH(s.failCause(e),u,n,a)}case eo:{let i=t.interrupt(e);return eH(s.failCause(i),u,n,a)}case ec:return eO(u)}},ej=(e,i,r,n,a,u,l,o)=>{if(n.value._tag===eb){let p=((e,i,r,n,a,u)=>{let l=new Map,o=new eV(i,l,e,n).run(),p=X(l);if(p===K)J(l);else if(p===$)throw Error("BUG: STM.TryCommit.tryCommit - please report an issue at https://github.com/Effect-TS/effect/issues");switch(o._tag){case ep:return r.value=ex(o),eH(s.succeed(o.value),l,a,u);case el:{r.value=ex(o);let e=t.fail(o.error);return eH(s.failCause(e),l,a,u)}case"Die":{r.value=ex(o);let e=t.die(o.defect);return eH(s.failCause(e),l,a,u)}case eo:{r.value=ex(o);let i=t.interrupt(e);return eH(s.failCause(i),l,a,u)}case ec:return eO(l)}})(e,i,n,a,u,l);switch(p._tag){case eh:eQ(p.exit,o);break;case ef:((e,t,i)=>{for(let[,r]of t)r.ref.todos.has(e)||r.ref.todos.set(e,i)})(r,p.journal,()=>ej(e,i,r,n,a,u,l,o))}}},eH=(e,t,i,r)=>{let n=(e=>{let t=new Map;for(let[,i]of e){for(let e of i.ref.todos)t.set(e[0],e[1]);i.ref.todos=new Map}return t})(t);return n.size>0&&i.scheduleTask(()=>(e=>{for(let[t,i]of Array.from(e.entries()).sort((e,t)=>e[0]-t[0]))i()})(n),r),{_tag:eh,exit:e}},eQ=(e,t)=>{t(e)};class eV{self;journal;fiberId;contStack=[];env;constructor(e,t,i,r){this.self=e,this.journal=t,this.fiberId=i,this.env=r}getEnv(){return this.env}pushStack(e){this.contStack.push(e)}popStack(){return this.contStack.pop()}nextSuccess(){let e=this.popStack();for(;void 0!==e&&e.effect_instruction_i0!==et;)e=this.popStack();return e}nextFailure(){let e=this.popStack();for(;void 0!==e&&e.effect_instruction_i0!==Y;)e=this.popStack();return e}nextRetry(){let e=this.popStack();for(;void 0!==e&&e.effect_instruction_i0!==ee;)e=this.popStack();return e}run(){let e,i=this.self;for(;void 0===e&&void 0!==i;)try{let r=i;if(r)switch(r._op){case"Tag":i=eX((e,t,i)=>y.unsafeGet(i,r));break;case"Left":i=eY(r.left);break;case"None":i=eY(new t.NoSuchElementException);break;case"Right":i=e6(r.right);break;case"Some":i=e6(r.value);break;case"Commit":switch(r.effect_instruction_i0){case"Die":e=eR((0,D.internalCall)(()=>r.effect_instruction_i1()));break;case es:{let t=this.nextFailure();void 0===t?e=eA((0,D.internalCall)(()=>r.effect_instruction_i1())):i=(0,D.internalCall)(()=>t.effect_instruction_i2((0,D.internalCall)(()=>r.effect_instruction_i1())));break}case ea:{let t=this.nextRetry();void 0===t?e=eD:i=(0,D.internalCall)(()=>t.effect_instruction_i2());break}case eu:e=ez(this.fiberId);break;case Z:i=(0,D.internalCall)(()=>r.effect_instruction_i1(this));break;case et:case Y:case ee:this.pushStack(r),i=r.effect_instruction_i1;break;case ei:{let e=this.env;this.env=(0,D.internalCall)(()=>r.effect_instruction_i2(e)),i=(0,u.pipe)(r.effect_instruction_i1,eZ(e5(()=>this.env=e)));break}case en:{let t=r.effect_instruction_i1,n=this.nextSuccess();void 0===n?e=eT(t):i=(0,D.internalCall)(()=>n.effect_instruction_i2(t));break}case er:{let t=(0,D.internalCall)(()=>r.effect_instruction_i1()),n=this.nextSuccess();void 0===n?e=eT(t):i=(0,D.internalCall)(()=>n.effect_instruction_i2(t))}}}}catch(e){i=eK(e)}return e}}let eG=(0,u.dual)(2,(e,t)=>{let i=new eB(Y);return i.effect_instruction_i1=e,i.effect_instruction_i2=t,i}),e$=(0,u.dual)(2,(e,t)=>{let i=new eB(ei);return i.effect_instruction_i1=e,i.effect_instruction_i2=t,i}),eK=e=>eJ(()=>e),eJ=e=>{let t=new eB("Die");return t.effect_instruction_i1=e,t},eX=e=>e4(t=>e6(e(t.journal,t.fiberId,t.getEnv()))),eZ=(0,u.dual)(2,(e,t)=>e2(e,{onFailure:e=>te(t,eY(e)),onSuccess:e=>te(t,e6(e))})),eY=e=>e0(()=>e),e0=e=>{let t=new eB(es);return t.effect_instruction_i1=e,t},e1=(0,u.dual)(2,(e,t)=>{let i=new eB(et);return i.effect_instruction_i1=e,i.effect_instruction_i2=t,i}),e2=(0,u.dual)(2,(e,{onFailure:t,onSuccess:i})=>(0,u.pipe)(e,e3(S.right),eG(e=>(0,u.pipe)(t(e),e3(S.left))),e1(e=>{switch(e._tag){case"Left":return e6(e.left);case"Right":return i(e.right)}}))),e4=e=>{let t=new eB(Z);return t.effect_instruction_i1=e,t},e7=e=>{let t=new eB(eu);return t.effect_instruction_i1=e,t},e3=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,e1(e=>e5(()=>t(e))))),e8=(0,u.dual)(2,(e,t)=>{let i=new eB(ee);return i.effect_instruction_i1=e,i.effect_instruction_i2=t,i}),e9=new eB(ea),e6=e=>{let t=new eB(en);return t.effect_instruction_i1=e,t},e5=e=>{let t=new eB(er);return t.effect_instruction_i1=e,t},te=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,e1(()=>t))),tt=(0,u.dual)(3,(e,t,i)=>(0,u.pipe)(e,e1(e=>(0,u.pipe)(t,e3(t=>i(e,t)))))),ti=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,e3(()=>t))),tr=((e,t)=>e2(e,{onFailure:eY,onSuccess:e=>{let i=t(e);return l.isSome(i)?i.value:e9}}),(0,u.dual)(2,(e,{onFailure:t,onSuccess:i})=>e2(e,{onFailure:e=>e6(t(e)),onSuccess:e=>e6(i(e))}))),tn=(0,u.dual)(e=>p.isIterable(e[0]),(e,t,i)=>i?.discard?(0,u.pipe)(e5(()=>e[Symbol.iterator]()),e1(e=>{let i=ts(()=>{let r=e.next();return r.done?tl:(0,u.pipe)(t(r.value),e1(()=>i))});return i})):ts(()=>z.fromIterable(e).reduce((e,i)=>tt(e,t(i),(e,t)=>(e.push(t),e)),e6([])))),ta=((e,t)=>e2(e,{onFailure:e=>eY(t(e)),onSuccess:e6}),(0,u.dual)(2,(e,t)=>e$(e,e=>t))),ts=((e,t,i)=>{let r;return r=r=>e1(i,i=>ta(e,y.add(r,t,i))),e1(eX((e,t,i)=>i),r)},e=>e1(e5(e),u.identity)),tu=(0,u.dual)(2,(e,t)=>e1(e,e=>ti(t(e),e))),tl=e6(void 0),to=Symbol.for("effect/TRef"),tp={_A:e=>e};class tc{[to]=tp;todos;versioned;constructor(e){this.versioned=new q(e),this.todos=new Map}modify(e){return eX(t=>{let i=td(this,t),[r,n]=e(i.newValue);return j(i,n),r})}pipe(){return(0,o.pipeArguments)(this,arguments)}}let th=e=>e.modify(e=>[e,e]),tf=(0,u.dual)(2,(e,t)=>e.modify(()=>[void 0,t])),td=(e,t)=>{if(t.has(e))return t.get(e);let i=U(e,!1);return t.set(e,i),i},tm=(0,u.dual)(2,(e,t)=>td(e,t).newValue),tb=(0,u.dual)(3,(e,t,i)=>{j(td(e,i),t)}),tg=Symbol.for("effect/TQueue/TDequeue"),ty={_Out:e=>e},tw=((e,t,r)=>ts(()=>{let n=(t,r,a)=>r<t?e6(a):(0,u.pipe)(e.takeUpTo(r),e1(s=>{let l=t-s.length;return 1===l?(0,u.pipe)(e.take,e3(e=>(0,u.pipe)(a,i.appendAll(i.unsafeFromArray(s)),i.append(e)))):l>1?(0,u.pipe)(e.take,e1(e=>n(l-1,r-s.length-1,(0,u.pipe)(a,i.appendAll(i.unsafeFromArray(s)),i.append(e))))):e6((0,u.pipe)(a,i.appendAll(i.unsafeFromArray(s))))}));return e3(n(t,r,i.empty()),e=>Array.from(e))}),Symbol.for("effect/TPubSub")),tS=Symbol.for("effect/TPubSub/AbsentValue"),tC=(e,t,i)=>({head:e,subscribers:t,tail:i});class tE{pubsubSize;publisherHead;requestedCapacity;subscriberHead;subscriberCount;subscribers;[tw]=tw;[tg]=ty;constructor(e,t,i,r,n,a){this.pubsubSize=e,this.publisherHead=t,this.requestedCapacity=i,this.subscriberHead=r,this.subscriberCount=n,this.subscribers=a}isShutdown=eX(e=>void 0===tm(this.subscriberHead,e));awaitShutdown=e1(this.isShutdown,e=>e?tl:e9);capacity(){return this.requestedCapacity}size=e4(e=>{let t=tm(this.subscriberHead,e.journal);if(void 0===t)return e7(e.fiberId);let i=!0,r=0;for(;i;){let n=tm(t,e.journal);void 0===n?i=!1:(n.head!==tS&&(r+=1)>=Number.MAX_SAFE_INTEGER&&(i=!1),t=n.tail)}return e6(r)});isEmpty=e3(this.size,e=>0===e);isFull=e3(this.size,e=>e===this.capacity());peek=e4(e=>{let t=tm(this.subscriberHead,e.journal);if(void 0===t)return e7(e.fiberId);let i=tS,r=!0;for(;r;){let n=tm(t,e.journal);if(void 0===n)return e9;let a=n.head,s=n.tail;a!==tS?(i=a,r=!1):t=s}return e6(i)});peekOption=e4(e=>{let t=tm(this.subscriberHead,e.journal);if(void 0===t)return e7(e.fiberId);let i=l.none(),r=!0;for(;r;){let n=tm(t,e.journal);if(void 0===n)i=l.none(),r=!1;else{let e=n.head,a=n.tail;e!==tS?(i=l.some(e),r=!1):t=a}}return e6(i)});shutdown=eX(e=>{let t=tm(this.subscriberHead,e);if(void 0!==t){tb(this.subscriberHead,void 0,e);let i=!0;for(;i;){let r=tm(t,e);if(void 0===r)i=!1;else{let i=r.head,n=r.tail;if(i!==tS){let a=r.subscribers;if(1===a){let i=tm(this.pubsubSize,e);tb(t,tC(tS,0,n),e),tb(this.publisherHead,n,e),tb(this.pubsubSize,i-1,e)}else tb(t,tC(i,a-1,n),e)}t=n}}let r=tm(this.subscriberCount,e);tb(this.subscriberCount,r-1,e),tb(this.subscribers,T.remove(tm(this.subscribers,e),this.subscriberHead),e)}});take=e4(e=>{let t=tm(this.subscriberHead,e.journal);if(void 0===t)return e7(e.fiberId);let i=tS,r=!0;for(;r;){let n=tm(t,e.journal);if(void 0===n)return e9;let a=n.head,s=n.tail;if(a!==tS){let u=n.subscribers;if(1===u){let i=tm(this.pubsubSize,e.journal);tb(t,tC(tS,0,s),e.journal),tb(this.publisherHead,s,e.journal),tb(this.pubsubSize,i-1,e.journal)}else tb(t,tC(a,u-1,s),e.journal);tb(this.subscriberHead,s,e.journal),i=a,r=!1}else t=s}return e6(i)});takeAll=this.takeUpTo(1/0);takeUpTo(e){return e4(t=>{let i=tm(this.subscriberHead,t.journal);if(void 0===i)return e7(t.fiberId);let r=[],n=0;for(;n!==e;){let a=tm(i,t.journal);if(void 0===a)n=e;else{let e=a.head,s=a.tail;if(e!==tS){let u=a.subscribers;if(1===u){let e=tm(this.pubsubSize,t.journal);tb(i,tC(tS,0,s),t.journal),tb(this.publisherHead,s,t.journal),tb(this.pubsubSize,e-1,t.journal)}else tb(i,tC(e,u-1,s),t.journal);r.push(e),n+=1}i=s}}return tb(this.subscriberHead,i,t.journal),e6(r)})}}var tv=e.i(52667),tk=e.i(377473),tx=e.i(777356);class tI{capacity;array;size=0;current=0;constructor(e){this.capacity=e,this.array=Array.from({length:e},u.constUndefined)}head(){return l.fromNullable(this.array[this.current])}lastOrNull(){if(0===this.size)return;let e=0===this.current?this.array.length-1:this.current-1;return this.array[e]??void 0}put(e){this.array[this.current]=e,this.increment()}dropLast(){this.size>0&&(this.decrement(),this.array[this.current]=void 0)}toChunk(){let e=this.current-this.size,t=e<0?[...this.array.slice(this.capacity+e,this.capacity),...this.array.slice(0,this.current)]:this.array.slice(e,this.current);return i.fromIterable(t)}increment(){this.size<this.capacity&&(this.size+=1),this.current=(this.current+1)%this.capacity}decrement(){this.size-=1,this.current>0?this.current-=1:this.current=this.capacity-1}}var t_=e.i(885200);let tF="NotStarted",tM="Previous",tA="Current",tR={_tag:tF},tz=e=>Object.assign(e,{chunk(e){return this(n.succeed(e))},die(e){return this(n.die(e))},dieMessage(e){return this(n.dieMessage(e))},done(e){return this(n.suspend(()=>s.mapBoth(e,{onFailure:l.some,onSuccess:i.of})))},end(){return this(n.fail(l.none()))},fail(e){return this(n.fail(l.some(e)))},fromEffect(e){return this(n.mapBoth(e,{onFailure:l.some,onSuccess:i.of}))},fromEffectChunk(e){return this((0,u.pipe)(e,n.mapError(l.some)))},halt(e){return this(n.failCause((0,u.pipe)(e,t.map(l.some))))},single(e){return this(n.succeed(i.of(e)))}});var tT=e.i(887672);let tW=Symbol.for("effect/Stream/Handoff"),tD="Empty",tO="Full",tP=e=>({_tag:tD,notifyConsumer:e}),tL=(e,t)=>i=>{switch(i._tag){case tD:return e(i.notifyConsumer);case tO:return t(i.value,i.notifyProducer)}},tN={_A:e=>e},tB=()=>(0,u.pipe)(r.make(),n.flatMap(e=>h.make(tP(e))),n.map(e=>({[tW]:tN,ref:e}))),tq=(0,u.dual)(2,(e,t)=>n.flatMap(r.make(),i=>n.flatten(h.modify(e.ref,a=>(0,u.pipe)(a,tL(e=>[n.zipRight(r.succeed(e,void 0),r.await(i)),{_tag:tO,value:t,notifyProducer:i}],(i,s)=>[n.flatMap(r.await(s),()=>(0,u.pipe)(e,tq(t))),a])))))),tU=e=>n.flatMap(r.make(),t=>n.flatten(h.modify(e.ref,i=>(0,u.pipe)(i,tL(t=>[n.flatMap(r.await(t),()=>tU(e)),i],(e,i)=>[n.as(r.succeed(i,void 0),e),tP(t)]))))),tj="Emit",tH="Halt",tQ=e=>({_tag:tj,elements:e}),tV=e=>({_tag:tH,cause:e}),tG=e=>({_tag:"End",reason:e}),t$=Symbol.for("effect/Take"),tK={_A:e=>e,_E:e=>e};class tJ{exit;[t$]=tK;constructor(e){this.exit=e}pipe(){return(0,o.pipeArguments)(this,arguments)}}let tX=e=>new tJ(s.succeed(e)),tZ=e=>n.suspend(()=>e.exit),tY=new tJ(s.fail(l.none())),t0=e=>new tJ(s.failCause((0,u.pipe)(e,t.map(l.some)))),t1=e=>n.matchCause(e,{onFailure:e=>l.match(t.flipCauseOption(e),{onNone:()=>tY,onSome:t0}),onSuccess:tX}),t2=(0,u.dual)(2,(e,{onEnd:i,onFailure:r,onSuccess:n})=>s.match(e.exit,{onFailure:e=>l.match(t.flipCauseOption(e),{onNone:i,onSome:r}),onSuccess:n})),t4=e=>new tJ(s.succeed(i.of(e))),t7=()=>n.fail(l.none()),t3=e=>n.mapError(n.failCause(e),l.some),t8="ScheduleEnd",t9="UpstreamEnd",t6={_tag:t8},t5={_tag:t9},ie="DrainLeft",it="DrainRight",ii="PullBoth",ir="PullLeft",ia="PullRight",is={_tag:ie},iu={_tag:it},il={_tag:ii},io=e=>({_tag:ir,rightChunk:e}),ip=e=>({_tag:ia,leftChunk:e}),ic="PullBoth",ih="PullLet",id="PullRight",im={_tag:ic},ib=e=>({_tag:ih,rightChunk:e}),ig=e=>({_tag:id,leftChunk:e});var iy=e.i(85358);let iw=Symbol.for("effect/Stream"),iS={_R:e=>e,_E:e=>e,_A:e=>e};class iC{channel;[iw]=iS;constructor(e){this.channel=e}pipe(){return(0,o.pipeArguments)(this,arguments)}}let iE=e=>(0,p.hasProperty)(e,iw)||n.isEffect(e),iv=4096,ik=e=>{let t=e=>b.readWith({onInput:r=>{let n=i.appendAll(e,r);return b.flatMap(b.write(n),()=>t(n))},onFailure:b.fail,onDone:()=>b.void});return new iC(b.pipeTo(rj(e),t(i.empty())))},ix=(e,t)=>aq(n.acquireRelease(e,t)),iI=(0,u.dual)(2,(e,t)=>i_(e,t,A.forever)),i_=(0,u.dual)(3,(e,t,i)=>r_(iF(e,t,i),e=>S.match(e,{onLeft:l.none,onRight:l.some}))),iF=(0,u.dual)(3,(e,r,a)=>rV(n.all([tB(),h.make(t6),h.make(i.empty()),A.driver(a),h.make(!1),h.make(!1)])).pipe(rT(([a,s,o,p,c,f])=>{let m=b.readWithCause({onInput:e=>b.flatMap(b.fromEffect((0,u.pipe)(a,tq(tQ(e)),n.when(()=>i.isNonEmpty(e)))),()=>m),onFailure:e=>b.fromEffect(tq(a,tV(e))),onDone:()=>b.fromEffect(tq(a,tG(t5)))}),g=(0,u.pipe)(h.getAndSet(o,i.empty()),n.flatMap(e=>i.isNonEmpty(e)?(0,u.pipe)(h.set(c,!0),n.zipRight(n.succeed((0,u.pipe)(b.write(e),b.flatMap(()=>g))))):(0,u.pipe)(tU(a),n.map(e=>{switch(e._tag){case tj:return(0,u.pipe)(b.fromEffect(h.set(c,!0)),d.zipRight(b.write(e.elements)),d.zipRight(b.fromEffect(h.get(f))),b.flatMap(e=>e?b.void:g));case tH:return b.failCause(e.cause);case"End":if(e.reason._tag===t8)return(0,u.pipe)(h.get(c),n.map(e=>e?b.fromEffect((0,u.pipe)(h.set(s,t6),n.zipRight(h.set(f,!0)))):(0,u.pipe)(b.fromEffect((0,u.pipe)(h.set(s,t6),n.zipRight(h.set(f,!0)))),b.flatMap(()=>g))),d.unwrap);return(0,u.pipe)(h.set(s,e.reason),n.zipRight(h.set(f,!0)),b.fromEffect)}}))),d.unwrap),y=(e,m,w)=>{let C=(0,u.pipe)(h.set(c,!1),n.zipRight(h.set(f,!1)),n.zipRight((0,u.pipe)(g,d.pipeToOrFail(B.toChannel(r)),b.collectElements,d.run,n.forkIn(w)))),v=(e,t,r)=>(0,u.pipe)(h.set(o,i.flatten(e)),n.zipRight(n.map(h.get(s),e=>{switch(e._tag){case t8:let a;return(0,u.pipe)(n.all([h.get(c),C,(0,u.pipe)((a=l.some(t),p.next(a)),n.forkIn(w))]),n.map(([e,n,a])=>{let s=(0,u.pipe)(r,l.match({onNone:()=>i.of(S.right(t)),onSome:e=>i.make(S.right(t),S.left(e))}));return e?(0,u.pipe)(b.write(s),b.flatMap(()=>y(n,a,w))):y(n,a,w)}),d.unwrap);case t9:return(0,u.pipe)(h.get(c),n.map(e=>e?b.write(i.of(S.right(t))):b.void),d.unwrap)}})),d.unwrap);return d.unwrap(n.raceWith(E.join(e),E.join(m),{onSelfDone:(e,t)=>(0,u.pipe)(E.interrupt(m),n.zipRight((0,u.pipe)(n.suspend(()=>e),n.map(([e,t])=>v(e,t,l.none()))))),onOtherDone:(i,r)=>n.matchCauseEffect(n.suspend(()=>i),{onFailure:i=>S.match(t.failureOrCause(i),{onLeft:()=>(0,u.pipe)(a,tq(tG(t6)),n.forkDaemon,n.zipRight((0,u.pipe)(E.join(e),n.map(([e,t])=>v(e,t,l.none()))))),onRight:t=>(0,u.pipe)(a,tq(tV(t)),n.forkDaemon,n.zipRight((0,u.pipe)(E.join(e),n.map(([e,t])=>v(e,t,l.none())))))}),onSuccess:t=>(0,u.pipe)(a,tq(tG(t6)),n.forkDaemon,n.zipRight((0,u.pipe)(E.join(e),n.map(([e,i])=>v(e,i,l.some(t))))))})}))};return sv(t=>b.pipeTo(rj(e),m).pipe(d.run,n.forkIn(t),n.zipRight(d.pipeToOrFail(g,B.toChannel(r)).pipe(b.collectElements,d.run,n.forkIn(t),n.flatMap(e=>{let i;return(i=l.none(),p.next(i)).pipe(n.forkIn(t),n.map(i=>new iC(y(e,i,t))))})))))}))),iM=(0,u.dual)(2,(e,t)=>nu(e,()=>t)),iA=e=>{if("unbounded"===e)return c.unbounded();if("number"==typeof e||void 0===e)return c.bounded(e??16);switch(e.strategy){case"dropping":return c.dropping(e.bufferSize??16);case"sliding":return c.sliding(e.bufferSize??16);default:return c.bounded(e.bufferSize??16)}},iR=(e,i)=>n.acquireRelease(iA(i),e=>c.shutdown(e)).pipe(n.flatMap(i=>n.runtime().pipe(n.flatMap(r=>n.sync(()=>{let a=M.runPromiseExit(r);return e(tz(e=>t1(e).pipe(n.flatMap(e=>c.offer(i,e)),n.asVoid,a).then(e=>{if(s.isFailure(e)&&!t.isInterrupted(e.cause))throw t.squash(e.cause)})))})),n.map(e=>{let t=c.take(i).pipe(n.flatMap(e=>tZ(e)),n.match({onFailure:e=>b.fromEffect(c.shutdown(i)).pipe(d.zipRight(l.match(e,{onNone:()=>b.void,onSome:e=>b.fail(e)}))),onSuccess:e=>b.write(e).pipe(b.flatMap(()=>t))}),d.unwrap);return rU(t).pipe(rg(e??n.void))}))),sE),iz=(e,t)=>n.acquireRelease(t?.bufferSize==="unbounded"||t?.bufferSize===void 0&&t?.strategy===void 0?c.unbounded():t?.strategy==="sliding"?c.sliding(t.bufferSize??16):c.dropping(t?.bufferSize??16),c.shutdown).pipe(n.tap(t=>v.getWith(v.currentScheduler,r=>e(((e,t)=>{let r=!1,n=[],a=!1;function u(e){if(r)return!1;if(e.length<=5e4)n.push.apply(n,e);else for(let t=0;t<e.length;t++)n.push(e[0]);return a||(a=!0,t.scheduleTask(l,0)),!0}function l(){a=!1,n.length>0&&(e.unsafeOffer(n),n=[])}function o(t){r||(r=!0,"Success"===t._tag&&n.push(t.value),l(),e.unsafeOffer("Success"===t._tag?s.void:t))}return{single:e=>!r&&(n.push(e),a||(a=!0,t.scheduleTask(l,0)),!0),array:u,chunk:e=>u(i.toReadonlyArray(e)),done:o,end(){r||(r=!0,l(),e.unsafeOffer(s.void))},halt:e=>o(s.failCause(e)),fail:e=>o(s.fail(e)),die:e=>o(s.die(e)),dieMessage:e=>o(s.die(Error(e)))}})(t,r)))),n.map(e=>{let t=b.flatMap(c.take(e),e=>s.isExit(e)?s.isSuccess(e)?b.void:b.failCause(e.cause):d.zipRight(b.write(i.unsafeFromArray(e)),t));return t}),d.unwrapScoped,rU),iT=(0,u.dual)(3,(e,t,r)=>aX(()=>{let n=e=>b.readWith({onInput:r=>{if(e.length+r.length>=t){let[n,s]=(0,u.pipe)(r,i.splitAt(t-e.length));return a((0,u.pipe)(e,i.appendAll(n)),s)}return n((0,u.pipe)(e,i.appendAll(r)))},onFailure:b.fail,onDone:()=>a(e,i.empty())}),a=(e,t)=>b.pipeTo(d.zipRight(b.write(t),d.identityChannel()),rj(r(e)));return new iC((0,u.pipe)(rj(e),d.pipeToOrFail(n(i.empty()))))})),iW=(0,u.dual)(3,(e,t,i)=>(0,u.pipe)(e,iP(t,i),n.map(e=>e.map(e=>rB(rZ(e,{shutdown:!0})))))),iD=(0,u.dual)(2,(e,t)=>n.map(su(e,t),e=>rB(r$(e)))),iO=(0,u.dual)(2,(e,t)=>n.map(F.make({acquire:iD(e,t),idleTimeToLive:t.idleTimeToLive}),e=>sE(F.get(e)))),iP=(0,u.dual)(3,(e,t,i)=>n.flatMap(ss(i),i=>(0,u.pipe)(n.all(Array.from({length:t},()=>_.subscribe(i))),n.tap(()=>n.forkScoped(aA(e,i)))))),iL=(0,u.dual)(2,(e,t)=>n.map(su(e,t),_.subscribe)),iN=(0,u.dual)(2,(e,r)=>{if("unbounded"===r.capacity)return iQ(e);if("dropping"===r.strategy)return ij(e,r.capacity);if("sliding"===r.strategy)return iH(e,r.capacity);let a=sp(e,r);return new iC(d.unwrapScoped(n.map(a,e=>{let r=(0,u.pipe)(b.fromEffect(c.take(e)),b.flatMap(s.match({onFailure:e=>(0,u.pipe)(t.flipCauseOption(e),l.match({onNone:()=>b.void,onSome:b.failCause})),onSuccess:e=>b.flatMap(b.write(i.of(e)),()=>r)})));return r})))}),iB=(0,u.dual)(2,(e,t)=>{if("dropping"===t.strategy)return iq(e,t.capacity);if("sliding"===t.strategy)return iU(e,t.capacity);let i=so(e,t);return new iC(d.unwrapScoped(n.map(i,e=>{let t=(0,u.pipe)(b.fromEffect(c.take(e)),b.flatMap(t2({onEnd:()=>b.void,onFailure:b.failCause,onSuccess:e=>(0,u.pipe)(b.write(e),b.flatMap(()=>t))})));return t})))}),iq=(0,u.dual)(2,(e,t)=>new iC(iV(n.acquireRelease(c.dropping(t),e=>c.shutdown(e)),rj(e)))),iU=(0,u.dual)(2,(e,t)=>new iC(iV(n.acquireRelease(c.sliding(t),e=>c.shutdown(e)),rj(e)))),ij=(0,u.dual)(2,(e,t)=>new iC(iV(n.acquireRelease(c.dropping(t),e=>c.shutdown(e)),rj(n9(1)(e))))),iH=(0,u.dual)(2,(e,t)=>new iC(iV(n.acquireRelease(c.sliding(t),e=>c.shutdown(e)),rj((0,u.pipe)(e,n9(1)))))),iQ=e=>{let t=so(e,{strategy:"unbounded"});return new iC(d.unwrapScoped(n.map(t,e=>{let t=(0,u.pipe)(b.fromEffect(c.take(e)),b.flatMap(t2({onEnd:()=>b.void,onFailure:b.failCause,onSuccess:e=>b.flatMap(b.write(e),()=>t)})));return t})))},iV=(e,t)=>{let i=(e,t)=>{let a=i=>(0,u.pipe)(h.get(t),n.tap(r.await),n.zipRight(r.make()),n.flatMap(a=>(0,u.pipe)(c.offer(e,[i,a]),n.zipRight(h.set(t,a)),n.zipRight(r.await(a)))),n.asVoid,b.fromEffect);return b.readWithCause({onInput:a=>(0,u.pipe)(r.make(),n.flatMap(i=>(0,u.pipe)(c.offer(e,[tX(a),i]),n.flatMap(e=>(0,u.pipe)(h.set(t,i),n.when(()=>e))))),n.asVoid,b.fromEffect,b.flatMap(()=>i(e,t))),onFailure:e=>a(t0(e)),onDone:()=>a(tY)})};return d.unwrapScoped((0,u.pipe)(e,n.flatMap(e=>(0,u.pipe)(r.make(),n.tap(e=>r.succeed(e,void 0)),n.flatMap(a=>{let s;return(0,u.pipe)(h.make(a),n.flatMap(r=>(0,u.pipe)(t,b.pipeTo(i(e,r)),d.runScoped,n.forkScoped)),n.as(s=(0,u.pipe)(b.fromEffect(c.take(e)),b.flatMap(([e,t])=>d.zipRight(b.fromEffect(r.succeed(t,void 0)),t2(e,{onEnd:()=>b.void,onFailure:b.failCause,onSuccess:e=>(0,u.pipe)(b.write(e),b.flatMap(()=>s))}))))))})))))},iG=(0,u.dual)(2,(e,i)=>i$(e,e=>S.match(t.failureOrCause(e),{onLeft:i,onRight:rk}))),i$=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),b.catchAllCause(e=>rj(t(e)))))),iK=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,iG(e=>(0,u.pipe)(t(e),l.getOrElse(()=>rE(e)))))),iJ=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,i$(e=>(0,u.pipe)(t(e),l.getOrElse(()=>rk(e)))))),iX=(0,u.dual)(3,(e,t,i)=>iG(e,e=>"_tag"in e&&e._tag===t?i(e):rE(e))),iZ=(0,u.dual)(2,(e,t)=>iG(e,e=>{let i=Object.keys(t);return"_tag"in e&&i.includes(e._tag)?t[e._tag](e):rE(e)})),iY=(0,u.dual)(2,(e,t)=>{let r=e=>b.readWithCause({onInput:n=>{let[a,s]=i.reduce(n,[e,i.empty()],([e,r],n)=>l.isSome(e)&&t(e.value,n)?[l.some(n),r]:[l.some(n),(0,u.pipe)(r,i.append(n))]);return b.flatMap(b.write(s),()=>r(a))},onFailure:b.failCause,onDone:()=>b.void});return new iC((0,u.pipe)(rj(e),b.pipeTo(r(l.none()))))}),i0=(0,u.dual)(2,(e,t)=>{let r=e=>b.readWithCause({onInput:a=>(0,u.pipe)(a,n.reduce([e,i.empty()],([e,r],a)=>l.isSome(e)?(0,u.pipe)(t(e.value,a),n.map(e=>e?[l.some(a),r]:[l.some(a),(0,u.pipe)(r,i.append(a))])):n.succeed([l.some(a),(0,u.pipe)(r,i.append(a))])),b.fromEffect,b.flatMap(([e,t])=>(0,u.pipe)(b.write(t),b.flatMap(()=>r(e))))),onFailure:b.failCause,onDone:()=>b.void});return new iC((0,u.pipe)(rj(e),b.pipeTo(r(l.none()))))}),i1=e=>(0,u.pipe)(e,nc(i.of)),i2=(0,u.dual)(2,(e,t)=>rP(t(i1(e)))),i4=e=>n.catchAll(n.asSome(e),e=>"None"===e._tag?n.succeedNone:n.fail(e.value)),i7=(0,u.dual)(4,(e,i,r,a)=>{function o(e,i){return b.fromEffect(tU(i)).pipe(d.zipRight(b.readWithCause({onInput:t=>b.flatMap(b.fromEffect(tq(e,s.succeed(t))),()=>o(e,i)),onFailure:i=>b.fromEffect(tq(e,s.failCause((0,u.pipe)(i,t.map(l.some))))),onDone:()=>b.flatMap(b.fromEffect(tq(e,s.fail(l.none()))),()=>o(e,i))})))}return new iC(d.unwrapScopedWith(t=>n.all([tB(),tB(),tB(),tB()]).pipe(n.tap(([i,r,a])=>rj(e).pipe(d.concatMap(d.writeChunk),b.pipeTo(o(i,a)),m.runIn(t),n.forkIn(t))),n.tap(([,e,r,a])=>rj(i).pipe(d.concatMap(d.writeChunk),b.pipeTo(o(e,a)),m.runIn(t),n.forkIn(t))),n.map(([e,t,i,s])=>{let l=tq(i,void 0).pipe(n.zipRight(tU(e).pipe(n.flatMap(u.identity)))),o=tq(s,void 0).pipe(n.zipRight(tU(t).pipe(n.flatMap(u.identity))));return rj(sw(r,e=>n.flatMap(a(e,l,o),i4)))}))))}),i3=(0,u.dual)(4,(e,t,i,r)=>{let a=(e,t)=>d.zipRight(b.fromEffect(tU(t)),b.readWithCause({onInput:i=>b.flatMap(b.fromEffect((0,u.pipe)(e,tq(tX(i)))),()=>a(e,t)),onFailure:t=>b.fromEffect(tq(e,t0(t))),onDone:()=>b.fromEffect(tq(e,tY))}));return new iC(d.unwrapScopedWith(s=>n.all([tB(),tB(),tB(),tB()]).pipe(n.tap(([t,i,r])=>b.pipeTo(rj(e),a(t,r)).pipe(m.runIn(s),n.forkIn(s))),n.tap(([e,i,r,u])=>b.pipeTo(rj(t),a(i,u)).pipe(m.runIn(s),n.forkIn(s))),n.map(([e,t,a,s])=>{let u=tq(a,void 0).pipe(n.zipRight(tU(e).pipe(n.flatMap(tZ)))),l=tq(s,void 0).pipe(n.zipRight(tU(t).pipe(n.flatMap(tZ))));return rj(sy(i,e=>n.flatMap(r(e,u,l),i4)))}))))}),i8=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),d.zipRight(rj(t))))),i9=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,re(t,(e,t)=>[e,t]))),i6=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,re(t,(e,t)=>e))),i5=(0,u.dual)(2,(e,t)=>rT(e,()=>t)),re=(0,u.dual)(3,(e,t,i)=>(0,u.pipe)(e,rT(e=>(0,u.pipe)(t,nu(t=>i(e,t)))))),rt=(0,u.dual)(2,(e,t)=>sv(r=>n.gen(function*(){let a=yield*tB();function u(e){return g.sleep(t).pipe(n.as(e),n.forkIn(r),n.map(e=>p({_tag:tM,fiber:e})))}let o=b.readWithCause({onInput:e=>l.match(i.last(e),{onNone:()=>o,onSome:e=>b.fromEffect(tq(a,tQ(i.of(e)))).pipe(b.flatMap(()=>o))}),onFailure:e=>b.fromEffect(tq(a,tV(e))),onDone:()=>b.fromEffect(tq(a,tG(t5)))});function p(e){switch(e._tag){case tF:return d.unwrap(tU(a).pipe(n.map(e=>{switch(e._tag){case tj:return d.unwrap(u(e.elements));case tH:return b.failCause(e.cause);case"End":return b.void}})));case tM:return d.unwrap(tU(a).pipe(n.forkIn(r),n.flatMap(t=>n.raceWith(E.join(e.fiber),E.join(t),{onSelfDone:(e,i)=>s.match(e,{onFailure:e=>E.interrupt(i).pipe(n.as(b.failCause(e))),onSuccess:e=>E.interrupt(i).pipe(n.zipRight(n.succeed(b.write(e).pipe(b.flatMap(()=>p({_tag:tA,fiber:t}))))))}),onOtherDone:(e,t)=>s.match(e,{onFailure:e=>E.interrupt(t).pipe(n.as(b.failCause(e))),onSuccess:e=>{switch(e._tag){case tj:return E.interrupt(t).pipe(n.zipRight(u(e.elements)));case tH:return E.interrupt(t).pipe(n.as(b.failCause(e.cause)));case"End":return E.join(t).pipe(n.map(e=>b.write(e).pipe(d.zipRight(b.void))))}}})}))));case tA:return d.unwrap(E.join(e.fiber).pipe(n.map(e=>{switch(e._tag){case tj:return d.unwrap(u(e.elements));case tH:return b.failCause(e.cause);case"End":return b.void}})))}}return aU(t=>b.pipeTo(rj(e),o).pipe(m.runIn(t),n.forkIn(t))).pipe(i5(new iC(p(tR))))}))),ri=e=>rV(n.die(e)),rr=(0,u.dual)(2,(e,t)=>(0,u.pipe)(r.make(),n.flatMap(a=>(0,u.pipe)(e,rs({maximumLag:t.maximumLag,decide:e=>n.flatMap(r.await(a),t=>t(e))}),n.flatMap(e=>(0,u.pipe)(n.all(i.map(i.range(0,t.size-1),t=>n.map(e,([e,i])=>[[e,t],i]))),n.map(i.unsafeFromArray),n.flatMap(e=>{let[s,l]=i.reduceRight(e,[new Map,i.empty()],([e,t],[r,n])=>[e.set(r[0],r[1]),(0,u.pipe)(t,i.prepend(n))]);return(0,u.pipe)(r.succeed(a,e=>n.map(t.decide(e),e=>t=>e(s.get(t)))),n.as(Array.from(l)))}))))))),rn={ref:0},ra=()=>{let e=rn.ref;return rn.ref=e+1,e},rs=(0,u.dual)(2,(e,t)=>ru(e,t.maximumLag,t.decide,()=>n.void)),ru=(0,u.dual)(4,(e,r,a,o)=>(0,u.pipe)(n.acquireRelease(h.make(new Map),(e,t)=>(0,u.pipe)(h.get(e),n.flatMap(e=>(0,u.pipe)(e.values(),n.forEach(c.shutdown))))),n.flatMap(p=>n.gen(function*(){let f=yield*n.makeSemaphore(1),d=yield*h.make((0,u.pipe)(c.bounded(r),n.flatMap(e=>{let t=ra();return(0,u.pipe)(h.update(p,i=>i.set(t,e)),n.as([t,e]))}))),m=e=>f.withPermits(1)((0,u.pipe)(h.set(d,(0,u.pipe)(c.bounded(1),n.tap(t=>c.offer(t,e)),n.flatMap(e=>{let t=ra();return(0,u.pipe)(h.update(p,i=>i.set(t,e)),n.as(tv.make(t,e)))}))),n.zipRight((0,u.pipe)(h.get(p),n.flatMap(r=>(0,u.pipe)(i.fromIterable(r.values()),n.forEach(i=>(0,u.pipe)(c.offer(i,e),n.catchSomeCause(e=>t.isInterrupted(e)?l.some(n.void):l.none()))))))),n.zipRight(o(e)),n.asVoid));return yield*(0,u.pipe)(e,aI(e=>(0,u.pipe)(a(e),n.flatMap(r=>(0,u.pipe)(h.get(p),n.flatMap(a=>(0,u.pipe)(a.entries(),n.reduce(i.empty(),(a,[l,o])=>r(l)?(0,u.pipe)(c.offer(o,s.succeed(e)),n.matchCauseEffect({onFailure:e=>t.isInterrupted(e)?n.succeed((0,u.pipe)(a,i.prepend(l))):n.failCause(e),onSuccess:()=>n.succeed(a)})):n.succeed(a)),n.flatMap(e=>i.isNonEmpty(e)?h.update(p,t=>{for(let i of e)t.delete(i);return t}):n.void))))),n.asVoid)),n.matchCauseEffect({onFailure:e=>m(s.failCause((0,u.pipe)(e,t.map(l.some)))),onSuccess:()=>m(s.fail(l.none()))}),n.forkScoped),f.withPermits(1)(n.flatten(h.get(d)))})))),rl=e=>new iC(d.drain(rj(e))),ro=(0,u.dual)(2,(e,t)=>rV(r.make()).pipe(rT(i=>aU(e=>rj(t).pipe(d.drain,m.runIn(e),n.catchAllCause(e=>r.failCause(i,e)),n.forkIn(e))).pipe(i5(na(e,i)))))),rp=(0,u.dual)(2,(e,t)=>{let r=e=>b.readWith({onInput:t=>{let n=(0,u.pipe)(t,i.drop(e)),a=Math.max(0,e-t.length);return i.isEmpty(t)||a>0?r(a):(0,u.pipe)(b.write(n),d.zipRight(d.identityChannel()))},onFailure:b.fail,onDone:()=>b.void});return new iC((0,u.pipe)(rj(e),d.pipeToOrFail(r(t))))}),rc=(0,u.dual)(2,(e,t)=>t<=0?r6():aX(()=>{let r=new tI(t),n=b.readWith({onInput:e=>{let t=(0,u.pipe)(e,i.filterMap(e=>{let t=r.head();return r.put(e),t}));return(0,u.pipe)(b.write(t),b.flatMap(()=>n))},onFailure:b.fail,onDone:()=>b.void});return new iC((0,u.pipe)(rj(e),d.pipeToOrFail(n)))})),rh=(0,u.dual)(2,(e,t)=>rp(rd(e,e=>!t(e)),1)),rf=(0,u.dual)(2,(e,t)=>{let r=b.readWith({onInput:e=>(0,u.pipe)(n.dropUntil(e,t),n.map(i.unsafeFromArray),n.map(e=>i.isEmpty(e)?b.suspend(()=>r):(0,u.pipe)(b.write(e),d.zipRight(d.identityChannel()))),d.unwrap),onFailure:b.fail,onDone:()=>b.void});return new iC((0,u.pipe)(rj(e),d.pipeToOrFail(r)))}),rd=(0,u.dual)(2,(e,t)=>{let r=b.readWith({onInput:e=>{let n=i.dropWhile(e,t);return i.isEmpty(n)?b.suspend(()=>r):d.zipRight(b.write(n),d.identityChannel())},onFailure:b.fail,onDone:b.succeedNow});return new iC(d.pipeToOrFail(rj(e),r))}),rm=(0,u.dual)(2,(e,t)=>{let r=b.readWith({onInput:e=>(0,u.pipe)(n.dropWhile(e,t),n.map(i.unsafeFromArray),n.map(e=>i.isEmpty(e)?b.suspend(()=>r):d.zipRight(b.write(e),d.identityChannel())),d.unwrap),onFailure:b.fail,onDone:()=>b.void});return new iC(d.pipeToOrFail(rj(e),r))}),rb=new iC(b.void),rg=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),d.ensuring(t)))),ry=(0,u.dual)(2,(e,t)=>new iC(b.ensuringWith(rj(e),t))),rw=()=>rV(n.context()),rS=e=>(0,u.pipe)(rw(),rT(e)),rC=e=>rl(rV(e)),rE=e=>rG(n.fail(l.some(e))),rv=e=>rG(n.failSync(()=>l.some(e()))),rk=e=>rV(n.failCause(e)),rx=(0,u.dual)(2,(e,t)=>nc(e,i.filter(t))),rI=(0,u.dual)(2,(e,t)=>{let r=e=>{let a=e.next();return a.done?b.readWithCause({onInput:e=>r(e[Symbol.iterator]()),onFailure:b.failCause,onDone:b.succeed}):(0,u.pipe)(t(a.value),n.map(t=>t?(0,u.pipe)(b.write(i.of(a.value)),b.flatMap(()=>r(e))):r(e)),d.unwrap)};return new iC(b.suspend(()=>(0,u.pipe)(rj(e),b.pipeTo(r(i.empty()[Symbol.iterator]())))))}),r_=(0,u.dual)(2,(e,t)=>nc(e,i.filterMap(t))),rF=(0,u.dual)(2,(e,t)=>aX(()=>{let r=e=>{let a=e.next();return a.done?b.readWithCause({onInput:e=>r(e[Symbol.iterator]()),onFailure:b.failCause,onDone:b.succeed}):(0,u.pipe)(t(a.value),l.match({onNone:()=>n.sync(()=>r(e)),onSome:n.map(t=>b.flatMap(b.write(i.of(t)),()=>r(e)))}),d.unwrap)};return new iC((0,u.pipe)(rj(e),b.pipeTo(r(i.empty()[Symbol.iterator]()))))})),rM=(0,u.dual)(2,(e,t)=>{let r=b.readWith({onInput:e=>{let n=i.filterMapWhile(e,t);return n.length===e.length?(0,u.pipe)(b.write(n),b.flatMap(()=>r)):b.write(n)},onFailure:b.fail,onDone:b.succeed});return new iC((0,u.pipe)(rj(e),d.pipeToOrFail(r)))}),rA=(0,u.dual)(2,(e,t)=>aX(()=>{let r=e=>{let a=e.next();return a.done?b.readWithCause({onInput:e=>r(e[Symbol.iterator]()),onFailure:b.failCause,onDone:b.succeed}):d.unwrap(l.match(t(a.value),{onNone:()=>n.succeed(b.void),onSome:n.map(t=>b.flatMap(b.write(i.of(t)),()=>r(e)))}))};return new iC((0,u.pipe)(rj(e),d.pipeToOrFail(r(i.empty()[Symbol.iterator]()))))})),rR=(0,u.dual)(2,(e,t)=>{let r=b.readWith({onInput:e=>l.match(i.findFirst(e,t),{onNone:()=>r,onSome:e=>b.write(i.of(e))}),onFailure:b.fail,onDone:()=>b.void});return new iC((0,u.pipe)(rj(e),b.pipeTo(r)))}),rz=(0,u.dual)(2,(e,t)=>{let r=b.readWith({onInput:e=>(0,u.pipe)(n.findFirst(e,t),n.map(l.match({onNone:()=>r,onSome:e=>b.write(i.of(e))})),d.unwrap),onFailure:b.fail,onDone:()=>b.void});return new iC((0,u.pipe)(rj(e),b.pipeTo(r)))}),rT=(0,u.dual)(e=>iE(e[0]),(e,t,r)=>{let n=r?.bufferSize??16;return r?.switch?rW(r?.concurrency,()=>rD(e,1,n,t),i=>rD(e,i,n,t)):rW(r?.concurrency,()=>new iC(d.concatMap(rj(e),e=>(0,u.pipe)(e,i.map(e=>rj(t(e))),i.reduce(b.void,(e,t)=>(0,u.pipe)(e,d.zipRight(t)))))),i=>new iC((0,u.pipe)(rj(e),d.concatMap(d.writeChunk),d.mergeMap(e=>rj(t(e)),r))))}),rW=(e,t,i)=>{switch(e){case void 0:return t();case"unbounded":return i(Number.MAX_SAFE_INTEGER);default:return e>1?i(e):t()}},rD=(0,u.dual)(4,(e,t,i,r)=>new iC((0,u.pipe)(rj(e),d.concatMap(d.writeChunk),d.mergeMap(e=>rj(r(e)),{concurrency:t,mergeStrategy:tk.BufferSliding(),bufferSize:i})))),rO=(0,u.dual)(e=>iE(e[0]),(e,t)=>rT(e,u.identity,t)),rP=e=>{let t=b.readWithCause({onInput:e=>b.flatMap(d.writeChunk(e),()=>t),onFailure:b.failCause,onDone:()=>b.void});return new iC((0,u.pipe)(rj(e),b.pipeTo(t)))},rL=(0,u.dual)(e=>iE(e[0]),(e,t)=>t?.unordered?rT(e,e=>rV(e),{concurrency:t.concurrency}):rW(t?.concurrency,()=>ng(e,u.identity),t=>new iC((0,u.pipe)(rj(e),d.concatMap(d.writeChunk),d.mapOutEffectPar(u.identity,t),d.mapOut(i.of))))),rN=e=>{let r=b.readWithCause({onInput:e=>((e,r)=>{let[n,a]=(0,u.pipe)(e,i.splitWhere(e=>!s.isSuccess(e))),o=(0,u.pipe)(i.head(a),l.match({onNone:()=>r,onSome:s.match({onFailure:e=>l.match(t.flipCauseOption(e),{onNone:()=>b.void,onSome:b.failCause}),onSuccess:()=>b.void})}));return(0,u.pipe)(b.write((0,u.pipe)(n,i.filterMap(e=>s.isSuccess(e)?l.some(e.value):l.none()))),b.flatMap(()=>o))})(e,r),onFailure:e=>b.failCause(e),onDone:()=>b.void});return new iC((0,u.pipe)(rj(e),b.pipeTo(r)))},rB=e=>rP(rN((0,u.pipe)(e,nu(e=>e.exit)))),rq=e=>new iC(d.repeated(rj(e))),rU=e=>new iC(e),rj=e=>{if("channel"in e)return e.channel;if(n.isEffect(e))return rj(rV(e));throw TypeError("Expected a Stream.")},rH=e=>new iC(i.isEmpty(e)?b.void:b.write(e)),rQ=(e,i)=>(0,u.pipe)(c.take(e),n.catchAllCause(i=>(0,u.pipe)(c.isShutdown(e),n.flatMap(e=>e&&t.isInterrupted(i)?t7():t3(i)))),ar,i?.shutdown?rg(c.shutdown(e)):u.identity),rV=e=>(0,u.pipe)(e,n.mapError(l.some),rG),rG=e=>new iC(d.unwrap(n.match(e,{onFailure:l.match({onNone:()=>b.void,onSome:b.fail}),onSuccess:e=>b.write(i.of(e))}))),r$=(e,t)=>{let i=t?.maxChunkSize??iv;if(t?.scoped){let r=n.map(_.subscribe(e),e=>rZ(e,{maxChunkSize:i,shutdown:!0}));return t.shutdown?n.map(r,rg(_.shutdown(e))):r}let r=rT(aq(_.subscribe(e)),e=>rZ(e,{maxChunkSize:i}));return t?.shutdown?rg(r,_.shutdown(e)):r},rK=e=>aX(()=>i.isChunk(e)?rH(e):rJ(e[Symbol.iterator]())),rJ=(e,t=iv)=>(0,u.pipe)(n.sync(()=>{let r=[],a=e=>(0,u.pipe)(n.sync(()=>{let n=e.next();if(1===t)return n.done?b.void:(0,u.pipe)(b.write(i.of(n.value)),b.flatMap(()=>a(e)));r=[];let s=0;for(;!1===n.done&&(r.push(n.value),!((s+=1)>=t));)n=e.next();return s>0?(0,u.pipe)(b.write(i.unsafeFromArray(r)),b.flatMap(()=>a(e))):b.void}),d.unwrap);return new iC(a(e))}),sC),rX=e=>(0,u.pipe)(e,n.map(ar),sE),rZ=(e,i)=>(0,u.pipe)(c.takeBetween(e,1,i?.maxChunkSize??iv),n.catchAllCause(i=>(0,u.pipe)(c.isShutdown(e),n.flatMap(e=>e&&t.isInterrupted(i)?t7():t3(i)))),ar,i?.shutdown?rg(c.shutdown(e)):u.identity),rY=e=>(0,u.pipe)(e.take,n.map(i.of),n.catchAllCause(i=>(0,u.pipe)(e.isShutdown,n.flatMap(e=>e&&t.isInterrupted(i)?t7():t3(i)))),ar),r0=(...e)=>{let t=1===e.length?e[0].evaluate:e[0],i=1===e.length?e[0].onError:e[1],r=1===e.length&&!0===e[0].releaseLockOnEnd;return sE(n.map(n.acquireRelease(n.sync(()=>t().getReader()),e=>r?n.sync(()=>e.releaseLock()):n.promise(()=>e.cancel())),e=>an(n.flatMap(n.tryPromise({try:()=>e.read(),catch:e=>l.some(i(e))}),({done:e,value:t})=>e?n.fail(l.none()):n.succeed(t)))))},r1=Symbol.for("effect/Stream/EOF"),r2=(0,u.dual)(2,(e,t)=>{let r=e=>b.readWithCause({onInput:n=>{let[a,s]=((e,r)=>{let n;if(i.isEmpty(r))return[e,i.empty()];let a=[],s=0,u=0,o=i.empty();switch(e._tag){case"Some":{let l=e.value;n=l[0];let p=!0;for(;p&&u<r.length;){let e=t(i.unsafeGet(r,u));if(!C.equals(n,e)){let t=l[1],o=i.unsafeFromArray(Array.from(r).slice(s,u)),c=i.appendAll(t,o);a.push([n,c]),n=e,s=u,p=!1}u+=1}p&&(o=l[1]);break}case"None":n=t(i.unsafeGet(r,u)),u+=1}for(;u<r.length;){let e=t(i.unsafeGet(r,u));C.equals(n,e)||(a.push([n,i.unsafeFromArray(Array.from(r).slice(s,u))]),n=e,s=u),u+=1}let p=i.appendAll(o,i.unsafeFromArray(Array.from(r).slice(s,u))),c=i.unsafeFromArray(a);return[l.some([n,p]),c]})(e,n);return i.isEmpty(s)?r(a):b.flatMap(b.write(s),()=>r(a))},onFailure:t=>l.match(e,{onNone:()=>b.failCause(t),onSome:e=>b.flatMap(b.write(i.of(e)),()=>b.failCause(t))}),onDone:t=>l.match(e,{onNone:()=>b.succeedNow(t),onSome:e=>b.flatMap(b.write(i.of(e)),()=>b.succeedNow(t))})});return new iC(d.pipeToOrFail(rj(e),r(l.none())))}),r4=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,n9(t),i1)),r7=(0,u.dual)(3,(e,t,i)=>i_(e,B.collectAllN(t),A.spaced(i))),r3=(0,u.dual)(2,(e,t)=>{let i=e=>(0,u.pipe)(E.poll(e),n.map(l.match({onNone:()=>b.readWith({onInput:t=>b.flatMap(b.write(t),()=>i(e)),onFailure:b.fail,onDone:()=>b.void}),onSome:s.match({onFailure:b.failCause,onSuccess:()=>b.void})})),d.unwrap);return new iC(d.unwrapScopedWith(r=>t.pipe(n.forkIn(r),n.map(t=>rj(e).pipe(b.pipeTo(i(t)))))))}),r8=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,r3(g.sleep(t)))),r9=(0,u.dual)(2,(e,t)=>{let i=(0,u.pipe)(r.poll(t),n.map(l.match({onNone:()=>b.readWith({onInput:e=>(0,u.pipe)(b.write(e),b.flatMap(()=>i)),onFailure:b.fail,onDone:()=>b.void}),onSome:e=>d.unwrap(n.match(e,{onFailure:b.fail,onSuccess:()=>b.void}))})),d.unwrap);return new iC((0,u.pipe)(rj(e),b.pipeTo(i)))}),r6=()=>new iC(d.identityChannel()),r5=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,ne(t,rq(ns(!0,!1))))),ne=(0,u.dual)(3,(e,t,i)=>{let r=e=>b.readWithCause({onInput:t=>b.flatMap(b.fromEffect(tq(e,t4(t))),()=>r(e)),onFailure:t=>b.fromEffect(tq(e,t0(t))),onDone:()=>b.fromEffect(tq(e,tY))});return new iC(d.unwrapScopedWith(a=>(0,u.pipe)(tB(),n.zip(tB()),n.tap(([t])=>rj(e).pipe(d.concatMap(d.writeChunk),b.pipeTo(r(t)),m.runIn(a),n.forkIn(a))),n.tap(([e,i])=>rj(t).pipe(d.concatMap(d.writeChunk),b.pipeTo(r(i)),m.runIn(a),n.forkIn(a))),n.map(([e,t])=>{let r=(i,n)=>b.readWithCause({onInput:a=>a&&!i?(0,u.pipe)(b.fromEffect(tU(e)),b.flatMap(t2({onEnd:()=>n?b.void:r(!0,n),onFailure:b.failCause,onSuccess:e=>(0,u.pipe)(b.write(e),b.flatMap(()=>r(i,n)))}))):a||n?r(i,n):(0,u.pipe)(b.fromEffect(tU(t)),b.flatMap(t2({onEnd:()=>i?b.void:r(i,!0),onFailure:b.failCause,onSuccess:e=>(0,u.pipe)(b.write(e),b.flatMap(()=>r(i,n)))}))),onFailure:b.failCause,onDone:()=>b.void});return(0,u.pipe)(rj(i),d.concatMap(d.writeChunk),b.pipeTo(r(!1,!1)))}))))}),nt=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),d.pipeToOrFail(b.suspend(()=>{let e=r=>b.readWithCause({onInput:n=>{let a=[],s=r;for(let e of n)s?s=!1:a.push(t),a.push(e);return(0,u.pipe)(b.write(i.unsafeFromArray(a)),b.flatMap(()=>e(s)))},onFailure:b.failCause,onDone:()=>b.void});return e(!0)}))))),ni=(0,u.dual)(2,(e,{end:t,middle:i,start:r})=>(0,u.pipe)(ns(r),i8((0,u.pipe)(e,nt(i))),i8(ns(t)))),nr=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,nn(g.sleep(t)))),nn=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),d.interruptWhen(t)))),na=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),d.interruptWhenDeferred(t)))),ns=(...e)=>rK(e),nu=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),d.mapOut(i.map(t))))),nl=(0,u.dual)(3,(e,t,r)=>{let n=e=>b.readWith({onInput:t=>{let[a,s]=i.mapAccum(t,e,r);return b.flatMap(b.write(s),()=>n(a))},onFailure:b.fail,onDone:()=>b.void});return new iC((0,u.pipe)(rj(e),b.pipeTo(n(t))))}),no=(0,u.dual)(3,(e,t,r)=>aX(()=>{let a=e=>b.readWith({onInput:t=>(0,u.pipe)(n.suspend(()=>{let s=[];return(0,u.pipe)(t,n.reduce(e,(e,t)=>(0,u.pipe)(r(e,t),n.flatMap(([e,t])=>(0,u.pipe)(n.sync(()=>{s.push(t)}),n.as(e))))),n.match({onFailure:e=>0!==s.length?d.zipRight(b.write(i.unsafeFromArray(s)),b.fail(e)):b.fail(e),onSuccess:e=>b.flatMap(b.write(i.unsafeFromArray(s)),()=>a(e))}))}),d.unwrap),onFailure:b.fail,onDone:()=>b.void});return new iC((0,u.pipe)(rj(e),d.pipeToOrFail(a(t))))})),np=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,nw(t.onFailure),nu(t.onSuccess))),nc=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),d.mapOut(t)))),nh=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),d.mapOutEffect(t)))),nf=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,nd(e=>i.fromIterable(t(e))))),nd=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,nc(i.flatMap(t)))),nm=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,ng(t),nd(u.identity))),nb=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,ng(e=>(0,u.pipe)(t(e),n.map(i.fromIterable))),nd(u.identity))),ng=(0,u.dual)(2,(e,t)=>{let r=e=>{let a=e.next();if(a.done)return b.readWithCause({onInput:e=>r(e[Symbol.iterator]()),onFailure:b.failCause,onDone:b.succeed});{let s=a.value;return d.unwrap(n.map(t(s),t=>b.flatMap(b.write(i.of(t)),()=>r(e))))}};return new iC((0,u.pipe)(rj(e),b.pipeTo(b.suspend(()=>r(i.empty()[Symbol.iterator]())))))}),ny=(0,u.dual)(3,(e,t,r)=>new iC((0,u.pipe)(rj(e),d.concatMap(d.writeChunk),d.mapOutEffectPar(r,t),d.mapOut(i.of)))),nw=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),d.mapError(t)))),nS=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),d.mapErrorCause(t)))),nC=(0,u.dual)(e=>iE(e[1]),(e,t,i)=>n_(e,t,{onSelf:u.identity,onOther:u.identity,haltStrategy:i?.haltStrategy})),nE=(0,u.dual)(e=>Symbol.iterator in e[0],(e,t)=>rO(rK(e),t)),nv=(0,u.dual)(2,(e,t)=>nE(Object.keys(e).map(t=>e[t].pipe(nu(e=>({_tag:t,value:e})))),t)),nk=(0,u.dual)(2,(e,t)=>n_(e,t,{onSelf:S.left,onOther:S.right})),nx=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,nC(rl(t)))),nI=(0,u.dual)(2,(e,t)=>(0,u.pipe)(rl(e),nC(t))),n_=(0,u.dual)(3,(e,t,i)=>{let r=i.haltStrategy?tT.fromInput(i.haltStrategy):R.Both,a=e=>t=>e||!s.isSuccess(t)?I.Done(n.suspend(()=>t)):I.Await(e=>n.suspend(()=>e));return new iC(d.mergeWith(rj(nu(e,i.onSelf)),{other:rj(nu(t,i.onOther)),onSelfDone:a("Either"===r._tag||"Left"===r._tag),onOtherDone:a("Either"===r._tag||"Right"===r._tag)}))}),nF=rV(n.never),nM=(0,u.dual)(2,(e,t)=>i8(e,rl(rV(t)))),nA=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,i$(e=>rV((0,u.pipe)(t(e),n.zipRight(n.failCause(e))))))),nR=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),b.ensuringWith(e=>s.isSuccess(e)?t():n.void)))),nz=(0,u.dual)(2,(e,t)=>sC(n.as(t,e))),nT=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),d.orDieWith(t)))),nW=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),d.orElse(()=>rj(t()))))),nD=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,nu(S.left),nW(()=>(0,u.pipe)(t(),nu(S.right))))),nO=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,nW(()=>rv(t)))),nP=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,nL(()=>i.of(t())))),nL=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,nN(()=>new iC(b.write(t()))))),nN=(0,u.dual)(2,(e,t)=>{let r=b.readWith({onInput:e=>i.isEmpty(e)?b.suspend(()=>r):(0,u.pipe)(b.write(e),d.zipRight(d.identityChannel())),onFailure:b.fail,onDone:()=>b.suspend(()=>rj(t()))});return new iC((0,u.pipe)(rj(e),b.pipeTo(r)))}),nB=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,nW(()=>aJ(t)))),nq=(e,t)=>{let i=e=>{let r=t(e);return l.match(r[1],{onNone:()=>d.zipRight(b.write(r[0]),b.void),onSome:e=>b.flatMap(b.write(r[0]),()=>i(e))})};return new iC(b.suspend(()=>i(e)))},nU=(e,t)=>{let i=e=>d.unwrap(n.map(t(e),([e,t])=>l.match(t,{onNone:()=>d.zipRight(b.write(e),b.void),onSome:t=>b.flatMap(b.write(e),()=>i(t))})));return new iC(b.suspend(()=>i(e)))},nj=(e,t)=>nU(e,e=>(0,u.pipe)(t(e),n.map(([e,t])=>[i.of(e),t]))),nH=(0,u.dual)(2,(e,t)=>{let i="Emit",a="Halt";return(0,u.pipe)(r.make(),n.flatMap(s=>(0,u.pipe)(tB(),n.map(l=>{let o=B.foldSink(B.collectLeftover(t),{onFailure:e=>B.zipRight(B.fromEffect(r.fail(s,e)),B.fail(e)),onSuccess:([e,t])=>{let n=b.readWithCause({onInput:e=>b.flatMap(b.fromEffect(tq(l,{_tag:i,elements:e})),()=>n),onFailure:e=>d.zipRight(b.fromEffect(tq(l,{_tag:a,cause:e})),b.failCause(e)),onDone:e=>d.zipRight(b.fromEffect(tq(l,{_tag:"End"})),b.void)});return B.fromChannel((0,u.pipe)(b.fromEffect(r.succeed(s,e)),d.zipRight(b.fromEffect((0,u.pipe)(l,tq({_tag:i,elements:t})))),d.zipRight(n)))}}),p=(0,u.pipe)(tU(l),n.map(e=>{switch(e._tag){case i:return(0,u.pipe)(b.write(e.elements),b.flatMap(()=>p));case a:return b.failCause(e.cause);case"End":return b.void}}),d.unwrap);return(0,u.pipe)(e,a8(e=>r.failCause(s,e)),af(o),n.forkScoped,n.zipRight(r.await(s)),n.map(e=>[e,new iC(p)]))}))),n.flatten)}),nQ=(0,u.dual)(e=>"function"==typeof e[1],(e,t,i)=>nV(e,e=>n.succeed(t(e)?S.right(e):S.left(e)),i)),nV=(0,u.dual)(e=>"function"==typeof e[1],(e,t,i)=>(0,u.pipe)(ng(e,t),rr({size:2,maximumLag:i?.bufferSize??16,decide:S.match({onLeft:()=>n.succeed(e=>0===e),onRight:()=>n.succeed(e=>1===e)})}),n.flatMap(([e,t])=>n.succeed([r_(rN(rZ(e,{shutdown:!0})),e=>S.match(e,{onLeft:l.some,onRight:l.none})),r_(rN(rZ(t,{shutdown:!0})),e=>S.match(e,{onLeft:l.none,onRight:l.some}))])))),nG=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),d.pipeToOrFail(B.toChannel(t))))),n$=(0,u.dual)(2,(e,t)=>new iC(b.pipeTo(rj(e),t))),nK=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),d.pipeToOrFail(t)))),nJ=(0,u.dual)(2,(e,t)=>new iC(d.zipRight(b.write(t),rj(e)))),nX=(0,u.dual)(2,(e,t)=>new iC((0,u.pipe)(rj(e),b.provideContext(t)))),nZ=(0,u.dual)(2,(e,t)=>n4(e,y.merge(t))),nY=(0,u.dual)(2,(e,t)=>new iC(d.unwrapScopedWith(i=>x.buildWithScope(t,i).pipe(n.map(t=>(0,u.pipe)(rj(e),b.provideContext(t))))))),n0=(0,u.dual)(3,(e,t,i)=>n1(e,t,n.succeed(i))),n1=(0,u.dual)(3,(e,t,i)=>n2(e,t,rV(i))),n2=(0,u.dual)(3,(e,t,i)=>rS(r=>rT(i,i=>(0,u.pipe)(e,nX(y.add(r,t,i)))))),n4=(0,u.dual)(2,(e,t)=>rS(i=>(0,u.pipe)(e,nX(t(i))))),n7=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,nY((0,u.pipe)(x.context(),x.merge(t))))),n3=(0,u.dual)(2,(e,t)=>n8(e,t)),n8=(...e)=>r.make().pipe(n.map(t=>{let i=null;return nE(e.map((e,a)=>e.pipe(a2(()=>null===i?(i=a,r.unsafeDone(t,s.void),!0):i===a),nn(r.await(t).pipe(n.flatMap(()=>i===a?n.never:n.void))))),{concurrency:e.length})}),sC),n9=(0,u.dual)(2,(e,t)=>aX(()=>{let i=Math.max(t,1),r=n6(new n5(i),i);return new iC((0,u.pipe)(rj(e),b.pipeTo(r)))})),n6=(e,t)=>b.readWithCause({onInput:r=>{if(r.length===t&&e.isEmpty())return b.flatMap(b.write(r),()=>n6(e,t));if(r.length>0){let n,a=[],s=0;for(;s<r.length;){for(;s<r.length&&void 0===n;)n=e.write((0,u.pipe)(r,i.unsafeGet(s))),s+=1;void 0!==n&&(a.push(n),n=void 0)}return b.flatMap(d.writeAll(...a),()=>n6(e,t))}return b.suspend(()=>n6(e,t))},onFailure:t=>d.zipRight(e.emitIfNotEmpty(),b.failCause(t)),onDone:()=>e.emitIfNotEmpty()});class n5{n;builder=[];pos=0;constructor(e){this.n=e}isEmpty(){return 0===this.pos}write(e){if(this.builder.push(e),this.pos+=1,this.pos===this.n){let e=i.unsafeFromArray(this.builder);return this.builder=[],this.pos=0,e}}emitIfNotEmpty(){return 0!==this.pos?b.write(i.unsafeFromArray(this.builder)):b.void}}let ae=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,at(t,u.identity))),at=(0,u.dual)(3,(e,i,r)=>new iC(d.catchAll(rj(e),e=>l.match(i(e),{onNone:()=>b.failCause(t.die(r(e))),onSome:b.fail})))),ai=(0,u.dual)(2,(e,t)=>r_(aa(e,t),e=>S.match(e,{onLeft:l.none,onRight:l.some}))),ar=e=>sy(e,e=>(0,u.pipe)(n.map(e,t=>l.some([t,e])),n.catchAll(l.match({onNone:()=>n.succeed(l.none()),onSome:n.fail})))),an=e=>ar((0,u.pipe)(e,n.map(i.of))),aa=(0,u.dual)(2,(e,t)=>al(e,t,{onElement:e=>S.right(e),onSchedule:S.left})),as=(0,u.dual)(2,(e,t)=>r_(au(e,t,{onElement:e=>l.some(e),onSchedule:l.none}),u.identity)),au=(0,u.dual)(3,(e,t,r)=>{let a=(0,u.pipe)(A.driver(t),n.map(e=>{let t=e=>l.match(i.head(e),{onNone:()=>s,onSome:t=>d.zipRight(b.write(i.of(r.onElement(t))),a((0,u.pipe)(e,i.drop(1)),t))}),a=(s,l)=>{let o=(0,u.pipe)(e.next(l),n.as((0,u.pipe)(b.write(i.of(r.onElement(l))),b.flatMap(()=>a(s,l))))),p=(0,u.pipe)(e.last,n.orDie,n.flatMap(a=>(0,u.pipe)(e.reset,n.map(()=>(0,u.pipe)(b.write(i.of(r.onSchedule(a))),d.zipRight(t(s)))))));return(0,u.pipe)(o,n.orElse(()=>p),d.unwrap)},s=b.readWith({onInput:t,onFailure:b.fail,onDone:()=>b.void});return s}),d.unwrap);return new iC((0,u.pipe)(rj(e),b.pipeTo(a)))}),al=(0,u.dual)(3,(e,t,r)=>(0,u.pipe)(A.driver(t),n.map(t=>{let a=n1(A.CurrentIterationMetadata,h.get(t.iterationMeta)),s=(0,u.pipe)(e,a,nu(r.onElement),rj),l=d.unwrap(n.match(t.next(void 0),{onFailure:()=>b.void,onSuccess:e=>b.flatMap(s,()=>d.zipRight(b.write(i.of(r.onSchedule(e))),l))}));return new iC(d.zipRight(s,l))}),sC)),ao=(e,t)=>rT(rV(n.zip(e,A.driver(t))),([t,i])=>{let r=n.provideServiceEffect(A.CurrentIterationMetadata,h.get(i.iterationMeta));return i8(aK(t),sw(t,t=>n.matchEffect(i.next(t),{onFailure:n.succeed,onSuccess:()=>n.map(r(e),e=>l.some([e,e]))})))}),ap=(0,u.dual)(2,(e,t)=>A.driver(t).pipe(n.map(t=>{let i=rj(n1(A.CurrentIterationMetadata,h.get(t.iterationMeta))(e)).pipe(d.mapOutEffect(e=>n.as(t.reset,e)),d.catchAll(e=>t.next(e).pipe(n.match({onFailure:()=>b.fail(e),onSuccess:()=>i}),d.unwrap)));return i}),d.unwrap,rU)),ac=(0,u.dual)(e=>iE(e[0]),(e,t,i)=>aX(()=>{let r=i?.preventFallbackOnPartialStream??!1,n=0,a=l.none(),s=aX(()=>{let i=t.steps[n++];if(!i)return rE(l.getOrThrow(a));let u=y.isContext(i.provide)?nZ(e,i.provide):n7(e,i.provide),o=!1;if(l.isSome(a)){let e=a.value,t=!1,r=u;u=ah(ap(u=aX(()=>t?r:(t=!0,rE(e))),k.scheduleFromStep(i,!1)))}else{let e=k.scheduleFromStep(i,!0);u=e?ah(ap(u,e)):u}return iG(r?nc(u,e=>(o=!0,e)):u,e=>r&&o?rE(e):(a=l.some(e),s))});return s})),ah=e=>i$(e,e=>rk(t_.scheduleDefectRefailCause(e))),af=(0,u.dual)(2,(e,t)=>rj(e).pipe(d.pipeToOrFail(B.toChannel(t)),d.runDrain)),ad=e=>af(e,B.drain),am=(0,u.dual)(3,(e,t,i)=>aw(e,t,u.constTrue,i)),ab=(0,u.dual)(3,(e,t,i)=>aS(e,t,u.constTrue,i)),ag=(0,u.dual)(3,(e,t,i)=>(0,u.pipe)(e,aC(t,u.constTrue,i))),ay=(0,u.dual)(3,(e,t,i)=>(0,u.pipe)(e,aE(t,u.constTrue,i))),aw=(0,u.dual)(4,(e,t,i,r)=>af(e,B.fold(t,i,r))),aS=(0,u.dual)(4,(e,t,i,r)=>af(e,B.foldEffect(t,i,r))),aC=(0,u.dual)(4,(e,t,i,r)=>(0,u.pipe)(e,aW(B.fold(t,i,r)))),aE=(0,u.dual)(4,(e,t,i,r)=>(0,u.pipe)(e,aW(B.foldEffect(t,i,r)))),av=(0,u.dual)(2,(e,t)=>af(e,B.forEach(t))),ak=(0,u.dual)(2,(e,t)=>af(e,B.forEachChunk(t))),ax=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,aW(B.forEachChunk(t)))),aI=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,aW(B.forEach(t)))),a_=(0,u.dual)(2,(e,t)=>af(e,B.forEachWhile(t))),aF=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,aW(B.forEachWhile(t)))),aM=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,aR(t))),aA=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,aT(t))),aR=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,aT(t),n.scoped)),az=(0,u.dual)(2,(e,r)=>{let a=b.readWithCause({onInput:e=>b.flatMap(b.fromEffect(c.offerAll(r,i.map(e,s.succeed))),()=>a),onFailure:e=>b.fromEffect(c.offer(r,s.failCause(t.map(e,l.some)))),onDone:()=>b.fromEffect(c.offer(r,s.fail(l.none())))});return(0,u.pipe)(b.pipeTo(rj(e),a),d.drain,d.runScoped,n.asVoid)}),aT=(0,u.dual)(2,(e,t)=>{let i=b.readWithCause({onInput:e=>b.flatMap(b.write(tX(e)),()=>i),onFailure:e=>b.write(t0(e)),onDone:()=>b.write(tY)});return(0,u.pipe)(b.pipeTo(rj(e),i),d.mapOutEffect(e=>c.offer(t,e)),d.drain,d.runScoped,n.asVoid)}),aW=(0,u.dual)(2,(e,t)=>(0,u.pipe)(rj(e),d.pipeToOrFail(B.toChannel(t)),d.drain,d.runScoped)),aD=(0,u.dual)(3,(e,t,i)=>(0,u.pipe)(e,aB(t,(e,t)=>n.succeed(i(e,t))))),aO=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,aP((e,i)=>n.succeed(t(e,i))))),aP=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,no(l.none(),(e,i)=>{switch(e._tag){case"None":return n.succeed([l.some(i),i]);case"Some":return(0,u.pipe)(t(e.value,i),n.map(e=>[l.some(e),e]))}}))),aL=(0,u.dual)(2,(e,t)=>r_(aN(e,t,{onElement:l.some,onSchedule:l.none}),u.identity)),aN=(0,u.dual)(3,(e,t,r)=>{let a=(e,t)=>{let s=t.next();return s.done?b.readWithCause({onInput:t=>a(e,t[Symbol.iterator]()),onFailure:b.failCause,onDone:b.succeedNow}):d.unwrap(n.matchEffect(e.next(s.value),{onFailure:()=>(0,u.pipe)(e.last,n.orDie,n.map(n=>(0,u.pipe)(b.write(i.make(r.onElement(s.value),r.onSchedule(n))),b.flatMap(()=>a(e,t)))),n.zipLeft(e.reset)),onSuccess:()=>n.succeed((0,u.pipe)(b.write(i.of(r.onElement(s.value))),b.flatMap(()=>a(e,t))))}))};return new iC((0,u.pipe)(b.fromEffect(A.driver(t)),b.flatMap(t=>(0,u.pipe)(rj(e),b.pipeTo(a(t,i.empty()[Symbol.iterator]()))))))}),aB=(0,u.dual)(3,(e,t,r)=>new iC((0,u.pipe)(b.write(i.of(t)),b.flatMap(()=>rj((0,u.pipe)(e,no(t,(e,t)=>(0,u.pipe)(r(e,t),n.map(e=>[e,e]))))))))),aq=e=>new iC(d.ensuring(d.scoped((0,u.pipe)(e,n.map(i.of))),n.void)),aU=e=>new iC(d.scopedWith(t=>e(t).pipe(n.map(i.of)))),aj=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,nu(l.getOrElse(t)))),aH=(0,u.dual)(2,(e,t)=>ng(e,l.match({onNone:()=>n.failSync(t),onSome:n.succeed}))),aQ=(0,u.dual)(2,(e,t)=>aV(e,t,1)),aV=(0,u.dual)(3,(e,r,n)=>r<=0||n<=0?ri(new t.IllegalArgumentException("Invalid bounds - `chunkSize` and `stepSize` must be greater than zero")):new iC(b.suspend(()=>{let t=new tI(r),a=(e,a)=>{if(e<r){let e=t.toChunk(),r=i.isEmpty(e)?i.empty():i.of(e);return(0,u.pipe)(b.write(r),b.flatMap(()=>a))}let s=e-(e-r)%n;if(s===e)return a;let l=(0,u.pipe)(t.toChunk(),i.takeRight(e-(s-r+n))),o=i.isEmpty(l)?i.empty():i.of(l);return(0,u.pipe)(b.write(o),b.flatMap(()=>a))},s=e=>b.readWithCause({onInput:a=>b.flatMap(b.write(i.filterMap(a,(i,a)=>{t.put(i);let s=e+a+1;return s<r||(s-r)%n>0?l.none():l.some(t.toChunk())})),()=>s(e+a.length)),onFailure:t=>a(e,b.failCause(t)),onDone:()=>a(e,b.void)});return(0,u.pipe)(rj(e),b.pipeTo(s(0)))}))),aG=(0,u.dual)(2,(e,t)=>{let r=(e,a)=>{let[s,l]=(0,u.pipe)(e,i.appendAll(a),i.splitWhere(t));return i.isEmpty(s)||i.isEmpty(l)?n((0,u.pipe)(s,i.appendAll((0,u.pipe)(l,i.drop(1))))):(0,u.pipe)(b.write(i.of(s)),b.flatMap(()=>r(i.empty(),(0,u.pipe)(l,i.drop(1)))))},n=e=>b.readWith({onInput:t=>r(e,t),onFailure:b.fail,onDone:()=>i.isEmpty(e)?b.void:l.isNone((0,u.pipe)(e,i.findFirst(t)))?d.zipRight(b.write(i.of(e)),b.void):d.zipRight(r(i.empty(),e),b.void)});return new iC((0,u.pipe)(rj(e),b.pipeTo(n(i.empty()))))}),a$=(0,u.dual)(2,(e,t)=>{let r=(e,n)=>b.readWithCause({onInput:a=>{let s,[o,p]=(0,u.pipe)(a,i.reduce([(0,u.pipe)(e,l.getOrElse(()=>i.empty())),n],([e,r],n)=>{let a=(0,u.pipe)(e,i.append(n));return r<t.length&&C.equals(n,(0,u.pipe)(t,i.unsafeGet(r)))?r+1===t.length?(void 0===s&&(s=[]),s.push((0,u.pipe)(a,i.take(a.length-t.length))),[i.empty(),0]):[a,r+1]:[a,+!!C.equals(n,(0,u.pipe)(t,i.unsafeGet(0)))]})),c=void 0===s?i.empty():i.unsafeFromArray(s);return b.flatMap(b.write(c),()=>r(i.isNonEmpty(o)?l.some(o):l.none(),p))},onFailure:t=>l.match(e,{onNone:()=>b.failCause(t),onSome:e=>d.zipRight(b.write(i.of(e)),b.failCause(t))}),onDone:t=>l.match(e,{onNone:()=>b.succeed(t),onSome:e=>d.zipRight(b.write(i.of(e)),b.succeed(t))})});return new iC((0,u.pipe)(rj(e),b.pipeTo(r(l.none(),0))))}),aK=e=>rH(i.of(e)),aJ=e=>aX(()=>rH(i.of(e()))),aX=e=>new iC(b.suspend(()=>rj(e()))),aZ=(0,u.dual)(2,(e,r)=>{if(!Number.isInteger(r))return ri(new t.IllegalArgumentException(`${r} must be an integer`));let n=e=>b.readWith({onInput:t=>{let r=(0,u.pipe)(t,i.take(Math.min(e,1/0))),a=Math.max(0,e-r.length);return a>0?(0,u.pipe)(b.write(r),b.flatMap(()=>n(a))):b.write(r)},onFailure:b.fail,onDone:b.succeed});return new iC((0,u.pipe)(rj(e),d.pipeToOrFail(0<r?n(r):b.void)))}),aY=(0,u.dual)(2,(e,t)=>t<=0?rb:new iC((0,u.pipe)(n.succeed(new tI(t)),n.map(t=>{let i=b.readWith({onInput:e=>{for(let i of e)t.put(i);return i},onFailure:b.fail,onDone:()=>(0,u.pipe)(b.write(t.toChunk()),d.zipRight(b.void))});return(0,u.pipe)(rj(e),b.pipeTo(i))}),d.unwrap))),a0=(0,u.dual)(2,(e,t)=>{let r=b.readWith({onInput:e=>{let n=(0,u.pipe)(e,i.takeWhile(e=>!t(e))),a=(0,u.pipe)(e,i.drop(n.length),i.take(1));return i.isEmpty(a)?(0,u.pipe)(b.write(n),b.flatMap(()=>r)):b.write((0,u.pipe)(n,i.appendAll(a)))},onFailure:b.fail,onDone:b.succeed});return new iC((0,u.pipe)(rj(e),d.pipeToOrFail(r)))}),a1=(0,u.dual)(2,(e,t)=>{let r=e=>{let a=e.next();return a.done?b.readWithCause({onInput:e=>r(e[Symbol.iterator]()),onFailure:b.failCause,onDone:b.succeed}):(0,u.pipe)(t(a.value),n.map(t=>t?b.write(i.of(a.value)):(0,u.pipe)(b.write(i.of(a.value)),b.flatMap(()=>r(e)))),d.unwrap)};return new iC((0,u.pipe)(rj(e),b.pipeTo(r(i.empty()[Symbol.iterator]()))))}),a2=(0,u.dual)(2,(e,t)=>{let r=b.readWith({onInput:e=>{let n=(0,u.pipe)(e,i.takeWhile(t));return n.length===e.length?(0,u.pipe)(b.write(n),b.flatMap(()=>r)):b.write(n)},onFailure:b.fail,onDone:b.succeed});return new iC((0,u.pipe)(rj(e),d.pipeToOrFail(r)))}),a4=(0,u.dual)(2,(e,t)=>ng(e,e=>n.as(t(e),e))),a7=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,a3(t.onFailure),a4(t.onSuccess))),a3=(0,u.dual)(2,(e,t)=>iG(e,e=>rV(n.zipRight(t(e),n.fail(e))))),a8=(0,u.dual)(2,(e,t)=>{let i=b.readWithCause({onInput:e=>b.flatMap(b.write(e),()=>i),onFailure:e=>b.fromEffect(n.zipRight(t(e),n.failCause(e))),onDone:b.succeedNow});return new iC((0,u.pipe)(rj(e),b.pipeTo(i)))}),a9=(0,u.dual)(2,(e,t)=>(0,u.pipe)(rV(n.all([c.bounded(1),r.make()])),rT(([i,a])=>{let s=rB(rZ(i,{maxChunkSize:1})),l=b.readWithCause({onInput:e=>(0,u.pipe)(b.fromEffect(c.offer(i,tX(e))),b.foldCauseChannel({onFailure:()=>b.flatMap(b.write(e),()=>d.identityChannel()),onSuccess:()=>b.flatMap(b.write(e),()=>l)})),onFailure:e=>(0,u.pipe)(b.fromEffect(c.offer(i,t0(e))),b.foldCauseChannel({onFailure:()=>b.failCause(e),onSuccess:()=>b.failCause(e)})),onDone:()=>(0,u.pipe)(b.fromEffect(c.offer(i,tY)),b.foldCauseChannel({onFailure:()=>b.void,onSuccess:()=>b.void}))});return(0,u.pipe)(new iC((0,u.pipe)(b.pipeTo(rj(e),l),d.ensuring(n.zipRight(n.forkDaemon(c.offer(i,tY)),r.await(a))))),nC(rC((0,u.pipe)(af(s,t),n.ensuring(n.zipRight(c.shutdown(i),r.succeed(a,void 0)))))))}))),a6=(0,u.dual)(2,(e,t)=>a5(e,{...t,cost:e=>n.succeed(t.cost(e))})),a5=(0,u.dual)(2,(e,t)=>"enforce"===t.strategy?se(e,t.cost,t.units,t.duration,t.burst??0):st(e,t.cost,t.units,t.duration,t.burst??0)),se=(e,t,i,r,a)=>{let s=(e,l)=>b.readWithCause({onInput:o=>(0,u.pipe)(t(o),n.zip(g.currentTimeMillis),n.map(([t,n])=>{let p=e+(n-l)/w.toMillis(r)*i,c=i+a<0?1/0:i+a,h=p<0?c:Math.min(p,c);return t<=h?(0,u.pipe)(b.write(o),b.flatMap(()=>s(h-t,n))):s(e,l)}),d.unwrap),onFailure:b.failCause,onDone:()=>b.void}),l=(0,u.pipe)(g.currentTimeMillis,n.map(e=>s(i,e)),d.unwrap);return new iC((0,u.pipe)(rj(e),d.pipeToOrFail(l)))},st=(e,t,i,r,a)=>{let s=(e,l)=>b.readWithCause({onInput:o=>(0,u.pipe)(t(o),n.zip(g.currentTimeMillis),n.map(([t,n])=>{let p=e+(n-l)/w.toMillis(r)*i,c=i+a<0?1/0:i+a,h=(p<0?c:Math.min(p,c))-t,f=h>=0?0:-h/i,m=w.millis(Math.max(0,f*w.toMillis(r)));return w.greaterThan(m,w.zero)?(0,u.pipe)(b.fromEffect(g.sleep(m)),d.zipRight(b.write(o)),b.flatMap(()=>s(h,n))):b.flatMap(b.write(o),()=>s(h,n))}),d.unwrap),onFailure:b.failCause,onDone:()=>b.void}),l=(0,u.pipe)(g.currentTimeMillis,n.map(e=>s(i,e)),d.unwrap);return new iC((0,u.pipe)(rj(e),d.pipeToOrFail(l)))},si=(0,u.dual)(2,(e,t)=>(0,u.pipe)(sl(e),n.map(n.timeoutFail({onTimeout:()=>l.none(),duration:t})),rX)),sr=(0,u.dual)(3,(e,t,i)=>(0,u.pipe)(e,sa(i,rv(t)))),sn=(0,u.dual)(3,(e,i,r)=>(0,u.pipe)(sl(e),n.map(n.timeoutFailCause({onTimeout:()=>t.map(i(),l.some),duration:r})),rX)),sa=(0,u.dual)(3,(e,i,r)=>{let n=new t.RuntimeException("Stream Timeout");return(0,u.pipe)(e,sn(()=>t.die(n),i),iJ(e=>t.isDieType(e)&&t.isRuntimeException(e.defect)&&void 0!==e.defect.message&&"Stream Timeout"===e.defect.message?l.some(r):l.none()))}),ss=e=>{if("number"==typeof e)return _.bounded(e);if("unbounded"===e.capacity)return _.unbounded({replay:e.replay});switch(e.strategy){case"dropping":return _.dropping(e);case"sliding":return _.sliding(e);default:return _.bounded(e)}},su=(0,u.dual)(2,(e,t)=>(0,u.pipe)(n.acquireRelease(ss(t),e=>_.shutdown(e)),n.tap(t=>(0,u.pipe)(e,aA(t),n.forkScoped)))),sl=e=>n.map(d.toPull(rj(e)),e=>(0,u.pipe)(e,n.mapError(l.some),n.flatMap(S.match({onLeft:()=>n.fail(l.none()),onRight:n.succeed})))),so=(0,u.dual)(e=>iE(e[0]),(e,t)=>n.tap(n.acquireRelease(t?.strategy==="unbounded"?c.unbounded():t?.strategy==="dropping"?c.dropping(t.capacity??2):t?.strategy==="sliding"?c.sliding(t.capacity??2):c.bounded(t?.capacity??2),e=>c.shutdown(e)),t=>n.forkScoped(aT(e,t)))),sp=(0,u.dual)(e=>iE(e[0]),(e,t)=>n.tap(n.acquireRelease(c.bounded(t?.capacity??2),e=>c.shutdown(e)),t=>n.forkScoped(az(e,t)))),sc=(0,u.dual)(e=>iE(e[0]),(e,t)=>sf(e,M.defaultRuntime,t)),sh=(0,u.dual)(e=>iE(e[0]),(e,t)=>n.map(n.runtime(),i=>sf(e,i,t))),sf=(0,u.dual)(e=>iE(e[0]),(e,i,r)=>{let a,s,u=M.runFork(i),l=n.unsafeMakeLatch(!1);return new ReadableStream({start(i){(s=u(ak(e,e=>0===e.length?n.void:l.whenOpen(n.sync(()=>{for(let t of(l.unsafeClose(),e))i.enqueue(t);a(),a=void 0}))))).addObserver(e=>{try{"Failure"===e._tag?i.error(t.squash(e.cause)):i.close()}catch{}})},pull:()=>new Promise(e=>{a=e,n.runSync(l.open)}),cancel(){if(s)return n.runPromise(n.asVoid(E.interrupt(s)))}},r?.strategy)}),sd=(0,u.dual)(2,(e,t)=>new iC(b.suspend(()=>{let r={ref:i.empty()},n={ref:!1},a=b.suspend(()=>{let e=r.ref;return i.isEmpty(e)?b.readWith({onInput:e=>(0,u.pipe)(b.write(e),b.flatMap(()=>a)),onFailure:b.fail,onDone:b.succeedNow}):(r.ref=i.empty(),(0,u.pipe)(d.writeChunk(e),b.flatMap(()=>a)))}),s=b.readWith({onInput:e=>b.flatMap(b.write(e),()=>s),onFailure:b.fail,onDone:e=>d.zipRight(b.sync(()=>{n.ref=!0}),b.succeedNow(e))}),l=(0,u.pipe)(t,B.toChannel,b.collectElements,b.flatMap(([e,t])=>{let a,s;return(0,u.pipe)(b.succeed([n.ref,(a=r.ref,r.ref=s=i.appendAll(a,i.filter(e,e=>0!==e.length)),s)]),b.flatMap(([e,r])=>{let n=e&&i.isEmpty(r)?b.void:l;return(0,u.pipe)(b.write(i.of(t)),b.flatMap(()=>n))}))}));return(0,u.pipe)(rj(e),b.pipeTo(s),b.pipeTo(a),d.pipeToOrFail(l))}))),sm=(0,u.dual)(e=>iE(e[0]),(e,i)=>{let r=M.runFork(i);return{[Symbol.asyncIterator](){let i,a,s,u=n.unsafeMakeLatch(!1),l=!1;return{next:()=>(s||(s=r(av(e,e=>u.whenOpen(n.sync(()=>{u.unsafeClose(),i({done:!1,value:e}),i=a=void 0}))))).addObserver(e=>{l||(s=n.runFork(u.whenOpen(n.sync(()=>{"Failure"===e._tag?a(t.squash(e.cause)):i({done:!0,value:void 0}),i=a=void 0}))))}),new Promise((e,t)=>{i=e,a=t,u.unsafeOpen()})),return:()=>(l=!0,s)?n.runPromise(n.as(E.interrupt(s),{done:!0,value:void 0})):Promise.resolve({done:!0,value:void 0})}}}}),sb=(e,t)=>sg(e,e=>(0,u.pipe)(t(e),l.map(([e,t])=>[i.of(e),t]))),sg=(e,t)=>{let i=e=>l.match(t(e),{onNone:()=>b.void,onSome:([e,t])=>b.flatMap(b.write(e),()=>i(t))});return new iC(b.suspend(()=>i(e)))},sy=(e,t)=>aX(()=>{let i=e=>d.unwrap(n.map(t(e),l.match({onNone:()=>b.void,onSome:([e,t])=>b.flatMap(b.write(e),()=>i(t))})));return new iC(i(e))}),sw=(e,t)=>sy(e,e=>(0,u.pipe)(t(e),n.map(l.map(([e,t])=>[i.of(e),t])))),sS=aK(void 0),sC=e=>rO(rV(e)),sE=e=>rO(aq(e)),sv=e=>rO(aU(t=>e(t))),sk=(0,u.dual)(3,(e,t,i)=>(0,u.pipe)(e,n4(e=>(0,u.pipe)(e,y.add(t,i((0,u.pipe)(e,y.unsafeGet(t)))))))),sx=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,s_(n.sync(t)))),sI=(0,u.dual)(2,(e,t)=>(0,u.pipe)(rV(e),rT(e=>(0,u.pipe)(t(e),l.getOrElse(()=>rb))))),s_=(0,u.dual)(2,(e,t)=>(0,u.pipe)(rV(t),rT(t=>t?e:rb))),sF=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,sj(t,(e,t)=>[e,t]))),sM=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,sj(t,(e,t)=>[...e,t]))),sA=(0,u.dual)(2,(e,t)=>sP(e,{other:t.other,onSelf:e=>[e,t.defaultOther],onOther:e=>[t.defaultSelf,e],onBoth:(e,t)=>[e,t]})),sR=(0,u.dual)(3,(e,t,i)=>sP(e,{other:t,onSelf:u.identity,onOther:()=>i,onBoth:e=>e})),sz=(0,u.dual)(3,(e,t,i)=>sP(e,{other:t,onSelf:()=>i,onOther:u.identity,onBoth:(e,t)=>t})),sT=(0,u.dual)(2,(e,t)=>sO(e,{other:t.other,onSelf:e=>[e,t.defaultOther],onOther:e=>[t.defaultSelf,e],onBoth:(e,t)=>[e,t],order:t.order})),sW=(0,u.dual)(2,(e,t)=>sO(e,{other:t.other,onSelf:u.identity,onOther:()=>t.defaultSelf,onBoth:e=>e,order:t.order})),sD=(0,u.dual)(2,(e,t)=>sO(e,{other:t.other,onSelf:()=>t.defaultOther,onOther:u.identity,onBoth:(e,t)=>t,order:t.order})),sO=(0,u.dual)(2,(e,t)=>{let r=(e,o,p)=>{switch(e._tag){case ie:return(0,u.pipe)(o,n.match({onFailure:s.fail,onSuccess:e=>s.succeed([i.map(e,([e,i])=>[e,t.onSelf(i)]),is])}));case it:return(0,u.pipe)(p,n.match({onFailure:s.fail,onSuccess:e=>s.succeed([i.map(e,([e,i])=>[e,t.onOther(i)]),iu])}));case ii:return(0,u.pipe)(i4(o),n.zip(i4(p),{concurrent:!0}),n.matchEffect({onFailure:e=>n.succeed(s.fail(l.some(e))),onSuccess:([e,c])=>l.isSome(e)&&l.isSome(c)?i.isEmpty(e.value)&&i.isEmpty(c.value)?r(il,o,p):i.isEmpty(e.value)?r(io(c.value),o,p):i.isEmpty(c.value)?r(ip(e.value),o,p):n.succeed(s.succeed(a(e.value,c.value))):l.isSome(e)&&l.isNone(c)?i.isEmpty(e.value)?r(is,o,p):n.succeed(s.succeed([(0,u.pipe)(e.value,i.map(([e,i])=>[e,t.onSelf(i)])),is])):l.isNone(e)&&l.isSome(c)?i.isEmpty(c.value)?r(iu,o,p):n.succeed(s.succeed([(0,u.pipe)(c.value,i.map(([e,i])=>[e,t.onOther(i)])),iu])):n.succeed(s.fail(l.none()))}));case ir:return n.matchEffect(o,{onFailure:l.match({onNone:()=>n.succeed(s.succeed([(0,u.pipe)(e.rightChunk,i.map(([e,i])=>[e,t.onOther(i)])),iu])),onSome:e=>n.succeed(s.fail(l.some(e)))}),onSuccess:t=>i.isEmpty(t)?r(io(e.rightChunk),o,p):n.succeed(s.succeed(a(t,e.rightChunk)))});case ia:return n.matchEffect(p,{onFailure:l.match({onNone:()=>n.succeed(s.succeed([i.map(e.leftChunk,([e,i])=>[e,t.onSelf(i)]),is])),onSome:e=>n.succeed(s.fail(l.some(e)))}),onSuccess:t=>i.isEmpty(t)?r(ip(e.leftChunk),o,p):n.succeed(s.succeed(a(e.leftChunk,t)))})}},a=(e,r)=>{let n,a=(e,t)=>t<e.length-1,s=[],l=0,o=0,p=(0,u.pipe)(e,i.unsafeGet(l)),c=(0,u.pipe)(r,i.unsafeGet(o)),h=p[0],f=p[1],d=c[0],m=c[1],b=!0;for(;b;){let g=t.order(h,d);if(0===g)s.push([h,t.onBoth(f,m)]),a(e,l)&&a(r,o)?(l+=1,o+=1,p=(0,u.pipe)(e,i.unsafeGet(l)),c=(0,u.pipe)(r,i.unsafeGet(o)),h=p[0],f=p[1],d=c[0],m=c[1]):(n=a(e,l)?ip((0,u.pipe)(e,i.drop(l+1))):a(r,o)?io((0,u.pipe)(r,i.drop(o+1))):il,b=!1);else if(g<0)if(s.push([h,t.onSelf(f)]),a(e,l))l+=1,h=(p=(0,u.pipe)(e,i.unsafeGet(l)))[0],f=p[1];else{let e=[];for(e.push(c);a(r,o);)o+=1,c=(0,u.pipe)(r,i.unsafeGet(o)),e.push(c);n=io(i.unsafeFromArray(e)),b=!1}else if(s.push([d,t.onOther(m)]),a(r,o))o+=1,d=(c=(0,u.pipe)(r,i.unsafeGet(o)))[0],m=c[1];else{let t=[];for(t.push(p);a(e,l);)l+=1,p=(0,u.pipe)(e,i.unsafeGet(l)),t.push(p);n=ip(i.unsafeFromArray(t)),b=!1}}return[i.unsafeFromArray(s),n]};return i3(e,t.other,il,r)}),sP=(0,u.dual)(2,(e,t)=>{let r=(e,o,p)=>{switch(e._tag){case ie:return n.matchEffect(o,{onFailure:e=>n.succeed(s.fail(e)),onSuccess:e=>n.succeed(s.succeed([i.map(e,t.onSelf),is]))});case it:return n.matchEffect(p,{onFailure:e=>n.succeed(s.fail(e)),onSuccess:e=>n.succeed(s.succeed([i.map(e,t.onOther),iu]))});case ii:return(0,u.pipe)(i4(o),n.zip(i4(p),{concurrent:!0}),n.matchEffect({onFailure:e=>n.succeed(s.fail(l.some(e))),onSuccess:([e,u])=>l.isSome(e)&&l.isSome(u)?i.isEmpty(e.value)&&i.isEmpty(u.value)?r(il,o,p):i.isEmpty(e.value)?r(io(u.value),o,p):i.isEmpty(u.value)?r(ip(e.value),o,p):n.succeed(s.succeed(a(e.value,u.value,t.onBoth))):l.isSome(e)&&l.isNone(u)?n.succeed(s.succeed([i.map(e.value,t.onSelf),is])):l.isNone(e)&&l.isSome(u)?n.succeed(s.succeed([i.map(u.value,t.onOther),iu])):n.succeed(s.fail(l.none()))}));case ir:return n.matchEffect(o,{onFailure:l.match({onNone:()=>n.succeed(s.succeed([i.map(e.rightChunk,t.onOther),iu])),onSome:e=>n.succeed(s.fail(l.some(e)))}),onSuccess:u=>i.isEmpty(u)?r(io(e.rightChunk),o,p):i.isEmpty(e.rightChunk)?r(ip(u),o,p):n.succeed(s.succeed(a(u,e.rightChunk,t.onBoth)))});case ia:return n.matchEffect(p,{onFailure:l.match({onNone:()=>n.succeed(s.succeed([i.map(e.leftChunk,t.onSelf),is])),onSome:e=>n.succeed(s.fail(l.some(e)))}),onSuccess:u=>i.isEmpty(u)?r(ip(e.leftChunk),o,p):i.isEmpty(e.leftChunk)?r(io(u),o,p):n.succeed(s.succeed(a(e.leftChunk,u,t.onBoth)))})}},a=(e,t,r)=>{let[n,a]=sG(e,t,r);switch(a._tag){case"Left":if(i.isEmpty(a.left))return[n,il];return[n,ip(a.left)];case"Right":if(i.isEmpty(a.right))return[n,il];return[n,io(a.right)]}};return i3(e,t.other,il,r)}),sL=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,sB(t,(e,t)=>[e,t]))),sN=(...e)=>{if(0===e.length)return rb;if(1===e.length)return nu(e[0],e=>[e]);let[t,...i]=e;return sB(t,sN(...i),(e,t)=>[e,...t])},sB=(0,u.dual)(3,(e,t,r)=>{let a=e=>(0,u.pipe)(e,n.flatMap(t=>i.isEmpty(t)?a(e):n.succeed(t)));return(0,u.pipe)(sl(e),n.map(a),n.zip((0,u.pipe)(sl(t),n.map(a))),n.flatMap(([e,t])=>(0,u.pipe)(rG(n.raceWith(e,t,{onSelfDone:(e,t)=>(0,u.pipe)(n.suspend(()=>e),n.zipWith(E.join(t),(e,t)=>[e,t,!0])),onOtherDone:(e,t)=>(0,u.pipe)(n.suspend(()=>e),n.zipWith(E.join(t),(e,t)=>[t,e,!1]))})),rT(([n,a,s])=>(0,u.pipe)(rV(h.make([i.unsafeLast(n),i.unsafeLast(a)])),rT(l=>(0,u.pipe)(rH(s?(0,u.pipe)(a,i.map(e=>r(i.unsafeLast(n),e))):(0,u.pipe)(n,i.map(e=>r(e,i.unsafeLast(a))))),i8((0,u.pipe)(an(e),nk(an(t)),ng(S.match({onLeft:e=>h.modify(l,([t,n])=>[(0,u.pipe)(e,i.map(e=>r(e,n))),[i.unsafeLast(e),n]]),onRight:e=>h.modify(l,([t,n])=>[(0,u.pipe)(e,i.map(e=>r(t,e))),[t,i.unsafeLast(e)]])})),rT(rH))))))),sl)),rX)}),sq=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,sH(t,(e,t)=>e.length>t.length?[(0,u.pipe)(e,i.take(t.length)),S.left((0,u.pipe)(e,i.take(t.length)))]:[e,S.right((0,u.pipe)(t,i.drop(e.length)))]))),sU=(0,u.dual)(2,(e,t)=>(0,u.pipe)(e,sH(t,(e,t)=>e.length>t.length?[t,S.left((0,u.pipe)(e,i.take(t.length)))]:[(0,u.pipe)(t,i.take(e.length)),S.right((0,u.pipe)(t,i.drop(e.length)))]))),sj=(0,u.dual)(3,(e,t,i)=>(0,u.pipe)(e,sH(t,(e,t)=>sG(e,t,i)))),sH=(0,u.dual)(3,(e,t,r)=>{let a=(e,t,r)=>{switch(e._tag){case ic:return(0,u.pipe)(i4(t),n.zip(i4(r),{concurrent:!0}),n.matchEffect({onFailure:e=>n.succeed(s.fail(l.some(e))),onSuccess:([e,u])=>l.isSome(e)&&l.isSome(u)?i.isEmpty(e.value)&&i.isEmpty(u.value)?a(im,t,r):i.isEmpty(e.value)?a(ib(u.value),t,r):i.isEmpty(u.value)?a(ig(e.value),t,r):n.succeed(s.succeed(o(e.value,u.value))):n.succeed(s.fail(l.none()))}));case ih:return n.matchEffect(t,{onFailure:e=>n.succeed(s.fail(e)),onSuccess:u=>i.isEmpty(u)?a(ib(e.rightChunk),t,r):i.isEmpty(e.rightChunk)?a(ig(u),t,r):n.succeed(s.succeed(o(u,e.rightChunk)))});case id:return n.matchEffect(r,{onFailure:e=>n.succeed(s.fail(e)),onSuccess:u=>i.isEmpty(u)?a(ig(e.leftChunk),t,r):i.isEmpty(e.leftChunk)?a(ib(u),t,r):n.succeed(s.succeed(o(e.leftChunk,u)))})}},o=(e,t)=>{let[n,a]=r(e,t);switch(a._tag){case"Left":if(i.isEmpty(a.left))return[n,im];return[n,ig(a.left)];case"Right":if(i.isEmpty(a.right))return[n,im];return[n,ib(a.right)]}};return(0,u.pipe)(e,i3(t,im,a))}),sQ=e=>{let t=e=>b.readWithCause({onInput:r=>{let[n,a]=i.mapAccum(r,e,(e,t)=>[l.some(t),(0,u.pipe)(e,l.map(e=>[e,t]))]),s=i.filterMap(a,e=>l.isSome(e)?l.some([e.value[0],l.some(e.value[1])]):l.none());return b.flatMap(b.write(s),()=>t(n))},onFailure:b.failCause,onDone:()=>l.match(e,{onNone:()=>b.void,onSome:e=>d.zipRight(b.write(i.of([e,l.none()])),b.void)})});return new iC((0,u.pipe)(rj(e),d.pipeToOrFail(t(l.none()))))},sV=e=>(0,u.pipe)(e,nl(l.none(),(e,t)=>[l.some(t),[e,t]])),sG=(e,t,r)=>e.length>t.length?[(0,u.pipe)(e,i.take(t.length),i.zipWith(t,r)),S.left((0,u.pipe)(e,i.drop(t.length)))]:[(0,u.pipe)(e,i.zipWith((0,u.pipe)(t,i.take(e.length)),r)),S.right((0,u.pipe)(t,i.drop(e.length)))],s$=aK({}),sK=(0,u.dual)(e=>"string"!=typeof e[0],(e,t,i,r)=>rT(e,e=>nu(i(e),i=>({...e,[t]:i})),r)),sJ=tx.bindTo(nu),sX=tx.let_(nu),sZ=(0,u.dual)(e=>iE(e[0]),(e,t="utf-8")=>aX(()=>{let i=new TextDecoder(t);return nu(e,e=>i.decode(e))})),sY=e=>aX(()=>{let t=new TextEncoder;return nu(e,e=>t.encode(e))});e.s(["DefaultChunkSize",0,iv,"Do",0,s$,"StreamTypeId",0,iw,"_async",0,iR,"accumulate",0,e=>i1(ik(e)),"accumulateChunks",0,ik,"acquireRelease",0,ix,"aggregate",0,iI,"aggregateWithin",0,i_,"aggregateWithinEither",0,iF,"as",0,iM,"asyncEffect",0,(e,i)=>(0,u.pipe)(n.acquireRelease(iA(i),e=>c.shutdown(e)),n.flatMap(i=>(0,u.pipe)(n.runtime(),n.flatMap(r=>(0,u.pipe)(e(tz(e=>(0,u.pipe)(t1(e),n.flatMap(e=>c.offer(i,e)),n.asVoid,M.runPromiseExit(r)).then(e=>{if(s.isFailure(e)&&!t.isInterrupted(e.cause))throw t.squash(e.cause)}))),n.map(()=>{let e=(0,u.pipe)(c.take(i),n.flatMap(tZ),n.match({onFailure:e=>(0,u.pipe)(b.fromEffect(c.shutdown(i)),d.zipRight(l.match(e,{onNone:()=>b.void,onSome:b.fail}))),onSuccess:t=>(0,u.pipe)(b.write(t),b.flatMap(()=>e))}),d.unwrap);return e}))))),d.unwrapScoped,rU),"asyncPush",0,iz,"asyncScoped",0,(e,i)=>(0,u.pipe)(n.acquireRelease(iA(i),e=>c.shutdown(e)),n.flatMap(i=>(0,u.pipe)(n.runtime(),n.flatMap(r=>(0,u.pipe)(e(tz(e=>(0,u.pipe)(t1(e),n.flatMap(e=>c.offer(i,e)),n.asVoid,M.runPromiseExit(r)).then(e=>{if(s.isFailure(e)&&!t.isInterrupted(e.cause))throw t.squash(e.cause)}))),n.zipRight(h.make(!1)),n.flatMap(e=>(0,u.pipe)(h.get(e),n.map(t=>t?t7():(0,u.pipe)(c.take(i),n.flatMap(tZ),n.onError(()=>(0,u.pipe)(h.set(e,!0),n.zipRight(c.shutdown(i)))))))))))),aq,rT(ar)),"bind",0,sK,"bindTo",0,sJ,"branchAfter",0,iT,"broadcast",0,iW,"broadcastDynamic",0,iD,"broadcastedQueues",0,iP,"broadcastedQueuesDynamic",0,iL,"buffer",0,iN,"bufferChunks",0,iB,"catchAll",0,iG,"catchAllCause",0,i$,"catchSome",0,iK,"catchSomeCause",0,iJ,"catchTag",0,iX,"catchTags",0,iZ,"changes",0,e=>(0,u.pipe)(e,iY((e,t)=>C.equals(t)(e))),"changesWith",0,iY,"changesWithEffect",0,i0,"channelToStream",0,e=>new iC(e),"chunks",0,i1,"chunksWith",0,i2,"combine",0,i7,"combineChunks",0,i3,"concat",0,i8,"concatAll",0,e=>aX(()=>(0,u.pipe)(e,i.reduce(rb,(e,t)=>i8(t)(e)))),"context",0,rw,"contextWith",0,e=>(0,u.pipe)(rw(),nu(e)),"contextWithEffect",0,e=>(0,u.pipe)(rw(),ng(e)),"contextWithStream",0,rS,"cross",0,i9,"crossLeft",0,i6,"crossRight",0,i5,"crossWith",0,re,"debounce",0,rt,"decodeText",0,sZ,"die",0,ri,"dieMessage",0,e=>rV(n.dieMessage(e)),"dieSync",0,e=>rV(n.dieSync(e)),"distributedWith",0,rr,"distributedWithDynamic",0,rs,"distributedWithDynamicCallback",0,ru,"drain",0,rl,"drainFork",0,ro,"drop",0,rp,"dropRight",0,rc,"dropUntil",0,rh,"dropUntilEffect",0,rf,"dropWhile",0,rd,"dropWhileEffect",0,rm,"either",0,e=>(0,u.pipe)(e,nu(S.right),iG(e=>ns(S.left(e)))),"empty",0,rb,"encodeText",0,sY,"ensuring",0,rg,"ensuringWith",0,ry,"execute",0,rC,"fail",0,rE,"failCause",0,rk,"failCauseSync",0,e=>rV(n.failCauseSync(e)),"failSync",0,rv,"filter",0,rx,"filterEffect",0,rI,"filterMap",0,r_,"filterMapEffect",0,rF,"filterMapWhile",0,rM,"filterMapWhileEffect",0,rA,"finalizer",0,e=>ix(n.void,()=>e),"find",0,rR,"findEffect",0,rz,"flatMap",0,rT,"flatten",0,rO,"flattenChunks",0,rP,"flattenEffect",0,rL,"flattenExitOption",0,rN,"flattenIterables",0,e=>(0,u.pipe)(e,nu(i.fromIterable),rP),"flattenTake",0,rB,"forever",0,rq,"fromAsyncIterable",0,(e,t)=>(0,u.pipe)(n.acquireRelease(n.sync(()=>e[Symbol.asyncIterator]()),e=>e.return?n.promise(async()=>e.return()):n.void),n.map(e=>an((0,u.pipe)(n.tryPromise({try:async()=>e.next(),catch:e=>l.some(t(e))}),n.flatMap(e=>e.done?n.fail(l.none()):n.succeed(e.value))))),sE),"fromChannel",0,rU,"fromChunk",0,rH,"fromChunkPubSub",0,(e,t)=>{if(t?.scoped){let i=n.map(_.subscribe(e),rQ);return t.shutdown?n.map(i,rg(_.shutdown(e))):i}let i=rT(aq(_.subscribe(e)),rQ);return t?.shutdown?rg(i,_.shutdown(e)):i},"fromChunkQueue",0,rQ,"fromChunks",0,(...e)=>(0,u.pipe)(rK(e),rT(rH)),"fromEffect",0,rV,"fromEffectOption",0,rG,"fromEventListener",0,(e,t,i)=>iz(r=>n.acquireRelease(n.sync(()=>e.addEventListener(t,r.single,i)),()=>n.sync(()=>e.removeEventListener(t,r.single,i))),{bufferSize:"object"==typeof i?i.bufferSize:void 0}),"fromIterable",0,rK,"fromIterableEffect",0,e=>(0,u.pipe)(e,n.map(rK),sC),"fromIteratorSucceed",0,rJ,"fromPubSub",0,r$,"fromPull",0,rX,"fromQueue",0,rZ,"fromReadableStream",0,r0,"fromReadableStreamByob",0,(...e)=>{let t=1===e.length?e[0].evaluate:e[0],i=1===e.length?e[0].onError:e[1],r=(1===e.length?e[0].bufferSize:e[2])??4096,a=1===e.length&&!0===e[0].releaseLockOnEnd;return sE(n.map(n.acquireRelease(n.sync(()=>t().getReader({mode:"byob"})),e=>a?n.sync(()=>e.releaseLock()):n.promise(()=>e.cancel())),e=>{var t,a;let s;return iG(rq((t=e,a=i,s=new ArrayBuffer(r),nj(0,e=>n.flatMap(n.tryPromise({try:()=>t.read(new Uint8Array(s,e,s.byteLength-e)),catch:e=>a(e)}),({done:t,value:i})=>{if(t)return n.fail(r1);let r=e+i.byteLength;return n.succeed([i,r>=s.byteLength?l.none():l.some(r)])})))),e=>e===r1?rb:rE(e))}))},"fromSchedule",0,e=>(0,u.pipe)(A.driver(e),n.map(e=>an(e.next(void 0))),sC),"fromTPubSub",0,e=>{let t,i,r,a,s,l;return sE(n.map(n.acquireRelease((t=e.pubsubSize,i=e.publisherHead,r=e.publisherTail,a=e.requestedCapacity,s=e.subscriberCount,l=e.subscribers,(0,u.pipe)(th(r),e1(e=>{let r,n;return(0,u.pipe)(Symbol.iterator in(r=[eX(t=>{let i=new tc(e);return t.set(i,U(i,!0)),i}),th(s),th(l)])?tn(r,u.identity,n):n?.discard?tn(Object.values(r),u.identity,n):e3(tn(Object.entries(r),([e,t])=>e3(t,t=>[e,t])),e=>{let t={};for(let[i,r]of e)t[i]=r;return t}),tu(([e,t])=>(0,u.pipe)(s,tf(t+1))),tu(([e,t,i])=>(0,u.pipe)(l,tf((0,u.pipe)(i,T.add(e))))),e3(([e])=>new tE(t,i,a,e,s,l)))}))),e=>e.shutdown),e=>rY(e)))},"fromTQueue",0,rY,"groupAdjacentBy",0,r2,"grouped",0,r4,"groupedWithin",0,r7,"haltAfter",0,r8,"haltWhen",0,r3,"haltWhenDeferred",0,r9,"identityStream",0,r6,"interleave",0,r5,"interleaveWith",0,ne,"interruptAfter",0,nr,"interruptWhen",0,nn,"interruptWhenDeferred",0,na,"intersperse",0,nt,"intersperseAffixes",0,ni,"isStream",0,iE,"iterate",0,(e,t)=>sb(e,e=>l.some([e,t(e)])),"let_",0,sX,"make",0,ns,"map",0,nu,"mapAccum",0,nl,"mapAccumEffect",0,no,"mapBoth",0,np,"mapChunks",0,nc,"mapChunksEffect",0,nh,"mapConcat",0,nf,"mapConcatChunk",0,nd,"mapConcatChunkEffect",0,nm,"mapConcatEffect",0,nb,"mapEffectPar",0,ny,"mapEffectSequential",0,ng,"mapError",0,nw,"mapErrorCause",0,nS,"mapInputContext",0,n4,"matchConcurrency",0,rW,"merge",0,nC,"mergeAll",0,nE,"mergeEither",0,nk,"mergeLeft",0,nx,"mergeRight",0,nI,"mergeWith",0,n_,"mergeWithTag",0,nv,"mkString",0,e=>af(e,B.mkString),"never",0,nF,"onDone",0,nR,"onEnd",0,nM,"onError",0,nA,"onStart",0,nz,"orDie",0,e=>(0,u.pipe)(e,nT(u.identity)),"orDieWith",0,nT,"orElse",0,nW,"orElseEither",0,nD,"orElseFail",0,nO,"orElseIfEmpty",0,nP,"orElseIfEmptyChunk",0,nL,"orElseIfEmptyStream",0,nN,"orElseSucceed",0,nB,"paginate",0,(e,t)=>nq(e,e=>{let r=t(e);return[i.of(r[0]),r[1]]}),"paginateChunk",0,nq,"paginateChunkEffect",0,nU,"paginateEffect",0,nj,"partition",0,nQ,"partitionEither",0,nV,"peel",0,nH,"pipeThrough",0,nG,"pipeThroughChannel",0,n$,"pipeThroughChannelOrFail",0,nK,"prepend",0,nJ,"provideContext",0,nX,"provideLayer",0,nY,"provideService",0,n0,"provideServiceEffect",0,n1,"provideServiceStream",0,n2,"provideSomeContext",0,nZ,"provideSomeLayer",0,n7,"race",0,n3,"raceAll",0,n8,"range",0,(e,t,r=iv)=>aX(()=>{if(e>t)return rb;let n=(e,t,r)=>{let a=t-e+1;return a>r?(0,u.pipe)(b.write(i.range(e,e+r-1)),b.flatMap(()=>n(e+r,t,r))):b.write(i.range(e,e+a-1))};return new iC(n(e,t,r))}),"rechunk",0,n9,"refineOrDie",0,ae,"refineOrDieWith",0,at,"repeat",0,ai,"repeatEffect",0,e=>an((0,u.pipe)(e,n.mapError(l.some))),"repeatEffectChunk",0,e=>ar((0,u.pipe)(e,n.mapError(l.some))),"repeatEffectChunkOption",0,ar,"repeatEffectOption",0,an,"repeatEffectWithSchedule",0,ao,"repeatEither",0,aa,"repeatElements",0,as,"repeatElementsWith",0,au,"repeatValue",0,e=>new iC(d.repeated(b.write(i.of(e)))),"repeatWith",0,al,"retry",0,ap,"run",0,af,"runCollect",0,e=>af(e,B.collectAll()),"runCount",0,e=>af(e,B.count),"runDrain",0,ad,"runFold",0,am,"runFoldEffect",0,ab,"runFoldScoped",0,ag,"runFoldScopedEffect",0,ay,"runFoldWhile",0,aw,"runFoldWhileEffect",0,aS,"runFoldWhileScoped",0,aC,"runFoldWhileScopedEffect",0,aE,"runForEach",0,av,"runForEachChunk",0,ak,"runForEachChunkScoped",0,ax,"runForEachScoped",0,aI,"runForEachWhile",0,a_,"runForEachWhileScoped",0,aF,"runHead",0,e=>af(e,B.head()),"runIntoPubSub",0,aM,"runIntoPubSubScoped",0,aA,"runIntoQueue",0,aR,"runIntoQueueElementsScoped",0,az,"runIntoQueueScoped",0,aT,"runLast",0,e=>af(e,B.last()),"runScoped",0,aW,"runSum",0,e=>af(e,B.sum),"scan",0,aD,"scanEffect",0,aB,"scanReduce",0,aO,"scanReduceEffect",0,aP,"schedule",0,aL,"scheduleWith",0,aN,"scoped",0,aq,"scopedWith",0,aU,"share",0,iO,"sliding",0,aQ,"slidingSize",0,aV,"some",0,e=>(0,u.pipe)(e,nw(l.some),aH(()=>l.none())),"someOrElse",0,aj,"someOrFail",0,aH,"split",0,aG,"splitLines",0,e=>n$(e,d.splitLines()),"splitOnChunk",0,a$,"succeed",0,aK,"suspend",0,aX,"sync",0,aJ,"take",0,aZ,"takeRight",0,aY,"takeUntil",0,a0,"takeUntilEffect",0,a1,"takeWhile",0,a2,"tap",0,a4,"tapBoth",0,a7,"tapError",0,a3,"tapErrorCause",0,a8,"tapSink",0,a9,"throttle",0,a6,"throttleEffect",0,a5,"tick",0,e=>{let t,i;return t=void 0,i=A.spaced(e),ao(n.succeed(t),i)},"timeout",0,si,"timeoutFail",0,sr,"timeoutFailCause",0,sn,"timeoutTo",0,sa,"toAsyncIterable",0,e=>sm(e,M.defaultRuntime),"toAsyncIterableEffect",0,e=>n.map(n.runtime(),t=>sm(e,t)),"toAsyncIterableRuntime",0,sm,"toChannel",0,rj,"toPubSub",0,su,"toPull",0,sl,"toQueue",0,so,"toQueueOfElements",0,sp,"toReadableStream",0,sc,"toReadableStreamEffect",0,sh,"toReadableStreamRuntime",0,sf,"transduce",0,sd,"unfold",0,sb,"unfoldChunk",0,sg,"unfoldChunkEffect",0,sy,"unfoldEffect",0,sw,"unwrap",0,sC,"unwrapScoped",0,sE,"unwrapScopedWith",0,sv,"updateService",0,sk,"void",()=>sS,"when",0,sx,"whenCase",0,(e,t)=>sI(t)(n.sync(e)),"whenCaseEffect",0,sI,"whenEffect",0,s_,"withExecutionPlan",0,ac,"withSpan",0,function(){let e="string"!=typeof arguments[0],t=e?arguments[1]:arguments[0],i=iy.addSpanStackTrace(e?arguments[2]:arguments[1]);if(e){let e=arguments[0];return new iC(d.withSpan(rj(e),t,i))}return e=>new iC(d.withSpan(rj(e),t,i))},"zip",0,sF,"zipAll",0,sA,"zipAllLeft",0,sR,"zipAllRight",0,sz,"zipAllSortedByKey",0,sT,"zipAllSortedByKeyLeft",0,sW,"zipAllSortedByKeyRight",0,sD,"zipAllSortedByKeyWith",0,sO,"zipAllWith",0,sP,"zipFlatten",0,sM,"zipLatest",0,sL,"zipLatestAll",0,sN,"zipLatestWith",0,sB,"zipLeft",0,sq,"zipRight",0,sU,"zipWith",0,sj,"zipWithChunks",0,sH,"zipWithIndex",0,e=>(0,u.pipe)(e,nl(0,(e,t)=>[e+1,[t,e]])),"zipWithNext",0,sQ,"zipWithPrevious",0,sV,"zipWithPreviousAndNext",0,e=>(0,u.pipe)(sQ(sV(e)),nu(([[e,t],i])=>[e,t,(0,u.pipe)(i,l.map(e=>e[1]))]))],932915);let s0=Symbol.for("effect/GroupBy"),s1={_R:e=>e,_E:e=>e,_K:e=>e,_V:e=>e},s2=(0,u.dual)(e=>{let t;return t=e[0],(0,p.hasProperty)(t,s0)},(e,t,i)=>rT(e.grouped,([e,i])=>t(e,rB(rZ(i,{shutdown:!0}))),{concurrency:"unbounded",bufferSize:i?.bufferSize??16})),s4=(0,u.dual)(e=>"function"!=typeof e[0],(e,t,i)=>i?.key?s2(s3(e,i.key,{bufferSize:i.bufferSize}),(e,i)=>ng(i,t)):rW(i?.concurrency,()=>ng(e,t),r=>i?.unordered?rT(e,e=>rV(t(e)),{concurrency:r}):ny(e,r,t)));class s7 extends a.Class{dequeue;f;[c.DequeueTypeId]={_Out:e=>e};constructor(e,t){super(),this.dequeue=e,this.f=t}capacity(){return c.capacity(this.dequeue)}get size(){return c.size(this.dequeue)}unsafeSize(){return this.dequeue.unsafeSize()}get awaitShutdown(){return c.awaitShutdown(this.dequeue)}isActive(){return this.dequeue.isActive()}get isShutdown(){return c.isShutdown(this.dequeue)}get shutdown(){return c.shutdown(this.dequeue)}get isFull(){return c.isFull(this.dequeue)}get isEmpty(){return c.isEmpty(this.dequeue)}get take(){return(0,u.pipe)(c.take(this.dequeue),n.map(e=>this.f(e)))}get takeAll(){return(0,u.pipe)(c.takeAll(this.dequeue),n.map(i.map(e=>this.f(e))))}takeUpTo(e){return(0,u.pipe)(c.takeUpTo(this.dequeue,e),n.map(i.map(e=>this.f(e))))}takeBetween(e,t){return(0,u.pipe)(c.takeBetween(this.dequeue,e,t),n.map(i.map(e=>this.f(e))))}takeN(e){return(0,u.pipe)(c.takeN(this.dequeue,e),n.map(i.map(e=>this.f(e))))}poll(){return(0,u.pipe)(c.poll(this.dequeue),n.map(l.map(e=>this.f(e))))}pipe(){return(0,o.pipeArguments)(this,arguments)}commit(){return this.take}}let s3=(0,u.dual)(e=>"function"!=typeof e[0],(e,i,r)=>{let a=(e,s)=>b.readWithCause({onInput:o=>b.flatMap(b.fromEffect(n.forEach(s8(o,i),([i,a])=>{let o=e.get(i);return void 0===o?(0,u.pipe)(c.bounded(r?.bufferSize??16),n.flatMap(r=>(0,u.pipe)(n.sync(()=>{e.set(i,r)}),n.zipRight(c.offer(s,t4([i,r]))),n.zipRight((0,u.pipe)(c.offer(r,tX(a)),n.catchSomeCause(e=>t.isInterruptedOnly(e)?l.some(n.void):l.none())))))):n.catchSomeCause(c.offer(o,tX(a)),e=>t.isInterruptedOnly(e)?l.some(n.void):l.none())},{discard:!0})),()=>a(e,s)),onFailure:e=>b.fromEffect(c.offer(s,t0(e))),onDone:()=>b.fromEffect((0,u.pipe)(n.forEach(e.entries(),([e,i])=>(0,u.pipe)(c.offer(i,tY),n.catchSomeCause(e=>t.isInterruptedOnly(e)?l.some(n.void):l.none())),{discard:!0}),n.zipRight(c.offer(s,tY))))});return{[s0]:s1,pipe(){return(0,o.pipeArguments)(this,arguments)},grouped:sv(t=>n.gen(function*(){let i=new Map,r=yield*c.unbounded();return yield*f.addFinalizer(t,c.shutdown(r)),yield*rj(e).pipe(b.pipeTo(a(i,r)),d.drain,m.runIn(t),n.forkIn(t),n.as(rB(rZ(r,{shutdown:!0}))))}))}}),s8=(0,u.dual)(2,(e,t)=>{let r,n=[],a=e[Symbol.iterator](),s=new Map;for(;(r=a.next())&&!r.done;){let e=r.value,i=t(e);if(s.has(i))s.get(i).push(e);else{let t=[e];n.push([i,t]),s.set(i,t)}}return i.unsafeFromArray(n.map(e=>[e[0],i.unsafeFromArray(e[1])]))});e.s(["StreamTypeId",0,iw,"async",()=>iR,"bufferChunks",0,iB,"catchAll",0,iG,"concat",0,i8,"die",0,ri,"encodeText",0,sY,"ensuring",0,rg,"fail",0,rE,"failCause",0,rk,"filter",0,rx,"flatMap",0,rT,"fromChannel",0,rU,"fromChunk",0,rH,"fromIterable",0,rK,"fromQueue",0,rZ,"fromReadableStream",0,r0,"map",0,nu,"mapChunksEffect",0,nh,"mapEffect",0,s4,"mapError",0,nw,"pipeThroughChannel",0,n$,"provideContext",0,nX,"provideSomeContext",0,nZ,"run",0,af,"runDrain",0,ad,"runForEach",0,av,"runForEachChunk",0,ak,"succeed",0,aK,"suspend",0,aX,"tap",0,a4,"toChannel",0,rj,"toReadableStreamEffect",0,sh,"toReadableStreamRuntime",0,sf,"unwrap",0,sC,"unwrapScoped",0,sE],788339);var s9=a,s6=e.i(643284),s5=e.i(576914);e.i(519479),e.i(916142);let ue=Symbol.for("effect/Mailbox"),ut=Symbol.for("effect/Mailbox/ReadonlyMailbox"),ui=i.empty(),ur=O.exitSucceed(ui),un=O.exitSucceed(!1),ua=O.exitSucceed(!0),us=[ui,!0];class uu extends s9.Class{scheduler;capacity;strategy;[ue]=ue;[ut]=ut;state={_tag:"Open",takers:new Set,offers:new Set,awaiters:new Set};messages=[];messagesChunk=i.empty();constructor(e,t,i){super(),this.scheduler=e,this.capacity=t,this.strategy=i}offer(e){return O.suspend(()=>{if("Open"!==this.state._tag)return un;if(this.messages.length+this.messagesChunk.length>=this.capacity)switch(this.strategy){case"dropping":return un;case"suspend":if(this.capacity<=0&&this.state.takers.size>0)return this.messages.push(e),this.releaseTaker(),ua;return this.offerRemainingSingle(e);case"sliding":return this.unsafeTake(),this.messages.push(e),ua}return this.messages.push(e),this.scheduleReleaseTaker(),ua})}unsafeOffer(e){return"Open"===this.state._tag&&(this.messages.length+this.messagesChunk.length>=this.capacity?"sliding"===this.strategy?(this.unsafeTake(),this.messages.push(e),!0):this.capacity<=0&&this.state.takers.size>0&&(this.messages.push(e),this.releaseTaker(),!0):(this.messages.push(e),this.scheduleReleaseTaker(),!0))}offerAll(e){return O.suspend(()=>{if("Open"!==this.state._tag)return O.succeed(i.fromIterable(e));let t=this.unsafeOfferAllArray(e);return 0===t.length?ur:"dropping"===this.strategy?O.succeed(i.unsafeFromArray(t)):this.offerRemainingArray(t)})}unsafeOfferAll(e){return i.unsafeFromArray(this.unsafeOfferAllArray(e))}unsafeOfferAllArray(e){if("Open"!==this.state._tag)return z.fromIterable(e);if(this.capacity===1/0||"sliding"===this.strategy)return this.messages.length>0&&(this.messagesChunk=i.appendAll(this.messagesChunk,i.unsafeFromArray(this.messages))),"sliding"===this.strategy?this.messagesChunk=this.messagesChunk.pipe(i.appendAll(i.fromIterable(e)),i.takeRight(this.capacity)):i.isChunk(e)?this.messagesChunk=i.appendAll(this.messagesChunk,e):this.messages=z.fromIterable(e),this.scheduleReleaseTaker(),[];let t=this.capacity<=0?this.state.takers.size:this.capacity-this.messages.length-this.messagesChunk.length;if(0===t)return z.fromIterable(e);let r=[],n=0;for(let i of e)n<t?this.messages.push(i):r.push(i),n++;return this.scheduleReleaseTaker(),r}fail(e){return this.done(O.exitFail(e))}failCause(e){return this.done(O.exitFailCause(e))}unsafeDone(e){return"Open"===this.state._tag&&(0===this.state.offers.size&&0===this.messages.length&&0===this.messagesChunk.length?this.finalize(e):this.state={...this.state,_tag:"Closing",exit:e},!0)}shutdown=O.sync(()=>{if("Done"===this.state._tag)return!0;this.messages=[],this.messagesChunk=ui;let e=this.state.offers;if(this.finalize("Open"===this.state._tag?O.exitVoid:this.state.exit),e.size>0){for(let t of e)"Single"===t._tag?t.resume(un):t.resume(O.exitSucceed(i.unsafeFromArray(t.remaining.slice(t.offset))));e.clear()}return!0});done(e){return O.sync(()=>this.unsafeDone(e))}end=this.done(O.exitVoid);clear=O.suspend(()=>{if("Done"===this.state._tag)return O.exitAs(this.state.exit,ui);let e=this.unsafeTakeAll();return this.releaseCapacity(),O.succeed(e)});takeAll=O.suspend(()=>{if("Done"===this.state._tag)return O.exitAs(this.state.exit,us);let e=this.unsafeTakeAll();return 0===e.length?O.zipRight(this.awaitTake,this.takeAll):O.succeed([e,this.releaseCapacity()])});takeN(e){return O.suspend(()=>{let t;if("Done"===this.state._tag)return O.exitAs(this.state.exit,us);if(e<=0)return O.succeed([ui,!1]);if((e=Math.min(e,this.capacity))<=this.messagesChunk.length)t=i.take(this.messagesChunk,e),this.messagesChunk=i.drop(this.messagesChunk,e);else{if(!(e<=this.messages.length+this.messagesChunk.length))return O.zipRight(this.awaitTake,this.takeN(e));this.messagesChunk=i.appendAll(this.messagesChunk,i.unsafeFromArray(this.messages)),this.messages=[],t=i.take(this.messagesChunk,e),this.messagesChunk=i.drop(this.messagesChunk,e)}return O.succeed([t,this.releaseCapacity()])})}unsafeTake(){let e;if("Done"===this.state._tag)return O.exitZipRight(this.state.exit,O.exitFail(new t.NoSuchElementException));if(this.messagesChunk.length>0)e=i.unsafeHead(this.messagesChunk),this.messagesChunk=i.drop(this.messagesChunk,1);else if(this.messages.length>0)e=this.messages[0],this.messagesChunk=i.drop(i.unsafeFromArray(this.messages),1),this.messages=[];else if(this.capacity<=0&&this.state.offers.size>0)return this.capacity=1,this.releaseCapacity(),this.capacity=0,this.messages.length>0?O.exitSucceed(this.messages.pop()):void 0;else return;return this.releaseCapacity(),O.exitSucceed(e)}take=O.suspend(()=>this.unsafeTake()??O.zipRight(this.awaitTake,this.take));await=O.asyncInterrupt(e=>"Done"===this.state._tag?e(this.state.exit):(this.state.awaiters.add(e),O.sync(()=>{"Done"!==this.state._tag&&this.state.awaiters.delete(e)})));unsafeSize(){let e=this.messages.length+this.messagesChunk.length;return"Done"===this.state._tag?l.none():l.some(e)}size=O.sync(()=>this.unsafeSize());commit(){return this.takeAll}pipe(){return(0,o.pipeArguments)(this,arguments)}toJSON(){return{_id:"effect/Mailbox",state:this.state._tag,size:this.unsafeSize().toJSON()}}toString(){return s6.format(this)}[s6.NodeInspectSymbol](){return s6.format(this)}offerRemainingSingle(e){return O.asyncInterrupt(t=>{if("Open"!==this.state._tag)return t(un);let i={_tag:"Single",message:e,resume:t};return this.state.offers.add(i),O.sync(()=>{"Open"===this.state._tag&&this.state.offers.delete(i)})})}offerRemainingArray(e){return O.asyncInterrupt(t=>{if("Open"!==this.state._tag)return t(O.exitSucceed(i.unsafeFromArray(e)));let r={_tag:"Array",remaining:e,offset:0,resume:t};return this.state.offers.add(r),O.sync(()=>{"Open"===this.state._tag&&this.state.offers.delete(r)})})}releaseCapacity(){if("Done"===this.state._tag)return"Success"===this.state.exit._tag;if(0===this.state.offers.size)return"Closing"===this.state._tag&&0===this.messages.length&&0===this.messagesChunk.length&&(this.finalize(this.state.exit),"Success"===this.state.exit._tag);let e=this.capacity-this.messages.length-this.messagesChunk.length;for(let t of this.state.offers)if(0===e)break;else if("Single"===t._tag)this.messages.push(t.message),e--,t.resume(ua),this.state.offers.delete(t);else{for(;t.offset<t.remaining.length;t.offset++){if(0===e)return!1;this.messages.push(t.remaining[t.offset]),e--}t.resume(ur),this.state.offers.delete(t)}return!1}awaitTake=O.asyncInterrupt(e=>"Done"===this.state._tag?e(this.state.exit):(this.state.takers.add(e),O.sync(()=>{"Done"!==this.state._tag&&this.state.takers.delete(e)})));scheduleRunning=!1;scheduleReleaseTaker(){this.scheduleRunning||(this.scheduleRunning=!0,this.scheduler.scheduleTask(this.releaseTaker,0))}releaseTaker=()=>{if(this.scheduleRunning=!1,"Done"===this.state._tag||0===this.state.takers.size)return;let e=s5.unsafeHead(this.state.takers);this.state.takers.delete(e),e(O.exitVoid)};unsafeTakeAll(){if(this.messagesChunk.length>0){let e=this.messages.length>0?i.appendAll(this.messagesChunk,i.unsafeFromArray(this.messages)):this.messagesChunk;return this.messagesChunk=ui,this.messages=[],e}if(this.messages.length>0){let e=i.unsafeFromArray(this.messages);return this.messages=[],e}return"Done"!==this.state._tag&&this.state.offers.size>0?(this.capacity=1,this.releaseCapacity(),this.capacity=0,i.of(this.messages.pop())):ui}finalize(e){if("Done"===this.state._tag)return;let t=this.state;for(let i of(this.state={_tag:"Done",exit:e},t.takers))i(e);for(let i of(t.takers.clear(),t.awaiters))i(e);t.awaiters.clear()}}let ul=(0,u.dual)(2,(e,t)=>O.uninterruptibleMask(i=>O.matchCauseEffect(i(e),{onFailure:e=>t.failCause(e),onSuccess:e=>t.end}))),uo=e=>{let t=b.flatMap(e.takeAll,([e,i])=>i?0===e.length?b.void:b.write(e):d.zipRight(b.write(e),t));return t};e.s(["into",0,ul,"isMailbox",0,e=>(0,p.hasProperty)(e,ue),"make",0,e=>O.withFiberRuntime(t=>O.succeed(new uu(t.currentScheduler,"number"==typeof e?e:e?.capacity??1/0,"number"==typeof e?"suspend":e?.strategy??"suspend"))),"toChannel",0,uo,"toStream",0,e=>rU(uo(e))],167256)}]);